      SUBROUTINE GLOOPR
CFPP$ EXPAND(ZNLACM,ACCDIA)
C..     ************************************************************
C..     *  ADDED ACCUMULATION OF CLDS AND CONVECTIVE CLOUD IN DG3  *
C..     *                                        K.A.C SEPT 1994   *
C..     *  F3D ADDED FOR CLOUDS..MI NEW CODE=F94/SOURCE2/DIAGNEW   *
C..     *                               B KATZ + K.A.C OCT  1994   *
C..     *  CHANGED  H,M,L CALCULATION IN CLDJMS (REMOVED FACV)     *
C..     *     AND ADDED PROPER TOTAL CLOUD CALCULATION             *
C..     *  CHANGED AVECLD CALC IN CLDIAG (USED CLDARY) AND         *
C..     *     USED TOTAL CLOUD CALCULATED IN CLDJMS                *
C..     *  CHANGED KENPTS TO STORE TOTAL CLOUD AND ALL LYRS        *
C..     *     OF CLOUD......                                       *
C..     *                                         K.A.C. NOV94     *
C..     *  INTERPOLATE O3 PROFILE TO EACH GRIDPOINT, IE USE        *
C..     *     PROPER SURFACE PRESSURE                              *
C..     *                                         K.A.C. DEC94     *
C..     *  FIX PL1 FOR OPERATIONS, WHERE DGZ IS ON AND DG3 IS OFF, *
C..     *     ....NOTE DG IS ON IF EITHER DGZ OR DG3 IS ON         *
C..     *                                         K.A.C. JAN94     *
C..     ************************************************************
C
C        UPDATES MADE TO ADD OCEANIC STRATUS AND TO FIX CONV CLOUD..
C                     TO GLOOPR - IVV(2),IBL ARE SET=1....
C                     TO GLOOPR - SET MIN Q TO 1.E-10,RATHER THAN 1.E-6
C                                 TO ANTICIPATE AVOIDING CLD CREATION
C                                 IN EXTREMELY DRY,COLD (WINTER) REGIONS
C                                 WHERE 1.E-6 COULD IMPLY HI VALU OF RH
C                     TO CLDJMS - MULTITUDE OF CHANGES
C        UPDATES MADE TO FIX THE H2D,H3D FILES...KAC AUG 90...
C        UPDATES MADE TO GLOOPR - CALL WRTH2D BEFORE WRTRAD (SO CTOP OK)
C                     TO GLOOPR - SEND WORK ARRAY TO WRTH3D
C                     TO WRTH3D - TO WRITE PROPER LAYERS OF HEAT..
C                                 (IN WRTRAD)
C        UPDATES MADE TO ADD GRID POINT DIAGNOSTICS ..K.A.C...SEP 91
C                     TO GLOOPR -
C        UPDATES MADE TO FIX SW APPROX              ..K.A.C...NOV 91
C                     TO COSZMN
C        UPDATES MADE TO PASS AND RECEIVE SIB DATA  ..K.A.C...MAR 92
C                     TO GLOOPR -
C        UPDATES MADE TO FIX SW RAD DIAGNOSTICS     ..K.A.C...JUN 92
C                     PROPER DIURNAL WEIGHTING
C                     TO GLOOPR AND COSZMN
C        UPDATES MADE TO CALCULATE CLEAR-SKY "ON-THE-FLY" KAC AUG 92
C                     TO GLOOPR,RADFS,FST,SPA,LWR,SWR
C                     ...FOR CLOUD FORCING....
CYH93...
C        UPDATES MADE FOR THE COMPLETELY NEW CLOUD ROUTINE (CLDJMS),USE
C                     FLAG IVVA TO CONTROL VERTICAL VELOCITY ADJ.
C                     FOR LOW CLD (=0: WITHOUT,  =1: WITH)
CYH94  NOT            USE FLAG IEMIS TO CONTROL CLD EMISS. SCHEME
CYH94  NOT            (=0: ORIG. SCHEME, =1: TEMP. DEP. SCHEME.)
C                     USE FLAG INVR TO CONTROL LAPSE RATE INVERSION
C                     TYPE OF CLD (=0: WITHOUT,  =1: WITH)
C                     TO GLOOPR AND RADFS ...Y.H.           ...DEC92
C        UPDATES MADE TO CALL CLD OPTICAL PROPERTY ROUTINE (CLDPRP),
C                     TO GIVE CLD EMISSIVITY, OPTICAL DEPTH, LAYER
C                     REFLECTANCE AND TRANSMITANCE
C                     TO GLOOPR AND RADFS ...Y.H.           ...FEB93
CYH94                 CLDPRP CALLED FROM RADFS...   Y.H.    ...FEB94
CTUNE
C       UPDATES MADE TO ALLOW TUNED CLD-RH DATA TO BE USED..CTUNE
C                   TO GLOOPR AND CLDJMS          ..K.A.C...DEC 92
C                   SPATIAL INTERPOLATION OF TABLES ........MAY93
C                   USE ONLY 1 SET OF TUNING TABLES FOR ALL FCST HRS,
C                    THE TUNING OF THE 24HR FCST       .....JAN94
C                    OLD CODE USED 6 TABLES..SEE CKC94 .....FEB94
C                   SINCE TUNING DONE FOR H,M,L CLD, VERTICALLY
C                    BLEND THE RELATIONS AT OLD HML BDRIES..JAN94
C        UPDATES MADE TO CHANGE DEFINITION OF H,M,L DOMAINS..
C          TO GLOOPR,GCLJMS,CLDJMS, CLDPRP   K.A.C...DEC92 + AUG93
CYH94         TO GLOOPR, CLDJMS, CLDPRP      K.A.C...JAN94
CYH94         TO CLDJMS..  CVTOP = KCVT (NOT KCVT+1)
CYH94                    AND TO ISTRAT=1 PART...NEW STRATUS +
CYH94                  ..NO CLOUD BELOW LLYRL..  K.A.C...MAR94
CYH94                  ..CHANGES TO CLDPRP.........Y.H...MAR94
CTUNE
CYH93...
CHL95      MODIFIED TO ALLOW MORE FREQUENT COMPUTATION OF SHORTWAVE FLUX
CHL95      ASSUME THAT DTSWAV <= DTLWAV!!!!!.....H.-L. PAN JUL95
C---
C     PARAMETER SETTINGS FOR THE LONGWAVE AND SHORTWAVE RADIATION CODE:
C          IMAX   =  NO. POINTS ALONG THE LAT. CIRCLE USED IN CALCS.
C          L      =  NO. VERTICAL LEVELS (ALSO LAYERS) IN MODEL
C***NOTE: THE USER NORMALLY WILL MODIFY ONLY THE IMAX AND L PARAMETERS
C          NBLW   =  NO. FREQ. BANDS FOR APPROX COMPUTATIONS. SEE
C                      BANDTA FOR DEFINITION
C          NBLX   =  NO. FREQ BANDS FOR APPROX CTS COMPUTATIONS
C          NBLY   =  NO. FREQ. BANDS FOR EXACT CTS COMPUTATIONS. SEE
C                      BDCOMB FOR DEFINITION
C          INLTE  =  NO. LEVELS USED FOR NLTE CALCS.
C          NNLTE  =  INDEX NO. OF FREQ. BAND IN NLTE CALCS.
C          NB,KO2 ARE SHORTWAVE PARAMETERS; OTHER QUANTITIES ARE DERIVED
C                    FROM THE ABOVE PARAMETERS.
      PARAMETER (L= 28 )
      PARAMETER (IMAX= 64 )
      PARAMETER (IMBX=IMAX+1)
      PARAMETER (NBLW=163,NBLX=47,NBLY=15)
      PARAMETER (NBLM=NBLY-1)
      PARAMETER (LP1=L+1,LP2=L+2,LP3=L+3)
      PARAMETER (LM1=L-1,LM2=L-2,LM3=L-3)
      PARAMETER (LL=2*L,LLP1=LL+1,LLP2=LL+2,LLP3=LL+3)
      PARAMETER (LLM1=LL-1,LLM2=LL-2,LLM3=LL-3)
      PARAMETER (LP1M=LP1*LP1,LP1M1=LP1M-1)
      PARAMETER (LP1V=LP1*(1+2*L/2))
      PARAMETER (LP121=LP1*NBLY)
      PARAMETER (LL3P=3*L+2)
      PARAMETER (NB=12)
      PARAMETER (INLTE=3,INLTEP=INLTE+1,NNLTE=56)
      PARAMETER (NB1=NB-1)
      PARAMETER (KO2=12)
      PARAMETER (KO21=KO2+1,KO2M=KO2-1)
CTUNE
CKC94 PARAMETER (MCLD=3,NSEAL=2,NBIN=100,NLON=2,NLAT=4,IDA=6)
      PARAMETER (MCLD=3,NSEAL=2,NBIN=100,NLON=2,NLAT=4)
CTUNE
      PARAMETER(NRM=23,NRS=32)
      PARAMETER(NLB=6,NST=6)
      PARAMETER(NMU=1,NMV=2,NMTV=3,NMQ=4,NMVOT2=5,
     &          NMDIV2=6,NMOMEGA=7,NMT=8,NMRH=9,NMKE=10,
     &          NMTCONV=11,NMTLARG=12,NMTSHAL=13,NMTVRDF=14,NMQCONV=15,
     &          NMQSHAL=16,NMQVRDF=17,NMUVRDF=18,NMVVRDF=19,NMTHSW=20,
     &          NMTHLW=21,NMTCLD=22,NMTCCV=23)
      PARAMETER(NSRAIN=1,NSRAINC=2,NSTSFC=3,NSQSFC=4,NSUSFC=5,
     &          NSVSFC=6,NSRCOV=7,NSRCOVC=8,NSPS=9,NSTSKIN=10,
     &          NSWET=11,NSSNOW=12,NSTG1=13,NSTG2=14,NSTG3=15,
     &          NSSFCSW=16,NSSFCLW=17,NSRHS=18,NSTVS=19,NSTS=20,
     &          NSQS=21,NSZORL=22,NSSLMSK=23,NSUGWD=24,NSVGWD=25,
     &          NSUASFC=26,NSUAGWD=27,NSUAMTN=28,NSUA=29,NSUAP=30,
     &          NSEP=31,NSCLDWRK=32)
      COMMON /COMZNL/ ZDM(2, 28 ,NRM, 47 ),ZWM(2, 47 ),ZHM(NRM)
      COMMON /COMZNL/ ZDS(2,NST,NRS, 47 ),ZWS(2,NST, 47 )
C  DIAGNOSTIC INDEXES AND FLAGS
C-DG3 PARAMETER(KDGDA=13)
C-DG3 PARAMETER(KDTLARG=1,KDTCONV=2,KDQCONV=3,KDTSHAL=4,KDQSHAL=5,
C-DG3&          KDTVRDF=6,KDUVRDF=7,KDVVRDF=8,KDQVRDF=9,
C-DG3&          KDTHSW=10,KDTHLW=11,KDTCLD=12,KDTCCV=13)
C-DG3 CHARACTER*8 CNMGDA
C-DG3 COMMON /COMGDC/ CNMGDA(KDGDA)
C-DG3 PARAMETER(NTGDA=92)
C-DG3 PARAMETER(NWGDA=(( 384 * 28 -1)/512+1)*512)
C-DG3 PARAMETER(NRGDA= 47 )
C-DG3 COMMON /COMGDA/ IPUGDA(KDGDA),IBMGDA(KDGDA)
C-DGM COMMON /COMGDD/ GDD(NWGDA*KDGDA*NRGDA)
C-DG3 DIMENSION GDA(NWGDA,KDGDA,NCLDB1)
C...
C...
C    VERSION WITH STACKED TRANSFORMS
C....
C.................................................................
C................BEGIN comfspec...................................
C....
       COMMON /comfspec/ IDATE(4),RELVOR( 28 ),ABSVOR( 28 ),
     1 EPS( 4032 ),EPSI( 4032 ),GZ( 4033 )
       COMMON /comfspec/
     *    ZEM    ( 4033 , 28 ),
     *    DIM    ( 4033 , 28 ),
     *    TEM    ( 4033 , 28 ),
     *    RM     ( 4033 , 28 ),
     *    QM     ( 4033 )
       COMMON /comfspec/
     *    ZE     ( 4033 , 28 ),
     *    DI     ( 4033 , 28 ),
     *    TE     ( 4033 , 28 ),
     *    RQ     ( 4033 , 28 ),
     *    DPDLAM ( 4033 ),
     *    DPDPHI ( 4033 ),
     *    ULN    ( 4033 , 28 ),
     *    VLN    ( 4033 , 28 ),
     *    Q      ( 4033 )
       COMMON /comfspec/
     *    X      ( 4033 , 28 ),
     *    Y      ( 4033 , 28 ),
     *    RT     ( 4033 , 28 ),
     *    Z      ( 4033 ),
     *    W      ( 4033 , 28 )
C.................................................................
C................sof   comfspec...................................
C....
C.................................................................
C................BEGIN comfgrid...................................
C....
       COMMON /comfgrid/
     * COLRAD( 47 ),WGT( 47 ),WGTCS( 47 ),RCS2( 47 ),
     * COLRAB( 47 ),WGB( 47 ),WGBCS( 47 ),RBS2( 47 ),
     * SINLAT( 47 ),
     * SINLAB( 384 , 47 ),COSLAB( 384 , 47 )
C.................................................................
C................sof   comfgrid...................................
C....
C.................................................................
C................BEGIN comfphys ..................................
C....
      COMMON /comfphys/SLMSK( 384 , 47 ),HPRIME( 384 , 47 ),
     * SWH( 384 , 28 , 47 ),HLW( 384 , 28 , 47 ),
     * SFCNSW( 384 , 47 ),SFCDLW( 384 , 47 ),
     * COSZEN( 384 , 47 ),XLON( 384 , 47 ),
     * SDEC,CDEC,SLAG,SOLHR,CLSTP,LASTEP,
     * CV( 384 , 47 ),CVT( 384 , 47 ),CVB( 384 , 47 ),
     * ALBEDO( 384 , 47 ),TSFLW( 384 , 47 ),
     *       DUSFC( 384 , 47 ), DVSFC( 384 , 47 ),
     *       DTSFC( 384 , 47 ), DQSFC( 384 , 47 ),
     *      DLWSFC( 384 , 47 ),ULWSFC( 384 , 47 ),
     *GESHEM( 384 , 47 ),TSEA( 384 , 47 ),F10M( 384 , 47 ),
     *       DUGWD( 384 , 47 ),DVGWD( 384 , 47 ),
     *       U10M( 384 , 47 ),V10M( 384 , 47 ),
     *       T2M( 384 , 47 ),Q2M( 384 , 47 ),
     *       PSURF( 384 , 47 ),PSMEAN( 384 , 47 ),
     *TG3( 384 , 47 ),ZORL( 384 , 47 ),PLANTR( 384 , 47 ),
     *        SHELEG( 384 , 47 ),BENGSH( 384 , 47 ),
     *        GFLUX( 384 , 47 ),SLRAD( 384 ),
     *        SMC( 384 , 47 , 2 ),STC( 384 , 47 , 2 ),
     *        CANOPY( 384 , 47 ),RUNOFF( 384 , 47 ),
     *        TMPMAX( 384 , 47 ),TMPMIN( 384 , 47 ),
     *        EP( 384 , 47 ),CLDWRK( 384 , 47 ),
     *        HPBL( 384 , 47 ),PWAT( 384 , 47 )
      LOGICAL LASTEP
C.................................................................
C................sof   comfphys ..................................
C....
C....
C....
C.....BEGIN comfver...............................................
      COMMON/comfver/AM( 28 , 28 ),HM( 28 , 28 ),TM( 28 , 28 ),
     O               BM( 28 , 28 ),CM( 28 , 28 ),SPDMAX( 28 ),
     1 SI( 29 ),SL( 28 ),DEL( 28 ),RDEL2( 28 ),RMSDOT( 27 ),
     2 CI( 29 ),CL( 28 ),TOV( 28 ),GV( 28 ),SV( 28 ),RPI( 27 ),
     3 P1( 28 ),P2( 28 ), H1( 28 ),   H2( 28 ),RPIREC( 27 ),
     8   THOUR,DELTIM,KDT,INISTP,SL1,Z00,FHOUR,SHOUR,LIMLOW,DTCVAV,
     9   NFLIP,NFLOP,NR2DDA,FILTA,FILTB,DK,TK,PERCUT,DTSWAV,DTLWAV,
     X   COWAVE,DTWAVE,N50UFL,NUMSUM,NUMMAX,NCPUS,NCPUS1,NCLDB1
C.....sof   comfver...............................................
C....
C....
      COMMON /RADIAG/ FLUXR( 256 , 31 ,26)
C     EQUIVALENCE (FFLWUP(1,1),FLUXR(1,1,1)),(FFSWUP(1,1),FLUXR(1,1,2)),
C    1            (FSSWUP(1,1),FLUXR(1,1,3)),(FSSWDN(1,1),FLUXR(1,1,4)),
C    2            (CCHI  (1,1),FLUXR(1,1,5)),(CCMID (1,1),FLUXR(1,1,6)),
C    3            (CCLO  (1,1),FLUXR(1,1,7)),(CTPH  (1,1),FLUXR(1,1,8)),
C    4         (CTPM  (1,1),FLUXR(1,1,9)), (CTPL  (1,1),FLUXR(1,1,10)),
C    5         (CBTH  (1,1),FLUXR(1,1,11)),(CBTM  (1,1),FLUXR(1,1,12)),
C    6         (CBTL  (1,1),FLUXR(1,1,13)),(CTHTMP(1,1),FLUXR(1,1,14)),
C    7         (CTMTMP(1,1),FLUXR(1,1,15)),(CTLTMP(1,1),FLUXR(1,1,16)),
C    8         (ALBDO (1,1),FLUXR(1,1,17)),(FFSWDN(1,1),FLUXR(1,1,18)),
C    9         (SLWDN (1,1),FLUXR(1,1,19)),(SLWUP (1,1),FLUXR(1,1,20)),
C    1         (FLWUPC(1,1),FLUXR(1,1,21)),(FSWUPC(1,1),FLUXR(1,1,22)),
C    2         (SSWDNC(1,1),FLUXR(1,1,23)),(SSWUPC(1,1),FLUXR(1,1,24)),
C    3         (SLWDNC(1,1),FLUXR(1,1,25)),(TOTALC(1,1),FLUXR(1,1,26))
      COMMON /RADIAG/ CVAVG( 384 , 47 )
      COMMON /RADIAG/ ILEFT( 384 ),IRGHT( 384 ),WGTLON( 384 )
      COMMON /RADIAG/ INSLAT( 47 ),WGTLAT( 47 )
C.............................................................
C....
C....
      SAVE  SOLC,RSIN1,RCOS1,RCOS2
C....
      COMMON /VERCON/ ROTSIN,ROTCOS,SEADRY,SL1KAP,C1,C2,RLRV,SL100K
C....
      INTEGER SEASON
      COMMON   /DIUCON/
     2   SEASON,           FCSTDA,
     3   JTYME(5),           DAZ(12),            JDNMC,
     4   FJDNMC,             TSLAG,              RLAG,
     5   TIMIN,              TPI,                HPI,
     6   YEAR,               DAY,                DHR,
     7   IXXXX
C
      COMMON /TABLES/  SC
C....
      DIMENSION COSZER( 256 , 31 ),COSZDG( 256 , 31 )
C...
      COMMON /SHRCOM/
     * COLRAR( 31 ),WGR( 31 ),WGRCS( 31 ),RRS2( 31 )
      COMMON /SHRCOM/ SINLAR( 256 , 31 ),COSLAR( 256 , 31 )
C...
C.............................................................
      COMMON /SHRCOM/ ALBEDR( 256 , 31 ),SLMSKR( 256 , 31 )
      COMMON /SHRCOM/ RLON( 256 , 31 ),RLAT( 256 , 31 )
C....
      DIMENSION AVECLD( 28 , 62 ),CLDL(4, 62 ),CLDSIG( 28 ,18)
      DIMENSION AVECV(3, 62 ),ZONHT( 28 , 62 )
C....
      COMMON /SHRCOM/ ILEFTR( 256 ),IRGHTR( 256 ),WGRLON( 256 )
      COMMON /SHRCOM/ INRLAT( 31 ),WGRLAT( 31 )
C....
      COMMON /SHRCOM/ JSNO,JMAXP1,IPOINT,JPOINT,
     1              RADDT,IUNCO2,KCCO2,ITIMSW,ITIMLW
      COMMON /SHRCOM/ IYR,IMON,IDAY,IZTIM,IHR,LGTH,IND,KDIMP1,KYEAR,
     1                JD,FJD,IFJD,DLT,     MUNTH,IM,ID,IYEAR
      COMMON /SHRCOM/ R1,ALF,XMIN,RUNRAD
      LOGICAL RUNRAD
CSIB  .. ALBEDOES FROM SIB PARAMETERIZATION...NEEDED FOR SW RAD
C     ..   THEY NEED TO BE INTERPOLATED FROM FCST TO RADIATION GRID
C-SIB COMMON/SIB/ ALVBF( 384 , 47 ),ALNBF( 384 , 47 ),
C-SIB1            ALVDF( 384 , 47 ),ALNDF( 384 , 47 )
C...... DOWNWARD SW FLUXES FROM SW RAD..FOR SIB PARAMETERIZATION
C     ..   THEY NEED TO BE INTERPOLATED FROM RADIATION TO FCST GRID
C-SIB COMMON/SIB/ GDFVBF( 384 , 47 ),GDFNBF( 384 , 47 ),
C-SIB1            GDFVDF( 384 , 47 ),GDFNDF( 384 , 47 )
CSIB
C....
CYH93 DIMENSION EMIS( 256 )
C....   CLDARY CONTAINS MULTI LAYERS OF CLOUD
CYH94 DIMENSION CLSTR( 256 ,NCPUS)
      DIMENSION CLDTOT( 256 , 28 ,NCPUS1),CLDCNV( 256 , 28 ,NCPUS1)
      DIMENSION SFCP( 256 ,NCPUS1)
      DIMENSION CLDT( 384 , 28 ,NCLDB1),CLCV( 384 , 28 ,NCLDB1)
      DIMENSION SFCPR( 384 ,NCLDB1)
      DIMENSION WORKF( 384 ,10),IWORKF( 384 )
CYH94 DIMENSION EMIS0( 256 ,3,NCPUS),TAUC0( 256 ,3,NCPUS)
CYH93...
C.................................................................
C SYN(1, 0* 28 +0* 28 +1, LAN)  DI
C SYN(1, 1* 28 +0* 28 +1, LAN)  TE
C SYN(1, 2* 28 +0* 28 +1, LAN)  RQ
C SYN(1, 2* 28 +1* 28 +1, LAN)  DPDLAM
C SYN(1, 2* 28 +1* 28 +2, LAN)  DPDPHI
C SYN(1, 2* 28 +1* 28 +3, LAN)  ULN
C SYN(1, 3* 28 +1* 28 +3, LAN)  VLN
C SYN(1, 4* 28 +1* 28 +3, LAN)  Q
C.................................................................
      PARAMETER(LOTS    =4* 28 +1* 28 +3,LOTST=2* 28 +1,
     &          KSD     =0* 28 +0* 28 +1,
     &          KST     =1* 28 +0* 28 +1,
     &          KSR     =2* 28 +0* 28 +1,
     &          KSPLAM  =2* 28 +1* 28 +1,
     &          KSPPHI  =2* 28 +1* 28 +2,KSTB=2* 28 +1* 28 +2,
     &          KSU     =2* 28 +1* 28 +3,
     &          KSV     =3* 28 +1* 28 +3,
     &          KSP     =4* 28 +1* 28 +3)
C...
       DIMENSION
     1 SYN( 258 ,LOTS,NCPUS),SYNTOP(2, 63 ,LOTST)
C....
      PARAMETER(LWORKR=(20/LOTS*20+LOTS/20*LOTS)/(20/LOTS+LOTS/20))
      DIMENSION WORKR( 256 ,LWORKR)
      DIMENSION IWORKR( 256 )
      DIMENSION    QTT( 4032 ,NCPUS),QVV( 4158 ,NCPUS),
     2             TSEAR( 256 ,NCPUS),SHELGR( 256 ,NCPUS),
     3             CVR( 256 ,NCPUS),CVTR( 256 ,NCPUS),
     4             CVBR( 256 ,NCPUS),PPPRSA( 256 , 28 ,NCPUS),
     5             OZONEA( 256 , 28 ,NCPUS),ALBDOA( 256 ,NCPUS),
     6             COSZRO( 256 ,NCPUS),TAUDAR( 256 ,NCPUS),
     7             CLDARY( 256 , 28 ,NCPUS),CLDSA( 256 ,4,NCPUS),
     8             MTOPA( 256 ,3,NCPUS),MBOTA( 256 ,3,NCPUS),
     9             SWHR( 256 , 28 ,NCPUS1),HLWR( 256 , 28 ,NCPUS1),
     A             SFNSWR( 256 ,NCPUS1),SFDLWR( 256 ,NCPUS1)
     B                                  ,TSFLWR( 256 ,NCPUS1)
C                  ADDED BY BOB GRUMBINE FOR SEA ICE ALBEDO ALGORITHM
     C             , TGR( 256 , NCPUS)
CSIB
      DIMENSION    ALVBR( 256 ,NCPUS),ALNBR( 256 ,NCPUS),
     1             ALVDR( 256 ,NCPUS),ALNDR( 256 ,NCPUS),
     2             GDFVBR( 256 ,NCPUS1),GDFNBR( 256 ,NCPUS1),
     3             GDFVDR( 256 ,NCPUS1),GDFNDR( 256 ,NCPUS1)
C...... DOWNWARD SW FLUXES FROM SW RAD..FOR SIB PARAMETERIZATION
C     ..   SAVED FOR H2D FILE....
      COMMON/SIBSW/ DFVBR( 256 , 31 ),DFNBR( 256 , 31 ),
     1              DFVDR( 256 , 31 ),DFNDR( 256 , 31 )
CSIB
CYH93...
C     SAVE KDAPRX,KEMIS,ISTRAT,IVV,IBL,ICONV,IEMIS,ITHK,
CYH94 SAVE KDAPRX,KEMIS,IEMIS,
      SAVE KDAPRX,
CTUNE1     JCAP,LEVS,CRH,RAD1ST,DTHR,HDTHR,DTLMOD,DTSMOD
     1     JCAP,LEVS,    RAD1ST,DTHR,HDTHR,DTLMOD,DTSMOD,DTLW,
     2     RHCLT,RHCL,FHR1,FHR2,FHRTAB,FHR1ST,IDTLN,IDTLS,DLON,ISTRAT
CTUNE
CYH   DIMENSION CRH(3),IVV(3)
CKAC  DIMENSION CRH( 28 ,2)
CTUNE
C...  ARRAY ADDED FOR RH-CL CALCULATION
C     INDICES FOR LON,LAT,CLD TYPE(L,M,H), LAND/SEA RESPECTIVELY
C     NLON=1-2, FOR EASTERN AND WESTERN HEMISPHERES
C     NLAT=1-4, FOR 60N-30N,30N-EQU,EQU-30S,30S-60S
C     LAND/SEA=1-2 FOR LAND(AND SEAICE),SEA
C.... RHCLT WILL CONTAIN ALL TIME LEVELS OF CLD-RH TABLES
      DIMENSION RHCL (NBIN,NLON,NLAT,MCLD,NSEAL)
CKC94 DIMENSION RHCLT(NBIN,NLON,NLAT,MCLD,NSEAL,IDA)
CKC94 DIMENSION FHRTAB(IDA)
C...   FHRTAB = VALID FCST HRS FOR CLD-RH TABLES
CKC94 DATA FHRTAB / 0. E 0,12. E 0,36. E 0,60. E 0,84. E 0,108. E 0 /
CKAC    ISTRAT = 0, USE CRH BELOW (DEFAULT), = 1 USE TUNED RHCLD
C...    ISTRAT = 0, CALCULATE CRH IN CLDJMS, = 1 USE TUNED RHCLD
      DATA ISTRAT / 1 /
CTUNE
CYH93...
CYH94 DATA CRH/9*0.72,7*0.70,12*0.86, 9*0.68,7*0.66,12*0.82/
CKAC  DATA CRH/9*0.75 E 0,7*0.75 E 0,12*0.88 E 0,
CKAC 1          9*0.70 E 0,7*0.70 E 0,12*0.85 E 0/
CYH94 DATA IEMIS/1/
C     DATA CRH/0.8,0.8,0.8/
C     DATA IVV/1,1,0/
C     DATA ISTRAT,IBL,ICONV,IEMIS,ITHK/1,1,1,0,1/
CYH93...
      LOGICAL RAD1ST
CYH94 DATA KDAPRX,KEMIS/1,0/
      DATA KDAPRX      /1/
      DATA JCAP/ 62 /,LEVS/ 28 /
      DATA RAD1ST/.TRUE./
C....
      IF(RAD1ST) THEN
        RUNRAD = .TRUE.
CTUNE
CKC94  GET CLD-RH RELATIONS IN TABULAR FORM FOR DAY 0-5
CKC94   CALL CRHTAB(RHCLT,IER)
C....  GET CLD-RH RELATIONS IN TABULAR FORM FOR DAY 1
        CALL CRHTAB(RHCL ,IER)
        IF (IER.LT.0) THEN
         ISTRAT = 0
         PRINT 1113
 1113    FORMAT(1H ,'===>TUNING TABLES NOT AVAILABLE..USE DEFAULT CRH')
        END IF
        PRINT 1114,ISTRAT
 1114   FORMAT(1H ,'..FOR DIAGNOSED CLDS....ISTRAT = ',I4)
        FHR1ST = FHOUR - DTSWAV
C....    COMPUTE LONGITUDE REGIONS (DATELINE)
        IDTLN =  128 /2
        IDTLS =  256 *3/4
        DLON  = 360. /  128
CTUNE
        KCCO2 = 0
        IUNCO2 = 15
        IPOINT = 0
        JPOINT = 0
        CALL GLATS ( 31 , COLRAR, WGR, WGRCS, RRS2)
        DO 1 J=1, 31
          SINLAJ=COS(COLRAR(J))
          COSLAJ=SQRT(1. E 0 - SINLAJ*SINLAJ)
          DO 1 I=1, 128
            SINLAR(I,J)= SINLAJ
            COSLAR(I,J)= COSLAJ
            SINLAR(I+ 128 ,J)=-SINLAJ
            COSLAR(I+ 128 ,J)= COSLAJ
    1   CONTINUE
        CALL GFT 128
CYH93...  THE FOLLOWING CODE HAS BEEN REWRITTEN....
        CALL GCLJMS(SI)
        CALL GRADFS(SL,KCCO2,IUNCO2)
C....
C...      SPECIFY QUANTITIES NEEDED FOR CALL TO NEW RADFS ..KAC JUL89
        KDIMP1 =  28  + 1
        JMAXP1 =  62 +1
C...     SPECIFY THE LATITUDE WHERE PERMANENT SNOW RESIDES POLEWARD...
C         JSNO=LATITUDE CLOSEST TO 70 DEG N-INDICATING EXTENT OF PERM
C         SNOW COVER. WILL CHANGE AS A FCN. OF LATITUDE STRUCTURE.
        JSNO=( 62 +1)/9
C....   GET INTERVAL (HRS) BETWEEN SHORT-WAVE RADIATION CALLS.....
        RADDT = 3600. E 0 * DTSWAV
        DTLW = 3600. * DTLWAV
        CALL LONLAT(RLON, 256 ,RLAT,COLRAR, 31 )
C===>    PREPARE THREE SFC FIELDS AS INPUT TO RADIATION CALCULATIONS
C         ALSO PREPARE 3 CONVECTIVE ARRAYS FOR INPUT TO CLD SCHEME..
C          NEED TO INTERPOLATE FROM FCST MODEL GRID TO RADIATION GRID.
        CALL BILWGT(COLRAB, 47 , 384 ,COLRAR, 31 , 256 ,
     1              INRLAT,WGRLAT,ILEFTR,IRGHTR,WGRLON)
C===>    PREPARE HEATING RATES AND FLUXES FOR SHIPMENT TO FCST MODEL
C          NEED TO INTERPOLATE FROM RADIATION GRID TO FCST MODEL GRID.
        CALL BILWGT(COLRAR, 31 , 256 ,COLRAB, 47 , 384 ,
     1              INSLAT,WGTLAT,ILEFT,IRGHT,WGTLON)
        IF(INISTP.EQ.0) THEN
          DO 50 IV=1,26
           DO 50 J=1, 31
            DO 50 I=1, 256
             FLUXR(I,J,IV) = 0. E 0
   50     CONTINUE
          DO 60 J=1, 47
           DO 60 I=1, 384
            CVAVG(I,J) = 0. E 0
   60     CONTINUE
CSIB
          DO 1877 J=1, 31
            DO 1877 I=1, 256
              DFVBR (I,J) = 0. E 0
              DFNBR (I,J) = 0. E 0
              DFVDR (I,J) = 0. E 0
              DFNDR (I,J) = 0. E 0
 1877     CONTINUE
CSIB
        ENDIF
        CALL INSURF(ALBEDO,SLMSK,
     1              ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,ALBEDR,SLMSKR)
        RAD1ST = .FALSE.
      ENDIF
      DTHR = DELTIM / 3600.0
      HDTHR = 0.5 * DTHR
      ITIMSW = 0
      ITIMLW = 0
      DTSMOD = AMOD(SOLHR,DTSWAV)
      IF(INISTP.NE.0 .OR. DTSMOD.LT.HDTHR .OR. DTSMOD.GE.DTSWAV-HDTHR)
     1   ITIMSW = 1
      DTLMOD = AMOD(SOLHR,DTLWAV)
      IF(INISTP.NE.0 .OR. DTLMOD.LT.HDTHR .OR. DTLMOD.GE.DTLWAV-HDTHR)
     1   ITIMLW = 1
      IF(ITIMSW.EQ.0 .AND. ITIMLW.EQ.0) RETURN
      IF(.NOT.RUNRAD .AND. INISTP.NE.0) GO TO 20000
CDG3     COMPUTE NUM SEC BETWEEN CALLS TO CLD CODE...FOR DIAGNOSTICS
      DTACC = MIN(DTSWAV,DTLWAV)
      DTACC = DTACC*3600. E 0
      PRINT 1001, JCAP, LEVS
 1001 FORMAT (1H0,'GFDL REDUCED RAD',I2,I2,'G, E  TYP, FEB 20 1986')
CTUNE
CKC94 DO 1117 M=1,NSEAL
CKC94  DO 1117 LCC=1,MCLD
CKC94   DO 1117 K=1,NLAT
CKC94    DO 1117 J=1,NLON
CKC94     DO 1117 I=1,NBIN
CKC94      RHCL(I,J,K,LCC,M) = RHCLT(I,J,K,LCC,M,6)
C1117 CONTINUE
C....    ADVANCE THE CLOCK FOR TIME INTERPOLATING THE CLD-RH RELATION
CKC94 FHR1ST = FHR1ST + DTSWAV + .1
CKC94 IHR1ST = FHR1ST
CKC94 FHR1ST = IHR1ST
CKC94 FHLAST = FHRTAB(IDA)
CKC94 IF (FHR1ST.LT.FHLAST) THEN
C...   TIME INTERPOLATE THE CLD-RH RELATION IF .108 HRS
C         LINEAR INTERPOLATION...
C....    DAY 0,1,2,3,4,5 VALID FOR FHR=0,12,36,60,84,108
CKC94  DO 1116 KTIME=2,IDA
CKC94   IF (FHR1ST.LT.FHRTAB(KTIME)) THEN
CKC94    IC2 = KTIME
CKC94    FHR2 = FHRTAB(KTIME)
CKC94    GO TO 1111
CKC94   END IF
C1116  CONTINUE
C1111 CONTINUE
CKC94  IC1 = IC2 - 1
CKC94  FHR1 = FHRTAB(IC1)
CKC94  PRINT 2007,FHR1,FHR2,FHR1ST
C2007  FORMAT(1H ,'..FOR TUNING INTERP, FHR1,FHR2,FHR1ST=',3F6.0)
CKC94  DO 1119 M=1,NSEAL
CKC94   DO 1119 LCC=1,MCLD
CKC94    DO 1119 K=1,NLAT
CKC94     DO 1119 J=1,NLON
CKC94      DO 1119 I=1,NBIN
CKC94       RHCL(I,J,K,LCC,M) =
CKC941                (RHCLT(I,J,K,LCC,M,IC2)-RHCLT(I,J,K,LCC,M,IC1))*
CKC942       (FHR1ST-FHR1)/(FHR2-FHR1)  + RHCLT(I,J,K,LCC,M,IC1)
C1119  CONTINUE
CKC94  IF (FHR1ST.LE.12. E 0) THEN
C....    IF 0-12..USE DAY1 FOR LOW CLOUD..SOME PROBLEM WITH VV OR
C          TUNING ALGORITHM FOR LOW CLD AT DAY0 WHEN VV USED
CKC94   LCC = 1
CKC94   DO 1129 M=1,NSEAL
CKC94    DO 1129 K=1,NLAT
CKC94     DO 1129 J=1,NLON
CKC94      DO 1129 I=1,NBIN
CKC94       RHCL(I,J,K,LCC,M) = RHCLT(I,J,K,LCC,M,2)
C1129   CONTINUE
CKC94  END IF
CKC94 END IF
CTUNE
      IF(INISTP.NE.0) THEN
        DO 70 IV=1,26
         DO 70 J=1, 31
          DO 70 I=1, 256
           FLUXR(I,J,IV) = 0. E 0
   70   CONTINUE
        DO 80 J=1, 47
         DO 80 I=1, 384
          CVAVG(I,J) = 0. E 0
   80   CONTINUE
CSIB
        DO 1888 J=1, 31
         DO 1888 I=1, 256
          DFVBR (I,J) = 0. E 0
          DFNBR (I,J) = 0. E 0
          DFVDR (I,J) = 0. E 0
          DFNDR (I,J) = 0. E 0
 1888   CONTINUE
CSIB
        CALL INSURF(ALBEDO,SLMSK,
     1              ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,ALBEDR,SLMSKR)
      ENDIF
      LGTH= 256 * 31
      IND=-1
      CALL EXTRM1(ALBEDR,LGTH,IND)
      CALL RMSGT ( Q, DI, TE, ZE,DEL,RQ)
C    ****************************************************************
C... * ASTRONOMY CALCULATIONS-ONCE FOR EACH NEW RADIATION STEP      *
C    ****************************************************************
C..      GET 4 DIGIT YEAR FOR JULIAN DAY COMPUTATION
      IYR = IDATE(4)
      IMON = IDATE(2)
      IDAY = IDATE(3)
      IZTIM = IDATE(1)
      KYEAR = 1900 + IYR
      CHOUR=FHOUR+SHOUR/3600.
      CALL COMPJD(KYEAR,IMON,IDAY,IZTIM,0,JDNMC,FJDNMC)
      CALL FCSTIM(CHOUR,IMON,IDAY,IZTIM,JDNMC,FJDNMC,RLAG,YEAR,
     1            RSIN1,RCOS1,RCOS2,JD,FJD)
C..**************************
      IF(ITIMSW.EQ.1) THEN
        CALL SOLAR(JD,FJD,R1,DLT,ALF,SLAG,SDEC,CDEC)
        IF(KDAPRX.GE.1) THEN
          CALL COSZMN(DTSWAV,SOLHR,SINLAR,COSLAR,SDEC,CDEC,SLAG,
     1                RLON, 256 , 31 ,COSZER,.TRUE.,COSZDG)
        ENDIF
C..**************************
C...     CALCULATE SOLAR INPUT APPROPRIATE FOR DATE
C..**************************
        SOLC=SC/(R1*R1)
      ENDIF
      CALL CDATE(JD,FJD,MUNTH,IM,ID,IYEAR,IHR,XMIN)
      CALL PRTIME(ID,MUNTH,IYEAR,IHR,XMIN,JD,FJD,DLT,ALF,R1,SLAG,SOLC)
C
      CALL DELLNP(Q,DPDPHI,SYNTOP,DPDLAM)
      CALL DZUVLE(DI,ZE,ULN,VLN,SYNTOP(1,1,2),SYNTOP(1,1, 28 +2))
C..**************************
CC
      LAST=MOD( 31 ,NCPUS)
      NGGS=( 31 -LAST)/NCPUS
      IF(LAST.NE.0)NGGS=NGGS+1
      INCLAT=NCPUS
      LAT1=1-NCPUS
      LAT2=0
      LATDON=0
      DO 10000 NGG=1,NGGS
      IF((NGG.EQ.NGGS).AND.(LAST.NE.0)) INCLAT=LAST
      LAT1=LAT1+NCPUS
      LAT2=LAT2+INCLAT
      IF(NGG.EQ.1) THEN
        LTWIDL=1
        LATRD1=1
      ELSE IF(NGG.EQ.2) THEN
        LTWIDL=MOD(LTWIDL+NCPUS-2,NCPUS1)+1
        LATRD1=LAT1-1
      ELSE
        LTWIDL=MOD(LTWIDL+NCPUS-1,NCPUS1)+1
        LATRD1=LAT1-1
      ENDIF
      LATIN1=INRLAT(LATRD1)+1
CKZ   IF(NGG.EQ.1) LATIN1=1
      IF(LATDON.LE.1) LATIN1=1
      LATIN2=INRLAT(LAT2)
      IF(NGG.EQ.NGGS) LATIN2= 47
      LATOUT=LATIN2-LATIN1+1
C-DG3 DO 150 LAT=LATIN1,LATIN2
C-DG3 LAN=LAT-LATIN1+1
C-DG3 CALL GETDIA(LAT,NWGDA*KDGDA,GDA(1,1,LAN))
  150 CONTINUE
      DO 190 LAT=LAT1,LAT2
        LAN=LAT-LATDON
        DO 190 I=1, 256
          CVR (I,LAN) = 0.0 E 0
          CVBR(I,LAN) = 0.0 E 0
          CVTR(I,LAN) = 0.0 E 0
  190 CONTINUE
C...   INTERPOLATE CONVECTIVE CLOUD DATA
      CALL CVINTF(CV,CVT,CVB, 384 , 47 , 47 ,
     1         CVR,CVTR,CVBR, 256 ,INCLAT, 31 ,
     2         ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,
     3         WORKR(1,1),WORKR(1,5),WORKR(1,9),WORKR(1,13),
     4         WORKR(1,17),IWORKR,1,1,LAT1)
      CALL GGINTF(TSEA, 384 , 47 , 47 ,
     1            TSEAR, 256 ,INCLAT, 31 ,1,
     2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
      CALL GGINTF(SHELEG, 384 , 47 , 47 ,
     1            SHELGR, 256 ,INCLAT, 31 ,1,
     2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
C     ADDED BY BOB GRUMBINE FOR SEA ICE/SNOW ALBEDO ALGORITHM
      CALL GGINTF(STC, 384 , 47 , 47 ,
     1            TGR, 256 ,INCLAT, 31 ,1,
     2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
CSIB
C...   INTERPOLATE SIB ALBEDOES.........
      ALVBR=-1.
      ALVBF=-1.
      ALVDR=-1.
      ALVDF=-1.
C-SIB CALL GGINTF(ALVBF, 384 , 47 , 47 ,
C-SIB1            ALVBR, 256 ,INCLAT, 31 ,1,
C-SIB2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
C-SIB CALL GGINTF(ALNBF, 384 , 47 , 47 ,
C-SIB1            ALNBR, 256 ,INCLAT, 31 ,1,
C-SIB2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
C-SIB CALL GGINTF(ALVDF, 384 , 47 , 47 ,
C-SIB1            ALVDR, 256 ,INCLAT, 31 ,1,
C-SIB2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
C-SIB CALL GGINTF(ALNDF, 384 , 47 , 47 ,
C-SIB1            ALNDR, 256 ,INCLAT, 31 ,1,
C-SIB2            ILEFTR,IRGHTR,WGRLON,INRLAT,WGRLAT,WORKR,1,1,LAT1)
CSIB
      IF(NGG.EQ.1) THEN
        TSMIN=TSEAR(1,1)
        TSMAX=TSEAR(1,1)
        SHMIN=SHELGR(1,1)
        SHMAX=SHELGR(1,1)
      ENDIF
C
C           LAT LOOP
CMIC$ DO ALL
CMIC$1 SHARED(SYN,LAT1,LAT2,LATDON,COLRAR,RRS2,QTT,QVV,NCPUS1)
CMIC$2 SHARED(Q,DPDLAM,DPDPHI,ULN,VLN,DI,TE,RQ)
CMIC$3 SHARED(SYNTOP)
CMIC$4 SHARED(RLAT,RLON,COSZER)
CTUNE
CMIC$4 SHARED(RHCL,ISTRAT,DLON,IDTLN,IDTLS)
CTUNE
CMIC$5 SHARED(CRH,JSNO,FJD,DLT,SLAG)
CYH93...
C....  SHARED(ISTRAT,IVV,IBL,ICONV,IEMIS,ITHK,KDAPRX)
CMIC$6 SHARED(KDAPRX)
CYH94  SHARED(KDAPRX,KEMIS)
CYH94.........CMIC$6 SHARED(EMIS0,TAUC0,CLSTR)
CYH93...
CMIC$7 SHARED(SHELGR,ALBEDR,SLMSKR,TSEAR,TGR)
CMIC$8 SHARED(PPPRSA,OZONEA,ALBDOA,COSZRO,TAUDAR)
CMIC$9 SHARED(CLDARY,CLDSA,MTOPA,MBOTA)
CMIC$A SHARED(CLDTOT,CLDCNV,SFCP)
CMIC$B SHARED(RSIN1,RCOS1,RCOS2)
CMIC$C SHARED(CVR,CVTR,CVBR,AVECLD,CLDL,AVECV)
CYH93...
CYH93...
CMIC$D PRIVATE(WORKR,LAT,LATCO,LAN,LATRAD)
CTUNE
      DO 1000 LAT=LAT1,LAT2
      LAN=LAT-LATDON
      LATCO= 62 +1-LAT
      LATRAD=MOD(LAT-1,NCPUS1)+1
C
      CALL PLN2I(QTT(1,LAN),QVV(1,LAN),COLRAR,LAT)
C
      CALL SUMS2R(DI,SYN(1,1,LAN),QTT(1,LAN),LOTS)
CCC  X             128 ,  128 /2)
C....
      CALL SUMTOP(SYN(1,KSTB,LAN),SYNTOP,QVV(1,LAN),LOTST, 128 , 128 /2)
C
C     IF(LAT .EQ. 2) CALL ERREXIT
C
      CALL FTI  128  (SYN(1,1,LAN),WORKR,2*LOTS,1)
C
      CALL GRRAD1(SYN(1,KSD,LAN),SYN(1,KSPLAM,LAN),SYN(1,KSPPHI,LAN),
     1            SYN(1,KSU,LAN),SYN(1,KSV,LAN),SYN(1,KST,LAN),
     2            SYN(1,KSR,LAN),SYN(1,KSP,LAN),
     3            ALBEDR(1,LAT),SLMSKR(1,LAT),
     4            COSZER(1,LAT),RLON(1,LAT),RLAT(1,LAT),
     5            TSEAR(1,LAN),SHELGR(1,LAN),TGR(1,LAN),
     6            CVR(1,LAN),CVTR(1,LAN),CVBR(1,LAN),RHCL,
     7            PPPRSA(1,1,LAN),OZONEA(1,1,LAN),ALBDOA(1,LAN),
     8            COSZRO(1,LAN),TAUDAR(1,LAN),CLDARY(1,1,LAN),
     9            CLDSA(1,1,LAN),MTOPA(1,1,LAN),MBOTA(1,1,LAN),
     A            RRS2,LAT,LATCO,IDTLN,IDTLS,DLON,ISTRAT,
     B            KDAPRX,SLAG,RSIN1,RCOS1,RCOS2,
     C            FJD,DLT,JSNO,WORKR,LWORKR,
     D            CLDTOT(1,1,LATRAD),CLDCNV(1,1,LATRAD),
     E            SFCP(1,LATRAD),
     F            AVECV,AVECLD,CLDL)
C
 1000 CONTINUE
C
C           LAT LOOP
CMIC$ DO ALL
CMIC$1 SHARED(SYN,LAT1,LAT2,LATDON,NCPUS1)
CMIC$2 SHARED(IPOINT,JPOINT,ITIMLW,ITIMSW,RADDT,DTLW)
CMIC$3 SHARED(RLAT,COSZRO,COSZDG)
CYH93...
CYH94.........CMIC$6 SHARED(EMIS0,TAUC0,CLSTR)
CYH93...
CMIC$4 SHARED(SHELGR,SLMSKR,TSEAR,TGR)
CMIC$5 SHARED(PPPRSA,OZONEA,ALBDOA,COSZRO,TAUDAR)
CMIC$6 SHARED(CLDARY,CLDSA,MTOPA,MBOTA)
CMIC$7 SHARED(SDEC,SOLC,RSIN1,RCOS1,RCOS2)
CMIC$8 SHARED(SFDLWR,SFNSWR,SWHR,HLWR,TSFLWR,ZONHT)
CSIB
CMIC$9 SHARED(ALVBR,ALNBR,ALVDR,ALNDR)
CMIC$A SHARED(GDFVBR,GDFNBR,GDFVDR,GDFNDR)
CSIB
CYH93...
CMIC$B PRIVATE(LAT,LATCO,LAN,LATRAD)
CTUNE
      DO 2000 LAT=LAT1,LAT2
      LAN=LAT-LATDON
      LATCO= 62 +1-LAT
      LATRAD=MOD(LAT-1,NCPUS1)+1
C
      CALL GRRAD2(SYN(1,KST,LAN),SYN(1,KSR,LAN),SYN(1,KSP,LAN),
     1            PPPRSA(1,1,LAN),OZONEA(1,1,LAN),ALBDOA(1,LAN),
     2            SLMSKR(1,LAT),COSZRO(1,LAN),COSZDG(1,LAT),
     3            TAUDAR(1,LAN),RLAT(1,LAT),TSEAR(1,LAN),
     4            ALVBR(1,LAN),ALNBR(1,LAN),ALVDR(1,LAN),ALNDR(1,LAN),
     5            CLDARY(1,1,LAN),CLDSA(1,1,LAN),
     6            MTOPA(1,1,LAN),MBOTA(1,1,LAN),
     7            LAT,LATCO,SDEC,SOLC,RSIN1,RCOS1,RCOS2,
     8            RADDT,DTLW,ITIMSW,ITIMLW,IPOINT,JPOINT,
     9            SWHR(1,1,LATRAD),HLWR(1,1,LATRAD),ZONHT,
     A            SFNSWR(1,LATRAD),SFDLWR(1,LATRAD),TSFLWR(1,LATRAD),
     B            GDFVDR(1,LATRAD),GDFNDR(1,LATRAD),
     C            GDFVBR(1,LATRAD),GDFNBR(1,LATRAD))
C
 2000 CONTINUE
      LGTH= 256 *INCLAT
      IND=1
      CALL EXTRM2(NGG,NGGS,TSEAR,TSMIN,TSMAX,SHELGR,SHMIN,SHMAX,
     1            LGTH,IND)
CDG3   INTERPOLATE TO FORECAST MODEL GRID
CDG3     FROM NCPUS1 LATS ON COARSE GRID TO LATOUT LATS ON FINE GRID..
CKZ      PROTECTION AGAINST PREMATURE INTERPOLATION FOLLOWS
      LATDON=LATDON+(LAT2-LAT1+1)
      IF(LATDON.GT.1) THEN
        CALL CLINTF(CLDTOT, 256 ,NCPUS1, 31 ,
     1              CLDT, 384 ,LATOUT, 47 , 28 ,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     3              WORKF(1,1),WORKF(1,5),WORKF(1,9),
     4              IWORKF,LTWIDL,LATRD1,LATIN1)
        CALL CLINTF(CLDCNV, 256 ,NCPUS1, 31 ,
     1              CLCV, 384 ,LATOUT, 47 , 28 ,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     3              WORKF(1,1),WORKF(1,5),WORKF(1,9),
     4              IWORKF,LTWIDL,LATRD1,LATIN1)
        CALL GGINTF(SFCP, 256 ,NCPUS1, 31 ,
     1              SFCPR, 384 ,LATOUT, 47 ,1,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
CDG3        CONVERT TO AMOUNT (*100)
C-DG3   CALL SYNDIA
CMIC$   DO ALL
CMIC$B   SHARED(CLDT,CLCV,LATIN1,LATOUT)
CMIC$D   SHARED(GDA)
CMIC$G   SHARED(DTACC,SFCPR)
CMIC$C   PRIVATE(I,K,LAT,LAN)
CDG3...
        DO 1039 LAT=1,LATOUT
         DO 351 K=1, 28
          DO 351 I=1, 384
           IF (CLDT(I,K,LAT).LT.0. E 0) THEN
            CLDT(I,K,LAT) = 0. E 0
           ELSE IF (CLDT(I,K,LAT).GT.1. E 0) THEN
            CLDT(I,K,LAT) = 100. E 0
           ELSE
            CLDT(I,K,LAT) = CLDT(I,K,LAT) * 100. E 0
           END IF
  351    CONTINUE
         DO 352 K=1, 28
          DO 352 I=1, 384
           IF (CLCV(I,K,LAT).LT.0. E 0) THEN
            CLCV(I,K,LAT) = 0. E 0
           ELSE IF (CLCV(I,K,LAT).GT.1. E 0) THEN
            CLCV(I,K,LAT) = 100. E 0
           ELSE
            CLCV(I,K,LAT) = CLCV(I,K,LAT) * 100. E 0
           END IF
  352    CONTINUE
         LAN = LATIN1 + LAT - 1
         CALL ZNLACM( 384 ,CLDT(1,1,LAT),SFCPR(1,LAT),DTACC,NMTCLD,LAN)
         CALL ZNLACM( 384 ,CLCV(1,1,LAT),SFCPR(1,LAT),DTACC,NMTCCV,LAN)
C-DG3    CALL ACCDIA( 384 ,CLDT(1,1,LAT),DTACC,KDTCLD,GDA(1,1,LAT))
C-DG3    CALL ACCDIA( 384 ,CLCV(1,1,LAT),DTACC,KDTCCV,GDA(1,1,LAT))
 1039   CONTINUE
C-DG3   DO 1041 LAT=LATIN1,LATIN2
C-DG3     LAN=LAT-LATIN1+1
C-DG3     CALL PUTDIA(LAT,NWGDA*KDGDA,GDA(1,1,LAN))
 1041   CONTINUE
      ENDIF
CKZ   PROTECTION AGAINST PREMATURE INTERPOLATION ENDS WITH ABOVE ENDIF
CKZ   IF(ITIMSW.EQ.1) THEN
      IF(LATDON.GT.1 .AND. ITIMSW.EQ.1) THEN
        CALL GGINTF(SWHR, 256 ,NCPUS1, 31 ,
     1              SWH(1,1,LATIN1), 384 ,LATOUT, 47 , 28 ,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
        CALL GGINTF(SFNSWR, 256 ,NCPUS1, 31 ,
     1              SFCNSW(1,LATIN1), 384 ,LATOUT, 47 ,1,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
CSIB...
C....... INTERPOLATE 4 COMPONENTS OF DOWNWARD SW FLUX TO FCST GRID
C-SIB   CALL GGINTF(GDFVDR, 256 ,NCPUS1, 31 ,
C-SIB1              GDFVDF(1,LATIN1), 384 ,LATOUT, 47 ,1,
C-SIB2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
C-SIB3              LTWIDL,LATRD1,LATIN1)
C-SIB   CALL GGINTF(GDFNDR, 256 ,NCPUS1, 31 ,
C-SIB1              GDFNDF(1,LATIN1), 384 ,LATOUT, 47 ,1,
C-SIB2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
C-SIB3              LTWIDL,LATRD1,LATIN1)
C-SIB   CALL GGINTF(GDFVBR, 256 ,NCPUS1, 31 ,
C-SIB1              GDFVBF(1,LATIN1), 384 ,LATOUT, 47 ,1,
C-SIB2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
C-SIB3              LTWIDL,LATRD1,LATIN1)
C-SIB   CALL GGINTF(GDFNBR, 256 ,NCPUS1, 31 ,
C-SIB1              GDFNBF(1,LATIN1), 384 ,LATOUT, 47 ,1,
C-SIB2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
C-SIB3              LTWIDL,LATRD1,LATIN1)
CSIB...
      ENDIF
CKZ   IF(ITIMLW.EQ.1) THEN
      IF(LATDON.GT.1 .AND. ITIMLW.EQ.1) THEN
        CALL GGINTF(HLWR, 256 ,NCPUS1, 31 ,
     1              HLW(1,1,LATIN1), 384 ,LATOUT, 47 , 28 ,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
        CALL GGINTF(SFDLWR, 256 ,NCPUS1, 31 ,
     1              SFCDLW(1,LATIN1), 384 ,LATOUT, 47 ,1,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
        CALL GGINTF(TSFLWR, 256 ,NCPUS1, 31 ,
     1              TSFLW(1,LATIN1), 384 ,LATOUT, 47 ,1,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORKR,
     3              LTWIDL,LATRD1,LATIN1)
      ENDIF
CKZ   LATDON=LATDON+(LAT2-LAT1+1)
C-DG3 CALL SYNDIA
10000 CONTINUE
CC
      DO 600 LAT=1, 62
       DO 600 K=1, 28
        ZONHT(K,LAT) = ZONHT(K,LAT) * 86400. E 0
  600 CONTINUE
      IF( 62 .GE.18) THEN
C...     PRINT MEAN HEATING RATES
      IF(ITIMLW.EQ.1.AND.ITIMSW.EQ.1) THEN
        CALL PROFZL(ZONHT,CLDSIG,COLRAR,FHOUR, 28 ,1)
      ENDIF
C...     PRINT MEAN CONVECTIVE CLD AMT,TOP,BOT
         CALL PROFZL(AVECV,CLDSIG,COLRAR,FHOUR,3,5)
C...     PRINT MEAN CLOUD DIAGNOSTICS
      CALL PROFZL(AVECLD,CLDSIG,COLRAR,FHOUR, 28 ,2)
      CALL PROFZL(CLDL,CLDSIG,COLRAR,FHOUR,4,3)
      ENDIF
C
      IF(ITIMSW.EQ.1) THEN
       CALL COSZMN(DTSWAV,SOLHR,SINLAB,COSLAB,SDEC,CDEC,SLAG,
     1            XLON, 384 , 47 ,COSZEN,.FALSE.,WORKR)
      ENDIF
C....   INTERPOLATE DIAGNOSTIC FLUXES (BI-LINEAR)
        DO 650 K=1, 47
        DO 650 J=1, 384
          CVAVG(J,K) = CVAVG(J,K) + RADDT * CV(J,K)
  650   CONTINUE
      IF(INISTP.NE.0) THEN
        RUNRAD=.FALSE.
      ELSE
        RUNRAD=.TRUE.
      ENDIF
20000 CONTINUE
C....
      RETURN
      END
