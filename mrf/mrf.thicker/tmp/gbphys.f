CFPP$ NOCONCUR R
      SUBROUTINE GBPHYS(PLAMGRS,PPHIGRS,UGRS,VGRS,PGR,TGRS,QGRS,XGRS,
     X GT0,GQ0,GU0,GV0,
     X TGMXL,IGMXL,KGMXL,TGMNL,IGMNL,KGMNL,
C-DG3X GDA,
C-RASX RAS,LMX,CP,ALHL,GRAV,RGAS,
C-RASX SIG, SGB, PRH, PRJ, HPK, FPK, ODS, PRNS,
C-RASX RASAL, LM, KRMIN, KRMAX, NSTRP,
C-RASX NCRND, RANNUM, AFAC, UFAC,
     X LAT)
C.................................................................
CFPP$ EXPAND(ZNLACM,ACCDIA)
C.................................................................
C................BEGIN comfgrid...................................
C....
       COMMON /comfgrid/
     * COLRAD( 47 ),WGT( 47 ),WGTCS( 47 ),RCS2( 47 ),
     * COLRAB( 47 ),WGB( 47 ),WGBCS( 47 ),RBS2( 47 ),
     * SINLAT( 47 ),
     * SINLAB( 384 , 47 ),COSLAB( 384 , 47 )
C.................................................................
C................sof   comfgrid...................................
C....
C.................................................................
C................BEGIN comfphys ..................................
C....
      COMMON /comfphys/SLMSK( 384 , 47 ),HPRIME( 384 , 47 ),
     * SWH( 384 , 28 , 47 ),HLW( 384 , 28 , 47 ),
     * SFCNSW( 384 , 47 ),SFCDLW( 384 , 47 ),
     * COSZEN( 384 , 47 ),XLON( 384 , 47 ),
     * SDEC,CDEC,SLAG,SOLHR,CLSTP,LASTEP,
     * CV( 384 , 47 ),CVT( 384 , 47 ),CVB( 384 , 47 ),
     * ALBEDO( 384 , 47 ),TSFLW( 384 , 47 ),
     *       DUSFC( 384 , 47 ), DVSFC( 384 , 47 ),
     *       DTSFC( 384 , 47 ), DQSFC( 384 , 47 ),
     *      DLWSFC( 384 , 47 ),ULWSFC( 384 , 47 ),
     *GESHEM( 384 , 47 ),TSEA( 384 , 47 ),F10M( 384 , 47 ),
     *       DUGWD( 384 , 47 ),DVGWD( 384 , 47 ),
     *       U10M( 384 , 47 ),V10M( 384 , 47 ),
     *       T2M( 384 , 47 ),Q2M( 384 , 47 ),
     *       PSURF( 384 , 47 ),PSMEAN( 384 , 47 ),
     *TG3( 384 , 47 ),ZORL( 384 , 47 ),PLANTR( 384 , 47 ),
     *        SHELEG( 384 , 47 ),BENGSH( 384 , 47 ),
     *        GFLUX( 384 , 47 ),SLRAD( 384 ),
     *        SMC( 384 , 47 , 2 ),STC( 384 , 47 , 2 ),
     *        CANOPY( 384 , 47 ),RUNOFF( 384 , 47 ),
     *        TMPMAX( 384 , 47 ),TMPMIN( 384 , 47 ),
     *        EP( 384 , 47 ),CLDWRK( 384 , 47 ),
     *        HPBL( 384 , 47 ),PWAT( 384 , 47 )
      LOGICAL LASTEP
C.................................................................
C................sof   comfphys ..................................
C....
C.....BEGIN comfver...............................................
      COMMON/comfver/AM( 28 , 28 ),HM( 28 , 28 ),TM( 28 , 28 ),
     O               BM( 28 , 28 ),CM( 28 , 28 ),SPDMAX( 28 ),
     1 SI( 29 ),SL( 28 ),DEL( 28 ),RDEL2( 28 ),RMSDOT( 27 ),
     2 CI( 29 ),CL( 28 ),TOV( 28 ),GV( 28 ),SV( 28 ),RPI( 27 ),
     3 P1( 28 ),P2( 28 ), H1( 28 ),   H2( 28 ),RPIREC( 27 ),
     8   THOUR,DELTIM,KDT,INISTP,SL1,Z00,FHOUR,SHOUR,LIMLOW,DTCVAV,
     9   NFLIP,NFLOP,NR2DDA,FILTA,FILTB,DK,TK,PERCUT,DTSWAV,DTLWAV,
     X   COWAVE,DTWAVE,N50UFL,NUMSUM,NUMMAX,NCPUS,NCPUS1,NCLDB1
C.....sof   comfver...............................................
      PARAMETER(NRM=23,NRS=32)
      PARAMETER(NLB=6,NST=6)
      PARAMETER(NMU=1,NMV=2,NMTV=3,NMQ=4,NMVOT2=5,
     &          NMDIV2=6,NMOMEGA=7,NMT=8,NMRH=9,NMKE=10,
     &          NMTCONV=11,NMTLARG=12,NMTSHAL=13,NMTVRDF=14,NMQCONV=15,
     &          NMQSHAL=16,NMQVRDF=17,NMUVRDF=18,NMVVRDF=19,NMTHSW=20,
     &          NMTHLW=21,NMTCLD=22,NMTCCV=23)
      PARAMETER(NSRAIN=1,NSRAINC=2,NSTSFC=3,NSQSFC=4,NSUSFC=5,
     &          NSVSFC=6,NSRCOV=7,NSRCOVC=8,NSPS=9,NSTSKIN=10,
     &          NSWET=11,NSSNOW=12,NSTG1=13,NSTG2=14,NSTG3=15,
     &          NSSFCSW=16,NSSFCLW=17,NSRHS=18,NSTVS=19,NSTS=20,
     &          NSQS=21,NSZORL=22,NSSLMSK=23,NSUGWD=24,NSVGWD=25,
     &          NSUASFC=26,NSUAGWD=27,NSUAMTN=28,NSUA=29,NSUAP=30,
     &          NSEP=31,NSCLDWRK=32)
      COMMON /COMZNL/ ZDM(2, 28 ,NRM, 47 ),ZWM(2, 47 ),ZHM(NRM)
      COMMON /COMZNL/ ZDS(2,NST,NRS, 47 ),ZWS(2,NST, 47 )
C  DIAGNOSTIC INDEXES AND FLAGS
C-DG3 PARAMETER(KDGDA=13)
C-DG3 PARAMETER(KDTLARG=1,KDTCONV=2,KDQCONV=3,KDTSHAL=4,KDQSHAL=5,
C-DG3&          KDTVRDF=6,KDUVRDF=7,KDVVRDF=8,KDQVRDF=9,
C-DG3&          KDTHSW=10,KDTHLW=11,KDTCLD=12,KDTCCV=13)
C-DG3 CHARACTER*8 CNMGDA
C-DG3 COMMON /COMGDC/ CNMGDA(KDGDA)
C-DG3 PARAMETER(NTGDA=92)
C-DG3 PARAMETER(NWGDA=(( 384 * 28 -1)/512+1)*512)
C-DG3 PARAMETER(NRGDA= 47 )
C-DG3 COMMON /COMGDA/ IPUGDA(KDGDA),IBMGDA(KDGDA)
C-DGM COMMON /COMGDD/ GDD(NWGDA*KDGDA*NRGDA)
      PARAMETER(NVRKEN= 80 + 9 * 28 ,NPTKEN= 50 )
      PARAMETER(NSTKEN= 24 )
      COMMON/COMGPD/ SVDATA(NVRKEN,NPTKEN,NSTKEN),
     1               IGRD(NPTKEN),JGRD(NPTKEN),
     2               IGRDR(NPTKEN),JGRDR(NPTKEN),
     3               ITNUM,NPOINT,ISAVE,ISSHRT,ILSHRT,IKFREQ
      PARAMETER(CNWATT=- 4.1855E+0 *1.E4/60.,FV= 4.6150E+2 / 2.8705E+2 -
     11.)
      DIMENSION IPTLAT(NPTKEN)
      DIMENSION JPTLAT(NPTKEN)
C-WAV COMMON/COMWAV/ HSTR,USTRGG( 384 , 47 ),VSTRGG( 384 , 47 )
C...................................................................
      DIMENSION  PLAMGRS( 386 )
      DIMENSION  PPHIGRS( 386 )
      DIMENSION     UGRS( 386 , 28 )
      DIMENSION     VGRS( 386 , 28 )
      DIMENSION      PGR( 386 )
      DIMENSION     TGRS( 386 , 28 )
      DIMENSION     QGRS( 386 , 28 , 1 )
      DIMENSION     XGRS( 386 , 28 )
      DIMENSION      GT0( 386 , 28 )
      DIMENSION      GQ0( 386 , 28 , 1 )
      DIMENSION      GU0( 386 , 28 )
      DIMENSION      GV0( 386 , 28 )
C...................................................................
      PARAMETER(LOTBS=7* 28 +4,LOTBST=2* 28 +1,
     &          LOTBA=4* 28 ,LOTBAT=2* 28 )
      PARAMETER(LOTSYN=8* 28 )
      PARAMETER(KSB=1* 28 -3,KSTB=1* 28 -2,
     &          KAB=4* 28 +1,KAFB=0* 28 +1)
      PARAMETER(KSU=1* 28 -1,KSV=2* 28 -1,KSP=3* 28 -1,
     &          KSPLAM=1* 28 -3,KSPPHI=1* 28 -2,
     &          KSX=7* 28 +1,
     &          KSQM=3* 28 +0,KSPM=4* 28 +0,
     &          KST=4* 28 +1,KSQ=5* 28 +1,
     &          KAT=4* 28 +1,KAQ=5* 28 +1,
     &          KAU=6* 28 +1,KAV=7* 28 +1)
      DIMENSION               SLK( 28 )
C.................................................................
      DIMENSION KBOT( 384 ),KTOP( 384 ),KUO( 384 ),
     1DUDT( 384 , 28 ),DVDT( 384 , 28 ),
     2DTDT( 384 , 28 ),DQDT( 384 , 28 ),
     2 HSW( 384 , 28 ),GFLX( 384 ),
     3 RAIN( 384 ),RAINC( 384 ),RAINL( 384 ),RAIN1( 384 ),
     4 EVAPC( 384 ),WORK1( 384 ),
     5 W2( 384 , 28 ),VVEL( 384 , 28 )
C.................................................................
      DIMENSION  TSTAR( 384 ), PSEXP( 384 ),
     1          SNOWMT( 384 ),FACTOR( 384 ),
     2              FM( 384 ),    FH( 384 ),
     3              CD( 384 ),   CDQ( 384 ),
     4             QSS( 384 ), RADSL( 384 )
      DIMENSION DUSFCG( 384 ),DVSFCG( 384 )
      DIMENSION DUSFC1( 384 ),DVSFC1( 384 ),
     1          DTSFC1( 384 ),DQSFC1( 384 ),
     1          DLWSF1( 384 ),ULWSF1( 384 )
      DIMENSION SMSOIL( 384 , 2 ),STSOIL( 384 , 2 )
      DIMENSION SOILTYP( 384 ),SIGMAF( 384 )
      DIMENSION RB( 384 ),RHSCNPY( 384 )
      DIMENSION AI( 384 , 2 ),BI( 384 , 2 ),DRAIN( 384 )
      DIMENSION CCI( 384 , 2 ),RHSMC( 384 , 2 ),RUNOF( 384 )
      DIMENSION ZSOIL( 384 , 2 ),CLD1D( 384 )
      DIMENSION EVAP( 384 ),HFLX( 384 ),RNET( 384 )
      DIMENSION T850( 384 ),PK( 384 ),PKP( 384 ),EP1D( 384 )
      DIMENSION GAMT( 384 ),GAMQ( 384 )
      INTEGER SOILTYP
      DIMENSION TOVZER( 28 )
C-DG3 DIMENSION GDA(NWGDA,KDGDA)
C-RAS LOGICAL RAS
C-RAS DIMENSION SIG(LMX+1), PRJ(LMX+1), PRH(LMX),   FPK(LMX), HPK(LMX)
C-RAS*,         SGB(LMX),   ODS(LMX),   RASAL(LMX), PRNS(LMX/2)
C-RAS*,         RANNUM(LMX)
C-RAS DIMENSION WRK( 384 *(27+15*LMX))
      LOGICAL LDIAG
      SIGSHC=0.7
      LEVSHC=0
      P850 = 850. * .1
C
C  FRAIN IS THE FACTOR FOR CENTERED DIFFERENCE SCHEME CORRECTION OF RAIN
C  AMOUNT.
C
      FRAIN = .5
      IF(INISTP.EQ.1) FRAIN = 1.
      DO 205 K=1, 28
      IF(SL(K).GT.SIGSHC) LEVSHC=K+1
      SLK(K)=SL(K)**( 2.8705E+2 / 1.0046E+3 )
205   TOVZER(K)=0. E 0
      MSTA=0
      LDIAG=.FALSE.
C
C  FOR THE TIME BEING, SOILTYP AND SIGMAF WILL BE SET TO CONSTANT
C  WE PLAN TO BRING IN A DATA SET FOR EACH
C  AT A LATTER TIME
C
      DO J = 1,  384
        SOILTYP(J) = 7
        SIGMAF(J) = .7
      ENDDO
C
      SL1=SL(1)
      FACTX=1000. E 0*(DELTIM*DEL(1)/ 9.8000E+0 )
      CSTRN2=1. E 0/(.75 E 0*150. E 0)
      DT2=DELTIM*2. E 0
      DTF=FRAIN*DT2
C
C  TRANSFER SOIL MOISTURE AND TEMPERATURE FROM GLOBAL TO LOCAL VARIABLES
C
      DO K = 1,  2
        DO J = 1,  384
          SMSOIL(J,K) = SMC(J,LAT,K)
          STSOIL(J,K) = STC(J,LAT,K)
        ENDDO
      ENDDO
C
      DO 240 K=1, 28
      DO 240 J=1, 384
      DUDT(J,K)=0. E 0
      DVDT(J,K)=0. E 0
      DTDT(J,K)=0. E 0
      DQDT(J,K)=0. E 0
  240 CONTINUE
      RCL=RBS2(LAT)
      RCS = SQRT(RCL)
C.................................................................
C
C  GET DRY TEP.
C
      DO 270 K=1, 28
      DO 270 J=1, 384
      TGRS(J,K)=TGRS(J,K)/(1.+FV*QGRS(J,K,1))
  270 CONTINUE
      DO 271 K=1, 28
        J=ISMAX( 384 ,TGRS(1,K),1)
        IF(TGRS(J,K).GT.TGMXL) THEN
          TGMXL=TGRS(J,K)
          IGMXL=J
          KGMXL=K
        ENDIF
        J=ISMIN( 384 ,TGRS(1,K),1)
        IF(TGRS(J,K).LT.TGMNL) THEN
          TGMNL=TGRS(J,K)
          IGMNL=J
          KGMNL=K
        ENDIF
  271 CONTINUE
C
C  GET SURFACE PRESSURE.
C
      DO 280 J=1, 384
      PSEXP(J)= EXP(PGR(J))
      FACTOR(J)=FACTX*PSEXP(J)
      PSURF(J,LAT)=PSEXP(J)
      PSMEAN(J,LAT)=PSMEAN(J,LAT)+PSEXP(J)*DTF
  280 CONTINUE
C
C  INITIALIZE DTDT WITH HEATING RATE FROM DCYC2 AND GET RADSL FOR PROGTM
C
      CALL DCYC2( 384 , 28 ,SOLHR,SLAG,SINLAB(1,LAT),COSLAB(1,LAT),
     &           SDEC,CDEC,XLON(1,LAT),COSZEN(1,LAT),
     &           SFCDLW(1,LAT),SFCNSW(1,LAT),TGRS(1,1),
     &           TSEA(1,LAT),TSFLW(1,LAT),SWH(1,1,LAT),HLW(1,1,LAT),
     &           DLWSF1,ULWSF1,RADSL,DTDT)
C
      DO 285 J=1, 384
      DLWSFC(J,LAT)=DLWSFC(J,LAT)+DLWSF1(J)*DTF
      ULWSFC(J,LAT)=ULWSFC(J,LAT)+ULWSF1(J)*DTF
285   CONTINUE
C
      DO 286 K=1, 28
      DO 286 J=1, 384
      HSW(J,K)=DTDT(J,K)-HLW(J,K,LAT)
286   CONTINUE
      CALL ZNLACM( 384 ,HSW,PSEXP, DTF,NMTHSW,LAT)
      CALL ZNLACM( 384 ,HLW(1,1,LAT),PSEXP, DTF,NMTHLW,LAT)
C-DG3 CALL ACCDIA( 384 ,HSW, DTF,KDTHSW,GDA)
C-DG3 CALL ACCDIA( 384 ,HLW(1,1,LAT), DTF,KDTHLW,GDA)
C
      CALL PROGTM( 384 , 2 ,PSEXP,
     1 UGRS(1,1),VGRS(1,1),
     1 TGRS(1,1),QGRS(1,1,1),
     2 SHELEG(1,LAT),TSEA(1,LAT),QSS,
     & SMSOIL,STSOIL,EVAPC,SOILTYP,SIGMAF,CANOPY(1,LAT),
     3 RADSL,SNOWMT,DELTIM,ZORL(1,LAT),PLANTR(1,LAT),TG3(1,LAT),
     4 GFLX,F10M(1,LAT),U10M(1,LAT),V10M(1,LAT),T2M(1,LAT),Q2M(1,LAT),
     5 ZSOIL,CD,CDQ,RB,RHSCNPY,RHSMC,AI,BI,CCI,
     6 RCL,SL1,SLK,SLMSK(1,LAT),INISTP,LAT,
     & DRAIN,EVAP,HFLX,RNET,EP1D,COWAVE,FM,FH)
C
      DO 290 J=1, 384
      GFLUX(J,LAT)=GFLUX(J,LAT)+GFLX(J)*DTF
      TMPMAX(J,LAT) = MAX(TMPMAX(J,LAT),T2M(J,LAT))
      TMPMIN(J,LAT) = MIN(TMPMIN(J,LAT),T2M(J,LAT))
      EP(J,LAT) = EP(J,LAT) + EP1D(J) * DTF
  290 CONTINUE
C
C     COMPUTE COEFFICIENT OF EVAPORATION IN EVAPC
C
      DO 320 J=1, 384
      TSTAR(J) = TSEA(J,LAT)
      IF (EVAPC(J).GT.1. E 0) EVAPC(J)=1.0 E 0
  320 CONTINUE
C
C     OVER SNOW COVER OR ICE OR SEA, COEF OF EVAP =1.0. E 0
C
      DO 330 J=1, 384
      IF ((SHELEG(J,LAT).GT.0. E 0) .OR.
     1     (SLMSK(J,LAT).NE.1. E 0))
     2      EVAPC(J)=1. E 0
  330 CONTINUE
C
C  DO VERTICAL DIFFUSION
C
      CALL ZNLACM( 384 ,DTDT,PSEXP,-DTF,NMTVRDF,LAT)
C-DG3 CALL ACCDIA( 384 ,DTDT,-DTF,KDTVRDF,GDA)
      CALL MONINP( 384 , 386 , 28 ,DVDT,DUDT,
     1 DTDT,DQDT,
     1 UGRS(1,1),VGRS(1,1),
     1 TGRS(1,1),QGRS(1,1,1),
     2         PSEXP,RB,CD,
     4         CDQ,FM,FH,TSTAR,QSS,EVAPC,EVAPD,
     5         SI,DEL,SL,SLK,RCL,DELTIM,LAT,KDT,THOUR,
     6  DUSFC1,DVSFC1,DTSFC1,DQSFC1,HPBL(1,LAT),GAMT,GAMQ)
C
      DO 340 J=1, 384
      DUSFC(J,LAT)=DUSFC(J,LAT)+DUSFC1(J)*DTF
      DVSFC(J,LAT)=DVSFC(J,LAT)+DVSFC1(J)*DTF
      DTSFC(J,LAT)=DTSFC(J,LAT)+DTSFC1(J)*DTF
      DQSFC(J,LAT)=DQSFC(J,LAT)+DQSFC1(J)*DTF
C-WAV IF(DTWAVE.GT.0.) THEN
C-WAV USTRGG(J,LAT)=USTRGG(J,LAT)+DUSFC1(J)*DTF
C-WAV VSTRGG(J,LAT)=VSTRGG(J,LAT)+DVSFC1(J)*DTF
C-WAV ENDIF
340   CONTINUE
C
      CALL GWDPS( 384 , 386 , 28 ,DVDT,DUDT,
     1 UGRS(1,1),VGRS(1,1),
     2 TGRS(1,1),QGRS(1,1,1),
     3  PSEXP,SI,DEL,CL,SL,RCL,DELTIM,LAT,KDT,HPRIME(1,LAT),
     4  DUSFCG,DVSFCG)
C
      DO 341 J=1, 384
      DUGWD(J,LAT)=DUGWD(J,LAT)+DUSFCG(J)*DTF
      DVGWD(J,LAT)=DVGWD(J,LAT)+DVSFCG(J)*DTF
341   CONTINUE
C
      CALL ZNLACM( 384 ,DUDT,PSEXP, DTF,NMUVRDF,LAT)
      CALL ZNLACM( 384 ,DVDT,PSEXP, DTF,NMVVRDF,LAT)
      CALL ZNLACM( 384 ,DTDT,PSEXP, DTF,NMTVRDF,LAT)
      CALL ZNLACM( 384 ,DQDT,PSEXP, DTF,NMQVRDF,LAT)
C-DG3 CALL ACCDIA( 384 ,DUDT, DTF,KDUVRDF,GDA)
C-DG3 CALL ACCDIA( 384 ,DVDT, DTF,KDVVRDF,GDA)
C-DG3 CALL ACCDIA( 384 ,DTDT, DTF,KDTVRDF,GDA)
C-DG3 CALL ACCDIA( 384 ,DQDT, DTF,KDQVRDF,GDA)
      IF(INISTP.LE.1) THEN
C.......................................................
C...      GET VERTICAL MOTION (CB/SEC) IN VVEL
C.......................................................
      CALL OMEGAS( 384 , 386 , 28 ,
     1            PPHIGRS(1),PLAMGRS(1),W2,
     1            UGRS(1,1),VGRS(1,1),
     2            XGRS(1,1),DEL,RBS2(LAT),VVEL,
     3            PSEXP,SL)
      ENDIF
C
C   W2 IS USED TO STORE WIND SPEED
C
      DO K=1, 28
       DO J=1, 384
          W2(J,K)=RCS*SQRT(UGRS(J,K)**2+VGRS(J,K)**2)
      ENDDO
      ENDDO
C
      DO 350 K=1, 28
      DO 350 J=1, 384
      GT0(J,K)=TGRS(J,K)+DTDT(J,K)*DT2
      GQ0(J,K,1)=QGRS(J,K,1)+DQDT(J,K)*DT2
      GU0(J,K)=UGRS(J,K)+DUDT(J,K)*DT2
      GV0(J,K)=VGRS(J,K)+DVDT(J,K)*DT2
  350 CONTINUE
C
C  OPERATIONALLY, NO PHYSICS IS DONE ON OTHER TRACERS
C
      DO 351 N=2, 1
      DO 351 K=1, 28
      DO 351 J=1, 384
      GQ0(J,K,N)=QGRS(J,K,N)
  351 CONTINUE
C
C  CALL TO GWATER
C
      IF(INISTP.LE.1) THEN
C.....
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP,-FRAIN,NMTCONV,LAT)
      CALL ZNLACM( 386 ,GQ0(1,1,1),PSEXP,-FRAIN,NMQCONV,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1),-FRAIN,KDTCONV,GDA)
C-DG3 CALL ACCDIA( 386 ,GQ0(1,1,1),-FRAIN,KDQCONV,GDA)
C-RAS IF (.NOT. RAS) THEN
      CALL SASCNV( 384 , 386 , 28 , 62 ,DELTIM,DEL,SL,SLK,PSEXP,
     2            GQ0(1,1,1),GT0(1,1),CLD1D,
     3            RAIN1,KBOT,KTOP,KUO,W2,LAT,SLMSK(1,LAT),VVEL)
C
      DO  J=1, 384
         CLDWRK(J,LAT) = CLDWRK(J,LAT) + CLD1D(J) * DTF
      ENDDO
C-RAS ELSE
C-RAS DTRAS = DELTIM / FRAIN
C-RAS IL1R = 1 + 8 *  384
C-RAS IL2R = IL1R + 10 *  384  * LM
C-RAS IL3R = IL2R +   384  * (5*LM+16)
C-RAS CALL RASCNV( 384 ,  386 ,  28 , LM, NSTRP, DTRAS, SI, SL
C-RAS*,           KRMIN, KRMAX, NCRND, AFAC, RANNUM, UFAC
C-RAS*,           RGAS, CP, GRAV, ALHL
C-RAS*,           GT0(1,1), GQ0(1,1,1)
C-RAS*,           GU0(1,1), GV0(1,1), PSEXP
C-RAS*,           RAIN1, KBOT, KTOP, KUO, LAT
C-RAS*,           SIG, PRJ, PRH, FPK, HPK, SGB, ODS, RASAL, PRNS
C-RAS*,           WRK(1), WRK(IL1R), WRK(IL2R)
C-RAS*,           WRK(IL3R), VVEL)
C-RAS CLD1D=0
C-RAS ENDIF
C
      DO 235 J=1, 384
      RAINC(J)=FRAIN*RAIN1(J)
      BENGSH(J,LAT)=BENGSH(J,LAT)+RAINC(J)
235   CONTINUE
      CALL CNVCLD(CLSTP, 384 ,RAINC,KBOT,KTOP,
     1            CV(1,LAT),CVB(1,LAT),CVT(1,LAT))
C
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP, FRAIN,NMTCONV,LAT)
      CALL ZNLACM( 386 ,GQ0(1,1,1),PSEXP, FRAIN,NMQCONV,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1), FRAIN,KDTCONV,GDA)
C-DG3 CALL ACCDIA( 386 ,GQ0(1,1,1), FRAIN,KDQCONV,GDA)
C.....
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP,-FRAIN,NMTSHAL,LAT)
      CALL ZNLACM( 386 ,GQ0(1,1,1),PSEXP,-FRAIN,NMQSHAL,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1),-FRAIN,KDTSHAL,GDA)
C-DG3 CALL ACCDIA( 386 ,GQ0(1,1,1),-FRAIN,KDQSHAL,GDA)
      CALL SHALCV( 384 , 386 ,LEVSHC,DELTIM,DEL,SI,SL,SLK,KUO,PSEXP,
     1            GQ0(1,1,1),GT0(1,1))
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP, FRAIN,NMTSHAL,LAT)
      CALL ZNLACM( 386 ,GQ0(1,1,1),PSEXP, FRAIN,NMQSHAL,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1), FRAIN,KDTSHAL,GDA)
C-DG3 CALL ACCDIA( 386 ,GQ0(1,1,1), FRAIN,KDQSHAL,GDA)
C.....
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP,-FRAIN,NMTLARG,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1),-FRAIN,KDTLARG,GDA)
      CALL LRGSCL( 384 , 386 , 28 ,DELTIM,PSEXP,
     1            GT0(1,1),GQ0(1,1,1),SL,DEL,SLK,
     &            RAIN1,LAT)
      CALL ZNLACM( 386 ,GT0(1,1),PSEXP, FRAIN,NMTLARG,LAT)
C-DG3 CALL ACCDIA( 386 ,GT0(1,1), FRAIN,KDTLARG,GDA)
C
      DO 440 J=1, 384
      RAINL(J)=FRAIN*RAIN1(J)
      RAIN(J)=RAINC(J)+RAINL(J)
      GESHEM(J,LAT)=GESHEM(J,LAT)+RAIN(J)
  440 CONTINUE
C
C  ESTIMATE T850 FOR RAIN-SNOW DECISION
C
      DO J = 1,  384
        PK(J) = PSEXP(J) * SL(1)
        T850(J) = GT0(J,1)
      ENDDO
      DO K = 1,  28  - 1
        DO J = 1,  384
          PKP(J) = PSEXP(J) * SL(K+1)
          IF(PK(J) .LE. P850 .AND. PKP(J) .GT. P850) THEN
            T850(J) = GT0(J,K) - (PK(J) - P850) /
     &                (PK(J) - PKP(J)) * (GT0(J,K)
     &                - GT0(J,K+1))
          ENDIF
          PK(J) = PKP(J)
        ENDDO
      ENDDO
C
C  FACTOR=WEIGHTED MEAN TEP.
      DO 450 J=1, 384
      IF(T850(J).LE.273.16) THEN
        IF(SLMSK(J,LAT).NE.0.) SHELEG(J,LAT)=SHELEG(J,LAT)+1.E3*RAIN(J)
        RAIN(J)=0.
      ENDIF
  450 CONTINUE
C
C
C  UPDATE SOIL MOISTURE AND CANOPY WATER AFTER PRECIPITATION HAS BEEN
C  COMPUTED
C
      CALL PROGT2( 384 , 2 ,RHSCNPY,RHSMC,AI,BI,CCI,SMSOIL,
     &  SLMSK(1,LAT),CANOPY(1,LAT),RAIN,RUNOF,SNOWMT,
     &  ZSOIL,SOILTYP,SIGMAF,DELTIM,LAT)
C
C  TOTAL RUNOFF IS COMPOSED OF DRAINAGE INTO WATER TABLE AND
C  RUNOFF AT THE SURFACE AND IS ACCUMULATED IN UNIT OF METERS
C
      DO J = 1,  384
        RUNOFF(J,LAT) = (DRAIN(J) + RUNOF(J)) * DTF / 1000.
     &                + RUNOFF(J,LAT)
      ENDDO
C
C  RETURN UPDATED SMSOIL AND STSOIL TO GLOBAL ARRAYS
C
      DO K = 1,  2
        DO J = 1,  384
          SMC(J,LAT,K) = SMSOIL(J,K)
          STC(J,LAT,K) = STSOIL(J,K)
        ENDDO
      ENDDO
      ENDIF
C
C  ZONAL DIAGNOSTICS
C
      IF(LASTEP) THEN
      SECPHY=SHOUR
      SECRAD=MAX(SHOUR,3600.*DTSWAV)
      CALL ZNLAVB(LAT, 384 , 386 , 28 ,SECPHY,SECRAD,
     &        RBS2(LAT),SI,SL,DEL,PSEXP,GESHEM(1,LAT),BENGSH(1,LAT),
     &        DUSFC(1,LAT),DVSFC(1,LAT),DTSFC(1,LAT),DQSFC(1,LAT),
     &        DUGWD(1,LAT),DVGWD(1,LAT),
     &        SLMSK(1,LAT),SHELEG(1,LAT),TSEA(1,LAT),
     &        SMC(1,LAT, 2 ),STC(1,LAT,1),STC(1,LAT, 2 ),
     &        TG3(1,LAT),ZORL(1,LAT),EP(1,LAT),CLDWRK(1,LAT),
     &        DLWSFC(1,LAT),ULWSFC(1,LAT),
     &        XGRS,GT0,GQ0(1,1,1),PLAMGRS,PPHIGRS,GU0,GV0)
      ENDIF
C
C  GRID POINT DIAGNOSTICS
C
      CALL KENPUT(LAT,RCL,
     &        SLMSK(1,LAT),PSEXP,TG3(1,LAT),SHELEG(1,LAT),RADSL,DLWSF1,
     &        TSEA(1,LAT),QSS,PLANTR(1,LAT),GFLX,ZORL(1,LAT),CD,CDQ,
     &        RNET,EVAP,HFLX,STSOIL,
     &        CANOPY(1,LAT),DRAIN,SMSOIL,RUNOF,CLD1D,
     &        U10M(1,LAT),V10M(1,LAT),T2M(1,LAT),Q2M(1,LAT),
     &        HPBL(1,LAT),GAMT,GAMQ,
     &        DQSFC1,DTSFC1,DUSFC1,DVSFC1,
     &        DUSFCG,DVSFCG,
     &        RAINC,RAINL,
     &        GU0(1,1),GV0(1,1),
     &        GT0(1,1),GQ0(1,1,1),
     &        HSW,HLW(1,1,LAT),VVEL)
C
      DO 4901 J=1, 384
      PWAT(J,LAT)=0.
 4901 CONTINUE
      DO 490 K=1, 28
      DO 490 J=1, 384
      GT0(J,K)=GT0(J,K)*(1.+FV*GQ0(J,K,1))
      PWAT(J,LAT)=PWAT(J,LAT)+DEL(K)*GQ0(J,K,1)
  490 CONTINUE
      DO 4902 J=1, 384
      PWAT(J,LAT)=PWAT(J,LAT)*PSEXP(J)*(1.E3/ 9.8000E+0 )
 4902 CONTINUE
C
      RETURN
      END
