C-----------------------------------------------------------------------
CFPP$ NOCONCUR R
      FUNCTION FTMAQ(THE,PK,QMA)
C$$$     SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM: FTMAQ        COMPUTE MOIST ADIABAT TEMPERATURE
C   AUTHOR: N PHILLIPS            W/NMC2X2   DATE: 30 DEC 82
C
C ABSTRACT: COMPUTE TEMPERATURE AND SPECIFIC HUMIDITY OF A PARCEL
C   LIFTED UP A MOIST ADIABAT FROM EQUIVALENT POTENTIAL TEMPERATURE
C   AT THE LCL AND PRESSURE OVER 100 KPA TO THE KAPPA POWER.
C   BIQUADRATIC INTERPOLATIONS ARE DONE BETWEEN VALUES IN A LOOKUP TABLE
C   COMPUTED IN GTMA. SEE DOCUMENTATION FOR FTMAXG FOR DETAILS.
C   INPUT VALUES OUTSIDE TABLE RANGE ARE RESET TO TABLE EXTREMA.
C   THE INTERPOLATION ACCURACY IS BETTER THAN 0.0005 KELVIN
C   AND 1.E-7 KG/KG FOR TEMPERATURE AND HUMIDITY, RESPECTIVELY.
C   ON THE CRAY, FTMAQ IS ABOUT 25 TIMES FASTER THAN EXACT CALCULATION.
C   THIS FUNCTION SHOULD BE EXPANDED INLINE IN THE CALLING ROUTINE.
C
C PROGRAM HISTORY LOG:
C   91-05-07  IREDELL             MADE INTO INLINABLE FUNCTION
C   94-12-30  IREDELL             QUADRATIC INTERPOLATION
C
C USAGE:   TMA=FTMAQ(THE,PK,QMA)
C
C   INPUT ARGUMENT LIST:
C     THE      - REAL EQUIVALENT POTENTIAL TEMPERATURE IN KELVIN
C     PK       - REAL PRESSURE OVER 100 KPA TO THE KAPPA POWER
C
C   OUTPUT ARGUMENT LIST:
C     FTMAQ    - REAL PARCEL TEMPERATURE IN KELVIN
C     QMA      - REAL PARCEL SPECIFIC HUMIDITY IN KG/KG
C
C COMMON BLOCKS:
C   COMMA    - SCALING PARAMETERS AND TABLE COMPUTED IN GTMA.
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN 77.
C   MACHINE:  CRAY.
C
C$$$
      PARAMETER(NX=151,NY=121)
      DIMENSION TBTMA(NX,NY),TBQMA(NX,NY)
      COMMON/COMMA/ C1XMA,C2XMA,C1YMA,C2YMA,TBTMA,TBQMA
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      XJ=MIN(MAX(C1XMA+C2XMA*THE,1.),FLOAT(NX))
      YJ=MIN(MAX(C1YMA+C2YMA*PK,1.),FLOAT(NY))
      JX=MIN(MAX(NINT(XJ),2),NX-1)
      JY=MIN(MAX(NINT(YJ),2),NY-1)
      DXJ=XJ-JX
      DYJ=YJ-JY
      FT11=TBTMA(JX-1,JY-1)
      FT12=TBTMA(JX-1,JY)
      FT13=TBTMA(JX-1,JY+1)
      FT21=TBTMA(JX,JY-1)
      FT22=TBTMA(JX,JY)
      FT23=TBTMA(JX,JY+1)
      FT31=TBTMA(JX+1,JY-1)
      FT32=TBTMA(JX+1,JY)
      FT33=TBTMA(JX+1,JY+1)
      FTX1=(((FT31+FT11)/2-FT21)*DXJ+(FT31-FT11)/2)*DXJ+FT21
      FTX2=(((FT32+FT12)/2-FT22)*DXJ+(FT32-FT12)/2)*DXJ+FT22
      FTX3=(((FT33+FT13)/2-FT23)*DXJ+(FT33-FT13)/2)*DXJ+FT23
      FTMAQ=(((FTX3+FTX1)/2-FTX2)*DYJ+(FTX3-FTX1)/2)*DYJ+FTX2
      Q11=TBQMA(JX-1,JY-1)
      Q12=TBQMA(JX-1,JY)
      Q13=TBQMA(JX-1,JY+1)
      Q21=TBQMA(JX,JY-1)
      Q22=TBQMA(JX,JY)
      Q23=TBQMA(JX,JY+1)
      Q31=TBQMA(JX+1,JY-1)
      Q32=TBQMA(JX+1,JY)
      Q33=TBQMA(JX+1,JY+1)
      QX1=(((Q31+Q11)/2-Q21)*DXJ+(Q31-Q11)/2)*DXJ+Q21
      QX2=(((Q32+Q12)/2-Q22)*DXJ+(Q32-Q12)/2)*DXJ+Q22
      QX3=(((Q33+Q13)/2-Q23)*DXJ+(Q33-Q13)/2)*DXJ+Q23
      QMA=(((QX3+QX1)/2-QX2)*DYJ+(QX3-QX1)/2)*DYJ+QX2
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      RETURN
      END
