      SUBROUTINE RADFS (IX,IX2,
     1                  QS,PP,QQH2O,TT,O3QO3,TSFC,SLMSK,ALBEDO,XLAT,
CYH931                  CLDS,CEMIS,MTOP,MBOT,COSZRO,TAUDAR,IBEG,IPTS,
CYH941                  CLDS,CEMIS,MTOP,MBOT,CLDARY,IEMIS,EMIS0,TAUC0,
     1                                        CLDARY,
     1                  COSZRO,TAUDAR,
CYH93...
CYH942                  LAT,KO3,KEMIS,KALB,IPT,JPOINT,
     2                  LAT,KO3,      KALB,IPT,JPOINT,
     3                  SLMRF,SLYMRF,ITIMSW,ITIMLW,SWH,HLW,
CSIB 4                  FLWUP,FSWUP,FSWDN,FSWDNS,FSWUPS,FLWDNS,FLWUPS)
     4                  FLWUP,FSWUP,FSWDN,FSWDNS,FSWUPS,FLWDNS,FLWUPS,
C-CLR5                  FLWUP0,FSWUP0,SSWDN0,SSWUP0,SLWDN0,
     5                  ALVBR,ALNBR,ALVDR,ALNDR,
     6                  GDFVBR,GDFNBR,GDFVDR,GDFNDR,
     7                  SOLC,RSIN1,RCOS1,RCOS2)
CSIB
CFPP$ NOCONCUR R
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C                .      .    .                                       .
C SUBPROGRAM:    RADFS       INTERFACE BETWIXT GLOOPR AND GFDL RADI8
C   PRGMMR: KENNETH CAMPANA  ORG: W/NMC23    DATE: 89-07-07
C           BERT B. KATZ     ORG: W/NMC23    DATE: 91-03-15
C
C ABSTRACT: PREPARES DATA FOR -SW- AND -LW- RADIATION CALCULATIONS.
C   E.G. FLIP VERTICAL COORDINATE (NMC K=1 IS LOWEST LAYER,WHILE FOR
C   GFDL K=1 IS TOPMOST LAYER),COMPUTE SFC ALBEDO OVER OPEN WATER,
C   PUT CLOUD DATA IN PROPER LOCATIONS,ETC..
C   RADFS THEN CALLS
C   SWR89  (-SW- CALCULATIONS) AND LWR88  (-LW- COMPUTATIONS).
C   FINALLY,RADIATIVE HEATING RATES AND BOUNDARY FLUXES ARE RETURNED
C   TO SUBROUTINE GLOOPR, ITSELF CALLED FROM THE MRF.
C
C PROGRAM HISTORY LOG:
C   84-01-01  GFDL
C   89-07-07  KENNETH CAMPANA - EXTENSIVE REVISIONS FOR
C                               PLUG COMPATIBILITY....
C   89-07-07  BERT KATZ (CENTEL CORP) - REVISION OF SEVERAL
C                               SECTIONS WITH VECTOR CODING.
C   89-10-19  KENNETH CAMPANA - USE-SLI-MASK IN PLACE OF TSEA TO
C                               DETERMINE OPEN WATER(SFC ALBEDO CALC)
C   89-11-29  KENNETH CAMPANA - INTERFACE WITH NEWEST VERSION OF GFDL
C                               LW RADIATION AND DEVECTORIZE FOR
C                               BENCHMARK.
C   91-03-15  BERT KATZ (CENTEL CORP) - MODIFIED FOR USE WITHIN
C                               THE MRF. MOST ASTRONOMICAL
C                               CALCULATIONS REMOVED AND ARE NOW
C                               IN THE NEW RADIATION DRIVER,
C                               SUBROUTINE GLOOPR. OTHER
C                               ONE-TIME CALCULATIONS MOVED
C                               TO SUBROUTINE GRADFS.
C                               ALL CODES AGAIN VECTORIZED,
C                               THIS TIME FOR THE CRAY Y-MP.
C
C USAGE:    CALL RADFS (QS,PP,QQH2O,TT,O3QO3,TSFC,SLMSK,ALBEDO,
C                       XLAT,XLON,COSZN,CLDS,CEMIS,MTOP,MBOT,CZMN,
C                       IBEG,IPTS,DTRAD,LAT,
C                       KDAPRX,KO3,KCZ,KEMIS,KALB,
C                       KCIRC,KMSK,ICHECK,IPT,JPOINT,
C                       SLMRF,SLYMRF,ITIMLW,ITIMSW,SWH,HLW,
C                       FLWUP,FSWUP,FSWDN,FSWDNS,FSWUPS,FLWDNS,FLWUPS)
C
C   INPUT ARGUMENT LIST:
C     QS      - SFC PRESSURE (CB)
C     PP      - LAYER PRESSURE (CB)-LYR 1 IS BOTTOMMOST LYR
C     QQH2O   - LAYER MOISTURE (G/G)
C     TT      - LAYER TEMPERATURE (DEG K)
C     TSFC    - SURFACE TEMPERATURE(DEG K)
C     SLMSK   - SEA(0),LAND(1),SEAICE(2) MASK
C     ALBEDO  - SFC ALBEDO(FRACTION) - ITS ASSUMED THAT SNOW
C               EFFECTS ON ALBEDO ARE ALREADY INCLUDED.
C     XLAT    - LATITUDE (DEG) FOR EACH POINT (S.HEMIS.=NEG)
C     XLON    - LONGITUDE(DEG) FOR EACH POINT
C     CLDS    - CLD FRACTION H,M,L (3 CLD TYPES)
C     MTOP    - CLD TOP(MODEL LYR)=H,M,L
C     MBOT    - CLD BOT(MODEL LYR)=H,M,L
C     IBEG    - STARTING POINT IN DOMAIN DEPENDENT INPUT, OUTPUT ARRAYS.
C     IPTS    - NUMBER OF POINTS FOR WHICH RADIATON IS TO BE PERFORMED.
C     LAT     - GRID ROW NUMBER
C     KDAPRX  - SW DIURNAL APPROX(=1),,=0 MEANS INSTANTANEOUS SW.
C     KO3     - O3 SWITCH(=1,USE INPUT QO3-=0,USE CLIMO INTERP)
C     KCZ     - COSZRO SWITCH (1,USE INPUT-=0,COMPUTE HEREIN-MRF)
C     KEMIS   - HI CLD EMISS SWTCH(=1,USE INPUT-=0,USE DEFAULT)
C     KALB    - OPEN WATER SFCALB(=1,USE INPUT-=0,USE PAYNE DATA)
C     KCIRC   - VALUE OF 1-5 REFERS TO MCCLATCHEY PROFILE OF O3
C               (1=TROPICAL)
C     KMSK    - 0=OPEN WATER, 1=LAND, 2=SEA ICE
C     IPT     - LONGITUDINAL INDEX OF DEBUG POINT. 0=NO DEBUG OUTPUT
C     JPOINT  - LATITUDINAL INDEX OF DEBUG POINT. 0=NO DEBUG OUTPUT
C     SLMRF   - SIGMA VALES AT INTERFACES
C     SLYMRF  - SIGMA VALES AT LAYERS
C     ITIMLW  - 1=PERFORM LONG WAVE CALCULATIONS, 0=DON'T DO LONG WAVE
C     ITIMSW  - 1=PERFORM SHORT WAVE CALCULATIONS, 0=DON'T DO SHORT WAVE
C    POSSIBLE INPUT:
C     O3QO3   - LAYER OZONE (G/G) - USED IF KO3=1
C     COSZN   - COSINE ZENITH ANGLE - USED IF KCZ=1
C     CEMIS   - HI CLD EMISSIVITY - USED IF KEMIS=1
C     CZMN    - LATITUDINAL DAYLIGHT MEAN OF COSINE ZENITH ANGLE-
C               USED IF KDAPRX=1.
C     DTRAD   - RADIATIVE TIMESTEP=NUM HRS BETWEEN CALLS TO SWR89.
C               NEEDED FOR CALL TO ZENITH - IF KCZ=0
C
C   OUTPUT ARGUMENT LIST:
C     SWH     - LAYER SW HEATING RATES (DEG/SEC)
C     HLW     - LAYER LW HEATING RATES (DEG/SEC)
C     FLWUP   - T.O.A. UPWARD LW FLUX (W/M2)
C     FSWUP   - T.O.A. UPWARD SW FLUX (W/M2)
C     FSWDN   - T.O.A. DNWARD SW FLUX (W/M2)
C     FSWDNS  - SFC    DNWARD SW FLUX (W/M2)
C     FSWUPS  - SFC    UPWARD SW FLUX (W/M2)
C     FLWDNS  - SFC    DNWARD LW FLUX (W/M2)
C     FLWUPS  - SFC    UPWARD LW FLUX (W/M2)
C
C   OUTPUT FILES:
C     OUTPUT   - PRINT FILE.
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN 200.
C   MACHINE:  CYBER 205.
C
C$$$
C      ****************************************************************
C      *  GENERALIZED FOR PLUG-COMPATIBILITY -                        *
C      *    ORIGINAL CODE WAS CLEANED-UP GFDL CODE...K.CAMPANA MAR89..*
C......*  EXAMPLE FOR MRF:                                            *
C      *    KO3  =0  AND O3QO3=DUMMY ARRAY.   (GFDL CLIMO O3 USED)    *
CYH94       NO KEMIS
C      *    KALB =0  AND SFC ALBEDO OVER OPEN WATER COMPUTED BELOW... *
C      *    KCCO2=0,CO2 OBTAINED FROM BLOCK DATA                      *
C      *         =1,CO2 COMPUTED IN HERE --- NOT AVAILABLE YET...     *
C      *    SLMRF = INTERFACE (LEVELS) SIGMA                          *
C      *    SLYMRF= LAYER SIGMA                                       *
C      *  UPDATED FOR YUTAI HOU SIB SW RADIATION....KAC 6 MAR 92      *
C      *    OCEAN ALBEDO FOR BEAM SET TO BULK SFCALB, SINCE           *
C      *       COSINE ZENITH ANGLE EFFECTS ALREADY THERE(REF:PAYNE)   *
C      *       SLMSK = 0.                                             *
C      *    SNOW ICE ALBEDO FOR BEAM NOT ENHANCED VIA COSINE ZENITH   *
C      *       ANGLE EITHER CAUSE VALU ALREADY HIGH (WE SEE POLAR     *
C      *       COOLING IF WE DO BEAM CALCULATION)....KAC 17MAR92      *
C      *       ALBEDO GE .5                                           *
C      *   UPDATED TO OBTAIN CLEAR SKY FLUXES "ON THE FLY" FOR        *
C      *       CLOUD FORCING DIAGNOSTICS ELSEWHERE...KAC 7AUG92       *
C      *       SEE C-CLR LINES...RADFS,LWR88,FST88,SPA88 .......      *
CYH93...
C      *  UPDATED FOR USE NEW CLD SCHEME      ......YH  DEC 92        *
CYH94 NOT   INPUT CLD MAY BE AS ORIGINAL IN 3 DOMAIN (CLD,MTOP,MBOT)  *
C      *       OR IN A VERTICAL ARRAY OF 28 MDL LAYERS (CLDARY)       *
CYH94 NOT   IEMIS=0  USE THE ORG. CLD EMIS SCHEME                     *
CYH94 NOT        =1  USE TEMP DEP. CLD EMIS SCHEME                    *
C      *  UPDATED TO COMPUTE CLD LAYER REFLECTANCE AND TRANSMITANCE   *
C      *    INPUT CLD EMISSIVITY AND OPTICAL THICKNESS 'EMIS0,TAUC0'  *
C      *                                      ......YH FEB 93         *
CYH93...
CYH94...
C      *  UPDATED FOR USE NEW CLD SCHEME      ......YH  DEC 93        *
C      *    INPUT            CLOUD FRACTIONS IN CLDARY, THE           *
C      *       STRATIFORM (STR) AND THE CONVECTIVE (CNV) TYPES OF     *
C      *       CLOUD ARE CONBINED AS CLDARY = STR + 1.E4 * CNV        *
C      *       THE MARINE STRATUS CLD IN STR TYPE IS FLAGGED BY       *
C      *       ADDING A VALUE OF 2.                                   *
C      *    CLOUD RADIATIVE PROPERTIES ARE HANDLED BY SUBROUTINE      *
C      *       CLDPRP, IN WHICH SW REFLECTANCE, TRANSMITANCE, AND     *
C      *       LW EMISSIVITY ARE CALCULATED AND ARE PUT INTO PROPER   *
C      *       ARRAYS FOR RADIATION COMPUTATIONS.                     *
CYH94...
C      ****************************************************************
C
      COMMON/PHYCON/AMOLWT,CSUBP,DIFFCTR,G,GRAVDR,O3DIFCTR,P0,
     *            P0XZP2,P0XZP8,P0X2,RADCON,RGAS,RGASSP,SECPDA
      COMMON/PHYCON/RATCO2MW,RATH2OMW
      COMMON/PHYCON/RADCON1
      COMMON/PHYCON/GINV,P0INV,GP0INV
      COMMON/HCON/HUNDRED,HNINETY,SIXTY,FIFTY,TEN,EIGHT,FIVE,
     *            FOUR,THREE,TWO,ONE,HAF,QUARTR,ZERO
      COMMON/HCON/H83E26,H71E26,H1E15,H1E13,H1E11,H1E8,H4E5,
     *            H165E5,H5725E4,H488E4,H1E4,H24E3,H20788E3,
     *            H2075E3,H1224E3,H5E2,H3082E2,H3E2,H2945E2,
     *            H23E2,H15E2,H35E1,H3P6,H181E1,H18E1,H2P9,H2P8,
     *            H2P5,H1P8,H1P4387,H1P4,H1P25892,HP8,HP518,
     *            HP369,HP1
      COMMON/HCON/H44871M2,H559M3,H1M3,H987M4,H285M4,H1M4,
     *            H6938M5,H394M5,H37412M5,H1439M5,H128M5,H1M5,
     *            H7M6,H4999M6,H25452M6,H1M6,H391M7,H1174M7,
     *            H8725M8,H327M8,H257M8,H1M8,H23M10,H14M10,
     *            H11M10,H1M10,H83M11,H82M11,H8M11,H77M11,
     *            H72M11,H53M11,H48M11,H44M11,H42M11,H37M11,
     *            H35M11,H32M11,H3M11,H28M11,H24M11,H23M11,
     *            H2M11,H18M11,H15M11,H14M11,H114M11,H11M11,
     *            H1M11,H96M12,H93M12,H77M12,H74M12,H65M12,
     *            H62M12,H6M12,H45M12,H44M12,H4M12,H38M12,
     *            H37M12,H3M12,H29M12,H28M12,H24M12,H21M12,
     *            H16M12,H14M12,H12M12,H8M13,H46M13,H36M13,
     *            H135M13,H12M13,H1M13,H3M14,H15M14,H14M14,
     *            H1M17,H1M18,H1M19,H1M20,H1M21,H1M22,H1M23,
     *            H1M24,H26M30,H14M30,H25M31,H21M31,H12M31,
     *            H9M32,H55M32,H45M32,H4M33,H62M34,H1M60
      COMMON/HCON/HMP575,HM13EZ,HM19EZ,HM1E1,HM181E1,HM1E2
      COMMON/HCON/H1E6,H2E6,H1M2,HMP66667,HM6666M2,HP166666,
     *            H41666M2,HMP5,HM2M2,H29316E2,H1226E1,H3116E1,
     *            H9P94,HP6,H625M2,HP228,HP60241,HM1797E1,
     *            H8121E1,H2E2,HM1EZ,H26E2,H44194M2,H1P41819
      COMMON/HCON/HP219,HP144,HP816,H69766E5,H235M3,HP26,
     *            H129M2,H75826M4,H1P082,HP805,H1386E2,
     *            H658M2,H1036E2,H2118M2,H42M2,H323M4,
     *            H67390E2,HP3795,HP5048,H102M5,H451M6
      COMMON/HCON/H16E1,HM161E1,H161E1,H3M3,H101M16,
     *            HM1597E1,H25E2,HP118666,H15M5,H3P5,H18E3,
     *            H6P08108,HMP805,HP602409,HP526315,
     *            H28571M2,H1M16
      COMMON/HCON/H3M4
      COMMON/HCON/HM8E1
      COMMON/HCON/H28E1
C     PARAMETER SETTINGS FOR THE LONGWAVE AND SHORTWAVE RADIATION CODE:
C          IMAX   =  NO. POINTS ALONG THE LAT. CIRCLE USED IN CALCS.
C          L      =  NO. VERTICAL LEVELS (ALSO LAYERS) IN MODEL
C***NOTE: THE USER NORMALLY WILL MODIFY ONLY THE IMAX AND L PARAMETERS
C          NBLW   =  NO. FREQ. BANDS FOR APPROX COMPUTATIONS. SEE
C                      BANDTA FOR DEFINITION
C          NBLX   =  NO. FREQ BANDS FOR APPROX CTS COMPUTATIONS
C          NBLY   =  NO. FREQ. BANDS FOR EXACT CTS COMPUTATIONS. SEE
C                      BDCOMB FOR DEFINITION
C          INLTE  =  NO. LEVELS USED FOR NLTE CALCS.
C          NNLTE  =  INDEX NO. OF FREQ. BAND IN NLTE CALCS.
C          NB,KO2 ARE SHORTWAVE PARAMETERS; OTHER QUANTITIES ARE DERIVED
C                    FROM THE ABOVE PARAMETERS.
      PARAMETER (L= 28 )
      PARAMETER (IMAX= 64 )
      PARAMETER (IMBX=IMAX+1)
      PARAMETER (NBLW=163,NBLX=47,NBLY=15)
      PARAMETER (NBLM=NBLY-1)
      PARAMETER (LP1=L+1,LP2=L+2,LP3=L+3)
      PARAMETER (LM1=L-1,LM2=L-2,LM3=L-3)
      PARAMETER (LL=2*L,LLP1=LL+1,LLP2=LL+2,LLP3=LL+3)
      PARAMETER (LLM1=LL-1,LLM2=LL-2,LLM3=LL-3)
      PARAMETER (LP1M=LP1*LP1,LP1M1=LP1M-1)
      PARAMETER (LP1V=LP1*(1+2*L/2))
      PARAMETER (LP121=LP1*NBLY)
      PARAMETER (LL3P=3*L+2)
      PARAMETER (NB=12)
      PARAMETER (INLTE=3,INLTEP=INLTE+1,NNLTE=56)
      PARAMETER (NB1=NB-1)
      PARAMETER (KO2=12)
      PARAMETER (KO21=KO2+1,KO2M=KO2-1)
      PARAMETER (LNGTH=37*L)
      PARAMETER (NRCHNK=( 256 -1)/IMAX+1)
C    COMMON BLOCK BANDTA CONTAINS RANDOM BAND PARAMETERS FOR THE LW
C    CALCULATIONS USING 10 CM-1 WIDE BANDS.THE 15 UM CO2 COMPLEX
C    IS 2 BANDS,560-670 AND 670-800 CM-1. OZONE COEFFICIENTS ARE
C    IN 3 BANDS,670-800 (14.1 UM),990-1070 AND 1070-1200 (9.6 UM).
C    THE  (NBLW) BANDS NOW INCLUDE:
C                56 BANDS, 10  CM-1 WIDE    0  -   560  CM-1
C                 2 BANDS, 15 UM COMPLEX  560  -   670  CM-1
C                                         670  -   800  CM-1
C                 3 "CONTINUUM" BANDS     800  -   900  CM-1
C                                         900  -   990  CM-1
C                                        1070  -   1200 CM-1
C                 1 BAND FOR 9.6 UM BAND  990  -   1070 CM-1
C               100 BANDS, 10 CM-1 WIDE  1200  -   2200 CM-1
C                 1 BAND FOR 4.3 UM SRC  2270  -   2380 CM-1
C    THUS NBLW PRESENTLY EQUALS    163
C    ALL BANDS ARE ARRANGED IN ORDER OF INCREASING WAVENUMBER
C
C        ARNDM   =   RANDOM "A" PARAMETER FOR (NBLW) BANDS
C        BRNDM   =   RANDOM "B" PARAMETER FOR (NBLW) BANDS
C        BETAD   =   CONTINUUM COEFFICIENTS FOR (NBLW) BANDS
C        AP,BP   =   CAPPHI COEFFICIENTS FOR (NBLW) BANDS
C        ATP,BTP =   CAPPSI COEFFICIENTS FOR (NBLW) BANDS
C        BANDLO  =   LOWEST FREQUENCY IN EACH OF (NBLW) FREQ. BANDS
C        BANDHI  =   HIGHEST FREQUENCY IN EACH OF (NBLW) FREQ. BANDS
C        AO3RND  =   RANDOM "A" PARAMETER FOR OZONE IN (3) OZONE
C                    BANDS
C        BO3RND  =   RANDOM "B" PARAMETER FOR OZONE IN (3) OZONE
C                    BANDS
C        AB15    =   THE PRODUCT ARNDM*BRNDM FOR THE TWO BANDS
C                    REPRESENTING THE 15 UM BAND COMPLEX OF CO2
C     DATA FOR ARNDM,BRNDM,AP,BP,ATP,BTP,AO3RND,BO3RND ARE OBTAINED BY
C     USING THE AFGL 1982 CATALOG. CONTINUUM COEFFICIENTS ARE FROM
C     ROBERTS (1976).
      COMMON / BANDTA / ARNDM(NBLW),BRNDM(NBLW),BETAD(NBLW),AP(NBLW),
     1                  BP(NBLW),ATP(NBLW),BTP(NBLW),BANDLO(NBLW),
     2                  BANDHI(NBLW),AO3RND(3),BO3RND(3),AB15(2)
C
C    COMMON BLOCK BDWIDE CONTAINS RANDOM BAND PARAMETERS FOR SPECIFIC
C    WIDE BANDS. AT PRESENT,THE INFORMATION CONSISTS OF 1) RANDOM
C    MODEL PARAMETERS FOR THE 15 UM BAND,560-800 CM-1; 2) THE
C    CONTINUUM COEFFICIENT FOR THE 800-990,1070-1200 CM-1 BAND
C        SPECIFICALLY:
C        AWIDE       =   RANDOM "A" PARAMETER FOR  BAND
C        BWIDE       =   RANDOM "B" PARAMETER FOR  BAND
C        BETAWD      =   CONTINUUM COEFFICIENTS FOR BAND
C        APWD,BPWD   =   CAPPHI COEFFICIENTS FOR  BAND
C        ATPWD,BTPWD =   CAPPSI COEFFICIENTS FOR BAND
C        BDLOWD      =   LOWEST FREQUENCY IN EACH  FREQ  BAND
C        BDHIWD      =   HIGHEST FREQUENCY IN EACH FREQ  BAND
C        AB15WD      =   THE PRODUCT ARNDM*BRNDM FOR THE ONE BAND
C                        REPRESENTING THE 15 UM BAND COMPLEX OF CO2
C        BETINW      =   CONT.COEFFICIENT FOR A SPECIFIED WIDE
C                        FREQ.BAND (800-990 AND 1070-1200 CM-1).
C        SKO2D       =   1./BETINW, USED IN SPA88 FOR CONT. COEFFS
C        SKC1R       =   BETAWD/BETINW, USED FOR CONT. COEFF. FOR
C                        15 UM BAND IN FST88
C        SKO3R       =   RATIO OF CONT. COEFF. FOR 9.9 UM BAND TO
C                        BETINW, USED FOR 9.6 UM CONT COEFF IN FST88
C     DATA FOR AWIDE,BWIDE,APWD,BPWD,ATPWD,BTPWD,AO3WD,BO3WD ARE
C     OBTAINED BY USING THE AFGL 1982 CATALOG. CONTINUUM COEFFICIENTS
C     ARE FROM ROBERTS (1976).
      COMMON / BDWIDE / AWIDE,BWIDE,BETAWD,
     1                  APWD,BPWD,ATPWD,BTPWD,
     2                  BDLOWD,BDHIWD,BETINW,
     3                  AB15WD,SKO2D,SKC1R,SKO3R
C
C    COMMON BLOCK BDCOMB CONTAINS RANDOM BAND PARAMETERS FOR THE LW
C    CALCULATIONS USING COMBINED WIDE FREQUENCY BANDS BETWEEN 160 AND
C    1200 CM-1,AS WELL AS THE 2270-2380 BAND FOR SOURCE CALC.
C        BANDS 1-8: COMBINED WIDE FREQUENCY BANDS FOR 160-560 CM-1
C        BANDS 9-14: FREQUENCY BANDS,AS IN BANDTA (NARROW BANDS)
C                    FOR 560-1200 CM-1
C        BAND  15:  FREQUENCY BAND 2270-2380 CM-1,USED FOR SOURCE
C                   CALCULATION ONLY
C        THUS NBLY PRESENTLY EQUALS   15
C
C        BANDS ARE ARRANGED IN ORDER OF INCREASING WAVENUMBER
C        ACOMB       =   RANDOM "A" PARAMETER FOR (NBLY) BANDS
C        BCOMB       =   RANDOM "B" PARAMETER FOR (NBLY) BANDS
C        BETACM      =   CONTINUUM COEFFICIENTS FOR (NBLY) BANDS
C        APCM,BPCM   =   CAPPHI COEFFICIENTS FOR (NBLY) BANDS
C        ATPCM,BTPCM =   CAPPSI COEFFICIENTS FOR (NBLY) BANDS
C        BDLOCM      =   LOWEST FREQUENCY IN EACH OF (NBLY) FREQ. BANDS
C        BDHICM      =   HIGHEST FREQUENCY IN EACH OF (NBLY) FREQ. BANDS
C        AO3CM       =   RANDOM "A" PARAMETER FOR OZONE IN (3) OZONE
C                        BANDS
C        BO3CM       =   RANDOM "B" PARAMETER FOR OZONE IN (3) OZONE
C                        BANDS
C        AB15CM      =   THE PRODUCT ARNDM*BRNDM FOR THE TWO BANDS
C                        REPRESENTING THE 15 UM BAND COMPLEX OF CO2
C        BETINC      =   CONT.COEFFICIENT FOR A SPECIFIED WIDE
C                        FREQ.BAND (800-990 AND 1070-1200 CM-1).
C        IBAND       =   INDEX NO OF THE 40 WIDE BANDS USED IN
C                        COMBINED WIDE BAND CALCULATIONS. IN OTHER
C                        WORDS,INDEX TELLING WHICH OF THE 40 WIDE
C                        BANDS BETWEEN 160-560 CM-1 ARE INCLUDED IN
C                        EACH OF THE FIRST 8 COMBINED WIDE BANDS
C     DATA FOR ACOMB,BCOMB,APCM,BPCM,ATPCM,BTPCM,AO3CM,BO3CM ARE
C     OBTAINED BY USING THE AFGL 1982 CATALOG. CONTINUUM COEFFICIENTS
C     ARE FROM ROBERTS (1976). IBAND INDEX VALUES ARE OBTAINED BY
C     EXPERIMENTATION.
      COMMON / BDCOMB / IBAND(40),ACOMB(NBLY),BCOMB(NBLY),
     1                  BETACM(NBLY),APCM(NBLY),BPCM(NBLY),ATPCM(NBLY),
     2                  BTPCM(NBLY),BDLOCM(NBLY),BDHICM(NBLY),BETINC,
     3                  AO3CM(3),BO3CM(3),AB15CM(2)
C
C   THE FOLLOWING COMMON BLOCKS CONTAIN PRETABULATED CO2 TRANSMISSION
C       FUNCTIONS, EVALUATED USING THE METHODS OF FELS AND
C       SCHWARZKOPF (1981) AND SCHWARZKOPF AND FELS (1985),
C***COMMON CO2BD3 CONTAINS CO2 TRANSMISSION FUNCTIONS AND TEMPERATURE
C   AND PRESSURE DERIVATIVES FOR THE 560-800 CM-1 BAND. ALSO INCLUDED
C   ARE THE STANDARD TEMPERATURES AND THE WEIGHTING FUNCTION. THESE
C   DATA ARE IN BLOCK DATA BD3:
C         CO251    =  TRANSMISSION FCTNS FOR T0 (STD. PROFILE)
C                       WITH P(SFC)=1013.25 MB
C         CO258    =  TRANSMISSION FCTNS. FOR T0 (STD. PROFILE)
C                       WITH P(SFC)= ^810 MB
C         CDT51    =  FIRST TEMPERATURE DERIVATIVE OF CO251
C         CDT58    =  FIRST TEMPERATURE DERIVATIVE OF CO258
C         C2D51    =  SECOND TEMPERATURE DERIVATIVE OF CO251
C         C2D58    =  SECOND TEMPERATURE DERIVATIVE OF CO251
C         CO2M51   =  TRANSMISSION FCTNS FOR T0 FOR ADJACENT PRESSURE
C                        LEVELS, WITH NO PRESSURE QUADRATURE. USED FOR
C                        NEARBY LAYER COMPUTATIONS. P(SFC)=1013.25 MB
C         CO2M58   =  SAME AS CO2M51,WITH P(SFC)= ^810 MB
C         CDTM51   =  FIRST TEMPERATURE DERIVATIVE OF CO2M51
C         CDTM58   =  FIRST TEMPERATURE DERIVATIVE OF CO2M58
C         C2DM51   =  SECOND TEMPERATURE DERIVATIVE OF CO2M51
C         C2DM58   =  SECOND TEMPERATURE DERIVATIVE OF CO2M58
C         STEMP    =  STANDARD TEMPERATURES FOR MODEL PRESSURE LEVEL
C                        STRUCTURE WITH P(SFC)=1013.25 MB
C         GTEMP    =  WEIGHTING FUNCTION FOR MODEL PRESSURE LEVEL
C                        STRUCTURE WITH P(SFC)=1013.25 MB.
C         B0       =  TEMP. COEFFICIENT USED FOR CO2 TRANS. FCTN.
C                        CORRECTION FOR T(K). (SEE REF. 4 AND BD3)
C         B1       =  TEMP. COEFFICIENT, USED ALONG WITH B0
C         B2       =  TEMP. COEFFICIENT, USED ALONG WITH B0
C         B3       =  TEMP. COEFFICIENT, USED ALONG WITH B0
C
      COMMON/CO2BD3/CO251(LP1,LP1),CO258(LP1,LP1),CDT51(LP1,LP1),
     1 CDT58(LP1,LP1),C2D51(LP1,LP1),C2D58(LP1,LP1),CO2M51(L),
     2 CO2M58(L),CDTM51(L),CDTM58(L),C2DM51(L),C2DM58(L),
     3 STEMP(LP1),GTEMP(LP1),B0,B1,B2,B3
C
C***COMMON CO2BD2 CONTAINS CO2 TRANSMISSION FUNCTIONS AND TEMPERATURE
C   AND PRESSURE DERIVATIVES FOR THE 560-670 CM-1 PART OF THE 15 UM
C   CO2 BAND.  THESE DATA ARE IN BLOCK DATA BD2.
C         CO231    =  TRANSMISSION FCTNS FOR T0 (STD. PROFILE)
C                       WITH P(SFC)=1013.25 MB
C         CO238    =  TRANSMISSION FCTNS. FOR T0 (STD. PROFILE)
C                       WITH P(SFC)= ^810 MB
C         CDT31    =  FIRST TEMPERATURE DERIVATIVE OF CO231
C         CDT38    =  FIRST TEMPERATURE DERIVATIVE OF CO238
C         C2D31    =  SECOND TEMPERATURE DERIVATIVE OF CO231
C         C2D38    =  SECOND TEMPERATURE DERIVATIVE OF CO231
C
      COMMON / CO2BD2 / CO231(LP1),CO238(LP1),CDT31(LP1),
     1 CDT38(LP1),C2D31(LP1),C2D38(LP1)
C
C***COMMON CO2BD4 CONTAINS CO2 TRANSMISSION FUNCTIONS AND TEMPERATURE
C   AND PRESSURE DERIVATIVES FOR THE 670-800 CM-1 PART OF THE 15 UM
C   CO2 BAND.  THESE DATA ARE IN BLOCK DATA BD4.
C         CO271    =  TRANSMISSION FCTNS FOR T0 (STD. PROFILE)
C                       WITH P(SFC)=1013.25 MB
C         CO278    =  TRANSMISSION FCTNS. FOR T0 (STD. PROFILE)
C                       WITH P(SFC)= ^810 MB
C         CDT71    =  FIRST TEMPERATURE DERIVATIVE OF CO271
C         CDT78    =  FIRST TEMPERATURE DERIVATIVE OF CO278
C         C2D71    =  SECOND TEMPERATURE DERIVATIVE OF CO271
C         C2D78    =  SECOND TEMPERATURE DERIVATIVE OF CO271
C
      COMMON / CO2BD4 / CO271(LP1),CO278(LP1),CDT71(LP1),
     1 CDT78(LP1),C2D71(LP1),C2D78(LP1)
C
C***COMMON CO2BD5 CONTAINS CO2 TRANSMISSION FUNCTIONS FOR THE 2270-
C   2380 PART OF THE 4.3 UM CO2 BAND. THESE DATA ARE IN BLOCK DATA BD5.
C         CO211    =  TRANSMISSION FCTNS FOR T0 (STD. PROFILE)
C                       WITH P(SFC)=1013.25 MB
C         CO218    =  TRANSMISSION FCTNS. FOR T0 (STD. PROFILE)
C                       WITH P(SFC)= ^810 MB
C
      COMMON / CO2BD5 / CO211(LP1),CO218(LP1)
C
C     COMMON BLOCK TABCOM CONTAINS QUANTITIES PRECOMPUTED IN SUBROUTINE
C     TABLE FOR USE IN THE LONGWAVE RADIATION PROGRAM:
C          EM1     =  E1 FUNCTION, EVALUATED OVER THE 0-560 AND
C                     1200-2200 CM-1 INTERVALS
C          EM1WDE  =  E1 FUNCTION, EVALUATED OVER THE 160-560 CM-1
C                     INTERVAL
C          TABLE1  =  E2 FUNCTION, EVALUATED OVER THE 0-560 AND
C                     1200-2200 CM-1 INTERVALS
C          TABLE2  =  TEMPERATURE DERIVATIVE OF TABLE1
C          TABLE3  =  MASS DERIVATIVE OF TABLE1
C          EM3     =  E3 FUNCTION, EVALUATED OVER THE 0-560 AND
C                     1200-2200 CM-1 INTERVALS
C          SOURCE  =  PLANCK FUNCTION, EVALUATED AT SPECIFIED TEMPS. FOR
C                     BANDS USED IN CTS CALCULATIONS
C          DSRCE   =  TEMPERATURE DERIVATIVE OF SOURCE
C          IND     =  INDEX, WITH VALUE IND(I)=I. USED IN FST88
C          INDX2   =  INDEX VALUES USED IN OBTAINING "LOWER TRIANGLE"
C                     ELEMENTS OF AVEPHI,ETC.,IN FST88
C          KMAXV   =  INDEX VALUES USED IN OBTAINING "UPPER TRIANGLE"
C                     ELEMENTS OF AVEPHI,ETC.,IN FST88
C          KMAXVM  =  KMAXV(L),USED FOR DO LOOP INDICES
C
      COMMON / TABCOM / IND(IMAX),INDX2(LP1V),KMAXV(LP1),
     1     KMAXVM
      COMMON/TABCOM/EM1(28,180),EM1WDE(28,180),TABLE1(28,180),
     1 TABLE2(28,180),TABLE3(28,180),EM3(28,180),SOURCE(28,NBLY),
     2 DSRCE(28,NBLY)
C        *********************************************
C====>   *   INPUT FROM FROM CALLING PROGRAM         *
C        *********************************************
      DIMENSION
     1  QS(IX2),PP(IX,L),QQH2O(IX2,L),TT(IX2,L),TSFC(IX),SLMSK(IX),
CYH942  ALBEDO(IX),XLAT(IX),CLDS(IX,3),MTOP(IX,3),MBOT(IX,3),
     2  ALBEDO(IX),XLAT(IX),
     3  COSZRO(IX),TAUDAR(IX)
CYH93  ADD CLD EMISSIVITY, OPTICAL DEPTH
CYH94 DIMENSION CLDARY(IX,L),EMIS0(IX,3),TAUC0(IX,3)
      DIMENSION CLDARY(IX,L)
CYH93...
      DIMENSION SLMRF(LP1),SLYMRF(L)
C        *********************************************
C====>   *   POSSIBLE INPUT FROM CALLING PROGRAM     *
C        *********************************************
      DIMENSION
CYH941  O3QO3(IX,L),CEMIS(IX)
     1  O3QO3(IX,L)
CSIB... ALBEDOES FROM SIB PARAMETERIZATION
      DIMENSION
     2  ALVBR(IX),     ALNBR(IX),     ALVDR(IX),    ALNDR(IX)
CSIB...
C        *********************************************
C====>   *   OUTPUT TO CALLING PROGRAM               *
C        *********************************************
      DIMENSION  SWH(IX,L),HLW(IX,L)
      DIMENSION  FLWUP(IX),FSWUP(IX),FSWDN(IX),
     1           FSWDNS(IX),FLWDNS(IX),FLWUPS(IX),FSWUPS(IX)
C-CLR DIMENSION  FLWUP0(IX),FSWUP0(IX),
C-CLR1           SSWDN0(IX),SLWDN0(IX),SSWUP0(IX)
CSIB...
C        *********************************************
C====>   *   POSSIBLE OUTPUT TO CALLING PROGRAM      *
C        *********************************************
C...... DOWNWARD SW FLUXES FOR THE SIB PARAMETERIZATION
      DIMENSION
     1  GDFVBR(IX),    GDFNBR(IX),    GDFVDR(IX),   GDFNDR(IX)
C        ************************************************************
C====>   *   ARRAYS NEEDED BY SWR93SIB..FOR CLEAR SKY DATA(EG.FSWL) *
C        ************************************************************
      DIMENSION
     1  FSWL(IMBX,LP1),  HSWL(IMBX,LP1),  UFL(IMBX,LP1),  DFL(IMBX,LP1)
CSIB...
C        ******************************************************
C====>   *   ARRAYS NEEDED BY CLO88, LWR88, SWR89 OR SWR91SIB *
C        ******************************************************
      DIMENSION NCLDS(IMAX),KTOP(IMBX,LP1),KBTM(IMBX,LP1)
CYH94 DIMENSION CAMTSW(IMBX,LP1),CAMT(IMBX,LP1)
      DIMENSION                  CAMT(IMBX,LP1)
      DIMENSION CLDFAC(IMBX,LP1,LP1),EMCLD(IMBX,LP1)
      DIMENSION PRESS(IMBX,LP1),TEMP(IMBX,LP1),RH2O(IMBX,L),QO3(IMBX,L)
      DIMENSION HEATRA(IMBX,L),GRNFLX(IMAX),TOPFLX(IMAX)
C-CLR DIMENSION GRNFX0(IMAX),TOPFX0(IMAX)
CYH94 DIMENSION KTOPSW(IMBX,LP1),KBTMSW(IMBX,LP1)
      DIMENSION EQCMT (IMBX,LP1)
CYH94 ...
CYH93 DIMENSION CIRAB(IMBX,LP1),CIRRF(IMBX,LP1),CUVRF(IMBX,LP1)
CYH94 DIMENSION FSW(IMBX,LP1),HSW(IMBX,LP1),GRDFLX(IMAX),
      DIMENSION FSW(IMBX,LP1),HSW(IMBX,LP1),
     1          UF(IMBX,LP1),DF(IMBX,LP1)
      DIMENSION COSZEN(IMAX),TAUDA(IMAX)
CYH93...
CYH93. ADD CLD REFLECTANCE AND TRANSMITTANCE, AND TEMP. VARIABLES
      DIMENSION RRCL(IMBX,NB,LP1), TTCL(IMBX,NB,LP1)
CYH93...
      DIMENSION
     1 JJROW(IMAX),DO3V(IMAX),DO3VP(IMAX),TTHAN(IMAX)
C====>    **************************************************************
C--     SEASONAL CLIMATOLOGIES OF O3 (OBTAINED FROM A PREVIOUSLY RUN
C             CODE WHICH INTERPOLATES O3 TO USER VERTICAL COORDINATE).
C         DEFINED AS 5 DEG LAT MEANS N.P.->S.P.
      COMMON /SAVMEM/
C-       ...WINTER....  ...SPRING....  ...SUMMER....  ....FALL.....
     1   DDUO3N(37,L), DDO3N2(37,L), DDO3N3(37,L), DDO3N4(37,L)
      DIMENSION RAD1(LNGTH), RAD2(LNGTH), RAD3(LNGTH), RAD4(LNGTH)
      EQUIVALENCE (RAD1(1),DDUO3N(1,1)),(RAD2(1),DDO3N2(1,1))
      EQUIVALENCE (RAD3(1),DDO3N3(1,1)),(RAD4(1),DDO3N4(1,1))
C====>    **************************************************************
      COMMON / SSALB /
     2   ALBD(21,20),        ZA(20),             TRN(21),
     3   DZA(19)
C    ***********************************************************
CSIB... LOCAL ARRAYS
      DIMENSION
     1  ALVB (IMAX),     ALNB (IMAX),     ALVD (IMAX),    ALND  (IMAX)
     2 ,GDFVB (IMAX),    GDFNB (IMAX),    GDFVD (IMAX),   GDFND (IMAX)
CSIB...
      DIMENSION  SFCALB(IMAX)
      COMMON /RDFSAV/ EMISP,EMIST,XLATT,XLATP,Q19001,HP98,H3M6,
     *     HP75,H6M2,HP537,H74E1,H15E1,Q14330,HP2,TWENTY,HNINE,
     *     DEGRAD,HSIGMA,DAYSEC,RCO2
C====> BEGIN HERE             .......................
C.....    SOLC,THE SOLAR CONSTANT IS SCALED TO A MORE CURRENT VALUE.
C          I.E. IF SOLC=2.0 LY/MIN THEN SSOLAR=1.96 LY/MIN.
C....   RE-COMPUTED CAUSE SSOLAR OVERWRITTEN AS PART OF SCRATCH COMMON
      RNDG = 180./ 3.141593E+0
      SSOLAR=SOLC*HP98
      DO 4000 IRCHNK = 1 , NRCHNK
      IBEG = (IRCHNK - 1) * IMAX + 1
      IEND = IBEG + IMAX - 1
      IF(IEND .GT.  256 ) IEND =  256
      IPTS = IEND - IBEG + 1
      DO 40 I=1,IPTS
        IR = I + IBEG - 1
        TH2=HP2*XLAT(IR)*RNDG
        JJROW(I)=Q19001-TH2
        TTHAN(I)=(19-JJROW(I))-TH2
C.....  NOTE THAT THE NMC VARIABLES ARE IN MKS (THUS PRESSURE IS IN
C          CENTIBARS)WHILE ALL GFDL VARIABLES ARE IN CGS UNITS
        SFCALB(I) = ALBEDO(IR)
C.....  NOW PUT SFC TEMP,PRESSURES, ZENITH ANGLE INTO SW COMMON BLOCK...
        PRESS(I,LP1)=H1E4*QS(IR)
        TEMP(I,LP1)=TSFC(IR)
        COSZEN(I) = COSZRO(IR)
        TAUDA(I) = TAUDAR(IR)
   40 CONTINUE
C
C.....  ALL GFDL VARIABLES HAVE K=1 AT THE TOP OF THE ATMOSPHERE.NMC
C      VARIABLES HAVE K=1 AT THE SURFACE.K-LOOP STRUCTURE IS DIFFERENT.
C
      DO 50 K=1,L
       DO 50 I=1,IPTS
        IR = I + IBEG - 1
C.....  NOW PUT TEMP,PRESSURES, INTO SW COMMON BLOCK..........
        TEMP(I,K) = TT(IR,LP1-K)
        PRESS(I,K) = H1E4 * PP(IR,LP1-K)
C.... STORE LYR MOISTURE AND ADD TO SW COMMON BLOCK
        RH2O(I,K)=QQH2O(IR,LP1-K)
        IF(RH2O(I,K).LT.H3M6) RH2O(I,K)=H3M6
   50 CONTINUE
C...    *************************
      IF (KO3.EQ.0) GO TO 65
C...    *************************
      DO 60 K=1,L
       DO 60 I=1,IPTS
c Ken+moorthi: set up minimum positive value for O3
        QO3(I,K) = max(O3QO3(I+IBEG-1,LP1-K), 1.0E-10)
   60 CONTINUE
   65 CONTINUE
C...   ************************************
      IF (KALB.GT.0) GO TO 110
C...   ************************************
C..... THE FOLLOWING CODE GETS ALBEDO FROM PAYNE,1972 TABLES IF
C         1) OPEN SEA POINT (SLMSK=0);2) KALB=0
      IQ=INT(TWENTY*HP537+ONE)
      DO 105 I=1,IPTS
         IF(COSZEN(I).GT.0.0 .AND. SLMSK(I+IBEG-1).EQ.0.0) THEN
           ZEN=DEGRAD*ACOS(MAX(COSZEN(I),0.0))
           IF(ZEN.GE.H74E1) JX=INT(HAF*(HNINETY-ZEN)+ONE)
           IF(ZEN.LT.H74E1.AND.ZEN.GE.FIFTY)
     1        JX=INT(QUARTR*(H74E1-ZEN)+HNINE)
           IF(ZEN.LT.FIFTY) JX=INT(HP1*(FIFTY-ZEN)+H15E1)
           DZEN=-(ZEN-ZA(JX))/DZA(JX)
           ALB1=ALBD(IQ,JX)+DZEN*(ALBD(IQ,JX+1)-ALBD(IQ,JX))
           ALB2=ALBD(IQ+1,JX)+DZEN*(ALBD(IQ+1,JX+1)-ALBD(IQ+1,JX))
           SFCALB(I)=ALB1+TWENTY*(ALB2-ALB1)*(HP537-TRN(IQ))
         ENDIF
  105 CONTINUE
  110 CONTINUE
C        **********************************
      IF (KO3.GT.0) GO TO 135
C        **********************************
C.... COMPUTE CLIMATOLOGICAL ZONAL MEAN OZONE,
C....   SEASONAL AND SPATIAL INTERPOLATION DONE BELOW.
      DO 130 K=1,L
        DO 125 I=1,IPTS
          DO3V(I)  = DDUO3N(JJROW(I),K) + RSIN1*DDO3N2(JJROW(I),K)
     1                +RCOS1*DDO3N3(JJROW(I),K)
     2                +RCOS2*DDO3N4(JJROW(I),K)
          DO3VP(I) = DDUO3N(JJROW(I)+1,K) + RSIN1*DDO3N2(JJROW(I)+1,K)
     1               +RCOS1*DDO3N3(JJROW(I)+1,K)
     2               +RCOS2*DDO3N4(JJROW(I)+1,K)
C...   NOW LATITUDINAL INTERPOLATION, AND
C          CONVERT O3 INTO MASS MIXING RATIO(ORIGINAL DATA MPY BY 1.E4)
          QO3(I,K) = H1M4 * (DO3V(I)+TTHAN(I)*(DO3VP(I)-DO3V(I)))
  125   CONTINUE
  130 CONTINUE
  135 CONTINUE
C...   **********************************************************
CYH94   CLOUD SHUFFLING NOT NEEDED, SWBOT+1 DONE IN SWR CODE SO NO
CYH94    NEED TO CARRY A KTOPSW AND KTOP,ETC, AND EMISS DEFAULT NOT.
CYH94   RRCL,TTCL NOW IN CLDPRP
CYH94     SO LOTS OF CODE DELETED..
C...   **********************************************************
      IF (IPTS .EQ. IMAX) GO TO 165
      IPTS1 = IPTS + 1
      DO 120 I=IPTS1,IMAX
        COSZEN(I) = COSZEN(IPTS)
        TAUDA (I) = TAUDA (IPTS)
  120 CONTINUE
      DO 140 K=1,LP1
      DO 140 I=IPTS1,IMAX
        PRESS(I,K) = PRESS(IPTS,K)
        TEMP (I,K) = TEMP (IPTS,K)
  140 CONTINUE
      DO 160 K=1,L
      DO 160 I=IPTS1,IMAX
        RH2O(I,K) = RH2O(IPTS,K)
        QO3 (I,K) = QO3 (IPTS,K)
  160 CONTINUE
  165 CONTINUE
C        **********************************************************
C====>   *      CLOUD SECTION-PUT DATA INTO DESIRED FORMAT        *
C        **********************************************************
C...  CALL CLDPRP TO GET CLOUD PROPERTIES AND PUT INTO PROPER ARRAYS
C
       CALL CLDPRP(IX,IX2,QS,RH2O,TEMP,SLMRF,CLDARY,IBEG,IPTS,XLAT,
     1             CAMT,KTOP,KBTM,NCLDS,EMCLD,RRCL,TTCL)
C
      DO 195 I=1,IPTS
CSIB...ALBEDOES FROM SIB SFC PARAMETERIZATION..
CSIB...      (UNCOMMENT 5 LINES WHEN SIB ACTIVATED)
C       IR = I + IBEG - 1
C.....     VISIBLE AND NEAR IR DIFFUSE ALBEDO
C       ALVD(I) = ALVDR(IR)
C       ALND(I) = ALNDR(IR)
C.....     VISIBLE AND NEAR IR DIRECT BEAM ALBEDO
C       ALVB(I) = ALVBR(IR)
C       ALNB(I) = ALNBR(IR)
CSIB...
CSIB...ALBEDOES FOR CASE WITHOUT SIB IN THE FCST MODEL
CSIB...      (COMMENT 4 LINES WHEN SIB ACTIVATED..VD,ND,VB,NB)
C.....     VISIBLE AND NEAR IR DIFFUSE ALBEDO
        ALVD(I) = SFCALB(I)
        ALND(I) = SFCALB(I)
C.....     VISIBLE AND NEAR IR DIRECT BEAM ALBEDO
        ALVB(I) = SFCALB(I)
        ALNB(I) = SFCALB(I)
C.....     VISIBLE AND NEAR IR DIRECT BEAM ALBEDO,IF NOT OCEAN NOR SNOW
C            ..FUNCTION OF COSINE SOLAR ZENITH ANGLE..
        IF (SLMSK(I+IBEG-1).GT.0.0 E 0) THEN
CYH93    IF (SFCALB(I).LT.0.5) THEN
         IF (SFCALB(I).LE.0.5 E 0) THEN
CYH93...
          ALBD0 = -18.0 E 0 * (0.5 E 0 - ACOS(COSZEN(I))/ 3.141593E+0 )
          ALBD0 = EXP (ALBD0)
CYH93...
          ALVD1 = (ALVD(I) - 0.054313 E 0) / 0.945687 E 0
          ALND1 = (ALND(I) - 0.054313 E 0) / 0.945687 E 0
          ALVB(I) = ALVD1 + (1.0 E 0 - ALVD1) * ALBD0
          ALNB(I) = ALND1 + (1.0 E 0 - ALND1) * ALBD0
CYH       ALVB(I) = ALVD(I) + (1.0 - ALVD(I)) * ALBD0
CYH       ALNB(I) = ALND(I) + (1.0 - ALND(I)) * ALBD0
CYH93...
         END IF
        END IF
CSIB...
  195 CONTINUE
      IF (IPTS.LT.IMAX) THEN
       IPTS1 = IPTS + 1
       DO 197 I=IPTS1,IMAX
        ALVD(I) = ALVD(IPTS)
        ALND(I) = ALND(IPTS)
        ALVB(I) = ALVB(IPTS)
        ALNB(I) = ALNB(IPTS)
  197  CONTINUE
      END IF
CYH94...
C...  SURFACE VALUES OF RRCL AND TTCL
      DO 200 N=1,2
      DO 200 I=1,IMAX
        RRCL(I,N,1) = ALVD(I)
        TTCL(I,N,1) = ZERO
  200 CONTINUE
      DO 220 N=3,NB
      DO 220 I=1,IMAX
        RRCL(I,N,1) = ALND(I)
        TTCL(I,N,1) = ZERO
  220 CONTINUE
CYH94...
C...     **************************
C...     *  END OF CLOUD SECTION  *
C...     **************************
C... THE FOLLOWING CODE CONVERTS RRVCO2,THE VOLUME MIXING RATIO OF CO2
C   INTO RRCO2,THE MASS MIXING RATIO.
      RRVCO2=RCO2
      RRCO2=RRVCO2*RATCO2MW
C     IF(LAT .EQ. 2) CALL ERREXIT
  250 IF(ITIMLW .EQ. 0) GO TO 300
C             ***********************
C====>        * LONG WAVE RADIATION *
C             ***********************
CYH94...
C...  ACCOUNT FOR REDUCED EMISSIVITY OF ANY CLOUD
      DO 240 K=1,LP1
      DO 240 I=1,IMAX
        EQCMT(I,K) = CAMT(I,K) * EMCLD(I,K)
  240 CONTINUE
CYH94...
C....    GET CLD FACTOR FOR LW CALCULATIONS
      CALL CLO89(CLDFAC,EQCMT,NCLDS,KBTM,KTOP)
C===>        LONG WAVE RADIATION
      CALL LWR88(HEATRA,GRNFLX,TOPFLX,
C-CLR1           GRNFX0,TOPFX0,
     1           PRESS,TEMP,RH2O,QO3,CLDFAC,
     2          EQCMT,NCLDS,KTOP,KBTM)
C....
      DO 280 I=1,IPTS
        IR = I + IBEG - 1
        FLWUP(IR) = TOPFLX(I) * .001 E 0
        GRNFLX(I)=Q14330*(HSIGMA*TEMP(I,LP1)**4-GRNFLX(I))
C.... GET LW FLUX DOWN AND UP AT GROUND(WATTS/M**2) - GRNFLX=LW DOWN.
        FLWDNS(IR)=GRNFLX(I)/(1.43306 E -06*1000. E 0)
        FLWUPS(IR)=HSIGMA*.001 E 0 * TEMP(I,LP1)**4
C-CLR   FLWUP0(IR) = TOPFX0(I) * .001 E 0
C-CLR   GRNFX0(I)=Q14330*(HSIGMA*TEMP(I,LP1)**4-GRNFX0(I))
C-CLR   SLWDN0(IR)=GRNFX0(I)/(1.43306 E -06*1000. E 0)
  280 CONTINUE
C....      CONVERT HEATING RATES TO DEG/SEC
      DO 290 K=1,L
        DO 290 I=1,IPTS
          HLW(I+IBEG-1,LP1-K)=HEATRA(I,K)*DAYSEC
  290 CONTINUE
  300 CONTINUE
      IF(ITIMSW .EQ. 0) GO TO 350
CYH93
      CALL SWR93SIB(FSW,HSW,UF,DF,FSWL,HSWL,UFL,DFL,
     1              PRESS,COSZEN,TAUDA,RH2O,RRCO2,SSOLAR,QO3,
CYH942              NCLDS,KTOPSW,KBTMSW,CAMTSW,RRCL,TTCL,
     2              NCLDS,KTOP  ,KBTM  ,CAMT  ,RRCL,TTCL,
     3              ALVB,ALNB,ALVD,ALND,GDFVB,GDFNB,GDFVD,GDFND)
CYH93...
C.....    GET SW FLUXES IN WATTS/M**2
      DO 320 I=1,IPTS
       IR = I + IBEG - 1
       FSWUP(IR) = UF(I,1) * 1. E -3
       FSWDN(IR) = DF(I,1) * 1. E -3
       FSWUPS(IR) = UF(I,LP1) * 1. E -3
C-CLR  FSWUP0(IR) = UFL(I,1) * 1. E -3
C-CLR  SSWUP0(IR) = UFL(I,LP1) * 1. E -3
C-CLR  SSWDN0(IR) = DFL(I,LP1) * 1. E -3
CSIB   FSWDNS(IR) = DF(I,LP1) * 1. E -3
CC..COUPLE W/M2 DIFF, IF FSWDNS(IR)=DF(I,LP1)*1. E -3
       FSWDNS(IR) = (GDFVB(I)+GDFNB(I)+GDFVD(I)+GDFND(I)) * 1. E -3
C...    DOWNWARD SFC FLUX FOR THE SIB PARAMETERATION
C.....     VISIBLE AND NEAR IR DIFFUSE
       GDFVDR(IR) = GDFVD(I) * 1. E -3
       GDFNDR(IR) = GDFND(I) * 1. E -3
C.....     VISIBLE AND NEAR IR DIRECT BEAM
       GDFVBR(IR) = GDFVB(I) * 1. E -3
       GDFNBR(IR) = GDFNB(I) * 1. E -3
CSIB...
  320 CONTINUE
C....      CONVERT HEATING RATES TO DEG/SEC
      DO 330 K=1,L
        DO 330 I=1,IPTS
          SWH(I+IBEG-1,LP1-K)=HSW(I,K)*DAYSEC
  330 CONTINUE
  350 CONTINUE
 4000 CONTINUE
      RETURN
      STOP
 1000 FORMAT(1H ,' YOU ARE CALLING GFDL RADIATION CODE FOR',I5,' PTS',
     1           'AND',I4,' LYRS,WITH KDAPRX,KO3,KCZ,KEMIS,KALB = ',5I2)
      END
