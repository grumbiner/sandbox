      SUBROUTINE ZNLAVB(LAT,LONB2,LONB22,LEVS,SECPHY,SECRAD,
     &                  RBS2,SI,SL,DEL,PSEXP,GESHEM,BENGSH,
     &                  DUSFC,DVSFC,DTSFC,DQSFC,DUGWD,DVGWD,
     &                  SLMSK,SHELEG,TSEA,SOILM,TG1,TG2,TG3,
     &                  ZORL,EP,CLDWRK,DLWSFC,ULWSFC,
     &                  DG,TG,RQG,DLAM,DPHI,UG,VG)
CFPP$ NOCONCUR R
CFPP$ EXPAND(FPVS,ZNLAIM,ZNLAIS)
C
      DIMENSION SI(LEVS+1),SL(LEVS),DEL(LEVS)
      DIMENSION PSEXP(LONB2)
      DIMENSION GESHEM(LONB2),BENGSH(LONB2)
      DIMENSION DUSFC(LONB2),DVSFC(LONB2)
      DIMENSION DTSFC(LONB2),DQSFC(LONB2)
      DIMENSION DUGWD(LONB2),DVGWD(LONB2)
      DIMENSION SLMSK(LONB2),SHELEG(LONB2)
      DIMENSION TSEA(LONB2),SOILM(LONB2)
      DIMENSION TG1(LONB2),TG2(LONB2),TG3(LONB2)
      DIMENSION ZORL(LONB2),EP(LONB2),CLDWRK(LONB2)
      DIMENSION DLWSFC(LONB2),ULWSFC(LONB2)
      DIMENSION DG(LONB22,LEVS)
      DIMENSION TG(LONB22,LEVS),RQG(LONB22,LEVS)
      DIMENSION DLAM(LONB2),DPHI(LONB2)
      DIMENSION UG(LONB22,LEVS),VG(LONB22,LEVS)
C
      PARAMETER(NRM=23,NRS=32)
      PARAMETER(NLB=6,NST=6)
      PARAMETER(NMU=1,NMV=2,NMTV=3,NMQ=4,NMVOT2=5,
     &          NMDIV2=6,NMOMEGA=7,NMT=8,NMRH=9,NMKE=10,
     &          NMTCONV=11,NMTLARG=12,NMTSHAL=13,NMTVRDF=14,NMQCONV=15,
     &          NMQSHAL=16,NMQVRDF=17,NMUVRDF=18,NMVVRDF=19,NMTHSW=20,
     &          NMTHLW=21,NMTCLD=22,NMTCCV=23)
      PARAMETER(NSRAIN=1,NSRAINC=2,NSTSFC=3,NSQSFC=4,NSUSFC=5,
     &          NSVSFC=6,NSRCOV=7,NSRCOVC=8,NSPS=9,NSTSKIN=10,
     &          NSWET=11,NSSNOW=12,NSTG1=13,NSTG2=14,NSTG3=15,
     &          NSSFCSW=16,NSSFCLW=17,NSRHS=18,NSTVS=19,NSTS=20,
     &          NSQS=21,NSZORL=22,NSSLMSK=23,NSUGWD=24,NSVGWD=25,
     &          NSUASFC=26,NSUAGWD=27,NSUAMTN=28,NSUA=29,NSUAP=30,
     &          NSEP=31,NSCLDWRK=32)
      COMMON /COMZNL/ ZDM(2, 28 ,NRM, 47 ),ZWM(2, 47 ),ZHM(NRM)
      COMMON /COMZNL/ ZDS(2,NST,NRS, 47 ),ZWS(2,NST, 47 )
C
      PARAMETER(CP= 1.0046E+3 ,RD= 2.8705E+2 ,RV= 4.6150E+2 )
      PARAMETER(FKAPPA=RD/CP,FVIRT=RV/RD-1.,FEPS=RD/RV,FEPSM1=RD/RV-1.)
      DIMENSION IST(LONB2)
      DIMENSION WORK(LONB2,LEVS),WORK1(LONB2)
C
      LONB=LONB2/2
C
      ZWM(1,LAT)=0.
      ZWM(2,LAT)=0.
      DO I=1,LONB
        ZWM(1,LAT)=ZWM(1,LAT)+PSEXP(I)
        ZWM(2,LAT)=ZWM(2,LAT)+PSEXP(I+LONB)
      ENDDO
C
      DO I=1,LONB2
        WORK1(I)=0.
      ENDDO
      DO K=LEVS,1,-1
        DO I=1,LONB2
          CG1=RBS2*(UG(I,K)*DLAM(I)+VG(I,K)*DPHI(I))
          CG2=CG1+DG(I,K)
          WORK1(I)=WORK1(I)+CG2*(SL(K)-SI(K+1))
          WORK(I,K)=FKAPPA*TG(I,K)*(CG1-WORK1(I)/SL(K))
          WORK1(I)=WORK1(I)+CG2*(SI(K)-SL(K))
        ENDDO
      ENDDO
      CALL ZNLAIM(LONB2,WORK,PSEXP,NMOMEGA,LAT)
C
      DO K=1,LEVS
        DO I=1,LONB2
          WORK(I,K)=TG(I,K)*(1.+FVIRT*RQG(I,K))
        ENDDO
      ENDDO
      CALL ZNLAIM(LONB2,WORK,PSEXP,NMTV,LAT)
C
      DO K=1,LEVS
        DO I=1,LONB2
          ES=FPVS(TG(I,K))
          QS=FEPS*ES/(SL(K)*PSEXP(I)+FEPSM1*ES)
          WORK(I,K)=100.*RQG(I,K)/QS
        ENDDO
      ENDDO
      CALL ZNLAIM(LONB2,WORK,PSEXP,NMRH,LAT)
C
      DO K=1,LEVS
        DO I=1,LONB2
          WORK(I,K)=RBS2*0.5*(UG(I,K)**2+VG(I,K)**2)
        ENDDO
      ENDDO
      CALL ZNLAIM(LONB2,WORK,PSEXP,NMKE,LAT)
C
      DO K=1,LEVS
        DO I=1,LONB2
          WORK(I,K)=DG(I,K)**2
        ENDDO
      ENDDO
      CALL ZNLAIM(LONB2,WORK,PSEXP,NMDIV2,LAT)
C
      CALL ZNLAIM(LONB22,UG,PSEXP,NMU,LAT)
      CALL ZNLAIM(LONB22,VG,PSEXP,NMV,LAT)
      CALL ZNLAIM(LONB22,TG,PSEXP,NMT,LAT)
      CALL ZNLAIM(LONB22,RQG,PSEXP,NMQ,LAT)
C
      WGINST=1.
      WGTIME=0.
      IF(SECPHY.GT.0.) WGTIME=1./SECPHY
      WRTIME=0.
      IF(SECRAD.GT.0.) WRTIME=1./SECRAD
      ZHM(NMU)=WGINST
      ZHM(NMV)=WGINST
      ZHM(NMTV)=WGINST
      ZHM(NMQ)=WGINST
      ZHM(NMVOT2)=0.
      ZHM(NMDIV2)=WGINST
      ZHM(NMOMEGA)=WGINST
      ZHM(NMT)=WGINST
      ZHM(NMRH)=WGINST
      ZHM(NMKE)=WGINST
      ZHM(NMTCONV)=WGTIME
      ZHM(NMTLARG)=WGTIME
      ZHM(NMTSHAL)=WGTIME
      ZHM(NMTVRDF)=WGTIME
      ZHM(NMQCONV)=WGTIME
      ZHM(NMQSHAL)=WGTIME
      ZHM(NMQVRDF)=WGTIME
      ZHM(NMUVRDF)=WGTIME
      ZHM(NMVVRDF)=WGTIME
      ZHM(NMTHSW)=WGTIME
      ZHM(NMTHLW)=WGTIME
      ZHM(NMTCLD)=WRTIME
      ZHM(NMTCCV)=WRTIME
C
      DO I=1,LONB2
        IF(SLMSK(I).EQ.0.) THEN
          IST(I)=6
        ELSEIF(SLMSK(I).EQ.1.) THEN
          IST(I)=2
          IF(SHELEG(I).GT.1.E-3) IST(I)=3
        ELSE
          IST(I)=4
          IF(SHELEG(I).GT.1.E-3) IST(I)=5
        ENDIF
      ENDDO
      ZWS(1,1,LAT)=LONB
      ZWS(2,1,LAT)=LONB
      DO K=2,NST
        ZWS(1,K,LAT)=0.
        ZWS(2,K,LAT)=0.
      ENDDO
      DO I=1,LONB
        ZWS(1,IST(I),LAT)=ZWS(1,IST(I),LAT)+1.
        ZWS(2,IST(I+LONB),LAT)=ZWS(2,IST(I+LONB),LAT)+1.
      ENDDO
C
      ACL= 6.3712E+6 /SQRT(RBS2)
      DO I=1,LONB2
        WORK1(I)=0.
      ENDDO
      DO K=1,LEVS
        DO I=1,LONB2
          WORK1(I)=WORK1(I)+DEL(K)*UG(I,K)
        ENDDO
      ENDDO
      UAFAC= 6.3712E+6 *1.E3/ 9.8000E+0
      DO I=1,LONB2
        WORK1(I)=UAFAC*PSEXP(I)*WORK1(I)
      ENDDO
      CALL ZNLAIS(WORK1,IST,1.,NSUA,LAT)
C
      UAFAC= 7.2921E-5 *ACL*ACL*1.E3/ 9.8000E+0
      UAREF= 7.2921E-5 *ACL*ACL*1.E4
      DO I=1,LONB2
        WORK1(I)=UAFAC*PSEXP(I)-UAREF
      ENDDO
      CALL ZNLAIS(WORK1,IST,1.,NSUAP,LAT)
C
      DO I=1,LONB2
        WORK1(I)=TG(I,1)*(1.+FVIRT*RQG(I,1))
      ENDDO
      CALL ZNLAIS(WORK1,IST,1.,NSTVS,LAT)
C
      DO I=1,LONB2
        ES=FPVS(TG(I,1))
        QS=FEPS*ES/(SL(1)*PSEXP(I)+FEPSM1*ES)
        WORK1(I)=100.*RQG(I,1)/QS
      ENDDO
      CALL ZNLAIS(WORK1,IST,1.,NSRHS,LAT)
C
      CALL ZNLAIS(SHELEG,IST,1.,NSSNOW,LAT)
      CALL ZNLAIS(PSEXP,IST,1.,NSPS,LAT)
      CALL ZNLAIS(TG(1,1),IST,1.,NSTS,LAT)
      CALL ZNLAIS(RQG(1,1),IST,1.,NSQS,LAT)
      CALL ZNLAIS(TSEA,IST,1.,NSTSKIN,LAT)
      CALL ZNLAIS(SOILM,IST,1.,NSWET,LAT)
      CALL ZNLAIS(TG1,IST,1.,NSTG1,LAT)
      CALL ZNLAIS(TG2,IST,1.,NSTG2,LAT)
      CALL ZNLAIS(TG3,IST,1.,NSTG3,LAT)
      CALL ZNLAIS(ZORL,IST,1.,NSZORL,LAT)
C
      IF(SECPHY.GT.0.) THEN
        DO I=1,LONB2
          WORK1(I)=0.
          IF(GESHEM(I).GT.0.) WORK1(I)=100.
        ENDDO
        CALL ZNLAIS(WORK1,IST,1.,NSRCOV,LAT)
C
        DO I=1,LONB2
          WORK1(I)=0.
          IF(BENGSH(I).GT.0.) WORK1(I)=100.
        ENDDO
        CALL ZNLAIS(WORK1,IST,1.,NSRCOVC,LAT)
C
        DO I=1,LONB2
          WORK1(I)=ULWSFC(I)-DLWSFC(I)
        ENDDO
        CALL ZNLAIS(WORK1,IST,1./SECPHY,NSSFCLW,LAT)
C
        CALL ZNLAIS(GESHEM,IST,86400./SECPHY,NSRAIN,LAT)
        CALL ZNLAIS(BENGSH,IST,86400./SECPHY,NSRAINC,LAT)
        CALL ZNLAIS(DUSFC,IST,1./SECPHY,NSUSFC,LAT)
        CALL ZNLAIS(DVSFC,IST,1./SECPHY,NSVSFC,LAT)
        CALL ZNLAIS(DUGWD,IST,1./SECPHY,NSUGWD,LAT)
        CALL ZNLAIS(DVGWD,IST,1./SECPHY,NSVGWD,LAT)
        CALL ZNLAIS(DUSFC,IST,ACL/SECPHY,NSUASFC,LAT)
        CALL ZNLAIS(DUGWD,IST,ACL/SECPHY,NSUAGWD,LAT)
        CALL ZNLAIS(DTSFC,IST,1./SECPHY,NSTSFC,LAT)
        CALL ZNLAIS(DQSFC,IST,1./SECPHY,NSQSFC,LAT)
        CALL ZNLAIS(EP,IST,1./SECPHY,NSEP,LAT)
        CALL ZNLAIS(CLDWRK,IST,1./SECPHY,NSCLDWRK,LAT)
      ENDIF
C
      RETURN
      END
