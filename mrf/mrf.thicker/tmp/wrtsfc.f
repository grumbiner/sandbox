      SUBROUTINE WRTSFC(FHOUR,THOUR,IDATE,NN,SLMASK,COLRAB,
     1                  DUSFC,DVSFC,DTSFC,DQSFC,TSEA,SMC,STC,SHELEG,
     2                  SECSWR,SECLWR,DLWSFC,ULWSFC,GESHEM,BENGSH,GFLUX,
     3                  FLUXR,ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     4                  U10,V10,T2,Q2,PSURF,ZORL,TMPMAX,TMPMIN,
     &                  RUNOFF,EP,CLDWRK,DUGWD,DVGWD,HPBL,PWAT)
      COMMON/COMBIT/NDEX( 4032 ),SNNP1( 4032 )
      COMMON/COMBIT/LAB(4),IFIN,ICEN,IGEN,ICEN2,IENST,IENSI,RUNID,USRID
      CHARACTER*8 LAB
      PARAMETER(IPRS=1,ITEMP=11,IZNLW=33,IMERW=34,ISPHUM=51,IPWAT=54,
     $          IPCPR=59,ISNOWD=65,ICLDF=71,ICCLDF=72,
     $          ISLMSK=81,IZORL=83,IALBDO=84,ISOILM=144,ICEMSK=91,
     $          ILHFLX=121,ISHFLX=122,IZWS=124,IMWS=125,IGHFLX=155,
     $          IUSWFC=160,IDSWFC=161,IULWFC=162,IDLWFC=163,
     $          INSWFC=164,INLWFC=165,
     $          IDSWVB=166,IDSWVD=167,IDSWNB=168,IDSWND=169,
     $          ITMX=15,ITMN=16,IRNOF=90,IEP=145,
     &          ICLDWK=146,IZGW=147,IMGW=148,IHPBL=221,
     $          IDSWF=204,IDLWF=205,IUSWF=211,IULWF=212,ICPCPR=214)
      PARAMETER(ISFC=1,ITOA=8,IELEV=105,
     $          ISGLEV=107,IDBLS=111,I2DBLS=112,ICOLMN=200,
     $          ILCBL=212,ILCTL=213,ILCLYR=214,
     $          IMCBL=222,IMCTL=223,IMCLYR=224,
     $          IHCBL=232,IHCTL=233,IHCLYR=234)
      PARAMETER(INST=10,IAVG=3,IACC=4)
      PARAMETER(IFHOUR=1,IFDAY=2)
      PARAMETER(LONB2= 384 ,LATB2= 47 )
      PARAMETER(LONR2= 256 ,LATR2= 31 )
      PARAMETER(LONB=LONB2/2,LATB=LATB2*2,LEN=LONB*LATB)
      LOGICAL   LBM(LEN)
      CHARACTER G(200+LEN*(16+1)/8)
      PARAMETER(NFLD=16)
      INTEGER   IPUR(NFLD),ITLR(NFLD)
      DATA      IPUR/IULWF , IUSWF , IUSWF , IDSWF ,  ICLDF,   IPRS,
     $                 IPRS, ITEMP ,  ICLDF,   IPRS,   IPRS, ITEMP ,
     $                ICLDF,   IPRS,   IPRS, ITEMP /
      DATA      ITLR/ITOA  , ITOA  , ISFC  , ISFC  , IHCLYR, IHCTL ,
     $               IHCBL , IHCTL , IMCLYR, IMCTL , IMCBL , IMCTL ,
     $               ILCLYR, ILCTL , ILCBL , ILCTL /
      REAL RTIMER(NFLD)
      INTEGER       IDATE(4)
      DIMENSION    SLMASK(LEN)
      DIMENSION    COLRAB(LATB2)
      DIMENSION    DUSFC(LEN)
      DIMENSION    DVSFC(LEN)
      DIMENSION    DTSFC(LEN)
      DIMENSION    DQSFC(LEN)
      DIMENSION     TSEA(LEN)
      DIMENSION      SMC(LEN, 2 )
      DIMENSION      STC(LEN, 2 )
      DIMENSION   SHELEG(LEN)
      DIMENSION   DLWSFC(LEN)
      DIMENSION   ULWSFC(LEN)
      DIMENSION   GESHEM(LEN)
      DIMENSION   BENGSH(LEN)
      DIMENSION   GFLUX(LEN)
      DIMENSION   FLUXR(LONR2,LATR2,26)
      DIMENSION   ILEFT(LONB2),IRGHT(LONB2),WGTLON(LONB2)
      DIMENSION   INSLAT(LATB2),WGTLAT(LATB2)
      DIMENSION   U10  (LEN)
      DIMENSION   V10  (LEN)
      DIMENSION   T2   (LEN)
      DIMENSION   Q2   (LEN)
      DIMENSION   PSURF(LEN)
      DIMENSION   ZORL (LEN)
      DIMENSION   TMPMAX (LEN)
      DIMENSION   TMPMIN (LEN)
      DIMENSION   RUNOFF (LEN)
      DIMENSION   EP (LEN)
      DIMENSION   CLDWRK (LEN)
      DIMENSION DUGWD(LEN), DVGWD(LEN)
      DIMENSION   HPBL (LEN)
      DIMENSION   PWAT (LEN)
      DIMENSION FLUXF(LEN,4),WORK1(LEN),WORK2(LONB2),SLMSEP(LEN)
      DIMENSION WORKC(LONB2*20),IWORKC(LONB2)
      DIMENSION IDS(255)
      DIMENSION IENS(5)
C
      REWIND NN
      CALL IDSDEF(1,IDS)
      ILPDS=28
      IF(ICEN2.EQ.2) ILPDS=45
      IENS(1)=1
      IENS(2)=IENST
      IENS(3)=IENSI
      IENS(4)=1
      IENS(5)=255
      IYR=IDATE(4)
      IMO=IDATE(2)
      IDA=IDATE(3)
      IHR=IDATE(1)
      IFHR=NINT(FHOUR)
      ITHR=NINT(THOUR)
      IF(THOUR.GT.FHOUR) THEN
        RTIME=1./(3600.*(THOUR-FHOUR))
      ELSE
        RTIME=0.
      ENDIF
      IF(SECSWR.GT.0.) THEN
        RTIMSW=1./SECSWR
      ELSE
        RTIMSW=1.
      ENDIF
      IF(SECLWR.GT.0.) THEN
        RTIMLW=1./SECLWR
      ELSE
        RTIMLW=1.
      ENDIF
      RTIMER=RTIMSW
      RTIMER(1)=RTIMLW
      SLMSEP=SLMASK
      CALL ROWSEP(SLMSEP)
      CL1=COLRAB(1)
CC
      WORK1=DUSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IZWS,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IZWS),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DVSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IMWS,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IMWS),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DTSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ISHFLX,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ISHFLX),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DQSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ILHFLX,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ILHFLX),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=TSEA
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ITEMP,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=SMC(:,1)
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.EQ.1.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,ISOILM,I2DBLS,0,10,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ISOILM),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=SMC(:,2)
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.EQ.1.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,ISOILM,I2DBLS,10,200,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ISOILM),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=STC(:,1)
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.EQ.1.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,ITEMP,I2DBLS,0,10,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=STC(:,2)
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.EQ.1.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,ITEMP,I2DBLS,10,200,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=SHELEG
      CALL ROWSEP(WORK1)
C     LBM=WORK1.GT.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ISNOWD,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ISNOWD),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DLWSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IDLWF,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDLWF),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=ULWSFC*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IULWF,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IULWF),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
C.......  FIX FLUXES FOR APPROX DIURNAL CYCLE
      DO 113 K=1,4
        CALL GGINTF(FLUXR(1,1,K),LONR2,LATR2,LATR2,
     1              WORK1,LONB2,LATB2,LATB2,1,
     2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
        WORK1=WORK1*RTIMER(K)
        CALL ROWSEP(WORK1)
        CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              0,IPUR(K),ITLR(K),0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPUR(K)),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
        IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
  113 CONTINUE
C....INTERPOLATE CLD TOP/BOT DATA ONLY FROM THOSE POINTS W/CLDS
C    CARE IS TAKEN NOT TO SPREAD CLOUDS....
      IW1=1
      IW2=IW1+4*LONB2
      IW3=IW2+4*LONB2
      IW4=IW3+4*LONB2
      IW5=IW4+4*LONB2
      DO 813 K=5,7
        DO 413 J=1,LATR2
        DO 413 I=1,LONR2
          IF(FLUXR(I,J,K).GT.0.) THEN
            FLUXR(I,J,K+3) = FLUXR(I,J,K+3) / FLUXR(I,J,K)
            FLUXR(I,J,K+6) = FLUXR(I,J,K+6) / FLUXR(I,J,K)
            FLUXR(I,J,K+9) = FLUXR(I,J,K+9) / FLUXR(I,J,K)
            FLUXR(I,J,K) = FLUXR(I,J,K) * RTIMSW
          ELSE
C....  ZERO CLD TOP TEMP IF NO CLDS--SAFETY, CAUSE USE ZERO IN GGINTT
            FLUXR(I,J,K+9) = 0.
          END IF
  413   CONTINUE
        CALL CVINTFX(FLUXR(1,1,K),FLUXR(1,1,K+3),FLUXR(1,1,K+6),
     1              LONR2,LATR2,LATR2,
     2              FLUXF(1,1),FLUXF(1,2),FLUXF(1,3),
     3              LONB2,LATB2,LATB2,
     4              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     5              WORKC(IW1),WORKC(IW2),WORKC(IW3),WORKC(IW4),
     6              WORKC(IW5),IWORKC,1,1,1)
C....AVERAGE CLD TOP TEMPS FROM ONLY THE CLOUD-FILLED POINTS...
        CALL GGAVET(FLUXR(1,1,K+9),LONR2,LATR2,LATR2,
     1              FLUXF(1,4),LONB2,LATB2,LATB2,
     2              ILEFT,IRGHT,INSLAT,WGTLAT,
     3              WORKC(IW1),WORKC(IW2),IWORKC,1,1,1)
CKAC    CALL GGINTF(FLUXR(1,1,K+9),LONR2,LATR2,LATR2,
CKAC 1              FLUXF(1,4),LONB2,LATB2,LATB2,1,
CKAC 2              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
        DO 513 J=1,LATR2
        DO 513 I=1,LONR2
          IF(FLUXR(I,J,K).GT.0.) THEN
            FLUXR(I,J,K) = FLUXR(I,J,K) / RTIMSW
            FLUXR(I,J,K+3) = FLUXR(I,J,K+3) * FLUXR(I,J,K)
            FLUXR(I,J,K+6) = FLUXR(I,J,K+6) * FLUXR(I,J,K)
            FLUXR(I,J,K+9) = FLUXR(I,J,K+9) * FLUXR(I,J,K)
          ELSE
C....  ZERO CLD TOP TEMP IF NO CLDS--SAFETY, CAUSE USE ZERO IN GGINTT
            FLUXR(I,J,K+9) = 0.
          END IF
  513   CONTINUE
C
        K4=4+(K-5)*4
        CALL ROWSEP(FLUXF(1,1))
        FLUXF(:,1)=FLUXF(:,1)*1.E2
        LBM=FLUXF(:,1).GT.0.5
        L=K4+1
        CALL GRIBIT(FLUXF(1,1),LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              0,IPUR(L),ITLR(L),0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPUR(L)),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
        IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
        CALL ROWSEP(FLUXF(1,2))
        FLUXF(:,2)=FLUXF(:,2)*1.E3
        L=K4+2
        CALL GRIBIT(FLUXF(1,2),LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              1,IPUR(L),ITLR(L),0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPUR(L)),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
        IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
        CALL ROWSEP(FLUXF(1,3))
        FLUXF(:,3)=FLUXF(:,3)*1.E3
        L=K4+3
        CALL GRIBIT(FLUXF(1,3),LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              1,IPUR(L),ITLR(L),0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPUR(L)),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
        IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
        CALL ROWSEP(FLUXF(1,4))
        L=K4+4
        CALL GRIBIT(FLUXF(1,4),LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              1,IPUR(L),ITLR(L),0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPUR(L)),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
        IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
  813 CONTINUE
CC
      WORK1=GESHEM*1.E3*RTIME
      CALL ROWSEP(WORK1)
C     LBM=WORK1.GT.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IPCPR,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPCPR),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=BENGSH*1.E3*RTIME
      CALL ROWSEP(WORK1)
C     LBM=WORK1.GT.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ICPCPR,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICPCPR),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=GFLUX*RTIME
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.NE.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,IGHFLX,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IGHFLX),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=MOD(SLMSEP,2.)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ISLMSK,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ISLMSK),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=MAX(SLMSEP-1.,0.)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ICEMSK,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ICEMSK),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=U10
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IZNLW,IELEV,0,10,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IZNLW),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=V10
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IMERW,IELEV,0,10,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IMERW),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=T2
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ITEMP,IELEV,0,2,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=Q2
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ISPHUM,IELEV,0,2,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ISPHUM),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=PSURF*1.E3
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IPRS,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IPRS),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
C-WAV WORK1=ZORL*1.E-2
C-WAV CALL ROWSEP(WORK1)
C-WAV LBM=SLMSEP.EQ.0.
C-WAV CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
C-WAV&            1,IZORL,ISFC,0,0,IYR,IMO,IDA,IHR,
C-WAV&            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IZORL),IENS,
C-WAV&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-WAV IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=TMPMAX
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ITMX,IELEV,0,2,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITMX),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
C  RESET TMPMAX
C
      TMPMAX = 0.
CC
      WORK1=TMPMIN
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ITMN,IELEV,0,2,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(ITMN),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
C  RESET TMPMIN
C
      TMPMIN = 1.E10
CC
      WORK1=RUNOFF * 1.E3
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.NE.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,IRNOF,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IACC,0,0,ICEN2,IDS(IRNOF),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=EP * RTIME
      CALL ROWSEP(WORK1)
      LBM=SLMSEP.NE.0.
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            1,IEP,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IEP),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=CLDWRK * RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,ICLDWK,ICOLMN,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICLDWK),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DUGWD*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IZGW,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IZGW),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=DVGWD*RTIME
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IMGW,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IMGW),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=HPBL
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IHPBL,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IHPBL),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      WORK1=PWAT
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IPWAT,ICOLMN,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,ITHR,0,INST,0,0,ICEN2,IDS(IPWAT),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
      CALL GGINTF(FLUXR(1,1,17),LONR2,LATR2,LATR2,
     1            WORK1,LONB2,LATB2,LATB2,1,
     2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C  CONVERT TO PERCENT
      WORK1=WORK1*RTIMSW * 100.
CC
      CALL ROWSEP(WORK1)
      CALL GRIBIT(WORK1,LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &            0,IALBDO,ISFC,0,0,IYR,IMO,IDA,IHR,
     &            IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IALBDO),IENS,
     &            0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
CC
      DO 1413 J=1,LATR2
        DO 1413 I=1,LONR2
          FLUXR(I,J,26) = FLUXR(I,J,26) * RTIMSW
 1413 CONTINUE
      CALL CVINAMT(FLUXR(1,1,26),
     1              LONR2,LATR2,LATR2,
     2              FLUXF(1,1),
     3              LONB2,LATB2,LATB2,
     4              ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     5              WORKC(IW1),WORKC(IW2),
     6              WORKC(IW5),IWORKC,1,1,1)
C... RESET DATA
      DO 1513 J=1,LATR2
        DO 1513 I=1,LONR2
          FLUXR(I,J,26) = FLUXR(I,J,26) / RTIMSW
 1513 CONTINUE
C
      CALL ROWSEP(FLUXF(1,1))
      FLUXF(:,1)=FLUXF(:,1)*1.E2
      LBM=FLUXF(:,1).GT.0.
      CALL GRIBIT(FLUXF(1,1),LBM,4,LONB,LATB,16,CL1,ILPDS,2,ICEN,IGEN,
     &              0,ICLDF,ICOLMN,0,0,IYR,IMO,IDA,IHR,
     &              IFHOUR,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICLDF),IENS,
     &              0.,0.,0.,0.,0.,0.,G,LG,IERR)
      IF(IERR.EQ.0) CALL WRYTE(NN,LG,G)
C
      CLOSE(NN)
CC
      PRINT *,'GRIB FLUX FILE WRITTEN ',THOUR,IDATE,NN
      RETURN
      END
