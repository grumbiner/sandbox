C-----------------------------------------------------------------------
CFPP$ NOCONCUR R
      FUNCTION FTHEQ(T,PK)
C$$$     SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM: FTHEQ        COMPUTE SATURATION VAPOR PRESSURE
C   AUTHOR: N PHILLIPS            W/NMC2X2   DATE: 30 DEC 82
C
C ABSTRACT: COMPUTE EQUIVALENT POTENTIAL TEMPERATURE AT THE LCL
C   FROM TEMPERATURE AND PRESSURE OVER 100 KPA TO THE KAPPA POWER.
C   A BIQUADRATIC INTERPOLATION IS DONE BETWEEN VALUES IN A LOOKUP TABLE
C   COMPUTED IN GTHE. SEE DOCUMENTATION FOR FTHEX FOR DETAILS.
C   INPUT VALUES OUTSIDE TABLE RANGE ARE RESET TO TABLE EXTREMA,
C   EXCEPT ZERO IS RETURNED FOR TOO COLD OR HIGH LCLS.
C   THE INTERPOLATION ACCURACY IS BETTER THAN 0.0002 KELVIN.
C   ON THE CRAY, FTHEQ IS ALMOST 3 TIMES FASTER THAN EXACT CALCULATION.
C   THIS FUNCTION SHOULD BE EXPANDED INLINE IN THE CALLING ROUTINE.
C
C PROGRAM HISTORY LOG:
C   91-05-07  IREDELL             MADE INTO INLINABLE FUNCTION
C   94-12-30  IREDELL             QUADRATIC INTERPOLATION
C
C USAGE:   THE=FTHEQ(PV)
C
C   INPUT ARGUMENT LIST:
C     T        - REAL LCL TEMPERATURE IN KELVIN
C     PK       - REAL LCL PRESSURE OVER 100 KPA TO THE KAPPA POWER
C
C   OUTPUT ARGUMENT LIST:
C     FTHEQ    - REAL EQUIVALENT POTENTIAL TEMPERATURE IN KELVIN
C
C COMMON BLOCKS:
C   COMTHE   - SCALING PARAMETERS AND TABLE COMPUTED IN GTHE.
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN 77.
C   MACHINE:  CRAY.
C
C$$$
      PARAMETER(NX=241,NY=151)
      DIMENSION TBTHE(NX,NY)
      COMMON/COMTHE/ C1XTHE,C2XTHE,C1YTHE,C2YTHE,TBTHE
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      XJ=MIN(C1XTHE+C2XTHE*T,FLOAT(NX))
      YJ=MIN(C1YTHE+C2YTHE*PK,FLOAT(NY))
      IF(XJ.GE.1..AND.YJ.GE.1.) THEN
        JX=MIN(MAX(NINT(XJ),2),NX-1)
        JY=MIN(MAX(NINT(YJ),2),NY-1)
        DXJ=XJ-JX
        DYJ=YJ-JY
        FT11=TBTHE(JX-1,JY-1)
        FT12=TBTHE(JX-1,JY)
        FT13=TBTHE(JX-1,JY+1)
        FT21=TBTHE(JX,JY-1)
        FT22=TBTHE(JX,JY)
        FT23=TBTHE(JX,JY+1)
        FT31=TBTHE(JX+1,JY-1)
        FT32=TBTHE(JX+1,JY)
        FT33=TBTHE(JX+1,JY+1)
        FTX1=(((FT31+FT11)/2-FT21)*DXJ+(FT31-FT11)/2)*DXJ+FT21
        FTX2=(((FT32+FT12)/2-FT22)*DXJ+(FT32-FT12)/2)*DXJ+FT22
        FTX3=(((FT33+FT13)/2-FT23)*DXJ+(FT33-FT13)/2)*DXJ+FT23
        FTHEQ=(((FTX3+FTX1)/2-FTX2)*DYJ+(FTX3-FTX1)/2)*DYJ+FTX2
      ELSE
        FTHEQ=0.
      ENDIF
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      RETURN
      END
