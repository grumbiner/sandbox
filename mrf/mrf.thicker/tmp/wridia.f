      SUBROUTINE WRIDIA(FHOUR,RHOUR,IDATE,SL,COLRAB,SLMASK,
     1 TSEA,SMSOIL,SHELEG,STSOIL,TG3,CANOPY,ZORL,GESHEM,BENGSH,
     2 DUSFC,DVSFC,DTSFC,DQSFC,
     3 FLUXR,CVAVG,
     3             ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
     4 NDG)
C
C-DG3 INTEGER IDATE(4)
C-DG3 DIMENSION SL( 28 ),COLRAB( 384 )
CSIB
C...... DOWNWARD SW FLUXES FROM SW SIB RAD..
C     ..   SAVED FOR H2D FILE....
C-DG3 COMMON/SIBSW/ DFVBR( 256 , 31 ),DFNBR( 256 , 31 ),
C-DG31              DFVDR( 256 , 31 ),DFNDR( 256 , 31 )
CSIB
CLD FORCE
C-CLR DIMENSION CFSW( 256 , 31 ,3)
C-CLR DIMENSION CFLW( 256 , 31 ,3)
C-CLR EQUIVALENCE (CFSW(1,1,1),CFLW(1,1,1))
CLD FORCE
C-DG3 DIMENSION SLMASK( 384 , 47 ),TSEA( 384 , 47 ),
C-DG31          SMSOIL( 384 , 47 , 2 ),SHELEG( 384 , 47 ),
C-DG32          STSOIL( 384 , 47 , 2 ),CANOPY( 384 , 47 ),
C-DG33          TG3( 384 , 47 ),
C-DG34          ZORL( 384 , 47 ),GESHEM( 384 , 47 )
C-DG35                             ,BENGSH( 384 , 47 )
C-DG36         ,DUSFC( 384 , 47 ),DVSFC( 384 , 47 )
C-DG36         ,DTSFC( 384 , 47 ),DQSFC( 384 , 47 )
C-DG3 DIMENSION   FLUXR( 256 , 31 ,25)
C-DG3 DIMENSION   CVAVG( 384 , 47 )
C-DG3 DIMENSION   ILEFT( 384 ),IRGHT( 384 ),WGTLON( 384 )
C-DG3 DIMENSION   INSLAT( 47 ),WGTLAT( 47 )
C
      COMMON/COMBIT/NDEX( 4032 ),SNNP1( 4032 )
      COMMON/COMBIT/LAB(4),IFIN,ICEN,IGEN,ICEN2,IENST,IENSI,RUNID,USRID
      CHARACTER*8 LAB
C
C  DIAGNOSTIC INDEXES AND FLAGS
C-DG3 PARAMETER(KDGDA=13)
C-DG3 PARAMETER(KDTLARG=1,KDTCONV=2,KDQCONV=3,KDTSHAL=4,KDQSHAL=5,
C-DG3&          KDTVRDF=6,KDUVRDF=7,KDVVRDF=8,KDQVRDF=9,
C-DG3&          KDTHSW=10,KDTHLW=11,KDTCLD=12,KDTCCV=13)
C-DG3 CHARACTER*8 CNMGDA
C-DG3 COMMON /COMGDC/ CNMGDA(KDGDA)
C-DG3 PARAMETER(NTGDA=92)
C-DG3 PARAMETER(NWGDA=(( 384 * 28 -1)/512+1)*512)
C-DG3 PARAMETER(NRGDA= 47 )
C-DG3 COMMON /COMGDA/ IPUGDA(KDGDA),IBMGDA(KDGDA)
C-DGM COMMON /COMGDD/ GDD(NWGDA*KDGDA*NRGDA)
C-DG3 DIMENSION GDA(NWGDA)
C
      PARAMETER(IPRS=1,ITEMP=11,IZNLW=33,IMERW=34,ISPHUM=51,
     $          IPCPR=59,ISNOWD=65,ICLDF=71,ICCLDF=72,
     $          ISLMSK=81,IZORL=83,IALBDO=84,ISOILM=144,ICEMSK=91,
     $          ILHFLX=121,ISHFLX=122,IZWS=124,IMWS=125,IGHFLX=155,
     $          IUSWFC=160,IDSWFC=161,IULWFC=162,IDLWFC=163,
     $          INSWFC=164,INLWFC=165,
     $          IDSWVB=166,IDSWVD=167,IDSWNB=168,IDSWND=169,
     $          ISGLYR=175,ICNPY=145,
     $          IDSWF=204,IDLWF=205,IUSWF=211,IULWF=212,ICPCPR=214)
      PARAMETER(ISFC=1,ITOA=8,IELEV=105,
     $          ISGLEV=107,IDBLS=111,I2DBLS=112,ICOLMN=200,
     $          ILCBL=212,ILCTL=213,ILCLYR=214,
     $          IMCBL=222,IMCTL=223,IMCLYR=224,
     $          IHCBL=232,IHCTL=233,IHCLYR=234)
      PARAMETER(INST=10,IAVG=3,IACC=4)
      PARAMETER(IFHOUR=1,IFDAY=2)
      PARAMETER(LONB= 384 /2,LATB= 47 *2)
C-DG3 LOGICAL LBM( 384 , 47 )
C-DG3 CHARACTER G(200+ 384 * 47 *(16+1)/8)
C-DG3 DIMENSION IDS(255)
C-DG3 DIMENSION IENS(5)
C-DG3 DIMENSION ICLYR(3),ICTL(3),ICBL(3),ITLCF(3)
C-DG3 DATA ICLYR/IHCLYR,IMCLYR,ILCLYR/
C-DG3 DATA ICTL /IHCTL ,IMCTL ,ILCTL /
C-DG3 DATA ICBL /IHCBL ,IMCBL ,ILCBL /
C-DG3 DATA ITLCF/ITOA,ISFC,ICOLMN/
C
C-DG3 DIMENSION WORK( 384 , 47 ),SLMSEP( 384 , 47 ),
C-DG31          WORK2( 384 , 47 , 28 +2/ 28 ),
C-DG31          WORKC( 384 ,20),IWORKC( 384 )
C
C-DG3 REWIND NDG
C-DG3 CALL IDSDEF(1,IDS)
C-DG3 IENS(1)=1
C-DG3 IENS(2)=IENST
C-DG3 IENS(3)=IENSI
C-DG3 IENS(4)=1
C-DG3 IENS(5)=255
C-DG3 IYR=IDATE(4)
C-DG3 IMO=IDATE(2)
C-DG3 IDA=IDATE(3)
C-DG3 IHR=IDATE(1)
C-DG3 IFTIME=IFHOUR
C-DG3 IFHR=NINT(FHOUR)
C-DG3 ITHR=NINT(RHOUR)
C-DG3 IF(ITHR.GT.255) THEN
C-DG3   IFTIME=IFDAY
C-DG3   IFHR=IFHR/24
C-DG3   ITHR=ITHR/24
C-DG3 ENDIF
C-DG3 DHOUR=RHOUR-FHOUR
C-DG3 IF(DHOUR.GT.0.) THEN
C-DG3   RTIME=1./(3600.*DHOUR)
C-DG3 ELSE
C-DG3   RTIME=0.
C-DG3 ENDIF
C-DG3 SLMSEP=SLMASK
C-DG3 CALL ROWSEP(SLMSEP)
C
C-DG3 WORK=TSEA
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ITEMP,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 DO J = 1,  47
C-DG3   DO I = 1,  384
C-DG3     WORK(I,J) = SMSOIL(I,J,1)
C-DG3   ENDDO
C-DG3 ENDDO
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.EQ.1.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,ISOILM,I2DBLS,0,10,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ISOILM),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 DO J = 1,  47
C-DG3   DO I = 1,  384
C-DG3     WORK(I,J) = SMSOIL(I,J,2)
C-DG3   ENDDO
C-DG3 ENDDO
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.EQ.1.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,ISOILM,I2DBLS,10,200,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ISOILM),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=SHELEG
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ISNOWD,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ISNOWD),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 DO J = 1,  47
C-DG3   DO I = 1,  384
C-DG3     WORK(I,J) = STSOIL(I,J,1)
C-DG3   ENDDO
C-DG3 ENDDO
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,ITEMP,I2DBLS,0,10,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 DO J = 1,  47
C-DG3   DO I = 1,  384
C-DG3     WORK(I,J) = STSOIL(I,J,2)
C-DG3   ENDDO
C-DG3 ENDDO
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,ITEMP,I2DBLS,10,200,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=TG3
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,ITEMP,IDBLS,0,300,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(ITEMP),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=ZORL*1.E-2
C-DG3 CALL ROWSEP(WORK)
C-DG3 LBM=SLMSEP.EQ.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            1,IZORL,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,ITHR,0,INST,0,0,ICEN2,IDS(IZORL),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 IF(DHOUR.GT.0.) THEN
C-DG3 WORK=GESHEM*1.E3*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IPCPR,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPCPR),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=BENGSH*1.E3*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ICPCPR,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICPCPR),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=DTSFC*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ISHFLX,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ISHFLX),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=DUSFC*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IZWS,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IZWS),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=DVSFC*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IMWS,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IMWS),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 WORK=DQSFC*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ILHFLX,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ILHFLX),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C
C-DG3 CALL GGINTF(FLUXR(1,1,17), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME*1.E2
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IALBDO,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IALBDO),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,1), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IULWF,ITOA,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IULWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,2), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IUSWF,ITOA,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IUSWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,18), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWF,ITOA,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,4), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWF,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,3), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IUSWF,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IUSWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,19), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDLWF,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDLWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(FLUXR(1,1,20), 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IULWF,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IULWF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 DO 813 K=5,7
C-DG3   DO 413 J=1, 31
C-DG3   DO 413 I=1, 256
C-DG3     IF(FLUXR(I,J,K).GT.0. E 0) THEN
C-DG3       FLUXR(I,J,K+3) = FLUXR(I,J,K+3) / FLUXR(I,J,K)
C-DG3       FLUXR(I,J,K+6) = FLUXR(I,J,K+6) / FLUXR(I,J,K)
C-DG3       FLUXR(I,J,K) = FLUXR(I,J,K) * RTIME
C-DG3     ENDIF
 413    CONTINUE
C-DG3   CALL CVINTF(FLUXR(1,1,K),FLUXR(1,1,K+3),FLUXR(1,1,K+6),
C-DG31                   256 , 31 , 31 ,
C-DG32                  WORK2(1,1,1),WORK2(1,1,2),WORK2(1,1,3),
C-DG33                   384 , 47 , 47 ,
C-DG34                  ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,
C-DG35                  WORKC(1,1),WORKC(1,5),WORKC(1,9),WORKC(1,13),
C-DG36                  WORKC(1,17),IWORKC,1,1,1)
C-DG3   DO 513 J=1, 31
C-DG3   DO 513 I=1, 256
C-DG3     IF(FLUXR(I,J,K).GT.0. E 0) THEN
C-DG3       FLUXR(I,J,K) = FLUXR(I,J,K) / RTIME
C-DG3       FLUXR(I,J,K+3) = FLUXR(I,J,K+3) * FLUXR(I,J,K)
C-DG3       FLUXR(I,J,K+6) = FLUXR(I,J,K+6) * FLUXR(I,J,K)
C-DG3     ENDIF
 513    CONTINUE
C-DG3   WORK=WORK2(:,:,1)*1.E2
C-DG3   CALL ROWSEP(WORK)
C-DG3   LBM=WORK.GT.0.
C-DG3   CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&              0,ICLDF,ICLYR(K-4),0,0,IYR,IMO,IDA,IHR,
C-DG3&              IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICLDF),IENS,
C-DG3&              0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3   IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3   WORK=WORK2(:,:,2)
C-DG3   CALL ROWSEP(WORK)
C-DG3   CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&              1,ISGLYR,ICTL(K-4),0,0,IYR,IMO,IDA,IHR,
C-DG3&              IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ISGLYR),IENS,
C-DG3&              0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3   IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3   WORK=WORK2(:,:,3)
C-DG3   CALL ROWSEP(WORK)
C-DG3   CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&              1,ISGLYR,ICBL(K-4),0,0,IYR,IMO,IDA,IHR,
C-DG3&              IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ISGLYR),IENS,
C-DG3&              0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3   IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
 813  CONTINUE
C-DG3 WORK=CVAVG*RTIME*1.E2
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.GT.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,ICCLDF,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(ICCLDF),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
CLD FORCE
C-CLR CALL GGINTF(FLUXR(1,1,21), 256 , 31 , 31 ,
C-CLR1            WORK, 384 , 47 , 47 ,1,
C-CLR2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR WORK=WORK*RTIME
C-CLR CALL ROWSEP(WORK)
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,IULWFC,ITOA,0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IULWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-CLR CALL GGINTF(FLUXR(1,1,22), 256 , 31 , 31 ,
C-CLR1            WORK, 384 , 47 , 47 ,1,
C-CLR2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR WORK=WORK*RTIME
C-CLR CALL ROWSEP(WORK)
CC-CLR LBM=WORK.NE.0.
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,IUSWFC,ITOA,0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IUSWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-CLR CALL GGINTF(FLUXR(1,1,25), 256 , 31 , 31 ,
C-CLR1            WORK, 384 , 47 , 47 ,1,
C-CLR2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR WORK=WORK*RTIME
C-CLR CALL ROWSEP(WORK)
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,IDLWFC,ISFC,0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDLWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-CLR CALL GGINTF(FLUXR(1,1,23), 256 , 31 , 31 ,
C-CLR1            WORK, 384 , 47 , 47 ,1,
C-CLR2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR WORK=WORK*RTIME
C-CLR CALL ROWSEP(WORK)
CC-CLR LBM=WORK.NE.0.
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,IDSWFC,ISFC,0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-CLR CALL GGINTF(FLUXR(1,1,24), 256 , 31 , 31 ,
C-CLR1            WORK, 384 , 47 , 47 ,1,
C-CLR2            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR WORK=WORK*RTIME
C-CLR CALL ROWSEP(WORK)
CC-CLR LBM=WORK.NE.0.
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,IUSWFC,ISFC,0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IUSWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C.....   COMPUTE SW CLOUD FORCING AT TOA (CLD-CLEAR),
C         FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 600 J=1, 31
C-CLR  DO 600 I=1, 256
C-CLR   CFSW(I,J,1) = - (FLUXR(I,J,2)-FLUXR(I,J,22))
  600 CONTINUE
C.....    COMPUTE CLOUD FORCING AT SFC (CLD-CLEAR)
C    AGAIN FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 601 J=1, 31
C-CLR  DO 601 I=1, 256
C-CLR  CFSW(I,J,2) =-(FLUXR(I,J,3)-FLUXR(I,J,4)
C-CLR1                      -(FLUXR(I,J,24)-FLUXR(I,J,23)))
  601 CONTINUE
C.....  FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 602 J=1, 31
C-CLR  DO 602 I=1, 256
C-CLR   CFSW(I,J,3) = - (CFSW(I,J,2) - CFSW(I,J,1))
  602 CONTINUE
C-CLR DO 603 K=1,3
C-CLR  CALL GGINTF(CFSW (1,1,K), 256 , 31 , 31 ,
C-CLR1             WORK, 384 , 47 , 47 ,1,
C-CLR2             ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR  WORK=WORK*RTIME
C-CLR  CALL ROWSEP(WORK)
CC-CLR  LBM=WORK.NE.0.
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,INSWFC,ITLCF(K),0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(INSWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
  603 CONTINUE
C.....   COMPUTE LW CLOUD FORCING AT TOA (CLD-CLEAR),
C         FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 1600 J=1, 31
C-CLR  DO 1600 I=1, 256
C-CLR   CFLW(I,J,1) = - (FLUXR(I,J,1)-FLUXR(I,J,21))
 1600 CONTINUE
C.....    COMPUTE CLOUD FORCING AT SFC (CLD-CLEAR)
C    AGAIN FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 1601 J=1, 31
C-CLR  DO 1601 I=1, 256
C-CLR  CFLW(I,J,2) = - (FLUXR(I,J,25)-FLUXR(I,J,19))
 1601 CONTINUE
C.....  FLIP SIGN SO POSITIVE MEANS CLD IS WARMING RELATIVE TO CLEAR
C-CLR DO 1602 J=1, 31
C-CLR  DO 1602 I=1, 256
C-CLR   CFLW(I,J,3) = - (CFLW(I,J,2) - CFLW(I,J,1))
 1602 CONTINUE
C-CLR DO 1603 K=1,3
C-CLR  CALL GGINTF(CFLW (1,1,K), 256 , 31 , 31 ,
C-CLR1             WORK, 384 , 47 , 47 ,1,
C-CLR2             ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-CLR  WORK=WORK*RTIME
C-CLR  CALL ROWSEP(WORK)
C-CLR CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-CLR&            0,INLWFC,ITLCF(K),0,0,IYR,IMO,IDA,IHR,
C-CLR&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(INLWFC),IENS,
C-CLR&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-CLR IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
 1603 CONTINUE
CLD FORCE
C..
CSIB
C-DG3 CALL GGINTF(DFVBR, 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWVB,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWVB),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(DFVDR, 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWVD,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWVD),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(DFNBR, 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWNB,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWNB),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
C-DG3 CALL GGINTF(DFNDR, 256 , 31 , 31 ,
C-DG31            WORK, 384 , 47 , 47 ,1,
C-DG32            ILEFT,IRGHT,WGTLON,INSLAT,WGTLAT,WORK2,1,1,1)
C-DG3 WORK=WORK*RTIME
C-DG3 CALL ROWSEP(WORK)
CC-DG3 LBM=WORK.NE.0.
C-DG3 CALL GRIBIT(WORK,LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            0,IDSWND,ISFC,0,0,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IDSWND),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
CSIB
C
C-DG3 DO 750 KD=1,KDGDA
C
C-DG3 DO 720 J=1,NRGDA
C-DG3 KGDA=(J-1)*KDGDA+KD
C-DG3 CALL GETDIA(KGDA,NWGDA,GDA)
C-DG3 CALL SYNDIA
C-DG3 IGDA=0
C-DG3 DO 710 K=1, 28
C-DG3 DO 710 I=1, 384
C-DG3 IGDA=IGDA+1
C-DG3 WORK2(I,J,K)=GDA(IGDA)*RTIME
710   CONTINUE
720   CONTINUE
C-DG3 IPU=IPUGDA(KD)
C-DG3 IBM=IBMGDA(KD)
C-DG3 DO 730 K=1, 28
C-DG3 ISL=NINT(SL(K)*1.E4)
C-DG3 CALL ROWSEP(WORK2(1,1,K))
C-DG3 IF(IBM.NE.0) LBM=WORK2(:,:,K).NE.0.
C-DG3 CALL GRIBIT(WORK2(1,1,K),LBM,4,LONB,LATB,16,COLRAB,28,2,ICEN,IGEN,
C-DG3&            IBM,IPU,ISGLEV,0,ISL,IYR,IMO,IDA,IHR,
C-DG3&            IFTIME,IFHR,ITHR,IAVG,0,0,ICEN2,IDS(IPU),IENS,
C-DG3&            0.,0.,0.,0.,0.,0.,G,LG,IERR)
C-DG3 IF(IERR.EQ.0) CALL WRYTE(NDG,LG,G)
730   CONTINUE
C
750   CONTINUE
C-DG3 ENDIF
C
C-DG3 CLOSE(NDG)
C
      RETURN
      END
