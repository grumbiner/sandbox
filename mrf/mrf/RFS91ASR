      BLOCK DATA  GFDLRD
C
C....    BLOCK DATA INTIALIZES QUANTITIES NEEDED BY THE GFDL CODES.
C.... BD2,BD3,BD4,BD5,BLCKFS ALL COMBINED INTO 1 BLOCKDATA FOR FRONTEND.
C
C     BLOCK DATA BD1 GIVES INPUT DATA (TEMPS,PRESSURES,MIXING RATIOS,
C     CLOUD AMTS AND HEIGHTS) FOR TESTING THE RADIATION CODE AS A
C     STANDALONE MODEL.
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE RNDDTA;
 %INCLUDE CO2DTA;
      COMMON/TBLTMP/ DELCM(NBLY)
C*** NOTE: THE DATA,EQUIVALENCE AND DIMENSION STATEMENTS FOR QUANTITIES
C    EQUIVALENCED TO COMMON BLOCK BANDTA DEPEND ON THE VALUE OF THE
C    PARAMETER NBLW.
C
      DIMENSION ARNDM1(64),ARNDM2(64),ARNDM3(35)
      DIMENSION BRNDM1(64),BRNDM2(64),BRNDM3(35)
      DIMENSION AP1(64),AP2(64),AP3(35)
      DIMENSION BP1(64),BP2(64),BP3(35)
      DIMENSION ATP1(64),ATP2(64),ATP3(35)
      DIMENSION BTP1(64),BTP2(64),BTP3(35)
      DIMENSION BETAD1(64),BETAD2(64),BETAD3(35)
      DIMENSION BANDL1(64),BANDL2(64),BANDL3(35)
      DIMENSION BANDH1(64),BANDH2(64),BANDH3(35)
      EQUIVALENCE (ARNDM1(1),ARNDM(1)),(ARNDM2(1),ARNDM(65)),
     1            (ARNDM3(1),ARNDM(129))
      EQUIVALENCE (BRNDM1(1),BRNDM(1)),(BRNDM2(1),BRNDM(65)),
     1            (BRNDM3(1),BRNDM(129))
      EQUIVALENCE (AP1(1),AP(1)),(AP2(1),AP(65)),
     1            (AP3(1),AP(129))
      EQUIVALENCE (BP1(1),BP(1)),(BP2(1),BP(65)),
     1            (BP3(1),BP(129))
      EQUIVALENCE (ATP1(1),ATP(1)),(ATP2(1),ATP(65)),
     1            (ATP3(1),ATP(129))
      EQUIVALENCE (BTP1(1),BTP(1)),(BTP2(1),BTP(65)),
     1            (BTP3(1),BTP(129))
      EQUIVALENCE (BETAD1(1),BETAD(1)),(BETAD2(1),BETAD(65)),
     1            (BETAD3(1),BETAD(129))
      EQUIVALENCE (BANDL1(1),BANDLO(1)),(BANDL2(1),BANDLO(65)),
     1            (BANDL3(1),BANDLO(129))
      EQUIVALENCE (BANDH1(1),BANDHI(1)),(BANDH2(1),BANDHI(65)),
     1            (BANDH3(1),BANDHI(129))
C
C***THE FOLLOWING DATA STATEMENTS ARE BAND PARAMETERS OBTAINED USING
C   THE 1982 AFGL CATALOG ON THE SPECIFIED BANDS
      DATA ARNDM1  /
     *   0.354693E+00,  0.269857E+03,  0.167062E+03,  0.201314E+04,
     *   0.964533E+03,  0.547971E+04,  0.152933E+04,  0.599429E+04,
     *   0.699329E+04,  0.856721E+04,  0.962489E+04,  0.233348E+04,
     *   0.127091E+05,  0.104383E+05,  0.504249E+04,  0.181227E+05,
     *   0.856480E+03,  0.136354E+05,  0.288635E+04,  0.170200E+04,
     *   0.209761E+05,  0.126797E+04,  0.110096E+05,  0.336436E+03,
     *   0.491663E+04,  0.863701E+04,  0.540389E+03,  0.439786E+04,
     *   0.347836E+04,  0.130557E+03,  0.465332E+04,  0.253086E+03,
     *   0.257387E+04,  0.488041E+03,  0.892991E+03,  0.117148E+04,
     *   0.125880E+03,  0.458852E+03,  0.142975E+03,  0.446355E+03,
     *   0.302887E+02,  0.394451E+03,  0.438112E+02,  0.348811E+02,
     *   0.615503E+02,  0.143165E+03,  0.103958E+02,  0.725108E+02,
     *   0.316628E+02,  0.946456E+01,  0.542675E+02,  0.351557E+02,
     *   0.301797E+02,  0.381010E+01,  0.126319E+02,  0.548010E+01,
     *   0.600199E+01,  0.640803E+00,  0.501549E-01,  0.167961E-01,
     *   0.178110E-01,  0.170166E+00,  0.273514E-01,  0.983767E+00/
      DATA ARNDM2  /
     *   0.753946E+00,  0.941763E-01,  0.970547E+00,  0.268862E+00,
     *   0.564373E+01,  0.389794E+01,  0.310955E+01,  0.128235E+01,
     *   0.196414E+01,  0.247113E+02,  0.593435E+01,  0.377552E+02,
     *   0.305173E+02,  0.852479E+01,  0.116780E+03,  0.101490E+03,
     *   0.138939E+03,  0.324228E+03,  0.683729E+02,  0.471304E+03,
     *   0.159684E+03,  0.427101E+03,  0.114716E+03,  0.106190E+04,
     *   0.294607E+03,  0.762948E+03,  0.333199E+03,  0.830645E+03,
     *   0.162512E+04,  0.525676E+03,  0.137739E+04,  0.136252E+04,
     *   0.147164E+04,  0.187196E+04,  0.131118E+04,  0.103975E+04,
     *   0.621637E+01,  0.399459E+02,  0.950648E+02,  0.943161E+03,
     *   0.526821E+03,  0.104150E+04,  0.905610E+03,  0.228142E+04,
     *   0.806270E+03,  0.691845E+03,  0.155237E+04,  0.192241E+04,
     *   0.991871E+03,  0.123907E+04,  0.457289E+02,  0.146146E+04,
     *   0.319382E+03,  0.436074E+03,  0.374214E+03,  0.778217E+03,
     *   0.140227E+03,  0.562540E+03,  0.682685E+02,  0.820292E+02,
     *   0.178779E+03,  0.186150E+03,  0.383864E+03,  0.567416E+01/
      DATA ARNDM3  /
     *   0.225129E+03,  0.473099E+01,  0.753149E+02,  0.233689E+02,
     *   0.339802E+02,  0.108855E+03,  0.380016E+02,  0.151039E+01,
     *   0.660346E+02,  0.370165E+01,  0.234169E+02,  0.440206E+00,
     *   0.615283E+01,  0.304077E+02,  0.117769E+01,  0.125248E+02,
     *   0.142652E+01,  0.241831E+00,  0.483721E+01,  0.226357E-01,
     *   0.549835E+01,  0.597067E+00,  0.404553E+00,  0.143584E+01,
     *   0.294291E+00,  0.466273E+00,  0.156048E+00,  0.656185E+00,
     *   0.172727E+00,  0.118349E+00,  0.141598E+00,  0.588581E-01,
     *   0.919409E-01,  0.155521E-01,  0.537083E-02/
      DATA BRNDM1  /
     *   0.789571E-01,  0.920256E-01,  0.696960E-01,  0.245544E+00,
     *   0.188503E+00,  0.266127E+00,  0.271371E+00,  0.330917E+00,
     *   0.190424E+00,  0.224498E+00,  0.282517E+00,  0.130675E+00,
     *   0.212579E+00,  0.227298E+00,  0.138585E+00,  0.187106E+00,
     *   0.194527E+00,  0.177034E+00,  0.115902E+00,  0.118499E+00,
     *   0.142848E+00,  0.216869E+00,  0.149848E+00,  0.971585E-01,
     *   0.151532E+00,  0.865628E-01,  0.764246E-01,  0.100035E+00,
     *   0.171133E+00,  0.134737E+00,  0.105173E+00,  0.860832E-01,
     *   0.148921E+00,  0.869234E-01,  0.106018E+00,  0.184865E+00,
     *   0.767454E-01,  0.108981E+00,  0.123094E+00,  0.177287E+00,
     *   0.848146E-01,  0.119356E+00,  0.133829E+00,  0.954505E-01,
     *   0.155405E+00,  0.164167E+00,  0.161390E+00,  0.113287E+00,
     *   0.714720E-01,  0.741598E-01,  0.719590E-01,  0.140616E+00,
     *   0.355356E-01,  0.832779E-01,  0.128680E+00,  0.983013E-01,
     *   0.629660E-01,  0.643346E-01,  0.717082E-01,  0.629730E-01,
     *   0.875182E-01,  0.857907E-01,  0.358808E+00,  0.178840E+00/
      DATA BRNDM2  /
     *   0.254265E+00,  0.297901E+00,  0.153916E+00,  0.537774E+00,
     *   0.267906E+00,  0.104254E+00,  0.400723E+00,  0.389670E+00,
     *   0.263701E+00,  0.338116E+00,  0.351528E+00,  0.267764E+00,
     *   0.186419E+00,  0.238237E+00,  0.210408E+00,  0.176869E+00,
     *   0.114715E+00,  0.173299E+00,  0.967770E-01,  0.172565E+00,
     *   0.162085E+00,  0.157782E+00,  0.886832E-01,  0.242999E+00,
     *   0.760298E-01,  0.164248E+00,  0.221428E+00,  0.166799E+00,
     *   0.312514E+00,  0.380600E+00,  0.353828E+00,  0.269500E+00,
     *   0.254759E+00,  0.285408E+00,  0.159764E+00,  0.721058E-01,
     *   0.170528E+00,  0.231595E+00,  0.307184E+00,  0.564136E-01,
     *   0.159884E+00,  0.147907E+00,  0.185666E+00,  0.183567E+00,
     *   0.182482E+00,  0.230650E+00,  0.175348E+00,  0.195978E+00,
     *   0.255323E+00,  0.198517E+00,  0.195500E+00,  0.208356E+00,
     *   0.309603E+00,  0.112011E+00,  0.102570E+00,  0.128276E+00,
     *   0.168100E+00,  0.177836E+00,  0.105533E+00,  0.903330E-01,
     *   0.126036E+00,  0.101430E+00,  0.124546E+00,  0.221406E+00/
      DATA BRNDM3  /
     *   0.137509E+00,  0.911365E-01,  0.724508E-01,  0.795788E-01,
     *   0.137411E+00,  0.549175E-01,  0.787714E-01,  0.165544E+00,
     *   0.136484E+00,  0.146729E+00,  0.820496E-01,  0.846211E-01,
     *   0.785821E-01,  0.122527E+00,  0.125359E+00,  0.101589E+00,
     *   0.155756E+00,  0.189239E+00,  0.999086E-01,  0.480993E+00,
     *   0.100233E+00,  0.153754E+00,  0.130780E+00,  0.136136E+00,
     *   0.159353E+00,  0.156634E+00,  0.272265E+00,  0.186874E+00,
     *   0.192090E+00,  0.135397E+00,  0.131497E+00,  0.127463E+00,
     *   0.227233E+00,  0.190562E+00,  0.214005E+00/
      DATA AP1     /
     *  -0.675950E-02, -0.909459E-02, -0.800214E-02, -0.658673E-02,
     *  -0.245580E-02, -0.710464E-02, -0.205565E-02, -0.446529E-02,
     *  -0.440265E-02, -0.593625E-02, -0.201913E-02, -0.349169E-02,
     *  -0.209324E-02, -0.127980E-02, -0.388007E-02, -0.140542E-02,
     *   0.518346E-02, -0.159375E-02,  0.250508E-02,  0.132182E-01,
     *  -0.903779E-03,  0.110959E-01,  0.924528E-03,  0.207428E-01,
     *   0.364166E-02,  0.365229E-02,  0.884367E-02,  0.617260E-02,
     *   0.701340E-02,  0.184265E-01,  0.992822E-02,  0.908582E-02,
     *   0.106581E-01,  0.276268E-02,  0.158414E-01,  0.145747E-01,
     *   0.453080E-02,  0.214767E-01,  0.553895E-02,  0.195031E-01,
     *   0.237016E-01,  0.112371E-01,  0.275977E-01,  0.188833E-01,
     *   0.131079E-01,  0.130019E-01,  0.385122E-01,  0.111768E-01,
     *   0.622620E-02,  0.194397E-01,  0.134360E-01,  0.207829E-01,
     *   0.147960E-01,  0.744479E-02,  0.107564E-01,  0.181562E-01,
     *   0.170062E-01,  0.233303E-01,  0.256735E-01,  0.274745E-01,
     *   0.279259E-01,  0.197002E-01,  0.140268E-01,  0.185933E-01/
      DATA AP2     /
     *   0.169525E-01,  0.214410E-01,  0.136577E-01,  0.169510E-01,
     *   0.173025E-01,  0.958346E-02,  0.255024E-01,  0.308943E-01,
     *   0.196031E-01,  0.183608E-01,  0.149419E-01,  0.206358E-01,
     *   0.140654E-01,  0.172797E-01,  0.145470E-01,  0.982987E-02,
     *   0.116695E-01,  0.811333E-02,  0.965823E-02,  0.649977E-02,
     *   0.462192E-02,  0.545929E-02,  0.680407E-02,  0.291235E-02,
     *  -0.974773E-03,  0.341591E-02,  0.376198E-02,  0.770610E-03,
     *  -0.940864E-04,  0.514532E-02,  0.232371E-02, -0.177741E-02,
     *  -0.374892E-03, -0.370485E-03, -0.221435E-02, -0.490000E-02,
     *   0.588664E-02,  0.931411E-03, -0.456043E-03, -0.545576E-02,
     *  -0.421136E-02, -0.353742E-02, -0.174276E-02, -0.361246E-02,
     *  -0.337822E-02, -0.867030E-03, -0.118001E-02, -0.222405E-02,
     *  -0.725144E-03,  0.118483E-02,  0.995087E-02,  0.273812E-03,
     *   0.417298E-02,  0.764294E-02,  0.631568E-02, -0.213528E-02,
     *   0.746130E-02,  0.110337E-02,  0.153157E-01,  0.504532E-02,
     *   0.406047E-02,  0.192895E-02,  0.202058E-02,  0.126420E-01/
      DATA AP3     /
     *   0.310028E-02,  0.214779E-01,  0.560165E-02,  0.661070E-02,
     *   0.694966E-02,  0.539194E-02,  0.103745E-01,  0.180150E-01,
     *   0.747133E-02,  0.114927E-01,  0.115213E-01,  0.160709E-02,
     *   0.154278E-01,  0.112067E-01,  0.148690E-01,  0.154442E-01,
     *   0.123977E-01,  0.237539E-01,  0.162820E-01,  0.269484E-01,
     *   0.178081E-01,  0.143221E-01,  0.262468E-01,  0.217065E-01,
     *   0.107083E-01,  0.281220E-01,  0.115565E-01,  0.231244E-01,
     *   0.225197E-01,  0.178624E-01,  0.327708E-01,  0.116657E-01,
     *   0.277452E-01,  0.301647E-01,  0.349782E-01/
      DATA BP1     /
     *   0.717848E-05,  0.169280E-04,  0.126710E-04,  0.758397E-05,
     *  -0.533900E-05,  0.143490E-04, -0.595854E-05,  0.296465E-05,
     *   0.323446E-05,  0.115359E-04, -0.692861E-05,  0.131477E-04,
     *  -0.624945E-05, -0.756955E-06,  0.107458E-05, -0.159796E-05,
     *  -0.290529E-04, -0.170918E-05, -0.193934E-04, -0.707209E-04,
     *  -0.148154E-04, -0.383162E-04, -0.186050E-04, -0.951796E-04,
     *  -0.210944E-04, -0.330590E-04, -0.373087E-04, -0.408972E-04,
     *  -0.396759E-04, -0.827756E-04, -0.573773E-04, -0.325384E-04,
     *  -0.449411E-04, -0.271450E-04, -0.752791E-04, -0.549699E-04,
     *  -0.225655E-04, -0.102034E-03, -0.740322E-05, -0.668846E-04,
     *  -0.106063E-03, -0.304840E-04, -0.796023E-04,  0.504880E-04,
     *   0.486384E-04, -0.531946E-04, -0.147771E-03, -0.406785E-04,
     *   0.615750E-05, -0.486264E-04, -0.419335E-04, -0.819467E-04,
     *  -0.709498E-04,  0.326984E-05, -0.369743E-04, -0.526848E-04,
     *  -0.550050E-04, -0.684057E-04, -0.447093E-04, -0.778390E-04,
     *  -0.982953E-04, -0.772497E-04, -0.119430E-05, -0.655187E-04/
      DATA BP2     /
     *  -0.339078E-04,  0.716657E-04, -0.335893E-04,  0.220239E-04,
     *  -0.491012E-04, -0.393325E-04, -0.626461E-04, -0.795479E-04,
     *  -0.599181E-04, -0.578153E-04, -0.597559E-05, -0.866750E-04,
     *  -0.486783E-04, -0.580912E-04, -0.647368E-04, -0.350643E-04,
     *  -0.566635E-04, -0.385738E-04, -0.463782E-04, -0.321485E-04,
     *  -0.177300E-04, -0.250201E-04, -0.365492E-04, -0.165218E-04,
     *  -0.649177E-05, -0.218458E-04, -0.984604E-05, -0.120034E-04,
     *  -0.110119E-06, -0.164405E-04, -0.141396E-04,  0.315347E-05,
     *  -0.141544E-05, -0.297320E-05, -0.216248E-05,  0.839264E-05,
     *  -0.178197E-04, -0.106225E-04, -0.468195E-05,  0.997043E-05,
     *   0.679709E-05,  0.324610E-05, -0.367325E-05,  0.671058E-05,
     *   0.509293E-05, -0.437392E-05, -0.787922E-06, -0.271503E-06,
     *  -0.437940E-05, -0.128205E-04, -0.417830E-04, -0.561134E-05,
     *  -0.209940E-04, -0.414366E-04, -0.289765E-04,  0.680406E-06,
     *  -0.558644E-05, -0.530395E-05, -0.622242E-04, -0.159979E-05,
     *  -0.140286E-04, -0.128463E-04, -0.929499E-05, -0.327886E-04/
      DATA BP3     /
     *  -0.189353E-04, -0.737589E-04, -0.323471E-04, -0.272502E-04,
     *  -0.321731E-04, -0.326958E-04, -0.509157E-04, -0.681890E-04,
     *  -0.362182E-04, -0.354405E-04, -0.578392E-04,  0.238627E-05,
     *  -0.709028E-04, -0.518717E-04, -0.491859E-04, -0.718017E-04,
     *  -0.418978E-05, -0.940819E-04, -0.630375E-04, -0.478469E-04,
     *  -0.751896E-04, -0.267113E-04, -0.109019E-03, -0.890983E-04,
     *  -0.177301E-04, -0.120216E-03,  0.220464E-04, -0.734277E-04,
     *  -0.868068E-04, -0.652319E-04, -0.136982E-03, -0.279933E-06,
     *  -0.791824E-04, -0.111781E-03, -0.748263E-04/
      DATA ATP1    /
     *  -0.722782E-02, -0.901531E-02, -0.821263E-02, -0.808024E-02,
     *  -0.320169E-02, -0.661305E-02, -0.287272E-02, -0.486143E-02,
     *  -0.242857E-02, -0.530288E-02, -0.146813E-02, -0.566474E-03,
     *  -0.102192E-02,  0.300643E-03, -0.331655E-02,  0.648220E-03,
     *   0.552446E-02, -0.933046E-03,  0.205703E-02,  0.130638E-01,
     *  -0.229828E-02,  0.715648E-02,  0.444446E-03,  0.193500E-01,
     *   0.364119E-02,  0.252713E-02,  0.102420E-01,  0.494224E-02,
     *   0.584934E-02,  0.146255E-01,  0.921986E-02,  0.768012E-02,
     *   0.916105E-02,  0.276223E-02,  0.125245E-01,  0.131146E-01,
     *   0.793016E-02,  0.201536E-01,  0.658631E-02,  0.171711E-01,
     *   0.228470E-01,  0.131306E-01,  0.226658E-01,  0.176086E-01,
     *   0.149987E-01,  0.143060E-01,  0.313189E-01,  0.117070E-01,
     *   0.133522E-01,  0.244259E-01,  0.148393E-01,  0.223982E-01,
     *   0.151792E-01,  0.180474E-01,  0.106299E-01,  0.191016E-01,
     *   0.171776E-01,  0.229724E-01,  0.275530E-01,  0.302731E-01,
     *   0.281662E-01,  0.199525E-01,  0.192588E-01,  0.173220E-01/
      DATA ATP2    /
     *   0.195220E-01,  0.169371E-01,  0.193212E-01,  0.145558E-01,
     *   0.189654E-01,  0.122030E-01,  0.186206E-01,  0.228842E-01,
     *   0.139343E-01,  0.164006E-01,  0.137276E-01,  0.154005E-01,
     *   0.114575E-01,  0.129956E-01,  0.115305E-01,  0.929260E-02,
     *   0.106359E-01,  0.771623E-02,  0.106075E-01,  0.597630E-02,
     *   0.493960E-02,  0.532554E-02,  0.646175E-02,  0.302693E-02,
     *   0.150899E-02,  0.310333E-02,  0.533734E-02,  0.239094E-03,
     *   0.356782E-02,  0.707574E-02,  0.215758E-02, -0.527589E-03,
     *   0.643893E-03, -0.101916E-02, -0.383336E-02, -0.445966E-02,
     *   0.880190E-02,  0.245662E-02, -0.560923E-03, -0.582201E-02,
     *  -0.323233E-02, -0.454197E-02, -0.240905E-02, -0.343160E-02,
     *  -0.335156E-02, -0.623846E-03,  0.393633E-03, -0.271593E-02,
     *  -0.675874E-03,  0.920642E-03,  0.102168E-01, -0.250663E-03,
     *   0.437126E-02,  0.767434E-02,  0.569931E-02, -0.929326E-03,
     *   0.659414E-02,  0.280687E-02,  0.127614E-01,  0.780789E-02,
     *   0.374807E-02,  0.274288E-02,  0.534940E-02,  0.104349E-01/
       DATA ATP3   /
     *   0.294379E-02,  0.177846E-01,  0.523249E-02,  0.125339E-01,
     *   0.548538E-02,  0.577403E-02,  0.101532E-01,  0.170375E-01,
     *   0.758396E-02,  0.113402E-01,  0.106960E-01,  0.107782E-01,
     *   0.136148E-01,  0.992064E-02,  0.167276E-01,  0.149603E-01,
     *   0.136259E-01,  0.234521E-01,  0.166806E-01,  0.298505E-01,
     *   0.167592E-01,  0.186679E-01,  0.233062E-01,  0.228467E-01,
     *   0.128947E-01,  0.293979E-01,  0.219815E-01,  0.220663E-01,
     *   0.272710E-01,  0.237139E-01,  0.331743E-01,  0.208799E-01,
     *   0.281472E-01,  0.318440E-01,  0.370962E-01/
      DATA BTP1    /
     *   0.149748E-04,  0.188007E-04,  0.196530E-04,  0.124747E-04,
     *  -0.215751E-07,  0.128357E-04, -0.265798E-05,  0.606262E-05,
     *   0.287668E-05,  0.974612E-05, -0.833451E-05,  0.584410E-05,
     *  -0.452879E-05, -0.782537E-05,  0.786165E-05, -0.768351E-05,
     *  -0.196168E-04,  0.177297E-06, -0.129258E-04, -0.642798E-04,
     *  -0.986297E-05, -0.257145E-04, -0.141996E-04, -0.865089E-04,
     *  -0.141691E-04, -0.272578E-04, -0.295198E-04, -0.308878E-04,
     *  -0.313193E-04, -0.669272E-04, -0.475777E-04, -0.221332E-04,
     *  -0.419930E-04, -0.102519E-04, -0.590184E-04, -0.574771E-04,
     *  -0.240809E-04, -0.913994E-04, -0.908886E-05, -0.721074E-04,
     *  -0.902837E-04, -0.447582E-04, -0.664544E-04, -0.143150E-04,
     *  -0.511866E-05, -0.559352E-04, -0.104734E-03, -0.305206E-04,
     *   0.103303E-04, -0.613019E-04, -0.320040E-04, -0.738909E-04,
     *  -0.388263E-04,  0.306515E-04, -0.352214E-04, -0.253940E-04,
     *  -0.521369E-04, -0.746260E-04, -0.744124E-04, -0.881905E-04,
     *  -0.933645E-04, -0.664045E-04, -0.570712E-05, -0.566312E-04/
      DATA BTP2    /
     *  -0.364967E-04,  0.393501E-06, -0.234050E-04, -0.141317E-04,
     *  -0.525480E-04, -0.172241E-04, -0.410843E-04, -0.358348E-04,
     *  -0.256168E-04, -0.509482E-04, -0.180570E-04, -0.555356E-04,
     *  -0.271464E-04, -0.274040E-04, -0.480889E-04, -0.275751E-04,
     *  -0.415681E-04, -0.383770E-04, -0.280139E-04, -0.287919E-04,
     *  -0.125865E-04, -0.265467E-04, -0.172765E-04, -0.164611E-04,
     *   0.189183E-04, -0.171219E-04, -0.132766E-04, -0.344611E-05,
     *  -0.442832E-05, -0.185779E-04, -0.139755E-04,  0.168083E-05,
     *  -0.395287E-05, -0.297871E-05,  0.434383E-05,  0.131741E-04,
     *  -0.192637E-04, -0.549551E-05,  0.122553E-05,  0.204627E-04,
     *   0.154027E-04,  0.953462E-05,  0.131125E-05,  0.732839E-05,
     *   0.755405E-05, -0.305552E-05, -0.434858E-05,  0.308409E-05,
     *  -0.164787E-05, -0.818533E-05, -0.355041E-04, -0.504696E-05,
     *  -0.229022E-04, -0.356891E-04, -0.230346E-04,  0.518835E-05,
     *  -0.160187E-04, -0.104617E-04, -0.464754E-04, -0.115807E-04,
     *  -0.130230E-04, -0.603491E-05, -0.125324E-04, -0.165516E-04/
      DATA BTP3    /
     *  -0.991679E-05, -0.529432E-04, -0.200199E-04, -0.181977E-04,
     *  -0.220940E-04, -0.204483E-04, -0.432584E-04, -0.449109E-04,
     *  -0.247305E-04, -0.174253E-04, -0.484446E-04,  0.354150E-04,
     *  -0.425581E-04, -0.406562E-04, -0.505495E-04, -0.651856E-04,
     *  -0.153953E-04, -0.894294E-04, -0.616551E-04, -0.846504E-04,
     *  -0.699414E-04, -0.376203E-04, -0.940985E-04, -0.753050E-04,
     *  -0.183710E-04, -0.123907E-03, -0.279347E-04, -0.736381E-04,
     *  -0.103588E-03, -0.754117E-04, -0.140991E-03, -0.366687E-04,
     *  -0.927785E-04, -0.125321E-03, -0.115290E-03/
      DATA BETAD1  /
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.234879E+03,  0.217419E+03,  0.201281E+03,  0.186364E+03,
     *   0.172576E+03,  0.159831E+03,  0.148051E+03,  0.137163E+03,
     *   0.127099E+03,  0.117796E+03,  0.109197E+03,  0.101249E+03,
     *   0.939031E+02,  0.871127E+02,  0.808363E+02,  0.750349E+02,
     *   0.497489E+02,  0.221212E+02,  0.113124E+02,  0.754174E+01,
     *   0.589554E+01,  0.495227E+01,  0.000000E+00,  0.000000E+00/
      DATA BETAD2  /
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00/
      DATA BETAD3  /
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.000000E+00,  0.000000E+00,  0.000000E+00/
      DATA BANDL1 /
     *   0.000000E+00,  0.100000E+02,  0.200000E+02,  0.300000E+02,
     *   0.400000E+02,  0.500000E+02,  0.600000E+02,  0.700000E+02,
     *   0.800000E+02,  0.900000E+02,  0.100000E+03,  0.110000E+03,
     *   0.120000E+03,  0.130000E+03,  0.140000E+03,  0.150000E+03,
     *   0.160000E+03,  0.170000E+03,  0.180000E+03,  0.190000E+03,
     *   0.200000E+03,  0.210000E+03,  0.220000E+03,  0.230000E+03,
     *   0.240000E+03,  0.250000E+03,  0.260000E+03,  0.270000E+03,
     *   0.280000E+03,  0.290000E+03,  0.300000E+03,  0.310000E+03,
     *   0.320000E+03,  0.330000E+03,  0.340000E+03,  0.350000E+03,
     *   0.360000E+03,  0.370000E+03,  0.380000E+03,  0.390000E+03,
     *   0.400000E+03,  0.410000E+03,  0.420000E+03,  0.430000E+03,
     *   0.440000E+03,  0.450000E+03,  0.460000E+03,  0.470000E+03,
     *   0.480000E+03,  0.490000E+03,  0.500000E+03,  0.510000E+03,
     *   0.520000E+03,  0.530000E+03,  0.540000E+03,  0.550000E+03,
     *   0.560000E+03,  0.670000E+03,  0.800000E+03,  0.900000E+03,
     *   0.990000E+03,  0.107000E+04,  0.120000E+04,  0.121000E+04/
      DATA BANDL2 /
     *   0.122000E+04,  0.123000E+04,  0.124000E+04,  0.125000E+04,
     *   0.126000E+04,  0.127000E+04,  0.128000E+04,  0.129000E+04,
     *   0.130000E+04,  0.131000E+04,  0.132000E+04,  0.133000E+04,
     *   0.134000E+04,  0.135000E+04,  0.136000E+04,  0.137000E+04,
     *   0.138000E+04,  0.139000E+04,  0.140000E+04,  0.141000E+04,
     *   0.142000E+04,  0.143000E+04,  0.144000E+04,  0.145000E+04,
     *   0.146000E+04,  0.147000E+04,  0.148000E+04,  0.149000E+04,
     *   0.150000E+04,  0.151000E+04,  0.152000E+04,  0.153000E+04,
     *   0.154000E+04,  0.155000E+04,  0.156000E+04,  0.157000E+04,
     *   0.158000E+04,  0.159000E+04,  0.160000E+04,  0.161000E+04,
     *   0.162000E+04,  0.163000E+04,  0.164000E+04,  0.165000E+04,
     *   0.166000E+04,  0.167000E+04,  0.168000E+04,  0.169000E+04,
     *   0.170000E+04,  0.171000E+04,  0.172000E+04,  0.173000E+04,
     *   0.174000E+04,  0.175000E+04,  0.176000E+04,  0.177000E+04,
     *   0.178000E+04,  0.179000E+04,  0.180000E+04,  0.181000E+04,
     *   0.182000E+04,  0.183000E+04,  0.184000E+04,  0.185000E+04/
      DATA BANDL3 /
     *   0.186000E+04,  0.187000E+04,  0.188000E+04,  0.189000E+04,
     *   0.190000E+04,  0.191000E+04,  0.192000E+04,  0.193000E+04,
     *   0.194000E+04,  0.195000E+04,  0.196000E+04,  0.197000E+04,
     *   0.198000E+04,  0.199000E+04,  0.200000E+04,  0.201000E+04,
     *   0.202000E+04,  0.203000E+04,  0.204000E+04,  0.205000E+04,
     *   0.206000E+04,  0.207000E+04,  0.208000E+04,  0.209000E+04,
     *   0.210000E+04,  0.211000E+04,  0.212000E+04,  0.213000E+04,
     *   0.214000E+04,  0.215000E+04,  0.216000E+04,  0.217000E+04,
     *   0.218000E+04,  0.219000E+04,  0.227000E+04/
      DATA BANDH1 /
     *   0.100000E+02,  0.200000E+02,  0.300000E+02,  0.400000E+02,
     *   0.500000E+02,  0.600000E+02,  0.700000E+02,  0.800000E+02,
     *   0.900000E+02,  0.100000E+03,  0.110000E+03,  0.120000E+03,
     *   0.130000E+03,  0.140000E+03,  0.150000E+03,  0.160000E+03,
     *   0.170000E+03,  0.180000E+03,  0.190000E+03,  0.200000E+03,
     *   0.210000E+03,  0.220000E+03,  0.230000E+03,  0.240000E+03,
     *   0.250000E+03,  0.260000E+03,  0.270000E+03,  0.280000E+03,
     *   0.290000E+03,  0.300000E+03,  0.310000E+03,  0.320000E+03,
     *   0.330000E+03,  0.340000E+03,  0.350000E+03,  0.360000E+03,
     *   0.370000E+03,  0.380000E+03,  0.390000E+03,  0.400000E+03,
     *   0.410000E+03,  0.420000E+03,  0.430000E+03,  0.440000E+03,
     *   0.450000E+03,  0.460000E+03,  0.470000E+03,  0.480000E+03,
     *   0.490000E+03,  0.500000E+03,  0.510000E+03,  0.520000E+03,
     *   0.530000E+03,  0.540000E+03,  0.550000E+03,  0.560000E+03,
     *   0.670000E+03,  0.800000E+03,  0.900000E+03,  0.990000E+03,
     *   0.107000E+04,  0.120000E+04,  0.121000E+04,  0.122000E+04/
      DATA BANDH2 /
     *   0.123000E+04,  0.124000E+04,  0.125000E+04,  0.126000E+04,
     *   0.127000E+04,  0.128000E+04,  0.129000E+04,  0.130000E+04,
     *   0.131000E+04,  0.132000E+04,  0.133000E+04,  0.134000E+04,
     *   0.135000E+04,  0.136000E+04,  0.137000E+04,  0.138000E+04,
     *   0.139000E+04,  0.140000E+04,  0.141000E+04,  0.142000E+04,
     *   0.143000E+04,  0.144000E+04,  0.145000E+04,  0.146000E+04,
     *   0.147000E+04,  0.148000E+04,  0.149000E+04,  0.150000E+04,
     *   0.151000E+04,  0.152000E+04,  0.153000E+04,  0.154000E+04,
     *   0.155000E+04,  0.156000E+04,  0.157000E+04,  0.158000E+04,
     *   0.159000E+04,  0.160000E+04,  0.161000E+04,  0.162000E+04,
     *   0.163000E+04,  0.164000E+04,  0.165000E+04,  0.166000E+04,
     *   0.167000E+04,  0.168000E+04,  0.169000E+04,  0.170000E+04,
     *   0.171000E+04,  0.172000E+04,  0.173000E+04,  0.174000E+04,
     *   0.175000E+04,  0.176000E+04,  0.177000E+04,  0.178000E+04,
     *   0.179000E+04,  0.180000E+04,  0.181000E+04,  0.182000E+04,
     *   0.183000E+04,  0.184000E+04,  0.185000E+04,  0.186000E+04/
      DATA BANDH3 /
     *   0.187000E+04,  0.188000E+04,  0.189000E+04,  0.190000E+04,
     *   0.191000E+04,  0.192000E+04,  0.193000E+04,  0.194000E+04,
     *   0.195000E+04,  0.196000E+04,  0.197000E+04,  0.198000E+04,
     *   0.199000E+04,  0.200000E+04,  0.201000E+04,  0.202000E+04,
     *   0.203000E+04,  0.204000E+04,  0.205000E+04,  0.206000E+04,
     *   0.207000E+04,  0.208000E+04,  0.209000E+04,  0.210000E+04,
     *   0.211000E+04,  0.212000E+04,  0.213000E+04,  0.214000E+04,
     *   0.215000E+04,  0.216000E+04,  0.217000E+04,  0.218000E+04,
     *   0.219000E+04,  0.220000E+04,  0.238000E+04/
      DATA AO3RND /
     *   0.543368E+02,  0.234676E+04,  0.384881E+02/
      DATA BO3RND /
     *   0.526064E+01,  0.922424E+01,  0.496515E+01/
      DATA AWIDE  /
     *   0.309801E+01/
      DATA BWIDE  /
     *   0.495357E-01/
      DATA APWD   /
     *   0.177115E-01/
      DATA BPWD   /
     *  -0.545226E-04/
      DATA ATPWD  /
     *   0.187967E-01/
      DATA BTPWD  /
     *  -0.567449E-04/
      DATA BETAWD /
     *   0.347839E+02/
      DATA BETINW /
     *   0.766811E+01/
      DATA BDLOWD /
     *   0.560000E+03/
      DATA BDHIWD /
     *   0.800000E+03/
      DATA ACOMB  /
     *   0.152070E+05,  0.332194E+04,  0.527177E+03,  0.163124E+03,
     *   0.268808E+03,  0.534591E+02,  0.268071E+02,  0.123133E+02,
     *   0.600199E+01,  0.640803E+00,  0.501549E-01,  0.167961E-01,
     *   0.178110E-01,  0.170166E+00,  0.537083E-02/
      DATA BCOMB  /
     *   0.152538E+00,  0.118677E+00,  0.103660E+00,  0.100119E+00,
     *   0.127518E+00,  0.118409E+00,  0.904061E-01,  0.642011E-01,
     *   0.629660E-01,  0.643346E-01,  0.717082E-01,  0.629730E-01,
     *   0.875182E-01,  0.857907E-01,  0.214005E+00/
      DATA APCM   /
     *  -0.671879E-03,  0.654345E-02,  0.143657E-01,  0.923593E-02,
     *   0.117022E-01,  0.159596E-01,  0.181600E-01,  0.145013E-01,
     *   0.170062E-01,  0.233303E-01,  0.256735E-01,  0.274745E-01,
     *   0.279259E-01,  0.197002E-01,  0.349782E-01/
      DATA BPCM   /
     *  -0.113520E-04, -0.323965E-04, -0.448417E-04, -0.230779E-04,
     *  -0.361981E-04, -0.145117E-04,  0.198349E-04, -0.486529E-04,
     *  -0.550050E-04, -0.684057E-04, -0.447093E-04, -0.778390E-04,
     *  -0.982953E-04, -0.772497E-04, -0.748263E-04/
      DATA ATPCM  /
     *  -0.106346E-02,  0.641531E-02,  0.137362E-01,  0.922513E-02,
     *   0.136162E-01,  0.169791E-01,  0.206959E-01,  0.166223E-01,
     *   0.171776E-01,  0.229724E-01,  0.275530E-01,  0.302731E-01,
     *   0.281662E-01,  0.199525E-01,  0.370962E-01/
      DATA BTPCM  /
     *  -0.735731E-05, -0.294149E-04, -0.505592E-04, -0.280894E-04,
     *  -0.492972E-04, -0.341508E-04, -0.362947E-04, -0.250487E-04,
     *  -0.521369E-04, -0.746260E-04, -0.744124E-04, -0.881905E-04,
     *  -0.933645E-04, -0.664045E-04, -0.115290E-03/
      DATA BETACM /
     *   0.000000E+00,  0.000000E+00,  0.000000E+00,  0.000000E+00,
     *   0.188625E+03,  0.144293E+03,  0.174098E+03,  0.909366E+02,
     *   0.497489E+02,  0.221212E+02,  0.113124E+02,  0.754174E+01,
     *   0.589554E+01,  0.495227E+01,  0.000000E+00/
      DATA DELCM  /
     *   0.300000E+02,  0.110000E+03,  0.600000E+02,  0.400000E+02,
     *   0.200000E+02,  0.500000E+02,  0.400000E+02,  0.500000E+02,
     *   0.110000E+03,  0.130000E+03,  0.100000E+03,  0.900000E+02,
     *   0.800000E+02,  0.130000E+03,  0.110000E+03/
      DATA IBAND  /
     *    2,   1,   2,   2,   1,   2,   1,   3,   2,   2,
     *    3,   2,   2,   4,   2,   4,   2,   3,   3,   2,
     *    4,   3,   4,   3,   7,   5,   6,   7,   6,   5,
     *    7,   6,   7,   8,   6,   6,   8,   8,   8,   8/
C***THE FOLLOWING DATA ARE LEVEL-INDEPENDENT
CCCCC DATA RCO2/3.3E-4/
      DATA G/980.665/
CCCCC DATA CTAUDA/.5/
CCCCC DATA CSOLAR/1.96/
CCCCC DATA CCOSZ/.5/
C   B0,B1,B2,B3 ARE COEFFICIENTS USED TO CORRECT FOR THE USE OF 250K IN
C   THE PLANCK FUNCTION USED IN EVALUATING PLANCK-WEIGHTED CO2
C   TRANSMISSION FUNCTIONS. (SEE REF. 4)
      DATA B0,B1,B2,B3/-.51926410E-4,-.18113332E-3,
     1 -.10680132E-5,-.67303519E-7/
C    *******************************************************************
C    *                                                                 *
C    *                           B L C K F S  FROM G F D L             *
C    *  UNUSED DATA CLEANED OUT - NOV 86 AND MAR 89 ..K.A.CAMPANA....  *
C    *                                                                 *
C    *******************************************************************
C
C     FOR SEASONAL VARIATION
C        SEASON=1,2,3,4 FOR WINTER,SPRING,SUMMER,FALL ONLY (NOT ACTIVE)
C        SEASON=5 - SEASONAL VARIATION(I.E.INTERPOLATE TO DAY OF FCST)
C
      INTEGER SEASON
      COMMON/DIUCON/SEASON,FCSTDA,JTIME(5),DAZ(12),JDNMC,
     .              FJDNMC,TSLAG,RLAG,TIMIN,TPI,HPI,YEAR,DAY,DHR,IXXXX
      DATA SEASON/5/
      DATA TSLAG/45.25/,  RLAG/14.8125/
      DATA DAY/86400./,  YEAR/365.25/
      DATA TPI/6.283185308/,  HPI/1.570796327/
      DATA JTIME/0,1,0,0,0/
      DATA DHR/2./
      DATA DAZ/0.,31.,59.,90.,120.,151.,181.,212.,243.,273.,304.,334./
C
C     SEA SURFACE ALBEDO DATA
C
      COMMON/SSALB/ALBD(21,20),ZA(20),TRN(21),DZA(19)
      DIMENSION ALB1(21,7),ALB2(21,7),ALB3(21,6)
      EQUIVALENCE (ALB1(1,1),ALBD(1,1)),(ALB2(1,1),ALBD(1,8)),
     .            (ALB3(1,1),ALBD(1,15))
      DATA ALB1/ .061,.062,.072,.087,.115,.163,.235,.318,.395,.472,.542,
     . .604,.655,.693,.719,.732,.730,.681,.581,.453,.425,.061,.062,.070,
     . .083,.108,.145,.198,.263,.336,.415,.487,.547,.595,.631,.656,.670,
     . .652,.602,.494,.398,.370,.061,.061,.068,.079,.098,.130,.174,.228,
     . .290,.357,.424,.498,.556,.588,.603,.592,.556,.488,.393,.342,.325,
     . .061,.061,.065,.073,.086,.110,.150,.192,.248,.306,.360,.407,.444,
     . .469,.480,.474,.444,.386,.333,.301,.290,.061,.061,.065,.070,.082,
     . .101,.131,.168,.208,.252,.295,.331,.358,.375,.385,.377,.356,.320,
     . .288,.266,.255,.061,.061,.063,.068,.077,.092,.114,.143,.176,.210,
     . .242,.272,.288,.296,.300,.291,.273,.252,.237,.266,.220,.061,.061,
     . .062,.066,.072,.084,.103,.127,.151,.176,.198,.219,.236,.245,.250,
     . .246,.235,.222,.211,.205,.200/
      DATA ALB2/ .061,.061,.061,.065,.071,.079,.094,.113,.134,.154,.173,
     . .185,.190,.193,.193,.190,.188,.185,.182,.180,.178,.061,.061,.061,
     . .064,.067,.072,.083,.099,.117,.135,.150,.160,.164,.165,.164,.162,
     . .160,.159,.158,.157,.157,.061,.061,.061,.062,.065,.068,.074,.084,
     . .097,.111,.121,.127,.130,.131,.131,.130,.129,.127,.126,.125,.122,
     . .061,.061,.061,.061,.062,.064,.070,.076,.085,.094,.101,.105,.107,
     . .106,.103,.100,.097,.096,.095,.095,.095,.061,.061,.061,.060,.061,
     . .062,.065,.070,.075,.081,.086,.089,.090,.088,.084,.080,.077,.075,
     . .074,.074,.074,.061,.061,.060,.060,.060,.061,.063,.065,.068,.072,
     . .076,.077,.076,.074,.071,.067,.064,.062,.061,.061,.061,.061,.061,
     . .060,.060,.060,.060,.061,.062,.065,.068,.069,.069,.068,.065,.061,
     . .058,.055,.054,.053,.052,.052/
      DATA ALB3/ .061,.061,.060,.060,.060,.060,.060,.060,.062,.065,.065,
     . .063,.060,.057,.054,.050,.047,.046,.045,.044,.044,.061,.061,.060,
     . .060,.060,.059,.059,.059,.059,.059,.058,.055,.051,.047,.043,.039,
     . .035,.033,.032,.031,.031,.061,.061,.060,.060,.060,.059,.059,.058,
     . .057,.056,.054,.051,.047,.043,.039,.036,.033,.030,.028,.027,.026,
     . .061,.061,.060,.060,.060,.059,.059,.058,.057,.055,.052,.049,.045,
     . .040,.036,.032,.029,.027,.026,.025,.025,.061,.061,.060,.060,.060,
     . .059,.059,.058,.056,.053,.050,.046,.042,.038,.034,.031,.028,.026,
     . .025,.025,.025,.061,.061,.060,.060,.059,.058,.058,.057,.055,.053,
     . .050,.046,.042,.038,.034,.030,.028,.029,.025,.025,.025/
      DATA ZA/90.,88.,86.,84.,82.,80.,78.,76.,74.,70.,66.,62.,58.,54.,
     .        50.,40.,30.,20.,10.,0.0/
      DATA TRN/.00,.05,.10,.15,.20,.25,.30,.35,.40,.45,.50,.55,.60,.65,
     .         .70,.75,.80,.85,.90,.95,1.00/
      DATA DZA/8*2.0,6*4.0,5*10.0/
C
      COMMON/TABLES/SC
      COMMON /SWRSAV/ ABCFF(NB),PWTS(NB),CFCO2,CFO3,REFLO3,RRAYAV
      DATA SC/2.0/
C---SPECIFICATION OF DATA STATEMENTS:
C         ABCFF=ABSORPTION COEFFICIENTS FOR BANDS IN K-DISTRI-
C     BUTION. ORIGINALLY GIVEN BY LACIS AND HANSEN, REVISED BY
C     RAMASWAMY
C         PWTS=CORRESPONDING WEIGHTS ASSIGNED TO BANDS IN THE
C     K-DISTRIBUTION
C         REFLO3,RRAYAV= REFLECTION COEFFICIENTS GIVEN BY
C     LACIS AND HANSEN TO ACCOUNT FOR EFFECTS OF RAYLEIGH SCATTERING
C     IN THE VISIBLE FREQUENCIES (BAND 1)
C         CFCO2,CFO3=CONVERSION FACTORS FROM GM/CM**2 TO CM-ATM(STP)
C
C---THE FOLLOWING ARE THE COEFFICIENTS FOR THE 12-BAND SHORTWAVE
C   RADIATION CODE, SPECIFIED BY RAMASWAMY.
      DATA ABCFF/2*4.0E-5,.002,.035,.377,1.95,9.40,44.6,190.,
     1           989.,2706.,39011./
      DATA PWTS/.5000,.121416,.0698,.1558,.0631,.0362,.0243,.0158,.0087,
     1          .001467,.002342,.001075/
C---THE ORIGINAL 9-BAND LACIS-HANSEN COEFFICIENTS ARE GIVEN HERE; IT
C   THE USER INSISTS ON USING THESE VALUES, SHE MUST ALSO CHANGE
C   THE PARAMETER NB FROM 12 TO 9. THIS PARAMETER IS DEFINED IN
C   RDPARM.H . NO OTHER CHANGES ARE REQUIRED!
C     DATA ABCFF/2*4.0E-5,.002,.035,.377,1.95,9.40,44.6,190./
C     DATA PWTS/.5000,.1470,.0698,.1443,.0584,.0335,.0225,.0158,.0087/
C
      DATA CFCO2,CFO3/508.96,466.64/
      DATA REFLO3/1.9/
      DATA RRAYAV/0.144/
      END
      SUBROUTINE CLO89(CLDFAC,CAMT,NCLDS,KBTM,KTOP)
CFPP$ NOCONCUR R
C
 %INCLUDE HCON;
C     SUBROUTINE CLO88 COMPUTES CLOUD TRANSMISSION FUNCTIONS FOR THE
C  LONGWAVE CODE,USING CODE WRITTEN BY BERT KATZ (301-763-8161).
C  AND MODIFIED BY DAN SCHWARZKOPF IN DECEMBER,1988.
C                INPUTS:          (COMMON BLOCK)
C      CAMT,KTOP,KBTM,NCLDS         RADISW
C                OUTPUT:
C      CLDFAC                       CLDCOM
C
C          CALLED BY:      RADMN OR MODEL ROUTINE
C          CALLS    :
C
 %INCLUDE RDPARM;
C
      DIMENSION NCLDS(IMAX),KTOP(IMBX,LP1),KBTM(IMBX,LP1)
      DIMENSION CAMT(IMBX,LP1),CLDFAC(IMBX,LP1,LP1)
      DIMENSION CLDROW(LP1)
C
C      DIMENSION CLDFIP(LP1,LP1)
       DIMENSION CLDIPT(LP1,LP1,#NVECT)
C
      DO 1 IQ=1,IMAX,#NVECT
      ITOP=IQ+(#NVECT-1)
      IF(ITOP.GT.IMAX) ITOP=IMAX
      JTOP=ITOP-IQ+1
      DO 11 IP=1,JTOP
      IR=IQ+IP-1
      IF (NCLDS(IR).EQ.0) THEN
        DO 25 J=1,LP1
        DO 25 I=1,LP1
        CLDIPT(I,J,IP)=1.
25      CONTINUE
      ENDIF
      IF (NCLDS(IR).GE.1) THEN
          XCLD=1.-CAMT(IR,2)
           K1=KTOP(IR,2)+1
           K2=KBTM(IR,2)
          DO 27 J=1,LP1
              CLDROW(J)=1.
27        CONTINUE
          DO 29 J=1,K2
              CLDROW(J)=XCLD
29        CONTINUE
          KB=MAX(K1,K2+1)
          DO 33 K=KB,LP1
          DO 33 KP=1,LP1
               CLDIPT(KP,K,IP)=CLDROW(KP)
33        CONTINUE
          DO 37 J=1,LP1
              CLDROW(J)=1.
37        CONTINUE
          DO 39 J=K1,LP1
              CLDROW(J)=XCLD
39        CONTINUE
          KT=MIN(K1-1,K2)
          DO 43 K=1,KT
          DO 43 KP=1,LP1
              CLDIPT(KP,K,IP)=CLDROW(KP)
43        CONTINUE
          IF(K2+1.LE.K1-1) THEN
            DO 31 J=K2+1,K1-1
            DO 31 I=1,LP1
                CLDIPT(I,J,IP)=1.
31          CONTINUE
          ELSE IF(K1.LE.K2) THEN
            DO 32 J=K1,K2
            DO 32 I=1,LP1
                CLDIPT(I,J,IP)=XCLD
32          CONTINUE
          ENDIF
      ENDIF
      IF (NCLDS(IR).GE.2) THEN
        DO 21 NC=2,NCLDS(IR)
          XCLD=1.-CAMT(IR,NC+1)
           K1=KTOP(IR,NC+1)+1
           K2=KBTM(IR,NC+1)
          DO 47 J=1,LP1
              CLDROW(J)=1.
47        CONTINUE
          DO 49 J=1,K2
              CLDROW(J)=XCLD
49        CONTINUE
          KB=MAX(K1,K2+1)
          DO 53 K=KB,LP1
          DO 53 KP=1,LP1
               CLDIPT(KP,K,IP)=CLDIPT(KP,K,IP)*CLDROW(KP)
C              CLDFIP(KP,K)=CLDROW(KP)
53        CONTINUE
          DO 57 J=1,LP1
              CLDROW(J)=1.
57        CONTINUE
          DO 59 J=K1,LP1
              CLDROW(J)=XCLD
59        CONTINUE
          KT=MIN(K1-1,K2)
          DO 63 K=1,KT
          DO 63 KP=1,LP1
              CLDIPT(KP,K,IP)=CLDIPT(KP,K,IP)*CLDROW(KP)
C             CLDFIP(KP,K)=CLDROW(KP)
63        CONTINUE
C         IF(K2+1.LE.K1-1) THEN
C           DO 51 J=K2+1,K1-1
C           DO 51 I=1,LP1
C               CLDIPT(I,J,IP)=1.
C51         CONTINUE
          IF(K1.LE.K2) THEN
            DO 52 J=K1,K2
            DO 52 I=1,LP1
                CLDIPT(I,J,IP)=CLDIPT(I,J,IP)*XCLD
52          CONTINUE
          ENDIF
C           DO 65 J=1,LP1
C           DO 65 I=1,LP1
C         CLDIPT(I,J,IP)=CLDIPT(I,J,IP)*CLDFIP(I,J)
C65       CONTINUE
21        CONTINUE
      ENDIF
11    CONTINUE
      DO 71 J=1,LP1
      DO 71 I=1,LP1
      DO 71 IP=1,JTOP
      IR=IQ+IP-1
      CLDFAC(IR,I,J)=CLDIPT(I,J,IP)
71    CONTINUE
1     CONTINUE
      RETURN
      END
      SUBROUTINE CONRAD(NFILE,RCO2)
CFPP$ NOCONCUR R
 % INCLUDE DBCONRAD  ;
C    *******************************************************************
C    *                           C O N R A D                           *
C    *    READ CO2 TRANSMISSION DATA FROM UNIT(NFILE)FOR NEW VERTICAL  *
C    *      COORDINATE TESTS      ...                                  *
C    *    THESE ARRAYS USED TO BE IN BLOCK DATA    ...K.CAMPANA-MAR 90 *
C    *******************************************************************
C
 %INCLUDE RDPARM;
      DIMENSION SGTMP(LP1,2),CO21D(L,6),CO22D(LP1,LP1,6)
      DIMENSION CO21D3(LP1,6),CO21D7(LP1,6)
C
C                 CO2 DATA TABLES FOR USER''S VERTICAL COORDINATE
C
C   THE FOLLOWING COMMON BLOCKS CONTAIN PRETABULATED CO2 TRANSMISSION
C       FUNCTIONS, EVALUATED USING THE METHODS OF FELS AND
C       SCHWARZKOPF (1981) AND SCHWARZKOPF AND FELS (1985),
C-----  THE 2-DIMENSIONAL ARRAYS ARE
C                    CO2 TRANSMISSION FUNCTIONS AND THEIR DERIVATIVES
C        FROM 109-LEVEL LINE-BY-LINE CALCULATIONS MADE USING THE 1982
C        MCCLATCHY TAPE (12511 LINES),CONSOLIDATED,INTERPOLATED
C        TO THE NMC MRF VERTICAL COORDINATTE,AND RE-CONSOLIDATED TO A
C        200 CM-1 BANDWIDTH. THE INTERPOLATION METHOD IS DESCRIBED IN
C        SCHWARZKOPF AND FELS (J.G.R.,1985).
C-----  THE 1-DIM ARRAYS ARE
C                  CO2 TRANSMISSION FUNCTIONS AND THEIR DERIVATIVES
C          FOR TAU(I,I+1),I=1,L,
C            WHERE THE VALUES ARE NOT OBTAINED BY QUADRATURE,BUT ARE THE
C            ACTUAL TRANSMISSIVITIES,ETC,BETWEEN A PAIR OF PRESSURES.
C          THESE USED ONLY FOR NEARBY LAYER CALCULATIONS INCLUDING QH2O.
C-----  THE WEIGHTING FUNCTION GTEMP=P(K)**0.2*(1.+P(K)/30000.)**0.8/
C         1013250.,WHERE P(K)=PRESSURE,NMC MRF(NEW)  L18 DATA LEVELS FOR
C         PSTAR=1013250.
C-----  STEMP IS US STANDARD ATMOSPHERES,1976,AT DATA PRESSURE LEVELS
C        USING NMC MRF SIGMAS,WHERE PSTAR=1013.25 MB (PTZ PROGRAM)
 %INCLUDE CO2DTA ;
C====>   BEGIN HERE TO GET CONSTANTS FOR RADIATION PACKAGE
      REWIND NFILE
C       READ IN PRE-COMPUTED CO2 TRANSMISSION DATA....
      DO 10 KK=1,2
        READ(NFILE) (SGTMP(I,KK),I=1,LP1)
   10 CONTINUE
      DO 15 KK=1,6
        READ(NFILE) (CO21D(I,KK),I=1,L)
   15 CONTINUE
      DO 20 KK=1,6
        READ(NFILE) ((CO22D(I,J,KK),I=1,LP1),J=1,LP1)
   20 CONTINUE
      DO 25 KK=1,6
        READ(NFILE) (CO21D3(I,KK),I=1,LP1)
   25 CONTINUE
      DO 30 KK=1,6
        READ(NFILE) (CO21D7(I,KK),I=1,LP1)
   30 CONTINUE
C  READ CO2 CONCENTRATION IN PPM (DEFAULTED IN GRADFS IF MISSING)
      READ(NFILE,END=31) RCO2
   31 CONTINUE
      PRINT *,'CO2 CONCENTRATION IS ',RCO2
      REWIND NFILE
      DO 35 K=1,LP1
        STEMP(K) = SGTMP(K,1)
        GTEMP(K) = SGTMP(K,2)
   35 CONTINUE
      DO 40 K=1,L
        CDTM51(K) = CO21D(K,1)
        CO2M51(K) = CO21D(K,2)
        C2DM51(K) = CO21D(K,3)
        CDTM58(K) = CO21D(K,4)
        CO2M58(K) = CO21D(K,5)
        C2DM58(K) = CO21D(K,6)
   40 CONTINUE
      DO 45 J=1,LP1
       DO 45 I=1,LP1
        CDT51(I,J) = CO22D(I,J,1)
        CO251(I,J) = CO22D(I,J,2)
        C2D51(I,J) = CO22D(I,J,3)
        CDT58(I,J) = CO22D(I,J,4)
        CO258(I,J) = CO22D(I,J,5)
        C2D58(I,J) = CO22D(I,J,6)
   45 CONTINUE
      DO 50 K=1,LP1
        CDT31(K) = CO21D3(K,1)
        CO231(K) = CO21D3(K,2)
        C2D31(K) = CO21D3(K,3)
        CDT38(K) = CO21D3(K,4)
        CO238(K) = CO21D3(K,5)
        C2D38(K) = CO21D3(K,6)
   50 CONTINUE
      DO 55 K=1,LP1
        CDT71(K) = CO21D7(K,1)
        CO271(K) = CO21D7(K,2)
        C2D71(K) = CO21D7(K,3)
        CDT78(K) = CO21D7(K,4)
        CO278(K) = CO21D7(K,5)
        C2D78(K) = CO21D7(K,6)
   55 CONTINUE
      PRINT 66,NFILE
   66 FORMAT(1H ,'----READ CO2 TRANSMISSION FUNCTIONS FROM UNIT ',I2)
C
C......    DEFINE TABLES FOR LW RADIATION
      CALL TABLE
C
      RETURN
      END
      SUBROUTINE E1E290(G1,G2,G3,G4,G5,EMISS,FXOE1,DTE1,FXOE2,DTE2,
     1                  AVEPHI,TEMP,T)
CFPP$ NOCONCUR R
C
C     SUBROUTINE E1E290 COMPUTES THE EXCHANGE TERMS IN THE FLUX EQUATION
C  FOR LONGWAVE RADIATION FOR ALL TERMS EXCEPT THE EXCHANGE WITH THE
C  TOP OF THE ATMOSPHERE. THE METHOD IS A TABLE LOOKUP ON A PRE-
C  COMPUTED E2 FUNCTION (DEFINED IN REF. (4)).
C      THE E1 FUNCTION  CALCULATIONS (FORMERLY DONE IN SUBROUTINE
C  E1V88 COMPUTE THE FLUX RESULTING FROM THE EXCHANGE OF PHOTONS
C  BETWEEN A LAYER AND THE TOP OF THE ATMOSPHERE.  THE METHOD IS A
C  TABLE LOOKUP ON A PRE-COMPUTED E1 FUNCTION.
C     CALCULATIONS ARE DONE IN TWO FREQUENCY RANGES:
C       1) 0-560,1200-2200 CM-1   FOR Q(APPROX)
C       2) 160-560 CM-1           FOR Q(APPROX,CTS).
C  MOTIVATION FOR THESE CALCULATIONS IS IN REFERENCES (1) AND (4).
C       INPUTS:                    (COMMON BLOCKS)
C     TABLE1,TABLE2,TABLE3,EM1,EM1WDE  TABCOM
C     AVEPHI                           TFCOM
C     TEMP                             RADISW
C     T                                KDACOM
C     FXOE1,DTE1                ARGUMENT LIST
C     FXOE2,DTE2                ARGUMENT LIST
C       OUTPUTS:
C     EMISS                            TFCOM
C     G1,G2,G3                  ARGUMENT LIST,FOR 1ST FREQ. RANGE
C     G4,G5                     ARGUMENT LIST,FOR 2ND FREQ. RANGE
C
C        CALLED BY :     FST88
C        CALLS     :
C
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE TABCOM;
      DIMENSION TEMP(IMBX,LP1),T(IMBX,LP1)
      DIMENSION AVEPHI(IMBX,LP1),EMISS(IMBX,LP1)
C
      DIMENSION IT1(IMBX,LL3P),IVAL(IMBX,LP1),
     5  FYO(IMBX,LP1),DU(IMBX,LP1),
     6  WW1(IMBX,LP1),WW2(IMBX,LP1),
     7  TMP3(IMBX,LP1),TMP5(IMAX),TMP9(IMAX)
C---VARIABLES EQUIVALENCED TO COMMON BLOCK VARIABLES
      DIMENSION T1(5040),T2(5040),T4(5040)
      DIMENSION EM1V(5040),EM1VW(5040)
C---VARIABLES IN THE ARGUMENT LIST
      DIMENSION FXOE1(IMBX,LP1),DTE1(IMBX,LP1),
     1          FXOE2(IMBX,LP1),DTE2(IMBX,LP1),
     2    G1(IMBX,LP1),G2(IMBX,L),G3(IMBX,LP1),G4(IMBX,LP1),G5(IMBX,L)
C
      EQUIVALENCE (EM1V(1),EM1(1,1)),(EM1VW(1),EM1WDE(1,1))
      EQUIVALENCE (T1(1),TABLE1(1,1)),(T2(1),TABLE2(1,1)),
     1 (T4(1),TABLE3(1,1))
C---FIRST WE OBTAIN THE EMISSIVITIES AS A FUNCTION OF TEMPERATURE
C   (INDEX FXO) AND WATER AMOUNT (INDEX FYO). THIS PART OF THE CODE
C   THUS GENERATES THE E2 FUNCTION. THE FXO INDICES HAVE BEEN
C   OBTAINED IN FST88, FOR CONVENIENCE.
C
C---THIS SUBROUTINE EVALUATES THE K=1 CASE ONLY--
C
C---THIS LOOP REPLACES LOOPS GOING FROMI=1,IMAX AND KP=2,LP1 PLUS
C   THE SPECIAL CASE FOR THE LP1TH LAYER.
      DO 1322 KP=1,LP1
      DO 1322 I=1,IMAX
      TMP3(I,KP)=LOG10(AVEPHI(I,KP))+H16E1
      FYO(I,KP)=AINT(TMP3(I,KP)*TEN)
      DU(I,KP)=TMP3(I,KP)-HP1*FYO(I,KP)
      FYO(I,KP)=H28E1*FYO(I,KP)
      IVAL(I,KP)=FYO(I,KP)+FXOE2(I,KP)
      EMISS(I,KP)=T1(IVAL(I,KP))+DU(I,KP)*T2(IVAL(I,KP))
     1                        +DTE2(I,KP)*T4(IVAL(I,KP))
1322  CONTINUE
C
C---THE SPECIAL CASE EMISS(I,L) (LAYER KP) IS OBTAINED NOW
C   BY AVERAGING THE VALUES FOR L AND LP1:
      DO 1344 I=1,IMAX
      EMISS(I,L)=HAF*(EMISS(I,L)+EMISS(I,LP1))
1344  CONTINUE
C
C   CALCULATIONS FOR THE KP=1 LAYER ARE NOT PERFORMED, AS
C   THE RADIATION CODE ASSUMES THAT THE TOP FLUX LAYER (ABOVE THE
C   TOP DATA LEVEL) IS ISOTHERMAL, AND HENCE CONTRIBUTES NOTHING
C   TO THE FLUXES AT OTHER LEVELS.
C
C***THE FOLLOWING IS THE CALCULATION FOR THE E1 FUNCTION, FORMERLY
C    DONE IN SUBROUTINE E1V88. THE MOVE TO E1E288 IS DUE TO THE
C    SAVINGS IN OBTAINING INDEX VALUES (THE TEMP. INDICES HAVE
C    BEEN OBTAINED IN FST88, WHILE THE U-INDICES ARE OBTAINED
C    IN THE E2 CALCS.,WITH K=1).
C
C
C   FOR TERMS INVOLVING TOP LAYER, DU IS NOT KNOWN; IN FACT, WE
C   USE INDEX 2 TO REPERSENT INDEX 1 IN PREV. CODE. THIS MEANS THAT
C    THE IT1 INDEX 1 AND LLP1 HAS TO BE CALCULATED SEPARATELY. THE
C   INDEX LLP2 GIVES THE SAME VALUE AS 1; IT CAN BE OMITTED.
      DO 208 I=1,IMAX
      IT1(I,1)=FXOE1(I,1)
      WW1(I,1)=TEN-DTE1(I,1)
      WW2(I,1)=HP1
208   CONTINUE
      DO 209 KP=1,L
      DO 209 I=1,IMAX
      IT1(I,KP+1)=FYO(I,KP)+FXOE1(I,KP+1)
      IT1(I,KP+LP1)=FYO(I,KP)+FXOE1(I,KP)
      WW1(I,KP+1)=TEN-DTE1(I,KP+1)
      WW2(I,KP+1)=HP1-DU(I,KP)
209   CONTINUE
      DO 211 KP=1,L
      DO 211 I=1,IMAX
      IT1(I,KP+LLP1)=FYO(I,KP)+FXOE1(I,1)
211   CONTINUE
C
C
C  G3(I,1) HAS THE SAME VALUES AS G1 (AND DID ALL ALONG)
      DO 230 I=1,IMAX
      G1(I,1)=WW1(I,1)*WW2(I,1)*EM1V(IT1(I,1))+
     1        WW2(I,1)*DTE1(I,1)*EM1V(IT1(I,1)+1)
      G3(I,1)=G1(I,1)
230   CONTINUE
      DO 240 KP=1,L
      DO 240 I=1,IMAX
      G1(I,KP+1)=WW1(I,KP+1)*WW2(I,KP+1)*EM1V(IT1(I,KP+1))+
     1        WW2(I,KP+1)*DTE1(I,KP+1)*EM1V(IT1(I,KP+1)+1)+
     2        WW1(I,KP+1)*DU(I,KP)*EM1V(IT1(I,KP+1)+28)+
     3        DTE1(I,KP+1)*DU(I,KP)*EM1V(IT1(I,KP+1)+29)
      G2(I,KP)=WW1(I,KP)*WW2(I,KP+1)*EM1V(IT1(I,KP+LP1))+
     1        WW2(I,KP+1)*DTE1(I,KP)*EM1V(IT1(I,KP+LP1)+1)+
     1        WW1(I,KP)*DU(I,KP)*EM1V(IT1(I,KP+LP1)+28)+
     2        DTE1(I,KP)*DU(I,KP)*EM1V(IT1(I,KP+LP1)+29)
240   CONTINUE
      DO 241 KP=2,LP1
      DO 241 I=1,IMAX
      G3(I,KP)=WW1(I,1)*WW2(I,KP)*EM1V(IT1(I,LL+KP))+
     1        WW2(I,KP)*DTE1(I,1)*EM1V(IT1(I,LL+KP)+1)+
     2        WW1(I,1)*DU(I,KP-1)*EM1V(IT1(I,LL+KP)+28)+
     3        DTE1(I,1)*DU(I,KP-1)*EM1V(IT1(I,LL+KP)+29)
241   CONTINUE
C
      DO 244 I=1,IMAX
      G4(I,1)=WW1(I,1)*WW2(I,1)*EM1VW(IT1(I,1))+
     1        WW2(I,1)*DTE1(I,1)*EM1VW(IT1(I,1)+1)
244   CONTINUE
      DO 242 KP=1,L
      DO 242 I=1,IMAX
      G4(I,KP+1)=WW1(I,KP+1)*WW2(I,KP+1)*EM1VW(IT1(I,KP+1))+
     1        WW2(I,KP+1)*DTE1(I,KP+1)*EM1VW(IT1(I,KP+1)+1)+
     2        WW1(I,KP+1)*DU(I,KP)*EM1VW(IT1(I,KP+1)+28)+
     3        DTE1(I,KP+1)*DU(I,KP)*EM1VW(IT1(I,KP+1)+29)
      G5(I,KP)=WW1(I,KP)*WW2(I,KP+1)*EM1VW(IT1(I,KP+LP1))+
     1        WW2(I,KP+1)*DTE1(I,KP)*EM1VW(IT1(I,KP+LP1)+1)+
     1        WW1(I,KP)*DU(I,KP)*EM1VW(IT1(I,KP+LP1)+28)+
     2        DTE1(I,KP)*DU(I,KP)*EM1VW(IT1(I,KP+LP1)+29)
242   CONTINUE
C
      RETURN
      END
      SUBROUTINE E290(EMISSB,EMISS,AVEPHI,KLEN,FXOE2,DTE2)
CFPP$ NOCONCUR R
C
C     SUBROUTINE E290 COMPUTES THE EXCHANGE TERMS IN THE FLUX EQUATION
C  FOR LONGWAVE RADIATION FOR ALL TERMS EXCEPT THE EXCHANGE WITH THE
C  TOP OF THE ATMOSPHERE. THE METHOD IS A TABLE LOOKUP ON A PRE-
C  COMPUTED E2 FUNCTION (DEFINED IN REF. (4)).
C     CALCULATIONS ARE DONE IN THE FREQUENCY RANGE:
C       1) 0-560,1200-2200 CM-1   FOR Q(APPROX)
C  MOTIVATION FOR THESE CALCULATIONS IS IN REFERENCES (1) AND (4).
C       INPUTS:                    (COMMON BLOCKS)
C     TABLE1,TABLE2,TABLE3,            TABCOM
C     AVEPHI                           TFCOM
C     FXOE2,DTE2,KLEN           ARGUMENT LIST
C       OUTPUTS:
C     EMISS,EMISSB                     TFCOM
C
C        CALLED BY :     FST88
C        CALLS     :
C
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE TABCOM;
      DIMENSION EMISSB(IMBX,LP1),EMISS(IMBX,LP1),AVEPHI(IMBX,LP1)
      DIMENSION IVAL(IMBX,LP1),
     1  DT(IMBX,LP1),FYO(IMBX,LP1),DU(IMBX,LP1)
C---TMP3 MAY BE EQUIVALENCED TO DT IN VTEMP
      DIMENSION TMP3(IMBX,LP1)
C---VARIABLES EQUIVALENCED TO COMMON BLOCK VARIABLES
      DIMENSION T1(5040),T2(5040),T4(5040)
C---VARIABLES IN THE ARGUMENT LIST
      DIMENSION FXOE2(IMBX,LP1),DTE2(IMBX,LP1)
C
      EQUIVALENCE (TMP3,DT)
      EQUIVALENCE (T1(1),TABLE1(1,1)),(T2(1),TABLE2(1,1)),
     1 (T4(1),TABLE3(1,1))
C---FIRST WE OBTAIN THE EMISSIVITIES AS A FUNCTION OF TEMPERATURE
C   (INDEX FXO) AND WATER AMOUNT (INDEX FYO). THIS PART OF THE CODE
C   THUS GENERATES THE E2 FUNCTION.
C
C---CALCULATIONS FOR VARYING KP (FROM KP=K+1 TO LP1, INCLUDING SPECIAL
C   CASE: RESULTS ARE IN EMISS
      DO 132 K=1,LP2-KLEN
      DO 132 I=1,IMAX
      TMP3(I,K)=LOG10(AVEPHI(I,K+KLEN-1))+H16E1
      FYO(I,K)=AINT(TMP3(I,K)*TEN)
      DU(I,K)=TMP3(I,K)-HP1*FYO(I,K)
      FYO(I,K)=H28E1*FYO(I,K)
      IVAL(I,K)=FYO(I,K)+FXOE2(I,K+KLEN-1)
      EMISS(I,K+KLEN-1)=T1(IVAL(I,K))+DU(I,K)*T2(IVAL(I,K))
     1                           +DTE2(I,K+KLEN-1)*T4(IVAL(I,K))
132   CONTINUE
C---THE SPECIAL CASE EMISS(I,L) (LAYER KP) IS OBTAINED NOW
C   BY AVERAGING THE VALUES FOR L AND LP1:
      DO 1344 I=1,IMAX
      EMISS(I,L)=HAF*(EMISS(I,L)+EMISS(I,LP1))
1344  CONTINUE
C---NOTE THAT EMISS(I,LP1) IS NOT USEFUL AFTER THIS POINT.
C
C---CALCULATIONS FOR KP=KLEN AND VARYING K; RESULTS ARE IN EMISSB.
C  IN THIS CASE, THE TEMPERATURE INDEX IS UNCHANGED, ALWAYS BEING
C  FXO(I,KLEN-1); THE WATER INDEX CHANGES, BUT IS SYMMETRICAL WITH
C  THAT FOR THE VARYING KP CASE.NOTE THAT THE SPECIAL CASE IS NOT
C  INVOLVED HERE.
C     (FIXED LEVEL) K VARIES FROM (KLEN+1) TO LP1; RESULTS ARE IN
C   EMISSB(I,(KLEN) TO L)
      DO 142 K=1,LP1-KLEN
      DO 142 I=1,IMAX
      DT(I,K)=DTE2(I,KLEN-1)
      IVAL(I,K)=FYO(I,K)+FXOE2(I,KLEN-1)
142   CONTINUE
C
      DO 234 K=1,LP1-KLEN
      DO 234 I=1,IMAX
      EMISSB(I,K+KLEN-1)=T1(IVAL(I,K))+DU(I,K)*T2(IVAL(I,K))
     1                                +DT(I,K)*T4(IVAL(I,K))
234   CONTINUE
      RETURN
      END
      SUBROUTINE E2SPEC(EMISS,AVEPHI,FXOSP,DTSP)
CFPP$ NOCONCUR R
C
C     SUBROUTINE E2SPEC COMPUTES THE EXCHANGE TERMS IN THE FLUX EQUATION
C  FOR LONGWAVE RADIATION FOR 2 TERMS USED FOR NEARBY LAYER COMPU-
C  TATIONS. THE METHOD IS A TABLE LOOKUP ON A PRE-
C  COMPUTED E2 FUNCTION (DEFINED IN REF. (4)).
C     CALCULATIONS ARE DONE IN THE FREQUENCY RANGE:
C        0-560,1200-2200 CM-1
C  MOTIVATION FOR THESE CALCULATIONS IS IN REFERENCES (1) AND (4).
C       INPUTS:                    (COMMON BLOCKS)
C     TABLE1,TABLE2,TABLE3,            TABCOM
C     AVEPHI                           TFCOM
C     FXOSP,DTSP                ARGUMENT LIST
C       OUTPUTS:
C     EMISS                            TFCOM
C
C        CALLED BY :     FST88
C        CALLS     :
C
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE TABCOM;
      DIMENSION AVEPHI(IMBX,LP1),EMISS(IMBX,LP1)
      DIMENSION IVAL(IMBX,LP1),
     1  FYO(IMBX,LP1),DU(IMBX,LP1),
     2  TMP3(IMBX,LP1)
C---VARIABLES EQUIVALENCED TO COMMON BLOCK VARIABLES
      DIMENSION T1(5040),T2(5040),T4(5040)
C---VARIABLES IN THE ARGUMENT LIST
      DIMENSION FXOSP(IMBX,2),DTSP(IMBX,2)
C
      EQUIVALENCE (T1(1),TABLE1(1,1)),(T2(1),TABLE2(1,1)),
     1 (T4(1),TABLE3(1,1))
C---FIRST WE OBTAIN THE EMISSIVITIES AS A FUNCTION OF TEMPERATURE
C   (INDEX FXO) AND WATER AMOUNT (INDEX FYO). THIS PART OF THE CODE
C   THUS GENERATES THE E2 FUNCTION.
C
      DO 132 K=1,2
      DO 132 I=1,IMAX
      TMP3(I,K)=LOG10(AVEPHI(I,K))+H16E1
      FYO(I,K)=AINT(TMP3(I,K)*TEN)
      DU(I,K)=TMP3(I,K)-HP1*FYO(I,K)
      IVAL(I,K)=H28E1*FYO(I,K)+FXOSP(I,K)
      EMISS(I,K)=T1(IVAL(I,K))+DU(I,K)*T2(IVAL(I,K))+
     1                         DTSP(I,K)*T4(IVAL(I,K))
132   CONTINUE
      RETURN
      END
C     SUBROUTINE E3V88 COMPUTES NEARBY LAYER TRANSMISSIVITIES FOR
C  H2O USING A TABLE LOOKUP OF THE PRE-COMPUTED E3 FUNCTION
C ( DESCRIBED IN REF. (4)).
C         INPUTS:                 (COMMON BLOCKS,ARGS.)
C       TV,AV                      ARGUMENT LIST
C       EM3                        TABCOM
C          OUTPUTS:
C       EMV                        ARGUMENT LIST
C
C       CALLED BY  :    FST88
C       CALLS      :    ALOG10H,ALOG10V
C
      SUBROUTINE E3V88(EMV,TV,AV)
CFPP$ NOCONCUR R
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE TABCOM;
      DIMENSION IT(IMBX,LLP1),WW1(IMBX,LLP1),
     1          DT(IMBX,LLP1),WW2(IMBX,LLP1),
     2          DU(IMBX,LLP1)
C   THE FOLLOWING ARRAYS ARE EQUIVALENCED TO VTEMP ARRAYS
      DIMENSION FXO(IMBX,LLP1),FYO(IMBX,LLP1),TMP3(IMBX,LLP1)
C
C    DIMENSIONS OF ARRAYS IN ARGUMENT LIST
      DIMENSION EMV(IMBX,LLP1),TV(IMBX,LLP1),AV(IMBX,LLP1)
C
C   THE FOLLOWING ARRAY IS EQUIVALENCED TO AN ARRAY IN TABCOM.H
      DIMENSION EM3V(5040)
C
      EQUIVALENCE (EM3V(1),EM3(1,1))
      EQUIVALENCE (FXO,WW1),(FYO,WW2),(IT,TMP3)
C---THE FOLLOWING LOOP REPLACES A DOUBLE LOOP OVER I (1-IMAX) AND
C   K (1-LLP1)
      DO 203 K=1,LLP1
      DO 203 I=1,IMAX
        FXO(I,K)=AINT(TV(I,K)*HP1)
        TMP3(I,K)=LOG10(AV(I,K))+H16E1
        DT(I,K)=TV(I,K)-TEN*FXO(I,K)
        FYO(I,K)=AINT(TMP3(I,K)*TEN)
        DU(I,K)=TMP3(I,K)-HP1*FYO(I,K)
C---OBTAIN INDEX FOR TABLE LOOKUP; THIS VALUE WILL HAVE TO BE
C   DECREMENTED BY 9 TO ACCOUNT FOR TABLE TEMPS STARTING AT 100K.
        IT(I,K)=FXO(I,K)+FYO(I,K)*H28E1
        WW1(I,K)=TEN-DT(I,K)
        WW2(I,K)=HP1-DU(I,K)
        EMV(I,K)=WW1(I,K)*WW2(I,K)*EM3V(IT(I,K)-9)+
     1           WW2(I,K)*DT(I,K)*EM3V(IT(I,K)-8)+
     2           WW1(I,K)*DU(I,K)*EM3V(IT(I,K)+19)+
     3           DT(I,K)*DU(I,K)*EM3V(IT(I,K)+20)
203   CONTINUE
      RETURN
      END
C     *****************************************************************
C          SUBROUTINE FST88 IS THE MAIN COMPUTATION MODULE OF THE
C     LONG-WAVE RADIATION CODE. IN IT ALL "EMISSIVITY" CALCULATIONS,
C     INCLUDING CALLS TO TABLE LOOKUP SUBROUTINES. ALSO,AFTER CALLING
C     SUBROUTINE "SPA88", FINAL COMBINED HEATING RATES AND GROUND
C     FLUX ARE OBTAINED.
C     *****************************************************************
C              INPUTS:
C        BETINW,BETAWD,AB15WD              BDWIDE
C        BETAD,BO3RND,AO3RND               BANDTA
C        CLDFAC                            CLDCOM
C        QH2O,P,DELP2,DELP,T,VAR1,VAR2,    KDACOM
C        VAR3,VAR4,CNTVAL                  KDACOM
C        TOTVO2,TOTO3,TOTPHI,EMPL,EMX1     KDACOM
C        TPHIO3,EMX2                       KDACOM
C        TEMP,PRESS                        RADISW
C        NCLDS,KTOP,KBTM,CAMT              RADISW
C        IND,INDX2,KMAXV,SOURCE,DSRCE      TABCOM
C        SKC1R,SKC3R,KMAXVM,NREP1,NREP2    TABCOM
C        NST1,NST2,NRP1,NRP2               TABCOM
C        CO2NBL,CO21                       TFCOM
C        CO2SP1,CO2SP2                     TFCOM
C              OUTPUTS:
C        HEATRA,GRNFLX,TOPFLX              LWOUT
C
C          CALLED BY  :    RADMN OR MAIN PGM
C          CALLS      :    CLO88,E1E288,E3V88,SPA88,NLTE
C
C        PASSED VARIABLES:
C              IN E3V88:
C        EMD     =  E3 FUNCTION FOR H2O LINES (0-560,1200-2200 CM-1)
C                     COMPUTED IN E3V88
C        TPL     =  TEMPERATURE INPUT FOR E3 CALCULATION IN E3V88
C        EMPL    =  H2O AMOUNT,INPUT FOR E3 CALCULATION IN E3V88
C                   (COMPUTED IN LWR88; STORED IN KDACOM.H)
C              IN E1E288:
C        E1CTS1  =  E1 FUNCTION FOR THE (I+1)TH LEVEL USING THE
C                   TEMPERATURE OF THE ITH DATA LEVEL,COMPUTED OVER
C                   THE FREQUENCY RANGE 0-560,1200-2200 CM-1. (E1CTS1-
C                   E1CTW1) IS USED IN OBTAINING THE FLUX AT THE TOP
C                   IN THE 0-160,1200-2200 CM-1 RANGE (FLX1E1).
C        E1CTS2  =  E1 FUNCTION FOR THE ITH LEVEL, USING THE TEMP. OF
C                   THE ITH DATA LEVEL,COMPUTED OVER THE FREQUENCY RANGE
C                   0-560,1200-2200 CM-1. (E1CTS2-E1CTW2) IS ALSO USED
C                   IN OBTAINING THE FLUX AT THE TOP IN THE 0-160,.
C                   1200-2200 CM-1 RANGE.
C        E1FLX   =  E1 FCTN. FOR THE ITH LEVEL,USING THE TEMPERATURE AT
C                   THE TOP OF THE ATMOSPHERE. COMPUTED OVER THE FREQ.
C                   RANGE 0-560,1200-2200 CM-1. USED FOR Q(APPROX) TERM.
C                   (IN COMMON BLOCK TFCOM)
C        E1CTW1  =  LIKE E1CTS1,BUT COMPUTED OVER THE 160-560 CM-1 RANGE
C                   AND USED FOR Q(APPROX,CTS) CALCULATION
C        E1CTW2  =  LIKE E1CTS2,BUT COMPUTED OVER THE 160-560 CM-1 RANGE
C                   AND USED FOR Q(APPROX,CTS) CALCULATION
C        FXO     =  TEMPERATURE INDEX USED FOR E1 FUNCTION AND ALSO
C                   USED FOR SOURCE FUNCTION CALC. IN FST88.
C        DT      =  TEMP. DIFF.BETWEEN MODEL TEMPS. AND TEMPS. AT
C                   TABULAR VALUES OF E1 AND SOURCE FCTNS. USED IN
C                   FST88 AND IN E1 FUNCTION CALC.
C        FXOE2   =  TEMPERATURE INDEX USED FOR E2 FUNCTION
C        DTE2    =  TEMP. DIFF. BETWEEN MODEL TEMP. AND TEMPS. AT
C                   TABULAR VALUES OF E2 FUNCTION.
      SUBROUTINE FST88(HEATRA,GRNFLX,TOPFLX,
##CLR1                 GRNFX0,TOPFX0,
     1                 QH2O,PRESS,P,DELP,DELP2,TEMP,T,
     2                 CLDFAC,NCLDS,KTOP,KBTM,CAMT,
     3                 CO21,CO2NBL,CO2SP1,CO2SP2,
     4                 VAR1,VAR2,VAR3,VAR4,CNTVAL,
     5                 TOTO3,TPHIO3,TOTPHI,TOTVO2,
     6                 EMX1,EMX2,EMPL)
CFPP$ NOCONCUR R
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE RNDDTA;
 %INCLUDE TABCOM;
C
      DIMENSION QH2O(IMBX,LP1),PRESS(IMBX,LP1)
      DIMENSION P(IMBX,LP1),DELP(IMBX,L),DELP2(IMBX,L),TEMP(IMBX,LP1)
      DIMENSION T(IMBX,LP1),CLDFAC(IMBX,LP1,LP1),CAMT(IMBX,LP1)
      DIMENSION NCLDS(IMAX),KTOP(IMBX,LP1),KBTM(IMBX,LP1)
      DIMENSION CO21(IMBX,LP1,LP1),CO2NBL(IMBX,L)
      DIMENSION CO2SP1(IMBX,LP1),CO2SP2(IMBX,LP1)
      DIMENSION VAR1(IMBX,L),VAR2(IMBX,L),VAR3(IMBX,L),VAR4(IMBX,L)
      DIMENSION CNTVAL(IMBX,LP1)
      DIMENSION HEATRA(IMBX,L),GRNFLX(IMAX),TOPFLX(IMAX)
C
##CLR DIMENSION HEATR0(IMBX,L),FLXNT0(IMBX,LP1)
##CLR DIMENSION GRNFX0(IMAX),TOPFX0(IMAX),GXCTS0(IMAX),FLX1E0(IMAX)
##CLR DIMENSION EXCTS0(IMBX,L),CTSO30(IMBX,L),CTS0(IMBX,L)
##CLR DIMENSION FLX0(IMBX,LP1)
C
      DIMENSION GXCTS(IMAX),FLX1E1(IMAX)
      DIMENSION AVEPHI(IMBX,LP1),EMISS(IMBX,LP1),EMISSB(IMBX,LP1)
C
      DIMENSION TOTO3(IMBX,LP1),TPHIO3(IMBX,LP1),TOTPHI(IMBX,LP1)
      DIMENSION TOTVO2(IMBX,LP1),EMX1(IMAX),EMX2(IMAX),EMPL(IMBX,LLP1)
C
      DIMENSION EXCTS(IMBX,L),CTSO3(IMBX,L),CTS(IMBX,L),E1FLX(IMBX,LP1)
      DIMENSION CO2SP(IMBX,LP1),TO3SPC(IMBX,L),TO3SP(IMBX,LP1)
      DIMENSION OSS(IMBX,LP1),CSS(IMBX,LP1),SS1(IMBX,LP1),SS2(IMBX,LP1),
     1 TC(IMBX,LP1),DTC(IMBX,LP1)
      DIMENSION SORC(IMBX,LP1,NBLY),CSOUR(IMBX,LP1)
CCC
      DIMENSION        AVVO2(IMBX,LP1),HEATEM(IMBX,LP1),
     1                 OVER1D(IMBX,LP1),
     1                 TO31D(IMBX,LP1),CONT1D(IMBX,LP1),
     2                 AVMO3(IMBX,LP1),AVPHO3(IMBX,LP1),
     2                 C(IMBX,LLP1),C2(IMBX,LLP1)
      DIMENSION       ITOP(IMAX),IBOT(IMAX),INDTC(IMAX)
      DIMENSION
     4 DELPTC(IMAX),PTOP(IMAX),PBOT(IMAX),FTOP(IMAX),
     5 FBOT(IMAX) ,EMSPEC(IMBX,2)
C---DIMENSION OF VARIABLES EQUIVALENCED TO THOSE IN VTEMP---
      DIMENSION VTMP3(IMBX,LP1),DSORC(IMBX,LP1)
      DIMENSION ALP(IMBX,LLP1),CSUB(IMBX,LLP1),CSUB2(IMBX,LLP1)
      DIMENSION FAC1(IMBX,LP1)
      DIMENSION DELPR1(IMBX,LP1),DELPR2(IMBX,LP1)
      DIMENSION EMISDG(IMBX,LP1),CONTDG(IMBX,LP1),TO3DG(IMBX,LP1)
      DIMENSION FLXNET(IMBX,LP1)
      DIMENSION IXO(IMBX,LP1)
      DIMENSION VSUM1(IMBX,LP1)
      DIMENSION FLXTHK(IMBX,LP1)
      DIMENSION Z1(IMBX,LP1)
C---DIMENSION OF VARIABLES PASSED TO OTHER SUBROUTINES---
C   (AND NOT FOUND IN COMMON BLOCKS)
      DIMENSION E1CTS1(IMBX,LP1),E1CTS2(IMBX,L)
      DIMENSION E1CTW1(IMBX,LP1),E1CTW2(IMBX,L)
      DIMENSION EMD(IMBX,LLP1),TPL(IMBX,LLP1)
C   IT IS POSSIBLE TO EQUIVALENCE EMD,TPL TO THE ABOVE VARIABLES,
C   AS THEY GET CALLED AT DIFFERENT TIMES
      DIMENSION FXO(IMBX,LP1),DT(IMBX,LP1)
      DIMENSION FXOE2(IMBX,LP1),DTE2(IMBX,LP1)
      DIMENSION FXOSP(IMBX,2),DTSP(IMBX,2)
C
C     DIMENSION OF LOCAL VARIABLES
      DIMENSION RLOG(IMBX,L),FLX(IMBX,LP1)
      DIMENSION TOTEVV(IMBX,LP1),CNTTAU(IMBX,LP1)
C
      EQUIVALENCE (ALP,C,CSUB),(CSUB2,C2)
      EQUIVALENCE (FAC1,DSORC,OVER1D,DELPR2,FLXNET)
      EQUIVALENCE (DELPR1,HEATEM)
      EQUIVALENCE (IXO,AVVO2,FLXTHK,TO3DG)
      EQUIVALENCE (Z1,AVMO3,CONTDG)
      EQUIVALENCE (EMISDG,VSUM1,AVPHO3)
      EQUIVALENCE (EMD(1,1),E1CTS1(1,1)),(EMD(1,LP2),E1CTS2(1,1))
      EQUIVALENCE (TPL(1,1),E1CTW1(1,1)),(TPL(1,LP2),E1CTW2(1,1))
C
C          FIRST SECTION IS TABLE LOOKUP FOR SOURCE FUNCTION AND
C     DERIVATIVE (B AND DB/DT).ALSO,THE NLTE CO2 SOURCE FUNCTION
C     IS OBTAINED
C
C---IN CALCS. BELOW, DECREMENTING THE INDEX BY 9
C   ACCOUNTS FOR THE TABLES BEGINNING AT T=100K.
C   AT T=100K.
      DO 101 K=1,LP1
      DO 101 I=1,IMAX
C---TEMP. INDICES FOR E1,SOURCE
      VTMP3(I,K)=AINT(TEMP(I,K)*HP1)
      FXO(I,K)=VTMP3(I,K)-9.
      DT(I,K)=TEMP(I,K)-TEN*VTMP3(I,K)
C---INTEGER INDEX FOR SOURCE (USED IMMEDIATELY)
      IXO(I,K)=FXO(I,K)
101   CONTINUE
      DO 103 K=1,L
      DO 103 I=1,IMAX
C---TEMP. INDICES FOR E2 (KP=1 LAYER NOT USED IN FLUX CALCULATIONS)
      VTMP3(I,K)=AINT(T(I,K+1)*HP1)
      FXOE2(I,K)=VTMP3(I,K)-9.
      DTE2(I,K)=T(I,K+1)-TEN*VTMP3(I,K)
103   CONTINUE
C---SPECIAL CASE TO HANDLE KP=LP1 LAYER AND SPECIAL E2 CALCS.
      DO 105 I=1,IMAX
      FXOE2(I,LP1)=FXO(I,L)
      DTE2(I,LP1)=DT(I,L)
      FXOSP(I,1)=FXOE2(I,LM1)
      FXOSP(I,2)=FXO(I,LM1)
      DTSP(I,1)=DTE2(I,LM1)
      DTSP(I,2)=DT(I,LM1)
105   CONTINUE
C
C---SOURCE FUNCTION FOR COMBINED BAND 1
      DO 4114 I=1,IMAX
      DO 4114 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),1)
        DSORC(I,K)=DSRCE(IXO(I,K),1)
4114   CONTINUE
      DO 4112 K=1,LP1
      DO 4112 I=1,IMAX
      SORC(I,K,1)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4112   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 2
      DO 4214 I=1,IMAX
      DO 4214 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),2)
        DSORC(I,K)=DSRCE(IXO(I,K),2)
4214   CONTINUE
      DO 4212 K=1,LP1
      DO 4212 I=1,IMAX
      SORC(I,K,2)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4212   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 3
      DO 4314 I=1,IMAX
      DO 4314 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),3)
        DSORC(I,K)=DSRCE(IXO(I,K),3)
4314   CONTINUE
      DO 4312 K=1,LP1
      DO 4312 I=1,IMAX
      SORC(I,K,3)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4312   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 4
      DO 4414 I=1,IMAX
      DO 4414 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),4)
        DSORC(I,K)=DSRCE(IXO(I,K),4)
4414   CONTINUE
      DO 4412 K=1,LP1
      DO 4412 I=1,IMAX
      SORC(I,K,4)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4412   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 5
      DO 4514 I=1,IMAX
      DO 4514 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),5)
        DSORC(I,K)=DSRCE(IXO(I,K),5)
4514   CONTINUE
      DO 4512 K=1,LP1
      DO 4512 I=1,IMAX
      SORC(I,K,5)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4512   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 6
      DO 4614 I=1,IMAX
      DO 4614 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),6)
        DSORC(I,K)=DSRCE(IXO(I,K),6)
4614   CONTINUE
      DO 4612 K=1,LP1
      DO 4612 I=1,IMAX
      SORC(I,K,6)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4612   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 7
      DO 4714 I=1,IMAX
      DO 4714 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),7)
        DSORC(I,K)=DSRCE(IXO(I,K),7)
4714   CONTINUE
      DO 4712 K=1,LP1
      DO 4712 I=1,IMAX
      SORC(I,K,7)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4712   CONTINUE
C---SOURCE FUNCTION FOR COMBINED BAND 8
      DO 4814 I=1,IMAX
      DO 4814 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),8)
        DSORC(I,K)=DSRCE(IXO(I,K),8)
4814   CONTINUE
      DO 4812 K=1,LP1
      DO 4812 I=1,IMAX
      SORC(I,K,8)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4812   CONTINUE
C---SOURCE FUNCTION FOR BAND 9 (560-670 CM-1)
      DO 4914 I=1,IMAX
      DO 4914 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),9)
        DSORC(I,K)=DSRCE(IXO(I,K),9)
4914   CONTINUE
      DO 4912 K=1,LP1
      DO 4912 I=1,IMAX
      SORC(I,K,9)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
4912   CONTINUE
C---SOURCE FUNCTION FOR BAND 10 (670-800 CM-1)
      DO 5014 I=1,IMAX
      DO 5014 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),10)
        DSORC(I,K)=DSRCE(IXO(I,K),10)
5014  CONTINUE
      DO 5012 K=1,LP1
      DO 5012 I=1,IMAX
      SORC(I,K,10)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
5012   CONTINUE
C---SOURCE FUNCTION FOR BAND 11 (800-900 CM-1)
      DO 5114 I=1,IMAX
      DO 5114 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),11)
        DSORC(I,K)=DSRCE(IXO(I,K),11)
5114   CONTINUE
      DO 5112 K=1,LP1
      DO 5112 I=1,IMAX
      SORC(I,K,11)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
5112   CONTINUE
C---SOURCE FUNCTION FOR BAND 12 (900-990 CM-1)
      DO 5214 I=1,IMAX
      DO 5214 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),12)
        DSORC(I,K)=DSRCE(IXO(I,K),12)
5214   CONTINUE
      DO 5212 K=1,LP1
      DO 5212 I=1,IMAX
      SORC(I,K,12)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
5212   CONTINUE
C---SOURCE FUNCTION FOR BAND 13 (990-1070 CM-1)
      DO 5314 I=1,IMAX
      DO 5314 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),13)
        DSORC(I,K)=DSRCE(IXO(I,K),13)
5314   CONTINUE
      DO 5312 K=1,LP1
      DO 5312 I=1,IMAX
      SORC(I,K,13)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
5312   CONTINUE
C---SOURCE FUNCTION FOR BAND 14 (1070-1200 CM-1)
      DO 5414 I=1,IMAX
      DO 5414 K=1,LP1
        VTMP3(I,K)=SOURCE(IXO(I,K),14)
        DSORC(I,K)=DSRCE(IXO(I,K),14)
5414   CONTINUE
      DO 5412 K=1,LP1
      DO 5412 I=1,IMAX
      SORC(I,K,14)=VTMP3(I,K)+DT(I,K)*DSORC(I,K)
5412   CONTINUE
C
C        THE FOLLOWING SUBROUTINE OBTAINS NLTE SOURCE FUNCTION FOR CO2
C
C
C     CALL NLTE
C
C
C---OBTAIN SPECIAL SOURCE FUNCTIONS FOR THE 15 UM BAND (CSOUR)
C   AND THE WINDOW REGION (SS1)
      DO 131 K=1,LP1
      DO 131 I=1,IMAX
      SS1(I,K)=SORC(I,K,11)+SORC(I,K,12)+SORC(I,K,14)
131   CONTINUE
      DO 143 K=1,LP1
      DO 143 I=1,IMAX
      CSOUR(I,K)=SORC(I,K,9)+SORC(I,K,10)
143   CONTINUE
C
C---COMPUTE TEMP**4 (TC) AND VERTICAL TEMPERATURE DIFFERENCES
C   (OSS,CSS,SS2,DTC). ALL THESE WILL BE USED LATER IN FLUX COMPUTA-
C   TIONS.
C
      DO 901 K=1,LP1
      DO 901 I=1,IMAX
      TC(I,K)=(TEMP(I,K)*TEMP(I,K))**2
901   CONTINUE
      DO 903 K=1,L
      DO 903 I=1,IMAX
      OSS(I,K+1)=SORC(I,K+1,13)-SORC(I,K,13)
      CSS(I,K+1)=CSOUR(I,K+1)-CSOUR(I,K)
      DTC(I,K+1)=TC(I,K+1)-TC(I,K)
      SS2(I,K+1)=SS1(I,K+1)-SS1(I,K)
903   CONTINUE
C
C
C---THE FOLLOWIMG IS A DRASTIC REWRITE OF THE RADIATION CODE TO
C    (LARGELY) ELIMINATE THREE-DIMENSIONAL ARRAYS. THE CODE WORKS
C    ON THE FOLLOWING PRINCIPLES:
C
C          LET K = FIXED FLUX LEVEL, KP = VARYING FLUX LEVEL
C          THEN FLUX(K)=SUM OVER KP : (DELTAB(KP)*TAU(KP,K))
C               OVER ALL KP'S, FROM 1 TO LP1.
C
C          WE CAN BREAK DOWN THE CALCULATIONS FOR ALL K'S AS FOLLOWS:
C
C          FOR ALL K'S K=1 TO LP1:
C              FLUX(K)=SUM OVER KP : (DELTAB(KP)*TAU(KP,K))  (1)
C                      OVER ALL KP'S, FROM K+1 TO LP1
C          AND
C              FOR KP FROM K+1 TO LP1:
C                 FLUX(KP) = DELTAB(K)*TAU(K,KP)              (2)
C
C          NOW IF TAU(K,KP)=TAU(KP,K) (SYMMETRICAL ARRAYS)
C          WE CAN COMPUTE A 1-DIMENSIONAL ARRAY TAU1D(KP) FROM
C          K+1 TO LP1, EACH TIME K IS INCREMENTED.
C          EQUATIONS (1) AND (2) THEN BECOME:
C
C             TAU1D(KP) = (VALUES FOR TAU(KP,K) AT THE PARTICULAR K)
C             FLUX(K) = SUM OVER KP : (DELTAB(KP)*TAU1D(KP))   (3)
C             FLUX(KP) = DELTAB(K)*TAU1D(KP)                   (4)
C
C         THE TERMS FOR TAU (K,K) AND OTHER SPECIAL TERMS (FOR
C         NEARBY LAYERS) MUST, OF COURSE, BE HANDLED SEPARATELY, AND
C         WITH CARE.
C
C      COMPUTE "UPPER TRIANGLE" TRANSMISSION FUNCTIONS FOR
C      THE 9.6 UM BAND (TO3SP) AND THE 15 UM BAND (OVER1D). ALSO,
C      THE
C      STAGE 1...COMPUTE O3 ,OVER TRANSMISSION FCTNS AND AVEPHI
C---DO K=1 CALCULATION (FROM FLUX LAYER KK TO THE TOP) SEPARATELY
C   AS VECTORIZATION IS IMPROVED,AND OZONE CTS TRANSMISSIVITY
C   MAY BE EXTRACTED HERE.
      DO 3021 K=1,L
      DO 3021 I=1,IMAX
      AVEPHI(I,K)=TOTPHI(I,K+1)
3021  CONTINUE
C---IN ORDER TO PROPERLY EVALUATE EMISS INTEGRATED OVER THE (LP1)
C   LAYER, A SPECIAL EVALUATION OF EMISS IS DONE. THIS REQUIRES
C   A SPECIAL COMPUTATION OF AVEPHI, AND IT IS STORED IN THE
C   (OTHERWISE VACANT) LP1'TH POSITION
C
      DO 803 I=1,IMAX
      AVEPHI(I,LP1)=AVEPHI(I,LM1)+EMX1(I)
803   CONTINUE
C   COMPUTE FLUXES FOR K=1
      CALL E1E290(E1CTS1,E1CTS2,E1FLX,E1CTW1,E1CTW2,EMISS,
     1            FXO,DT,FXOE2,DTE2,AVEPHI,TEMP,T)
      DO 302 K=1,L
      DO 302 I=1,IMAX
      FAC1(I,K)=BO3RND(2)*TPHIO3(I,K+1)/TOTO3(I,K+1)
      TO3SPC(I,K)=HAF*(FAC1(I,K)*
     1    (SQRT(ONE+(FOUR*AO3RND(2)*TOTO3(I,K+1))/FAC1(I,K))-ONE))
C   FOR K=1, TO3SP IS USED INSTEAD OF TO31D (THEY ARE EQUAL IN THIS
C   CASE); TO3SP IS PASSED TO SPA90, WHILE TO31D IS A WORK-ARRAY.
      TO3SP(I,K)=EXP(HM1EZ*(TO3SPC(I,K)+SKO3R*TOTVO2(I,K+1)))
      OVER1D(I,K)=EXP(HM1EZ*(SQRT(AB15WD*TOTPHI(I,K+1))+
     1            SKC1R*TOTVO2(I,K+1)))
C---BECAUSE ALL CONTINUUM TRANSMISSIVITIES ARE OBTAINED FROM THE
C  2-D QUANTITY CNTTAU (AND ITS RECIPROCAL TOTEVV) WE STORE BOTH
C  OF THESE HERE. FOR K=1, CONT1D EQUALS CNTTAU
      CNTTAU(I,K)=EXP(HM1EZ*TOTVO2(I,K+1))
      TOTEVV(I,K)=1./CNTTAU(I,K)
302   CONTINUE
      DO 3022 K=1,L
      DO 3022 I=1,IMAX
      CO2SP(I,K+1)=OVER1D(I,K)*CO21(I,1,K+1)
3022  CONTINUE
      DO 3023 K=1,L
      DO 3023 I=1,IMAX
      CO21(I,K+1,1)=CO21(I,K+1,1)*OVER1D(I,K)
3023  CONTINUE
C---RLOG IS THE NBL AMOUNT FOR THE 15 UM BAND CALCULATION
      DO 1808 I=1,IMAX
      RLOG(I,1)=OVER1D(I,1)*CO2NBL(I,1)
1808  CONTINUE
C---THE TERMS WHEN KP=1 FOR ALL K ARE THE PHOTON EXCHANGE WITH
C   THE TOP OF THE ATMOSPHERE, AND ARE OBTAINED DIFFERENTLY THAN
C   THE OTHER CALCULATIONS
      DO 305 K=2,LP1
      DO 305 I=1,IMAX
      FLX(I,K)= (TC(I,1)*E1FLX(I,K)
     1          +SS1(I,1)*CNTTAU(I,K-1)
     2          +SORC(I,1,13)*TO3SP(I,K-1)
     3          +CSOUR(I,1)*CO2SP(I,K))
     4          *CLDFAC(I,1,K)
305   CONTINUE
      DO 307 I=1,IMAX
      FLX(I,1)= TC(I,1)*E1FLX(I,1)+SS1(I,1)+SORC(I,1,13)
     1          +CSOUR(I,1)
307   CONTINUE
C---THE KP TERMS FOR K=1...
      DO 303 KP=2,LP1
      DO 303 I=1,IMAX
      FLX(I,1)=FLX(I,1)+(OSS(I,KP)*TO3SP(I,KP-1)
     1                  +SS2(I,KP)*CNTTAU(I,KP-1)
     2                  +CSS(I,KP)*CO21(I,KP,1)
     3                  +DTC(I,KP)*EMISS(I,KP-1))*CLDFAC(I,KP,1)
303   CONTINUE
C...    DITTO FOR CLEAR SKY....
##CLR DO 2305 K=2,LP1
##CLR DO 2305 I=1,IMAX
##CLR FLX0(I,K)=  TC(I,1)*E1FLX(I,K)
##CLR1          +SS1(I,1)*CNTTAU(I,K-1)
##CLR2          +SORC(I,1,13)*TO3SP(I,K-1)
##CLR3          +CSOUR(I,1)*CO2SP(I,K)
2305  CONTINUE
##CLR DO 2307 I=1,IMAX
##CLR FLX0(I,1)=TC(I,1)*E1FLX(I,1)+SS1(I,1)+SORC(I,1,13)
##CLR1          +CSOUR(I,1)
2307  CONTINUE
C---THE KP TERMS FOR K=1...
##CLR DO 2303 KP=2,LP1
##CLR  DO 2303 I=1,IMAX
##CLR   FLX0(I,1)=FLX0(I,1)+ OSS(I,KP)*TO3SP(I,KP-1)
##CLR1                  +SS2(I,KP)*CNTTAU(I,KP-1)
##CLR2                  +CSS(I,KP)*CO21(I,KP,1)
##CLR3                  +DTC(I,KP)*EMISS(I,KP-1)
2303  CONTINUE
C          SUBROUTINE SPA88 IS CALLED TO OBTAIN EXACT CTS FOR WATER
C     CO2 AND O3, AND APPROXIMATE CTS CO2 AND O3 CALCULATIONS.
C
      CALL SPA88(EXCTS,CTSO3,GXCTS,SORC,CSOUR,
##CLR1           EXCTS0,CTSO30,GXCTS0,
     1           CLDFAC,TEMP,PRESS,VAR1,VAR2,
     2           P,DELP,DELP2,TOTVO2,TO3SP,TO3SPC,
     3           CO2SP1,CO2SP2,CO2SP)
C
C    THIS SECTION COMPUTES THE EMISSIVITY CTS HEATING RATES FOR 2
C    EMISSIVITY BANDS: THE 0-160,1200-2200 CM-1 BAND AND THE 800-
C    990,1070-1200 CM-1 BAND. THE REMAINING CTS COMTRIBUTIONS ARE
C    CONTAINED IN CTSO3, COMPUTED IN SPA88.
C
      DO 998 I=1,IMAX
      VTMP3(I,1)=1.
998   CONTINUE
      DO 999 K=1,L
      DO 999 I=1,IMAX
      VTMP3(I,K+1)=CNTTAU(I,K)*CLDFAC(I,K+1,1)
999   CONTINUE
      DO 1001 K=1,L
      DO 1001 I=1,IMAX
      CTS(I,K)=RADCON*DELP(I,K)*(TC(I,K)*
     1     (E1CTW2(I,K)*CLDFAC(I,K+1,1)-E1CTW1(I,K)*CLDFAC(I,K,1)) +
     2      SS1(I,K)*(VTMP3(I,K+1)-VTMP3(I,K)))
1001  CONTINUE
C
      DO 1011 K=1,L
      DO 1011 I=1,IMAX
      VTMP3(I,K)=TC(I,K)*(CLDFAC(I,K,1)*(E1CTS1(I,K)-E1CTW1(I,K)) -
     1                    CLDFAC(I,K+1,1)*(E1CTS2(I,K)-E1CTW2(I,K)))
1011  CONTINUE
      DO 1012 I=1,IMAX
      FLX1E1(I)=TC(I,LP1)*CLDFAC(I,LP1,1)*
     1          (E1CTS1(I,LP1)-E1CTW1(I,LP1))
1012  CONTINUE
      DO 1014 K=1,L
      DO 1013 I=1,IMAX
      FLX1E1(I)=FLX1E1(I)+VTMP3(I,K)
1013  CONTINUE
1014  CONTINUE
C  ... DITTO FOR CLEAR SKY  ...
##CLR DO 2998 I=1,IMAX
##CLR  VTMP3(I,1)=1.
2998  CONTINUE
##CLR DO 2999 K=1,L
##CLR DO 2999 I=1,IMAX
##CLR  VTMP3(I,K+1)=CNTTAU(I,K)
2999  CONTINUE
##CLR DO 2001 K=1,L
##CLR DO 2001 I=1,IMAX
##CLR  CTS0(I,K)=RADCON*DELP(I,K)*(TC(I,K)*
##CLR1     (E1CTW2(I,K)-E1CTW1(I,K)) +
##CLR2      SS1(I,K)*(VTMP3(I,K+1)-VTMP3(I,K)))
2001  CONTINUE
C
##CLR DO 2011 K=1,L
##CLR DO 2011 I=1,IMAX
##CLR  VTMP3(I,K)=TC(I,K)*(E1CTS1(I,K)-E1CTW1(I,K)  -
##CLR1                    (E1CTS2(I,K)-E1CTW2(I,K)))
2011  CONTINUE
##CLR DO 2012 I=1,IMAX
##CLR  FLX1E0(I)=TC(I,LP1)*
##CLR1          (E1CTS1(I,LP1)-E1CTW1(I,LP1))
2012  CONTINUE
##CLR DO 2014 K=1,L
##CLR  DO 2013 I=1,IMAX
##CLR   FLX1E0(I)=FLX1E0(I)+VTMP3(I,K)
2013   CONTINUE
2014  CONTINUE
C
C---NOW REPEAT FLUX CALCULATIONS FOR THE K=2..LM1  CASES.
C   CALCULATIONS FOR FLUX LEVEL L AND LP1 ARE DONE SEPARATELY, AS ALL
C   EMISSIVITY AND CO2 CALCULATIONS ARE SPECIAL CASES OR NEARBY LAYERS.
C
      DO 321 K=2,LM1
      KLEN=K
C
      DO 3218 KK=1,LP1-K
      DO 3218 I=1,IMAX
      AVEPHI(I,KK+K-1)=TOTPHI(I,KK+K)-TOTPHI(I,K)
3218  CONTINUE
      DO 1803 I=1,IMAX
      AVEPHI(I,LP1)=AVEPHI(I,LM1)+EMX1(I)
1803   CONTINUE
C---COMPUTE EMISSIVITY FLUXES (E2) FOR THIS CASE. NOTE THAT
C   WE HAVE OMITTED THE NEARBY LATER CASE (EMISS(I,K,K)) AS WELL
C   AS ALL CASES WITH K=L OR LP1. BUT THESE CASES HAVE ALWAYS
C   BEEN HANDLED AS SPECIAL CASES, SO WE MAY AS WELL COMPUTE
C    THEIR FLUXES SEPARASTELY.
C
      CALL E290(EMISSB,EMISS,AVEPHI,KLEN,FXOE2,DTE2)
      DO 322 KK=1,LP1-K
      DO 322 I=1,IMAX
      AVMO3(I,KK+K-1)=TOTO3(I,KK+K)-TOTO3(I,K)
      AVPHO3(I,KK+K-1)=TPHIO3(I,KK+K)-TPHIO3(I,K)
      AVVO2(I,KK+K-1)=TOTVO2(I,KK+K)-TOTVO2(I,K)
      CONT1D(I,KK+K-1)=CNTTAU(I,KK+K-1)*TOTEVV(I,K-1)
322   CONTINUE
C
      DO 3221 KK=1,LP1-K
      DO 3221 I=1,IMAX
      FAC1(I,KK+K-1)=BO3RND(2)*AVPHO3(I,KK+K-1)/AVMO3(I,KK+K-1)
      VTMP3(I,KK+K-1)=HAF*(FAC1(I,KK+K-1)*
     1  (SQRT(ONE+(FOUR*AO3RND(2)*AVMO3(I,KK+K-1))/FAC1(I,KK+K-1))-ONE))
      TO31D(I,KK+K-1)=EXP(HM1EZ*(VTMP3(I,KK+K-1)+SKO3R*AVVO2(I,KK+K-1)))
      OVER1D(I,KK+K-1)=EXP(HM1EZ*(SQRT(AB15WD*AVEPHI(I,KK+K-1))+
     1            SKC1R*AVVO2(I,KK+K-1)))
      CO21(I,KK+K,K)=OVER1D(I,KK+K-1)*CO21(I,KK+K,K)
3221  CONTINUE
      DO 3223 KP=K+1,LP1
      DO 3223 I=1,IMAX
      CO21(I,K,KP)=OVER1D(I,KP-1)*CO21(I,K,KP)
3223  CONTINUE
C---RLOG IS THE NBL AMOUNT FOR THE 15 UM BAND CALCULATION
      DO 1804 I=1,IMAX
      RLOG(I,K)=OVER1D(I,K)*CO2NBL(I,K)
1804  CONTINUE
C---THE KP TERMS FOR ARBIRRARY K..
      DO 3423 KP=K+1,LP1
      DO 3423 I=1,IMAX
      FLX(I,K)=FLX(I,K)+(OSS(I,KP)*TO31D(I,KP-1)
     1                  +SS2(I,KP)*CONT1D(I,KP-1)
     2                  +CSS(I,KP)*CO21(I,KP,K)
     3                  +DTC(I,KP)*EMISS(I,KP-1))*CLDFAC(I,KP,K)
3423  CONTINUE
      DO 3425 KP=K+1,LP1
      DO 3425 I=1,IMAX
      FLX(I,KP)=FLX(I,KP)+(OSS(I,K)*TO31D(I,KP-1)
     1                   +SS2(I,K)*CONT1D(I,KP-1)
     2                   +CSS(I,K)*CO21(I,K,KP)
     3                   +DTC(I,K)*EMISSB(I,KP-1))*CLDFAC(I,K,KP)
3425  CONTINUE
C ....   DITTO FOR CLEAR SKY .. CLDFAC=1.
##CLR DO 2423 KP=K+1,LP1
##CLR  DO 2423 I=1,IMAX
##CLR   FLX0(I,K)=FLX0(I,K)+ OSS(I,KP)*TO31D(I,KP-1)
##CLR1                  +SS2(I,KP)*CONT1D(I,KP-1)
##CLR2                  +CSS(I,KP)*CO21(I,KP,K)
##CLR3                  +DTC(I,KP)*EMISS(I,KP-1)
2423  CONTINUE
##CLR DO 2425 KP=K+1,LP1
##CLR  DO 2425 I=1,IMAX
##CLR   FLX0(I,KP)=FLX0(I,KP)+ OSS(I,K)*TO31D(I,KP-1)
##CLR1                   +SS2(I,K)*CONT1D(I,KP-1)
##CLR2                   +CSS(I,K)*CO21(I,K,KP)
##CLR3                   +DTC(I,K)*EMISSB(I,KP-1)
2425  CONTINUE
321   CONTINUE
C
C   NOW DO K=L CASE. SINCE THE KP LOOP IS LENGTH 1, MANY SIMPLIFI-
C   CATIONS OCCUR. ALSO, THE CO2 QUANTITIES (AS WELL AS THE EMISS
C  QUANTITIES) ARE COMPUTED IN THE NBL SEDCTION; THEREFORE, WE WANT
C  ONLY OVER,TO3 AND CONT1D (OVER(I,L),TO31D(I,L) AND CONT1D(I,L)
C  ACCORDING TO THE NOTATION. THUS NO CALL IS MADE TO THE E290
C  SUBROUTINE.
C         THE THIRD SECTION CALCULATES BOUNDARY LAYER AND NEARBY LAYER
C     CORRECTIONS TO THE TRANSMISSION FUNCTIONS OBTAINED ABOVE. METHODS
C     ARE GIVEN IN REF. (4).
C          THE FOLLOWING RATIOS ARE USED IN VARIOUS NBL CALCULATIONS:
C
C   THE REMAINING CALCULATIONS ARE FOR :
C                        1) THE (K,K) TERMS, K=2,LM1;
C                        2) THE (L,L) TERM
C                        3) THE (L,LP1) TERM
C                        4) THE (LP1,L) TERM
C                        5) THE (LP1,LP1) TERM.
C     EACH IS UNIQUELY HANDLED; DIFFERENT FLUX TERMS ARE COMPUTED
C     DIFFERENTLY
C
C
C          FOURTH SECTION OBTAINS WATER TRANSMISSION FUNCTIONS
C     USED IN Q(APPROX) CALCULATIONS AND ALSO MAKES NBL CORRECTIONS:
C     1) EMISS (I,J) IS THE TRANSMISSION FUNCTION MATRIX OBTAINED
C     BY CALLING SUBROUTINE E1E288;
C     2) "NEARBY LAYER" CORRECTIONS (EMISS(I,I)) ARE OBTAINED
C     USING SUBROUTINE E3V88;
C     3) SPECIAL VALUES AT THE SURFACE (EMISS(L,LP1),EMISS(LP1,L),
C     EMISS(LP1,LP1)) ARE CALCULATED.
C
C
C      OBTAIN ARGUMENTS FOR E1E288 AND E3V88:
C
      DO 821 I=1,IMAX
      TPL(I,1)=TEMP(I,L)
      TPL(I,LP1)=HAF*(T(I,LP1)+TEMP(I,L))
      TPL(I,LLP1)=HAF*(T(I,L)+TEMP(I,L))
821   CONTINUE
      DO 823 K=2,L
      DO 823 I=1,IMAX
      TPL(I,K)=T(I,K)
      TPL(I,K+L)=T(I,K)
823   CONTINUE
C
C---E2 FUNCTIONS ARE REQUIRED IN THE NBL CALCULATIONS FOR 2 CASES,
C   DENOTED (IN OLD CODE) AS (L,LP1) AND (LP1,LP1)
      DO 833 I=1,IMAX
      AVEPHI(I,1)=VAR2(I,L)
      AVEPHI(I,2)=VAR2(I,L)+EMPL(I,L)
833   CONTINUE
      CALL E2SPEC(EMISS,AVEPHI,FXOSP,DTSP)
C
C     CALL E3V88 FOR NBL H2O TRANSMISSIVITIES
           CALL E3V88(EMD,TPL,EMPL)
C
C   COMPUTE NEARBY LAYER AND SPECIAL-CASE TRANSMISSIVITIES FOR EMISS
C    USING METHODS FOR H2O GIVEN IN REF. (4)
      DO 851 K=2,L
      DO 851 I=1,IMAX
      EMISDG(I,K)=EMD(I,K+L)+EMD(I,K)
851   CONTINUE
C
C   NOTE THAT EMX1/2 (PRESSURE SCALED PATHS) ARE NOW COMPUTED IN
C   LWR88
      DO 861 I=1,IMAX
      EMSPEC(I,1)=(EMD(I,1)*EMPL(I,1)-EMD(I,LP1)*EMPL(I,LP1))/
     1 EMX1(I) + QUARTR*(EMISS(I,1)+EMISS(I,2))
      EMISDG(I,LP1)=TWO*EMD(I,LP1)
      EMSPEC(I,2)=TWO*(EMD(I,1)*EMPL(I,1)-EMD(I,LLP1)*EMPL(I,LLP1))/
     * EMX2(I)
861   CONTINUE
      DO 331 I=1,IMAX
      FAC1(I,L)=BO3RND(2)*VAR4(I,L)/VAR3(I,L)
      VTMP3(I,L)=HAF*(FAC1(I,L)*
     1    (SQRT(ONE+(FOUR*AO3RND(2)*VAR3(I,L))/FAC1(I,L))-ONE))
      TO31D(I,L)=EXP(HM1EZ*(VTMP3(I,L)+SKO3R*CNTVAL(I,L)))
      OVER1D(I,L)=EXP(HM1EZ*(SQRT(AB15WD*VAR2(I,L))+
     1            SKC1R*CNTVAL(I,L)))
      CONT1D(I,L)=CNTTAU(I,L)*TOTEVV(I,LM1)
      RLOG(I,L)=OVER1D(I,L)*CO2NBL(I,L)
331   CONTINUE
      DO 618 K=1,L
      DO 618 I=1,IMAX
      RLOG(I,K)=LOG(RLOG(I,K))
618   CONTINUE
      DO 601 K=1,LM1
      DO 601 I=1,IMAX
      DELPR1(I,K+1)=DELP(I,K+1)*(PRESS(I,K+1)-P(I,K+1))
      ALP(I,K+L)=-SQRT(DELPR1(I,K+1))*RLOG(I,K+1)
601   CONTINUE
      DO 603 K=1,L
      DO 603 I=1,IMAX
      DELPR2(I,K+1)=DELP(I,K)*(P(I,K+1)-PRESS(I,K))
      ALP(I,K)=-SQRT(DELPR2(I,K+1))*RLOG(I,K)
603   CONTINUE
      DO 625 I=1,IMAX
      ALP(I,LL)=-RLOG(I,L)
      ALP(I,LLP1)=-RLOG(I,L)*SQRT(DELP(I,L)*(P(I,LP1)-PRESS(I,LM1)))
625   CONTINUE
C        THE FIRST COMPUTATION IS FOR THE 15 UM BAND,WITH THE
C     FOR THE COMBINED H2O AND CO2 TRANSMISSION FUNCTION.
C
C       PERFORM NBL COMPUTATIONS FOR THE 15 UM BAND
C***THE STATEMENT FUNCTION SF IN PREV. VERSIONS IS NOW EXPLICITLY
C   EVALUATED.
      DO 631 K=1,LLP1
      DO 631 I=1,IMAX
      C(I,K)=ALP(I,K)*(HMP66667+ALP(I,K)*(QUARTR+ALP(I,K)*HM6666M2))
631   CONTINUE
      DO 641 I=1,IMAX
      CO21(I,LP1,LP1)=ONE+C(I,L)
      CO21(I,LP1,L)=ONE+(DELP2(I,L)*C(I,LL)-(PRESS(I,L)-P(I,L))*
     1 C(I,LLM1))/(P(I,LP1)-PRESS(I,L))
      CO21(I,L,LP1)=ONE+((P(I,LP1)-PRESS(I,LM1))*C(I,LLP1)-
     1 (P(I,LP1)-PRESS(I,L))*C(I,L))/(PRESS(I,L)-PRESS(I,LM1))
641   CONTINUE
      DO 643 K=2,L
      DO 643 I=1,IMAX
      CO21(I,K,K)=ONE+HAF*(C(I,LM1+K)+C(I,K-1))
643   CONTINUE
C
C    COMPUTE NEARBY-LAYER TRANSMISSIVITIES FOR THE O3 BAND AND FOR THE
C    ONE-BAND CONTINUUM BAND (TO3 AND EMISS2). THE SF2 FUNCTION IS
C    USED. THE METHOD IS THE SAME AS DESCRIBED FOR CO2 IN REF (4).
      DO 651 K=1,LM1
      DO 651 I=1,IMAX
      CSUB(I,K+1)=CNTVAL(I,K+1)*DELPR1(I,K+1)
      CSUB(I,K+L)=CNTVAL(I,K)*DELPR2(I,K+1)
651   CONTINUE
C---THE SF2 FUNCTION IN PREV. VERSIONS IS NOW EXPLICITLY EVALUATED
      DO 655 K=1,LLM2
      DO 655 I=1,IMAX
      CSUB2(I,K+1)=SKO3R*CSUB(I,K+1)
      C(I,K+1)=CSUB(I,K+1)*(HMP5+CSUB(I,K+1)*
     1          (HP166666-CSUB(I,K+1)*H41666M2))
      C2(I,K+1)=CSUB2(I,K+1)*(HMP5+CSUB2(I,K+1)*
     1           (HP166666-CSUB2(I,K+1)*H41666M2))
655   CONTINUE
      DO 661 I=1,IMAX
      CONTDG(I,LP1)=1.+C(I,LLM1)
      TO3DG(I,LP1)=1.+C2(I,LLM1)
661   CONTINUE
      DO 663 K=2,L
      DO 663 I=1,IMAX
      CONTDG(I,K)=ONE+HAF*(C(I,K)+C(I,LM1+K))
      TO3DG(I,K)=ONE+HAF*(C2(I,K)+C2(I,LM1+K))
663   CONTINUE
C---NOW OBTAIN FLUXES
C
C    FOR THE DIAGONAL TERMS...
      DO 871 K=2,LP1
      DO 871 I=1,IMAX
      FLX(I,K)=FLX(I,K)+(DTC(I,K)*EMISDG(I,K)
     1                 +SS2(I,K)*CONTDG(I,K)
     2                 +OSS(I,K)*TO3DG(I,K)
     3                 +CSS(I,K)*CO21(I,K,K))*CLDFAC(I,K,K)
871   CONTINUE
C     FOR THE TWO OFF-DIAGONAL TERMS...
      DO 873 I=1,IMAX
      FLX(I,L)=FLX(I,L)+(CSS(I,LP1)*CO21(I,LP1,L)
     1                  +DTC(I,LP1)*EMSPEC(I,2)
     2                  +OSS(I,LP1)*TO31D(I,L)
     3                  +SS2(I,LP1)*CONT1D(I,L))*CLDFAC(I,LP1,L)
      FLX(I,LP1)=FLX(I,LP1)+(CSS(I,L)*CO21(I,L,LP1)
     1                      +OSS(I,L)*TO31D(I,L)
     2                      +SS2(I,L)*CONT1D(I,L)
     3                      +DTC(I,L)*EMSPEC(I,1))*CLDFAC(I,L,LP1)
873   CONTINUE
C ...   DITTO FOR CLEAR SKY ... CLDFAC =1.
##CLR DO 2871 K=2,LP1
##CLR  DO 2871 I=1,IMAX
##CLR   FLX0(I,K)=FLX0(I,K)+ DTC(I,K)*EMISDG(I,K)
##CLR1                 +SS2(I,K)*CONTDG(I,K)
##CLR2                 +OSS(I,K)*TO3DG(I,K)
##CLR3                 +CSS(I,K)*CO21(I,K,K)
2871  CONTINUE
C     FOR THE TWO OFF-DIAGONAL TERMS...
##CLR DO 2873 I=1,IMAX
##CLR  FLX0(I,L)=FLX0(I,L)+ CSS(I,LP1)*CO21(I,LP1,L)
##CLR1                  +DTC(I,LP1)*EMSPEC(I,2)
##CLR2                  +OSS(I,LP1)*TO31D(I,L)
##CLR3                  +SS2(I,LP1)*CONT1D(I,L)
##CLR  FLX0(I,LP1)=FLX0(I,LP1)+ CSS(I,L)*CO21(I,L,LP1)
##CLR1                      +OSS(I,L)*TO31D(I,L)
##CLR2                      +SS2(I,L)*CONT1D(I,L)
##CLR3                      +DTC(I,L)*EMSPEC(I,1)
2873  CONTINUE
C
C     FINAL SECTION OBTAINS EMISSIVITY HEATING RATES,
C     TOTAL HEATING RATES AND THE FLUX AT THE GROUND
C
C     .....CALCULATE THE EMISSIVITY HEATING RATES
      DO 1101 K=1,L
      DO 1101 I=1,IMAX
      HEATEM(I,K)=RADCON*(FLX(I,K+1)-FLX(I,K))*DELP(I,K)
1101  CONTINUE
C     .....CALCULATE THE TOTAL HEATING RATES
      DO 1103 K=1,L
      DO 1103 I=1,IMAX
      HEATRA(I,K)=HEATEM(I,K)-CTS(I,K)-CTSO3(I,K)+EXCTS(I,K)
1103  CONTINUE
C     .....CALCULATE THE FLUX AT EACH FLUX LEVEL USING THE FLUX AT THE
C    TOP (FLX1E1+GXCTS) AND THE INTEGRAL OF THE HEATING RATES (VSUM1)
      DO 1111 K=1,L
      DO 1111 I=1,IMAX
      VSUM1(I,K)=HEATRA(I,K)*DELP2(I,K)*RADCON1
1111  CONTINUE
      DO 1115 I=1,IMAX
      TOPFLX(I)=FLX1E1(I)+GXCTS(I)
      FLXNET(I,1)=TOPFLX(I)
1115  CONTINUE
C---ONLY THE SURFACE VALUE OF FLUX (GRNFLX) IS NEEDED UNLESS
C    THE THICK CLOUD SECTION IS INVOKED.
      DO 1123 K=2,LP1
      DO 1123 I=1,IMAX
      FLXNET(I,K)=FLXNET(I,K-1)+VSUM1(I,K-1)
1123  CONTINUE
      DO 1125 I=1,IMAX
      GRNFLX(I)=FLXNET(I,LP1)
1125  CONTINUE
C ...   DITTO FOR CLEAR SKY .. CLDFAC=1.
##CLR DO 2101 K=1,L
##CLR DO 2101 I=1,IMAX
##CLR  HEATEM(I,K)=RADCON*(FLX0(I,K+1)-FLX0(I,K))*DELP(I,K)
2101  CONTINUE
C     .....CALCULATE THE TOTAL HEATING RATES
##CLR DO 2103 K=1,L
##CLR DO 2103 I=1,IMAX
##CLR  HEATR0(I,K)=HEATEM(I,K)-CTS0(I,K)-CTSO30(I,K)+EXCTS0(I,K)
2103  CONTINUE
C     .....CALCULATE THE FLUX AT EACH FLUX LEVEL USING THE FLUX AT THE
C    TOP (FLX1E1+GXCTS) AND THE INTEGRAL OF THE HEATING RATES (VSUM1)
##CLR DO 2111 K=1,L
##CLR DO 2111 I=1,IMAX
##CLR  VSUM1(I,K)=HEATR0(I,K)*DELP2(I,K)*RADCON1
2111  CONTINUE
##CLR DO 2115 I=1,IMAX
##CLR  TOPFX0(I)=FLX1E0(I)+GXCTS0(I)
##CLR  FLXNT0(I,1)=TOPFX0(I)
2115  CONTINUE
C---ONLY THE SURFACE VALUE OF FLUX (GRNFLX) IS NEEDED UNLESS
C    THE THICK CLOUD SECTION IS INVOKED.
##CLR DO 2123 K=2,LP1
##CLR  DO 2123 I=1,IMAX
##CLR   FLXNT0(I,K)=FLXNT0(I,K-1)+VSUM1(I,K-1)
2123  CONTINUE
##CLR DO 2125 I=1,IMAX
##CLR  GRNFX0(I)=FLXNT0(I,LP1)
2125  CONTINUE
C
C     THIS IS THE THICK CLOUD SECTION.OPTIONALLY,IF THICK CLOUD
C     FLUXES ARE TO BE "CONVECTIVELY ADJUSTED",IE,DF/DP IS CONSTANT,
C     FOR CLOUDY PART OF GRID POINT, THE FOLLOWING CODE IS EXECUTED.
C***FIRST,COUNT THE NUMBER OF CLOUDS ALONG THE LAT. ROW. SKIP THE
C   ENTIRE THICK CLOUD COMPUTATION OF THERE ARE NO CLOUDS.
      ICNT=0
      DO 1301 I=1,IMAX
      ICNT=ICNT+NCLDS(I)
1301  CONTINUE
      IF (ICNT.EQ.0) GO TO 6999
C---FIND THE MAXIMUM NUMBER OF CLOUDS IN THE LATITUDE ROW
      KCLDS=NCLDS(1)
      DO 2106 I=2,IMAX
      KCLDS=MAX(NCLDS(I),KCLDS)
2106  CONTINUE
C
C
C***OBTAIN THE PRESSURES AND FLUXES OF THE TOP AND BOTTOM OF
C   THE NC'TH CLOUD (IT IS ASSUMED THAT ALL KTOP AND KBTM'S HAVE
C   BEEN DEFINED!).
      DO 1361 KK=1,KCLDS
      KMIN=LP1
      KMAX=0
      DO 1362 I=1,IMAX
        J1=KTOP(I,KK+1)
C       IF (J1.EQ.1) GO TO 1362
        J3=KBTM(I,KK+1)
        IF (J3.GT.J1) THEN
          PTOP(I)=P(I,J1)
          PBOT(I)=P(I,J3+1)
          FTOP(I)=FLXNET(I,J1)
          FBOT(I)=FLXNET(I,J3+1)
C***OBTAIN THE "FLUX DERIVATIVE" DF/DP (DELPTC)
          DELPTC(I)=(FTOP(I)-FBOT(I))/(PTOP(I)-PBOT(I))
          KMIN=MIN(KMIN,J1)
          KMAX=MAX(KMAX,J3)
        ENDIF
1362  CONTINUE
      KMIN=KMIN+1
C***CALCULATE THE TOT. FLUX CHG. FROM THE TOP OF THE CLOUD, FOR
C   ALL LEVELS.
      DO 1365 K=KMIN,KMAX
      DO 1363 I=1,IMAX
C       IF (KTOP(I,KK+1).EQ.1) GO TO 1363
        IF(KTOP(I,KK+1).LT.K .AND. K.LE.KBTM(I,KK+1)) THEN
          Z1(I,K)=(P(I,K)-PTOP(I))*DELPTC(I)+FTOP(I)
CORIGINAL FLXNET(I,K)=FLXNET(I,K)*(ONE-CAMT(I,KK+1)) +
CORIGINAL1            Z1(I,K)*CAMT(I,KK+1)
          FLXNET(I,K)=Z1(I,K)
        ENDIF
1363  CONTINUE
1365  CONTINUE
1361  CONTINUE
C***USING THIS FLUX CHG. IN THE CLOUDY PART OF THE GRID BOX, OBTAIN
C   THE NEW FLUXES, WEIGHTING THE CLEAR AND CLOUDY FLUXES:AGAIN, ONLY
C    THE FLUXES IN THICK-CLOUD LEVELS WILL EVENTUALLY BE USED.
C     DO 6051 K=1,LP1
C     DO 6051 I=1,IMAX
C     FLXNET(I,K)=FLXNET(I,K)*(ONE-CAMT(I,NC)) +
C    1            Z1(I,K)*CAMT(I,NC)
C051  CONTINUE
C***MERGE FLXTHK INTO FLXNET FOR APPROPRIATE LEVELS.
C     DO 1401 K=1,LP1
C     DO 1401 I=1,IMAX
C     IF (K.GT.ITOP(I) .AND. K.LE.IBOT(I)
C    1  .AND.  (NC-1).LE.NCLDS(I))  THEN
C          FLXNET(I,K)=FLXTHK(I,K)
C     ENDIF
C401  CONTINUE
C
C******END OF CLOUD LOOP*****
6001  CONTINUE
6999  CONTINUE
C***THE FINAL STEP IS TO RECOMPUTE THE HEATING RATES BASED ON THE
C   REVISED FLUXES:
      DO 6101 K=1,L
      DO 6101 I=1,IMAX
      HEATRA(I,K)=RADCON*(FLXNET(I,K+1)-FLXNET(I,K))*DELP(I,K)
6101  CONTINUE
C     THE THICK CLOUD SECTION ENDS HERE.
      RETURN
      END
      SUBROUTINE HCONST
CFPP$ NOCONCUR R
C
 %INCLUDE HCON;
C     SUBROUTINE HCONST DEFINES VARIABLES TO REPRESENT FLOATING-
C       POINT CONSTANTS.
C
C     COMDECK HCON CONTAINS THE COMMON BLOCK FOR THESE FLOATING-
C       POINT CONSTANTS.
C
C     THE NAMING CONVENTIONS FOR THE FLOATING-POINT VARIABLES ARE
C       AS FOLLOWS:
C
C   1) PHYSICAL AND MATHEMATICAL CONSTANTS WILL BE GIVEN NAMES
C     RELEVANT TO THEIR MEANING
C   2) OTHER CONSTANTS WILL BE GIVEN NAMES RELEVANT TO THEIR VALUE
C      AND ADHERING TO THE FOLLOWING CONVENTIONS:
C       A) THE FIRST LETTER WILL BE REPRESENTED WITH AN 'H' EXCEPT
C          FOR I) AND J) BELOW
C       B) A DECIMAL POINT WILL BE REPRESENTED WITH A 'P'
C       C) THERE WILL BE NO EMBEDDED '0'(ZERO); ALL 0'S WILL
C          BE REPRESENTED WITH A 'Z'
C       D) A MINUS SIGN WILL BE REPRESENTED WITH AN 'M'
C       E) THE DECIMAL POINT IS ASSUMED AFTER THE FIRST DIGIT FOR
C          NUMBERS WITH EXPONENTS
C       F) POSITIVE EXPONENTS ARE INDICATED WITH 'E';NEGATIVE
C          EXPONENTS WITH 'M'
C       G) DIGITS ARE TRUNCATED IN ORDER TO HAVE NO MORE THAN 8
C          CHARACTERS PER NAME
C       H) NUMBERS LESS THAN 0.1 AND GREATER THAN 10. WILL BE
C          REPRESENTED IN EXPONENT FORMAT (EXCEPT A FEW SPECIAL CASES)
C       I) THE WHOLE NUMBERS FROM 0.0 THROUGH 10.,AND 20.,30.,40.,50.,
C          60.,70.,80.,90.,100.,WILL BE SPELLED OUT
C       J) GOOD JUDGMENT WILL PREVAIL OVER ALL CONVENTIONS
C
C       EXAMPLES
C     CONSTANT           VARIABLE NAME             CONVENTION
C      600.                 LHEATC                  1)
C      680.                 LHEATS                  1)
C     1.4142               SQROOT2                  1)
C     2.0                    TWO                    2)-(I)
C    -3.0                  HM3PZ                    2)-(A,B,D)
C    310.                  C31E2                    2)-(A,E,F,H)
C   -0.7239E-9             HM723M1Z                 2)-(A,C,D,E,F,G,H)
C     0.0                   ZERO                    2)-(I)
C     0.1                   HP1                     2)-(A,B,H)
C     0.01                 H1M2                     2)-(A,E,F,H)
C     30.                  THIRTY                   2)-(H,I)
C     0.5                  HAF                      2)-(J)
C     9.0                  HNINE                    2)-(J)
C
C******THE FOLLOWING ARE PHYSICAL CONSTANTS*****
C        ARRANGED IN ALPHABETICAL ORDER
      AMOLWT=28.9644
      CSUBP=1.00484E7
      DIFFCTR=1.66
      G=980.665
      GINV=1./G
      GRAVDR=980.0
      O3DIFCTR=1.90
      P0=1013250.
      P0INV=1./P0
      GP0INV=GINV*P0INV
      P0XZP2=202649.902
      P0XZP8=810600.098
      P0X2=2.*1013250.
      RADCON=8.427
      RADCON1=1./8.427
      RATCO2MW=1.519449738
      RATH2OMW=.622
      RGAS=8.3142E7
      RGASSP=8.31432E7
      SECPDA=8.64E4
C
C******THE FOLLOWING ARE MATHEMATICAL CONSTANTS*******
C        ARRANGED IN DECREASING ORDER
      HUNDRED=100.
      HNINETY=90.
      SIXTY=60.
      FIFTY=50.
      TEN=10.
      EIGHT=8.
      FIVE=5.
      FOUR=4.
      THREE=3.
      TWO=2.
      ONE=1.
      HAF=0.5
      QUARTR=0.25
      ZERO=0.
C
C******FOLLOWING ARE POSITIVE FLOATING POINT CONSTANTS(H'S)
C       ARRANGED IN DECREASING ORDER
      H83E26=8.3E26
      H71E26=7.1E26
      H1E15=1.E15
      H1E13=1.E13
      H1E11=1.E11
      H1E8=1.E8
      H2E6=2.0E6
      H1E6=1.0E6
      H69766E5=6.97667E5
      H4E5=4.E5
      H165E5=1.65E5
      H5725E4=57250.
      H488E4=48800.
      H1E4=1.E4
      H24E3=2400.
      H20788E3=2078.8
      H2075E3=2075.
      H18E3=1800.
      H1224E3=1224.
      H67390E2=673.9057
      H5E2=500.
      H3082E2=308.2
      H3E2=300.
      H2945E2=294.5
      H29316E2=293.16
      H26E2=260.0
      H25E2=250.
      H23E2=230.
      H2E2=200.0
      H15E2=150.
      H1386E2=138.6
      H1036E2=103.6
      H8121E1=81.21
      H35E1=35.
      H3116E1=31.16
      H28E1=28.
      H181E1=18.1
      H18E1=18.
      H161E1=16.1
      H16E1=16.
      H1226E1=12.26
      H9P94=9.94
      H6P08108=6.081081081
      H3P6=3.6
      H3P5=3.5
      H2P9=2.9
      H2P8=2.8
      H2P5=2.5
      H1P8=1.8
      H1P4387=1.4387
      H1P41819=1.418191
      H1P4=1.4
      H1P25892=1.258925411
      H1P082=1.082
      HP816=0.816
      HP805=0.805
      HP8=0.8
      HP60241=0.60241
      HP602409=0.60240964
      HP6=0.6
      HP526315=0.52631579
      HP518=0.518
      HP5048=0.5048
      HP3795=0.3795
      HP369=0.369
      HP26=0.26
      HP228=0.228
      HP219=0.219
      HP166666=.166666
      HP144=0.144
      HP118666=0.118666192
      HP1=0.1
C        (NEGATIVE EXPONENTIALS BEGIN HERE)
      H658M2=0.0658
      H625M2=0.0625
      H44871M2=4.4871E-2
      H44194M2=.044194
      H42M2=0.042
      H41666M2=0.0416666
      H28571M2=.02857142857
      H2118M2=0.02118
      H129M2=0.0129
      H1M2=.01
      H559M3=5.59E-3
      H3M3=0.003
      H235M3=2.35E-3
      H1M3=1.0E-3
      H987M4=9.87E-4
      H323M4=0.000323
      H3M4=0.0003
      H285M4=2.85E-4
      H1M4=0.0001
      H75826M4=7.58265E-4
      H6938M5=6.938E-5
      H394M5=3.94E-5
      H37412M5=3.7412E-5
      H15M5=1.5E-5
      H1439M5=1.439E-5
      H128M5=1.28E-5
      H102M5=1.02E-5
      H1M5=1.0E-5
      H7M6=7.E-6
      H4999M6=4.999E-6
      H451M6=4.51E-6
      H25452M6=2.5452E-6
      H1M6=1.E-6
      H391M7=3.91E-7
      H1174M7=1.174E-7
      H8725M8=8.725E-8
      H327M8=3.27E-8
      H257M8=2.57E-8
      H1M8=1.0E-8
      H23M10=2.3E-10
      H14M10=1.4E-10
      H11M10=1.1E-10
      H1M10=1.E-10
      H83M11=8.3E-11
      H82M11=8.2E-11
      H8M11=8.E-11
      H77M11=7.7E-11
      H72M11=7.2E-11
      H53M11=5.3E-11
      H48M11=4.8E-11
      H44M11=4.4E-11
      H42M11=4.2E-11
      H37M11=3.7E-11
      H35M11=3.5E-11
      H32M11=3.2E-11
      H3M11=3.0E-11
      H28M11=2.8E-11
      H24M11=2.4E-11
      H23M11=2.3E-11
      H2M11=2.E-11
      H18M11=1.8E-11
      H15M11=1.5E-11
      H14M11=1.4E-11
      H114M11=1.14E-11
      H11M11=1.1E-11
      H1M11=1.E-11
      H96M12=9.6E-12
      H93M12=9.3E-12
      H77M12=7.7E-12
      H74M12=7.4E-12
      H65M12=6.5E-12
      H62M12=6.2E-12
      H6M12=6.E-12
      H45M12=4.5E-12
      H44M12=4.4E-12
      H4M12=4.E-12
      H38M12=3.8E-12
      H37M12=3.7E-12
      H3M12=3.E-12
      H29M12=2.9E-12
      H28M12=2.8E-12
      H24M12=2.4E-12
      H21M12=2.1E-12
      H16M12=1.6E-12
      H14M12=1.4E-12
      H12M12=1.2E-12
      H8M13=8.E-13
      H46M13=4.6E-13
      H36M13=3.6E-13
      H135M13=1.35E-13
      H12M13=1.2E-13
      H1M13=1.E-13
      H3M14=3.E-14
      H15M14=1.5E-14
      H14M14=1.4E-14
      H101M16=1.01E-16
      H1M16=1.0E-16
      H1M17=1.E-17
      H1M18=1.E-18
      H1M19=1.E-19
      H1M20=1.E-20
      H1M21=1.E-21
      H1M22=1.E-22
      H1M23=1.E-23
      H1M24=1.E-24
      H26M30=2.6E-30
      H14M30=1.4E-30
      H25M31=2.5E-31
      H21M31=2.1E-31
      H12M31=1.2E-31
      H9M32=9.E-32
      H55M32=5.5E-32
      H45M32=4.5E-32
      H4M33=4.E-33
      H62M34=6.2E-34
      H1M60=1.0E-60
C
C******FOLLOWING ARE NEGATIVE FLOATING POINT CONSTANTS (HM'S)
C          ARRANGED IN DESCENDING ORDER
      HM2M2=-.02
      HM6666M2=-.066667
      HMP5=-0.5
      HMP575=-0.575
      HMP66667=-.66667
      HMP805=-0.805
      HM1EZ=-1.
      HM13EZ=-1.3
      HM19EZ=-1.9
      HM1E1=-10.
      HM1597E1=-15.97469413
      HM161E1=-16.1
      HM1797E1=-17.97469413
      HM181E1=-18.1
      HM8E1=-80.
      HM1E2=-100.
C
      RETURN
      END
      SUBROUTINE LWR88(HEATRA,GRNFLX,TOPFLX,
##CLR1                 GRNFX0,TOPFX0,
     1                 PRESS,TEMP,RH2O,QO3,CLDFAC,
     2                 CAMT,NCLDS,KTOP,KBTM)
CFPP$ NOCONCUR R
C     SUBROUTINE LWR88 COMPUTES TEMPERATURE-CORRECTED CO2 TRANSMISSION
C   FUNCTIONS AND ALSO COMPUTES THE PRESSURE GRID AND LAYER OPTICAL
C   PATHS.
C          INPUTS:                (COMMON BLOCKS)
C      CLDFAC                          CLDCOM
C      PRESS,TEMP,RH2O,QO3             RADISW
C      CAMT,NCLDS,KTOP,KBTM            RADISW
C      CO251,CO258,CDT51,CDT58         CO2BD3
C      C2D51,C2D58,CO2M51,CO2M58       CO2BD3
C      CDTM51,CDTM58,C2DM51,C2DM58     CO2BD3
C      STEMP,GTEMP                     CO2BD3
C      CO231,CO238,CDT31,CDT38         CO2BD2
C      C2D31,C2D38                     CO2BD2
C      CO271,CO278,CDT71,CDT78         CO2BD4
C      C2D71,C2D78                     CO2BD4
C      BETINW                          BDWIDE
C          OUTPUTS:
C      HEATRA,GRNFLX,TOPFLX            LWOUT
C          CALLED BY:
C      RADMN OR INPUT ROUTINE OF MODEL
C          CALLS:
C      FST88
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE CO2DTA;
 %INCLUDE RNDDTA;
C
      DIMENSION PRESS(IMBX,LP1),TEMP(IMBX,LP1),RH2O(IMBX,L),QO3(IMBX,L)
      DIMENSION CLDFAC(IMBX,LP1,LP1),CAMT(IMBX,LP1)
      DIMENSION NCLDS(IMAX),KTOP(IMBX,LP1),KBTM(IMBX,LP1)
      DIMENSION HEATRA(IMBX,L),GRNFLX(IMAX),TOPFLX(IMAX)
##CLR DIMENSION GRNFX0(IMAX),TOPFX0(IMAX)
      DIMENSION DELP2(IMBX,L)
C
      DIMENSION QH2O(IMBX,L),T(IMBX,LP1)
      DIMENSION P(IMBX,LP1),DELP(IMBX,L)
      DIMENSION CO21(IMBX,LP1,LP1),CO2NBL(IMBX,L)
      DIMENSION CO2SP1(IMBX,LP1),CO2SP2(IMBX,LP1)
      DIMENSION VAR1(IMBX,L),VAR2(IMBX,L),VAR3(IMBX,L),VAR4(IMBX,L)
      DIMENSION CNTVAL(IMBX,LP1)
      DIMENSION TOTO3(IMBX,LP1),TPHIO3(IMBX,LP1),TOTPHI(IMBX,LP1)
      DIMENSION TOTVO2(IMBX,LP1),EMX1(IMAX),EMX2(IMAX),EMPL(IMBX,LLP1)
C
      DIMENSION CO2R(IMBX,LP1),DIFT(IMBX,LP1)
      DIMENSION CO2R1(IMBX,LP1),DCO2D1(IMBX,LP1)
      DIMENSION D2CD21(IMBX,LP1),D2CD22(IMBX,LP1)
      DIMENSION CO2R2(IMBX,LP1),DCO2D2(IMBX,LP1)
      DIMENSION CO2MR(IMBX,L),CO2MD(IMBX,L),CO2M2D(IMBX,L)
      DIMENSION TDAV(IMBX,LP1),TSTDAV(IMBX,LP1),
     1 VV(IMBX,L),VSUM3(IMBX,LP1),VSUM1(IMAX),VSUM2(IMAX)
      DIMENSION A1(IMAX),A2(IMAX)
      DIMENSION DCO2DT(IMBX,LP1),D2CDT2(IMBX,LP1)
C
      DIMENSION TEXPSL(IMBX,LP1),TLSQU(IMBX,LP1)
      DIMENSION VSUM4(IMBX,L)
      EQUIVALENCE (VSUM3,TLSQU,TEXPSL)
      EQUIVALENCE (VV,VSUM4)
C
C****COMPUTE FLUX PRESSURES (P) AND DIFFERENCES (DELP2,DELP)
C****COMPUTE FLUX LEVEL TEMPERATURES (T) AND CONTINUUM TEMPERATURE
C    CORRECTIONS (TEXPSL)
      DO 103 K=2,L
      DO 103 I=1,IMAX
      P(I,K)=HAF*(PRESS(I,K-1)+PRESS(I,K))
      T(I,K)=HAF*(TEMP(I,K-1)+TEMP(I,K))
103   CONTINUE
      DO 105 I=1,IMAX
      P(I,1)=ZERO
      P(I,LP1)=PRESS(I,LP1)
      T(I,1)=TEMP(I,1)
      T(I,LP1)=TEMP(I,LP1)
105   CONTINUE
      DO 107 K=1,L
      DO 107 I=1,IMAX
      DELP2(I,K)=P(I,K+1)-P(I,K)
      DELP(I,K)=ONE/DELP2(I,K)
107   CONTINUE
C****COMPUTE ARGUMENT FOR CONT.TEMP.COEFF.
C    (THIS IS 1800.(1./TEMP-1./296.))
      DO 125 K=1,LP1
      DO 125 I=1,IMAX
      TEXPSL(I,K)=H18E3/TEMP(I,K)-H6P08108
C...THEN TAKE EXPONENTIAL
      TEXPSL(I,K)=EXP(TEXPSL(I,K))
125   CONTINUE
C***COMPUTE OPTICAL PATHS FOR H2O AND O3, USING THE DIFFUSIVITY
C   APPROXIMATION FOR THE ANGULAR INTEGRATION (1.66). OBTAIN THE
C   UNWEIGHTED VALUES(VAR1,VAR3) AND THE WEIGHTED VALUES(VAR2,VAR4).
C   THE QUANTITIES H3M4(.0003) AND H3M3(.003) APPEARING IN THE VAR2 AND
C   VAR4 EXPRESSIONS ARE THE APPROXIMATE VOIGT CORRECTIONS FOR H2O AND
C   O3,RESPECTIVELY.
C
      DO 131 K=1,L
      DO 131 I=1,IMAX
      QH2O(I,K)=RH2O(I,K)*DIFFCTR
C---VV IS THE LAYER-MEAN PRESSURE (IN ATM),WHICH IS NOT THE SAME AS
C   THE LEVEL PRESSURE (PRESS)
      VV(I,K)=HAF*(P(I,K+1)+P(I,K))*P0INV
      VAR1(I,K)=DELP2(I,K)*QH2O(I,K)*GINV
      VAR3(I,K)=DELP2(I,K)*QO3(I,K)*DIFFCTR*GINV
      VAR2(I,K)=VAR1(I,K)*(VV(I,K)+H3M4)
      VAR4(I,K)=VAR3(I,K)*(VV(I,K)+H3M3)
C  COMPUTE OPTICAL PATH FOR THE H2O CONTINUUM, USING ROBERTS COEFFS.
C  (BETINW),AND TEMP. CORRECTION (TEXPSL). THE DIFFUSIVITY FACTOR
C  (WHICH CANCELS OUT IN THIS EXPRESSION) IS ASSUMED TO BE 1.66. THE
C  USE OF THE DIFFUSIVITY FACTOR HAS BEEN SHOWN TO BE A SIGNIFICANT
C  SOURCE OF ERROR IN THE CONTINUUM CALCS.,BUT THE TIME PENALTY OF
C  AN ANGULAR INTEGRATION IS SEVERE.
C
      CNTVAL(I,K)=TEXPSL(I,K)*RH2O(I,K)*VAR2(I,K)*BETINW/
     1             (RH2O(I,K)+RATH2OMW)
131   CONTINUE
C   COMPUTE SUMMED OPTICAL PATHS FOR H2O,O3 AND CONTINUUM
      DO 201 I=1,IMAX
      TOTPHI(I,1)=ZERO
      TOTO3(I,1)=ZERO
      TPHIO3(I,1)=ZERO
      TOTVO2(I,1)=ZERO
201   CONTINUE
      DO 203 K=2,LP1
      DO 203 I=1,IMAX
      TOTPHI(I,K)=TOTPHI(I,K-1)+VAR2(I,K-1)
      TOTO3(I,K)=TOTO3(I,K-1)+VAR3(I,K-1)
      TPHIO3(I,K)=TPHIO3(I,K-1)+VAR4(I,K-1)
      TOTVO2(I,K)=TOTVO2(I,K-1)+CNTVAL(I,K-1)
203   CONTINUE
C---EMX1 IS THE ADDITIONAL PRESSURE-SCALED MASS FROM PRESS(L) TO
C   P(L). IT IS USED IN NEARBY LAYER AND EMISS CALCULATIONS.
C---EMX2 IS THE ADDITIONAL PRESSURE-SCALED MASS FROM PRESS(L) TO
C   P(LP1). IT IS USED IN CALCULATIONS BETWEEN FLUX LEVELS L AND LP1.
C
      DO 801 I=1,IMAX
      EMX1(I)=QH2O(I,L)*PRESS(I,L)*(PRESS(I,L)-P(I,L))*GP0INV
      EMX2(I)=QH2O(I,L)*PRESS(I,L)*(P(I,LP1)-PRESS(I,L))*GP0INV
801   CONTINUE
C---EMPL IS THE PRESSURE SCALED MASS FROM P(K) TO PRESS(K) (INDEX 2-LP1)
C   OR TO PRESS(K+1) (INDEX LP2-LL)
      DO 811 K=1,L
      DO 811 I=1,IMAX
      EMPL(I,K+1)=QH2O(I,K)*P(I,K+1)*(P(I,K+1)-PRESS(I,K))*GP0INV
811   CONTINUE
      DO 812 K=1,LM1
      DO 812 I=1,IMAX
      EMPL(I,K+LP1)=QH2O(I,K+1)*P(I,K+1)*(PRESS(I,K+1)-P(I,K+1))*GP0INV
812   CONTINUE
      DO 821 I=1,IMAX
      EMPL(I,1)=VAR2(I,L)
      EMPL(I,LLP1)=EMPL(I,LL)
821   CONTINUE
C***COMPUTE WEIGHTED TEMPERATURE (TDAV) AND PRESSURE (TSTDAV) INTEGRALS
C   FOR USE IN OBTAINING TEMP. DIFFERENCE BET. SOUNDING AND STD.
C   TEMP. SOUNDING (DIFT)
      DO 161 I=1,IMAX
      TSTDAV(I,1)=ZERO
      TDAV(I,1)=ZERO
161   CONTINUE
      DO 162 K=1,LP1
      DO 162 I=1,IMAX
      VSUM3(I,K)=TEMP(I,K)-STEMP(K)
162   CONTINUE
      DO 163 K=1,L
      DO 165 I=1,IMAX
      VSUM2(I)=GTEMP(K)*DELP2(I,K)
      VSUM1(I)=VSUM2(I)*VSUM3(I,K)
      TSTDAV(I,K+1)=TSTDAV(I,K)+VSUM2(I)
      TDAV(I,K+1)=TDAV(I,K)+VSUM1(I)
165   CONTINUE
163   CONTINUE
C
C****EVALUATE COEFFICIENTS FOR CO2 PRESSURE INTERPOLATION (A1,A2)
      DO 171 I=1,IMAX
      A1(I)=(PRESS(I,LP1)-P0XZP8)/P0XZP2
      A2(I)=(P0-PRESS(I,LP1))/P0XZP2
171   CONTINUE
C***PERFORM CO2 PRESSURE INTERPOLATION ON ALL INPUTTED TRANSMISSION
C   FUNCTIONS AND TEMP. DERIVATIVES
C---SUCCESSIVELY COMPUTING CO2R,DCO2DT AND D2CDT2 IS DONE TO SAVE
C   STORAGE (AT A SLIGHT LOSS IN COMPUTATION TIME)
      DO 184 K=1,LP1
      DO 184 I=1,IMAX
        CO2R1(I,K)=A1(I)*CO231(K)+A2(I)*CO238(K)
        D2CD21(I,K)=H1M3*(A1(I)*C2D31(K)+A2(I)*C2D38(K))
        DCO2D1(I,K)=H1M2*(A1(I)*CDT31(K)+A2(I)*CDT38(K))
        CO2R2(I,K)=A1(I)*CO271(K)+A2(I)*CO278(K)
        D2CD22(I,K)=H1M3*(A1(I)*C2D71(K)+A2(I)*C2D78(K))
        DCO2D2(I,K)=H1M2*(A1(I)*CDT71(K)+A2(I)*CDT78(K))
184   CONTINUE
      DO 190 K=1,L
      DO 190 I=1,IMAX
        CO2MR(I,K)=A1(I)*CO2M51(K)+A2(I)*CO2M58(K)
        CO2MD(I,K)=H1M2*(A1(I)*CDTM51(K)+A2(I)*CDTM58(K))
        CO2M2D(I,K)=H1M3*(A1(I)*C2DM51(K)+A2(I)*C2DM58(K))
190   CONTINUE
C***COMPUTE CO2 TEMPERATURE INTERPOLATIONS FOR ALL BANDS,USING DIFT
C
C   THE CASE WHERE K=1 IS HANDLED FIRST. WE ARE NOW REPLACING
C   3-DIMENSIONAL ARRAYS BY 2-D ARRAYS, TO SAVE SPACE. THUS THIS
C   CALCULATION IS FOR (I,KP,1)
      DO 211 KP=2,LP1
      DO 211 I=1,IMAX
      DIFT(I,KP)=TDAV(I,KP)/TSTDAV(I,KP)
211   CONTINUE
      DO 212 I=1,IMAX
      CO21(I,1,1)=1.0
      CO2SP1(I,1)=1.0
      CO2SP2(I,1)=1.0
212   CONTINUE
      DO 215 KP=2,LP1
      DO 215 I=1,IMAX
C---CALCULATIONS FOR KP>1 FOR K=1
      CO2R(I,KP)=A1(I)*CO251(KP,1)+A2(I)*CO258(KP,1)
      DCO2DT(I,KP)=H1M2*(A1(I)*CDT51(KP,1)+A2(I)*CDT58(KP,1))
      D2CDT2(I,KP)=H1M3*(A1(I)*C2D51(KP,1)+A2(I)*C2D58(KP,1))
      CO21(I,KP,1)=CO2R(I,KP)+DIFT(I,KP)*(DCO2DT(I,KP)+
     1             HAF*DIFT(I,KP)*D2CDT2(I,KP))
C---CALCULATIONS FOR (EFFECTIVELY) KP=1,K>KP. THESE USE THE
C   SAME VALUE OF DIFT DUE TO SYMMETRY
      CO2R(I,KP)=A1(I)*CO251(1,KP)+A2(I)*CO258(1,KP)
      DCO2DT(I,KP)=H1M2*(A1(I)*CDT51(1,KP)+A2(I)*CDT58(1,KP))
      D2CDT2(I,KP)=H1M3*(A1(I)*C2D51(1,KP)+A2(I)*C2D58(1,KP))
      CO21(I,1,KP)=CO2R(I,KP)+DIFT(I,KP)*(DCO2DT(I,KP)+
     1             HAF*DIFT(I,KP)*D2CDT2(I,KP))
215   CONTINUE
C   THE TRANSMISSION FUNCTIONS USED IN SPA88 MAY BE COMPUTED NOW.
C---(IN THE 250 LOOP,DIFT REALLY SHOULD BE (I,1,K), BUT DIFT IS
C    INVARIANT WITH RESPECT TO K,KP,AND SO (I,1,K)=(I,K,1))
      DO 250 K=2,LP1
      DO 250 I=1,IMAX
      CO2SP1(I,K)=CO2R1(I,K)+DIFT(I,K)*(DCO2D1(I,K)+HAF*DIFT(I,K)*
     1 D2CD21(I,K))
      CO2SP2(I,K)=CO2R2(I,K)+DIFT(I,K)*(DCO2D2(I,K)+HAF*DIFT(I,K)*
     1 D2CD22(I,K))
250   CONTINUE
C
C   NEXT THE CASE WHEN K=2...L
      DO 220 K=2,L
      DO 222 KP=K+1,LP1
      DO 222 I=1,IMAX
      DIFT(I,KP)=(TDAV(I,KP)-TDAV(I,K))/
     1              (TSTDAV(I,KP)-TSTDAV(I,K))
      CO2R(I,KP)=A1(I)*CO251(KP,K)+A2(I)*CO258(KP,K)
      DCO2DT(I,KP)=H1M2*(A1(I)*CDT51(KP,K)+A2(I)*CDT58(KP,K))
      D2CDT2(I,KP)=H1M3*(A1(I)*C2D51(KP,K)+A2(I)*C2D58(KP,K))
      CO21(I,KP,K)=CO2R(I,KP)+DIFT(I,KP)*(DCO2DT(I,KP)+
     1             HAF*DIFT(I,KP)*D2CDT2(I,KP))
      CO2R(I,KP)=A1(I)*CO251(K,KP)+A2(I)*CO258(K,KP)
      DCO2DT(I,KP)=H1M2*(A1(I)*CDT51(K,KP)+A2(I)*CDT58(K,KP))
      D2CDT2(I,KP)=H1M3*(A1(I)*C2D51(K,KP)+A2(I)*C2D58(K,KP))
      CO21(I,K,KP)=CO2R(I,KP)+DIFT(I,KP)*(DCO2DT(I,KP)+
     1             HAF*DIFT(I,KP)*D2CDT2(I,KP))
222   CONTINUE
220   CONTINUE
C   FINALLY THE CASE WHEN K=KP,K=2..LP1
      DO 206 K=2,LP1
      DO 206 I=1,IMAX
      DIFT(I,K)=HAF*(VSUM3(I,K)+VSUM3(I,K-1))
      CO2R(I,K)=A1(I)*CO251(K,K)+A2(I)*CO258(K,K)
      DCO2DT(I,K)=H1M2*(A1(I)*CDT51(K,K)+A2(I)*CDT58(K,K))
      D2CDT2(I,K)=H1M3*(A1(I)*C2D51(K,K)+A2(I)*C2D58(K,K))
      CO21(I,K,K)=CO2R(I,K)+DIFT(I,K)*(DCO2DT(I,K)+
     1             HAF*DIFT(I,K)*D2CDT2(I,K))
206   CONTINUE
C--- WE AREN'T DOING NBL TFS ON THE 100 CM-1 BANDS .
      DO 260 K=1,L
      DO 260 I=1,IMAX
      CO2NBL(I,K)=CO2MR(I,K)+VSUM3(I,K)*(CO2MD(I,K)+HAF*
     1 VSUM3(I,K)*CO2M2D(I,K))
260   CONTINUE
C***COMPUTE TEMP. COEFFICIENT BASED ON T(K) (SEE REF.2)
      DO 264 K=1,LP1
      DO 264 I=1,IMAX
      IF (T(I,K).LE.H25E2) THEN
         TLSQU(I,K)=B0+(T(I,K)-H25E2)*
     1                      (B1+(T(I,K)-H25E2)*
     2                   (B2+B3*(T(I,K)-H25E2)))
      ELSE
         TLSQU(I,K)=B0
      ENDIF
264   CONTINUE
C***APPLY TO ALL CO2 TFS
      DO 280 K=1,LP1
      DO 282 KP=1,LP1
      DO 282 I=1,IMAX
      CO21(I,KP,K)=CO21(I,KP,K)*(ONE-TLSQU(I,KP))+TLSQU(I,KP)
282   CONTINUE
280   CONTINUE
      DO 284 K=1,LP1
      DO 286 I=1,IMAX
      CO2SP1(I,K)=CO2SP1(I,K)*(ONE-TLSQU(I,1))+TLSQU(I,1)
      CO2SP2(I,K)=CO2SP2(I,K)*(ONE-TLSQU(I,1))+TLSQU(I,1)
286   CONTINUE
284   CONTINUE
      DO 288 K=1,L
      DO 290 I=1,IMAX
      CO2NBL(I,K)=CO2NBL(I,K)*(ONE-TLSQU(I,K))+TLSQU(I,K)
290   CONTINUE
288   CONTINUE
      CALL FST88(HEATRA,GRNFLX,TOPFLX,
##CLR1           GRNFX0,TOPFX0,
     1           QH2O,PRESS,P,DELP,DELP2,TEMP,T,
     2           CLDFAC,NCLDS,KTOP,KBTM,CAMT,
     3           CO21,CO2NBL,CO2SP1,CO2SP2,
     4           VAR1,VAR2,VAR3,VAR4,CNTVAL,
     5           TOTO3,TPHIO3,TOTPHI,TOTVO2,
     6           EMX1,EMX2,EMPL)
      RETURN
      END
C     SUBROUTINE SPA88 COMPUTES EXACT CTS HEATING RATES AND FLUXES AND
C  CORRESPONDING CTS EMISSIVITY QUANTITIES FOR H2O,CO2 AND O3.
C          INPUTS:                (COMMON BLOCKS)
C       ACOMB,BCOMB,APCM,BPCM                  BDCOMB
C       ATPCM,BTPCM,BETACM                     BDCOMB
C       BETINW                                 BDWIDE
C       TEMP,PRESS                             RADISW
C       VAR1,VAR2,P,DELP,DELP2                 KDACOM
C       TOTVO2,TO3SP,TO3SPC                    TFCOM
C       CO2SP1,CO2SP2,CO2SP                    TFCOM
C       CLDFAC                                 CLDCOM
C       SKO2D                                  TABCOM
C       SORC,CSOUR                             SRCCOM
C           OUTPUTS:
C       EXCTS,CTSO3                            TFCOM
C       GXCTS                                  RDFLUX
C           CALLED BY:
C       FST88
C            CALLS:
C
      SUBROUTINE SPA88(EXCTS,CTSO3,GXCTS,SORC,CSOUR,
##CLR1                 EXCTS0,CTSO30,GXCTS0,
     1                 CLDFAC,TEMP,PRESS,VAR1,VAR2,
     2                 P,DELP,DELP2,TOTVO2,TO3SP,TO3SPC,
     3                 CO2SP1,CO2SP2,CO2SP)
CFPP$ NOCONCUR R
C
 %INCLUDE HCON;
 %INCLUDE RDPARM;
 %INCLUDE RNDDTA;
C
      DIMENSION SORC(IMBX,LP1,NBLY),CSOUR(IMBX,LP1)
      DIMENSION CLDFAC(IMBX,LP1,LP1)
      DIMENSION TEMP(IMBX,LP1),PRESS(IMBX,LP1)
      DIMENSION VAR1(IMBX,L),VAR2(IMBX,L)
      DIMENSION P(IMBX,LP1),DELP(IMBX,L),DELP2(IMBX,L)
      DIMENSION TOTVO2(IMBX,LP1),TO3SPC(IMBX,L),TO3SP(IMBX,LP1)
      DIMENSION CO2SP1(IMBX,LP1),CO2SP2(IMBX,LP1),CO2SP(IMBX,LP1)
      DIMENSION EXCTS(IMBX,L),CTSO3(IMBX,L),GXCTS(IMAX)
##CLR DIMENSION EXCTS0(IMBX,L),CTSO30(IMBX,L),GXCTS0(IMAX)
##CLR DIMENSION CTMP0(IMBX,LP1),CTMP20(IMBX,LP1),CTMP30(IMBX,LP1)
C
      DIMENSION PHITMP(IMBX,L),PSITMP(IMBX,L),TT(IMBX,L),
     1          FAC1(IMBX,L),FAC2(IMBX,L),
     2          CTMP(IMBX,LP1),X(IMBX,L),Y(IMBX,L),
     3          TOPM(IMBX,L),TOPPHI(IMBX,L),
     4          CTMP3(IMBX,LP1),CTMP2(IMBX,LP1)
      DIMENSION F(IMBX,L),FF(IMBX,L),AG(IMBX,L),AGG(IMBX,L)
      EQUIVALENCE (F,AG,PHITMP)
      EQUIVALENCE (FF,AGG,PSITMP)
C---COMPUTE TEMPERATURE QUANTITIES FOR USE IN PROGRAM
      DO 101 K=1,L
      DO 101 I=1,IMAX
      X(I,K)=TEMP(I,K)-H25E2
      Y(I,K)=X(I,K)*X(I,K)
101   CONTINUE
C---INITIALIZE CTMP(I,1),CTMP2(I,1),CTMP3(I,1) TO UNITY; THESE ARE
C   TRANSMISSION FCTNS AT THE TOP.
      DO 345 I=1,IMAX
      CTMP(I,1)=ONE
      CTMP2(I,1)=1.
      CTMP3(I,1)=1.
345   CONTINUE
C...   DITTO FOR THE CLEAR SKY CALCULATION...
##CLR DO 2345 I=1,IMAX
##CLR  CTMP0(I,1)=ONE
##CLR  CTMP20(I,1)=1.
##CLR  CTMP30(I,1)=1.
2345  CONTINUE
C***BEGIN LOOP ON FREQUENCY BANDS (1)***
C
C---CALCULATION FOR BAND 1 (COMBINED BAND 1)
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 301 K=1,L
      DO 301 I=1,IMAX
      F(I,K)=H44194M2*(APCM(1)*X(I,K)+BPCM(1)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(1)*X(I,K)+BTPCM(1)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
301   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 315 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
315   CONTINUE
      DO 319 K=2,L
      DO 317 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
317   CONTINUE
319   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 321 K=1,L
      DO 321 I=1,IMAX
      FAC1(I,K)=ACOMB(1)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(1)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*FAC1(I,K)/SQRT(1.+FAC2(I,K)))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
321   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 353 K=1,L
      DO 353 I=1,IMAX
      EXCTS(I,K)=SORC(I,K,1)*(CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=SORC(I,K,1)*(CTMP0(I,K+1)-CTMP0(I,K))
353   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 361 I=1,IMAX
      GXCTS(I)=                 TT(I,L)*SORC(I,L,1)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,1)-SORC(I,L,1))
##CLR  GXCTS0(I)=GXCTS(I)
       GXCTS(I)=CLDFAC(I,LP1,1)*GXCTS(I)
361   CONTINUE
C
C
C-----CALCULATION FOR BAND 2 (COMBINED BAND 2)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 401 K=1,L
      DO 401 I=1,IMAX
      F(I,K)=H44194M2*(APCM(2)*X(I,K)+BPCM(2)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(2)*X(I,K)+BTPCM(2)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
401   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 415 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
415   CONTINUE
      DO 419 K=2,L
      DO 417 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
417   CONTINUE
419   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 421 K=1,L
      DO 421 I=1,IMAX
      FAC1(I,K)=ACOMB(2)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(2)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*FAC1(I,K)/SQRT(1.+FAC2(I,K)))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
421   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 453 K=1,L
      DO 453 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,2)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,2)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
453   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 461 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,2)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,2)-SORC(I,L,2)))
461   CONTINUE
##CLR DO 2461 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+               TT(I,L)*SORC(I,L,2)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,2)-SORC(I,L,2))
2461  CONTINUE
C
C-----CALCULATION FOR BAND 3 (COMBINED BAND 3)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 501 K=1,L
      DO 501 I=1,IMAX
      F(I,K)=H44194M2*(APCM(3)*X(I,K)+BPCM(3)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(3)*X(I,K)+BTPCM(3)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
501   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 515 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
515   CONTINUE
      DO 519 K=2,L
      DO 517 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
517   CONTINUE
519   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 521 K=1,L
      DO 521 I=1,IMAX
      FAC1(I,K)=ACOMB(3)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(3)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*FAC1(I,K)/SQRT(1.+FAC2(I,K)))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
521   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 553 K=1,L
      DO 553 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,3)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,3)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
553   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 561 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,3)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,3)-SORC(I,L,3)))
561   CONTINUE
##CLR DO 2561 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,3)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,3)-SORC(I,L,3))
2561  CONTINUE
C
C-----CALCULATION FOR BAND 4 (COMBINED BAND 4)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 601 K=1,L
      DO 601 I=1,IMAX
      F(I,K)=H44194M2*(APCM(4)*X(I,K)+BPCM(4)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(4)*X(I,K)+BTPCM(4)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
601   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 615 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
615   CONTINUE
      DO 619 K=2,L
      DO 617 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
617   CONTINUE
619   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 621 K=1,L
      DO 621 I=1,IMAX
      FAC1(I,K)=ACOMB(4)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(4)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*FAC1(I,K)/SQRT(1.+FAC2(I,K)))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
621   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 653 K=1,L
      DO 653 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,4)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,4)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
653   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 661 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,4)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,4)-SORC(I,L,4)))
661   CONTINUE
##CLR DO 2661 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,4)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,4)-SORC(I,L,4))
2661  CONTINUE
C
C-----CALCULATION FOR BAND 5 (COMBINED BAND 5)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 701 K=1,L
      DO 701 I=1,IMAX
      F(I,K)=H44194M2*(APCM(5)*X(I,K)+BPCM(5)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(5)*X(I,K)+BTPCM(5)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
701   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 715 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
715   CONTINUE
      DO 719 K=2,L
      DO 717 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
717   CONTINUE
719   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 721 K=1,L
      DO 721 I=1,IMAX
      FAC1(I,K)=ACOMB(5)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(5)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(5)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
721   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 753 K=1,L
      DO 753 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,5)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,5)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
753   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 761 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,5)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,5)-SORC(I,L,5)))
761   CONTINUE
##CLR DO 2761 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,5)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,5)-SORC(I,L,5))
2761  CONTINUE
C
C-----CALCULATION FOR BAND 6 (COMBINED BAND 6)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 801 K=1,L
      DO 801 I=1,IMAX
      F(I,K)=H44194M2*(APCM(6)*X(I,K)+BPCM(6)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(6)*X(I,K)+BTPCM(6)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
801   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 815 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
815   CONTINUE
      DO 819 K=2,L
      DO 817 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
817   CONTINUE
819   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 821 K=1,L
      DO 821 I=1,IMAX
      FAC1(I,K)=ACOMB(6)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(6)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(6)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
821   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 853 K=1,L
      DO 853 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,6)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,6)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
853   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 861 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,6)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,6)-SORC(I,L,6)))
861   CONTINUE
##CLR DO 2861 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+ TT(I,L)*SORC(I,L,6)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,6)-SORC(I,L,6))
2861  CONTINUE
C
C-----CALCULATION FOR BAND 7 (COMBINED BAND 7)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 901 K=1,L
      DO 901 I=1,IMAX
      F(I,K)=H44194M2*(APCM(7)*X(I,K)+BPCM(7)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(7)*X(I,K)+BTPCM(7)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
901   CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 915 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
915   CONTINUE
      DO 919 K=2,L
      DO 917 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
917   CONTINUE
919   CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 921 K=1,L
      DO 921 I=1,IMAX
      FAC1(I,K)=ACOMB(7)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(7)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(7)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
921   CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 953 K=1,L
      DO 953 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,7)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,7)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
953   CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 961 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,7)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,7)-SORC(I,L,7)))
961   CONTINUE
##CLR DO 1961 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,7)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,7)-SORC(I,L,7))
1961  CONTINUE
C
C-----CALCULATION FOR BAND 8 (COMBINED BAND 8)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1001 K=1,L
      DO 1001 I=1,IMAX
      F(I,K)=H44194M2*(APCM(8)*X(I,K)+BPCM(8)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(8)*X(I,K)+BTPCM(8)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1001  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1015 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1015  CONTINUE
      DO 1019 K=2,L
      DO 1017 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1017  CONTINUE
1019  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1021 K=1,L
      DO 1021 I=1,IMAX
      FAC1(I,K)=ACOMB(8)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(8)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(8)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1021  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1053 K=1,L
      DO 1053 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,8)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,8)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1053  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1061 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,8)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,8)-SORC(I,L,8)))
1061  CONTINUE
##CLR DO 2061 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,8)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,8)-SORC(I,L,8))
2061  CONTINUE
C
C-----CALCULATION FOR BAND 9 ( 560-670 CM-1; INCLUDES CO2)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1101 K=1,L
      DO 1101 I=1,IMAX
      F(I,K)=H44194M2*(APCM(9)*X(I,K)+BPCM(9)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(9)*X(I,K)+BTPCM(9)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1101  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1115 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1115  CONTINUE
      DO 1119 K=2,L
      DO 1117 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1117  CONTINUE
1119  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1121 K=1,L
      DO 1121 I=1,IMAX
      FAC1(I,K)=ACOMB(9)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(9)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(9)*TOTVO2(I,K+1)*SKO2D))*CO2SP1(I,K+1)
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1121  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1153 K=1,L
      DO 1153 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,9)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,9)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1153  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1161 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,9)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,9)-SORC(I,L,9)))
1161  CONTINUE
##CLR DO 2161 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,9)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,9)-SORC(I,L,9))
2161  CONTINUE
C
C-----CALCULATION FOR BAND 10 (670-800 CM-1; INCLUDES CO2)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1201 K=1,L
      DO 1201 I=1,IMAX
      F(I,K)=H44194M2*(APCM(10)*X(I,K)+BPCM(10)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(10)*X(I,K)+BTPCM(10)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1201  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1215 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1215  CONTINUE
      DO 1219 K=2,L
      DO 1217 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1217  CONTINUE
1219  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1221 K=1,L
      DO 1221 I=1,IMAX
      FAC1(I,K)=ACOMB(10)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(10)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(10)*TOTVO2(I,K+1)*SKO2D))*CO2SP2(I,K+1)
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1221  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1253 K=1,L
      DO 1253 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,10)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,10)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1253  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1261 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,10)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,10)-SORC(I,L,10)))
1261  CONTINUE
##CLR DO 3261 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,10)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,10)-SORC(I,L,10))
3261  CONTINUE
C
C-----CALCULATION FOR BAND 11 (800-900 CM-1)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1301 K=1,L
      DO 1301 I=1,IMAX
      F(I,K)=H44194M2*(APCM(11)*X(I,K)+BPCM(11)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(11)*X(I,K)+BTPCM(11)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1301  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1315 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1315  CONTINUE
      DO 1319 K=2,L
      DO 1317 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1317  CONTINUE
1319  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1321 K=1,L
      DO 1321 I=1,IMAX
      FAC1(I,K)=ACOMB(11)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(11)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(11)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1321  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1353 K=1,L
      DO 1353 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,11)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,11)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1353  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1361 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,11)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,11)-SORC(I,L,11)))
1361  CONTINUE
##CLR DO 3361 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,11)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,11)-SORC(I,L,11))
3361  CONTINUE
C
C-----CALCULATION FOR BAND 12 (900-990 CM-1)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1401 K=1,L
      DO 1401 I=1,IMAX
      F(I,K)=H44194M2*(APCM(12)*X(I,K)+BPCM(12)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(12)*X(I,K)+BTPCM(12)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1401  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1415 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1415  CONTINUE
      DO 1419 K=2,L
      DO 1417 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1417  CONTINUE
1419  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1421 K=1,L
      DO 1421 I=1,IMAX
      FAC1(I,K)=ACOMB(12)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(12)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(12)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1421  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1453 K=1,L
      DO 1453 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,12)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,12)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1453  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1461 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,12)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,12)-SORC(I,L,12)))
1461  CONTINUE
##CLR DO 3461 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,12)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,12)-SORC(I,L,12))
3461  CONTINUE
C
C-----CALCULATION FOR BAND 13 (990-1070 CM-1; INCLUDES O3))
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1501 K=1,L
      DO 1501 I=1,IMAX
      F(I,K)=H44194M2*(APCM(13)*X(I,K)+BPCM(13)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(13)*X(I,K)+BTPCM(13)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1501  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1515 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1515  CONTINUE
      DO 1519 K=2,L
      DO 1517 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1517  CONTINUE
1519  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1521 K=1,L
      DO 1521 I=1,IMAX
      FAC1(I,K)=ACOMB(13)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(13)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(13)*TOTVO2(I,K+1)*SKO2D +TO3SPC(I,K)))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1521  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1553 K=1,L
      DO 1553 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,13)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,13)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1553  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1561 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,13)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,13)-SORC(I,L,13)))
1561  CONTINUE
##CLR DO 3561 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,13)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,13)-SORC(I,L,13))
3561  CONTINUE
C
C-----CALCULATION FOR BAND 14 (1070-1200 CM-1)
C
C
C---OBTAIN TEMPERATURE CORRECTION (CAPPHI,CAPPSI),THEN MULTIPLY
C   BY OPTICAL PATH (VAR1,VAR2) TO COMPUTE TEMPERATURE-CORRECTED
C   OPTICAL PATH AND MEAN PRESSURE FOR A LAYER (PHITMP,PSITMP)
      DO 1601 K=1,L
      DO 1601 I=1,IMAX
      F(I,K)=H44194M2*(APCM(14)*X(I,K)+BPCM(14)*Y(I,K))
      FF(I,K)=H44194M2*(ATPCM(14)*X(I,K)+BTPCM(14)*Y(I,K))
      AG(I,K)=(H1P41819+F(I,K))*F(I,K)+ONE
      AGG(I,K)=(H1P41819+FF(I,K))*FF(I,K)+ONE
      PHITMP(I,K)=VAR1(I,K)*(((( AG(I,K)*AG(I,K))**2)**2)**2)
      PSITMP(I,K)=VAR2(I,K)*(((( AGG(I,K)*AGG(I,K))**2)**2)**2)
1601  CONTINUE
C---OBTAIN OPTICAL PATH,MEAN PRESSURE FROM THE TOP TO THE PRESSURE
C   P(K) (TOPM,TOPPHI)
      DO 1615 I=1,IMAX
      TOPM(I,1)=PHITMP(I,1)
      TOPPHI(I,1)=PSITMP(I,1)
1615  CONTINUE
      DO 1619 K=2,L
      DO 1617 I=1,IMAX
      TOPM(I,K)=TOPM(I,K-1)+PHITMP(I,K)
      TOPPHI(I,K)=TOPPHI(I,K-1)+PSITMP(I,K)
1617  CONTINUE
1619  CONTINUE
C---TT IS THE CLOUD-FREE CTS TRANSMISSION FUNCTION
      DO 1621 K=1,L
      DO 1621 I=1,IMAX
      FAC1(I,K)=ACOMB(14)*TOPM(I,K)
      FAC2(I,K)=FAC1(I,K)*TOPM(I,K)/(BCOMB(14)*TOPPHI(I,K))
      TT(I,K)=EXP(HM1EZ*(FAC1(I,K)/SQRT(ONE+FAC2(I,K))+
     1           BETACM(14)*TOTVO2(I,K+1)*SKO2D))
      CTMP(I,K+1)=TT(I,K)*CLDFAC(I,K+1,1)
##CLR  CTMP0(I,K+1)=TT(I,K)
1621  CONTINUE
C---EXCTS IS THE CTS COOLING RATE ACCUMULATED OVER FREQUENCY BANDS
      DO 1653 K=1,L
      DO 1653 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)+SORC(I,K,14)*
     1             (CTMP(I,K+1)-CTMP(I,K))
##CLR  EXCTS0(I,K)=EXCTS0(I,K)+SORC(I,K,14)*
##CLR1             (CTMP0(I,K+1)-CTMP0(I,K))
1653  CONTINUE
C---GXCTS IS THE EXACT CTS TOP FLUX ACCUMULATED OVER FREQUENCY BANDS
      DO 1661 I=1,IMAX
      GXCTS(I)=GXCTS(I)+CLDFAC(I,LP1,1)*(TT(I,L)*SORC(I,L,14)+
     1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
     2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
     3   (SORC(I,LP1,14)-SORC(I,L,14)))
1661  CONTINUE
##CLR DO 3661 I=1,IMAX
##CLR  GXCTS0(I)=GXCTS0(I)+TT(I,L)*SORC(I,L,14)+
##CLR1   (HAF*DELP(I,L)*(TT(I,LM1)*(P(I,LP1)-PRESS(I,L)) +
##CLR2   TT(I,L)*(P(I,LP1)+PRESS(I,L)-TWO*P(I,L)))) *
##CLR3   (SORC(I,LP1,14)-SORC(I,L,14))
3661  CONTINUE
C
C
C   OBTAIN CTS FLUX AT THE TOP BY INTEGRATION OF HEATING RATES AND
C   USING CTS FLUX AT THE BOTTOM (CURRENT VALUE OF GXCTS). NOTE
C   THAT THE PRESSURE QUANTITIES AND CONVERSION FACTORS HAVE NOT
C   BEEN INCLUDED EITHER IN EXCTS OR IN GXCTS. THESE CANCEL OUT, THUS
C   REDUCING COMPUTATIONS!
      DO 1731 K=1,L
      DO 1731 I=1,IMAX
      GXCTS(I)=GXCTS(I)-EXCTS(I,K)
##CLR GXCTS0(I)=GXCTS0(I)-EXCTS0(I,K)
1731  CONTINUE
C
C   NOW SCALE THE COOLING RATE (EXCTS) BY INCLUDING THE PRESSURE
C   FACTOR (DELP) AND THE CONVERSION FACTOR (RADCON)
      DO 1741 K=1,L
      DO 1741 I=1,IMAX
      EXCTS(I,K)=EXCTS(I,K)*RADCON*DELP(I,K)
##CLR EXCTS0(I,K)=EXCTS0(I,K)*RADCON*DELP(I,K)
1741  CONTINUE
C---THIS IS THE END OF THE EXACT CTS COMPUTATIONS; AT THIS POINT
C   EXCTS HAS ITS APPROPRIATE VALUE.
C
C*** COMPUTE APPROXIMATE CTS HEATING RATES FOR 15UM AND 9.6 UM BANDS
C     (CTSO3)
      DO 1711 K=1,L
      DO 1711 I=1,IMAX
      CTMP2(I,K+1)=CO2SP(I,K+1)*CLDFAC(I,K+1,1)
      CTMP3(I,K+1)=TO3SP(I,K)*CLDFAC(I,K+1,1)
##CLR CTMP20(I,K+1)=CO2SP(I,K+1)
##CLR CTMP30(I,K+1)=TO3SP(I,K)
1711  CONTINUE
      DO 1701 K=1,L
      DO 1701 I=1,IMAX
      CTSO3(I,K)=RADCON*DELP(I,K)*
     1     (CSOUR(I,K)*(CTMP2(I,K+1)-CTMP2(I,K)) +
     2      SORC(I,K,13)*(CTMP3(I,K+1)-CTMP3(I,K)))
1701  CONTINUE
##CLR DO 3701 K=1,L
##CLR DO 3701 I=1,IMAX
##CLR  CTSO30(I,K)=RADCON*DELP(I,K)*
##CLR1     (CSOUR(I,K)*(CTMP20(I,K+1)-CTMP20(I,K)) +
##CLR2      SORC(I,K,13)*(CTMP30(I,K+1)-CTMP30(I,K)))
3701  CONTINUE
      RETURN
      END
      SUBROUTINE SWR93SIB(FSWC,HSWC,UFSWC,DFSWC,FSWL,HSWL,UFSWL,DFSWL,
     1                    PRESS,COSZRO,TAUDAR,RH2O,RRCO2,SSOLAR,QO3,
CFE932                    NCLDS,KTOPSW,KBTMSW,CIRAB,CIRRF,CUVRF,CAMT,
     2                    NCLDS,KTOP,KBTM,CAMT,CRR,CTT,
     A                    ALVB,ALNB,ALVD,ALND,GDFVB,GDFNB,GDFVD,GDFND)
CFPP$ NOCONCUR R
C===>    *********************************************************
C --- SWR91SIB --- MODIFIED FROM SWR89-BAND12....YUTAI HOU
C --- SWR93SIB --- MODIFIED FROM SWR91SIB AS NOTED BELOW..
C        -INPUTS 12 BANDS CLD REFLECTANCE AND TRANSMITANCE
C        -CRR,CTT TO REPLACE CIRAB,CIRRF,CUVRF...YUTAI HOU ..FEB 93
C
C     -SW- RADIATION CODE............................
C        INPUTS:PRESS,COSZRO,TAUDAR,RH2O,RRCO2,SSOLAR,QO3,NCLDS,
CDE93           KTOPSW,KBTMSW,CIRAB,CIRRF,CUVRF,CAMT,
C               KTOP,KBTM,CAMT,CRR,CTT,
C               ALVB,ALVD,ALNB,ALND;
C        OUTPUT:FSWC,HSWC,UFSWC,DFSWC,FSWL,HSWL,UFSWL,DFSWL,
C               GDFVB,GDFVD,GDFNB,GDFND.
C --- SWR91SIB --- MODIFIED BY K. CAMPANA..06 MAR 92
C         INCLUDE HPCON,PARMC CHANGED TO HCON,RDPARM
C         6 Q..... VARIABLE NAMES RESTORED TO ORIGINAL 7,8 CHAR
C         CHANGE O3DIFF,DIFFCC TO O3DIFCTR,DIFFCTR
C --- SWR91SIB --- MODIFIED BY Y. HOU         FEB 93
C         INPUTS 12 BANDS CLD REFLECTTANCE AND TRANSMITTANCE
C         CRR,CTT TO REPLACE CIRAB,CIRRF,CUVRF
C --- SWR93SIB --- MODIFIED BY Y. HOU         DEC 93
C         INPUT VARIABLES KTOP, KBTM
C ---          --- MODIFIED BY Y. HOU         FEB 94
C         TO INCORPORATE B KATZ IMPROVED CODING
C
C===>    *********************************************************
 %INCLUDE HCON;
 %INCLUDE RDPARM;
C     PARAMETER SETTINGS FOR THE LONGWAVE AND SHORTWAVE RADIATION CODE:
C          IMAX   =  NO. POINTS ALONG THE LAT. CIRCLE USED IN CALCS.
C          L      =  NO. VERTICAL LEVELS (ALSO LAYERS) IN MODEL
C***NOTE: THE USER NORMALLY WILL MODIFY ONLY THE IMAX AND L PARAMETERS
C          NB IS A SHORTWAVE PARAMETER; OTHER QUANTITIES ARE DERIVED
C                    FROM THE ABOVE PARAMETERS.
C --- VARIABLES AS IN ARGUMENT LIST
                       D I M E N S I O N
CFE931  FSWC  (IMBX,LP1),  HSWC  (IMBX,LP1)
CFE932, FSWL  (IMBX,LP1),  HSWL  (IMBX,LP1)
     1  FSWC  (IMBX,LP1),  HSWC  (IMBX,LP1),   CRR   (IMBX,NB,LP1)
     2, FSWL  (IMBX,LP1),  HSWL  (IMBX,LP1),   CTT   (IMBX,NB,LP1)
     3, UFSWC (IMBX,LP1),  DFSWC (IMBX,LP1)
     4, UFSWL (IMBX,LP1),  DFSWL (IMBX,LP1)
     5, PRESS (IMBX,LP1),  RH2O  (IMBX,L),     QO3   (IMBX,L)
     6, CAMT  (IMBX,LP1),  KTOP  (IMBX,LP1),   KBTM  (IMBX,LP1)
CFE937, CIRAB (IMBX,LP1),  CIRRF (IMBX,LP1),   CUVRF (IMBX,LP1)
     8, COSZRO(IMAX),      TAUDAR(IMAX),       NCLDS (IMAX)
     A, ALVB  (IMAX),  ALNB  (IMAX),  ALVD  (IMAX),  ALND  (IMAX)
     B, GDFVB (IMAX),  GDFNB (IMAX),  GDFVD (IMAX),  GDFND (IMAX)
C --- LOCAL VARIABLES
                       D I M E N S I O N
     1  PP    (IMBX,LP1),  DP    (IMBX,LP1),   PR2   (IMBX,LP1)
     3, DU    (IMBX,LP1),  DUCO2 (IMBX,LP1),   DUO3  (IMBX,LP1)
     4, FF    (IMBX,LP1),  FFCO2 (IMBX,LP1),   FFO3  (IMBX,LP1)
     5, RRAY  (IMAX),      DFNTOP(IMBX,NB),    SECZ  (IMAX)
     6, REFL  (IMAX),      TEMP1 (IMAX),       REFL2 (IMAX)
     7, TEMPF (IMAX),      TEMPG (IMAX)
     A, CCMAX (IMAX),      XAMT  (IMBX,LP1),   KBTMSW(IMBX,LP1)
                       D I M E N S I O N
     1                     UD    (IMBX,LP1),   UR    (IMBX,LP1)
     2, UCO2  (IMBX,LLP2), UDCO2 (IMBX,LP1),   URCO2 (IMBX,LP1)
     3, UO3   (IMBX,LLP2), UDO3  (IMBX,LP1),   URO3  (IMBX,LP1)
     4, TCO2  (IMBX,LLP2), TDCO2 (IMBX,LP1),   TUCO2 (IMBX,LP1)
     5, TO3   (IMBX,LLP2), TDO3  (IMBX,LP1),   TUO3  (IMBX,LP1)
                       D I M E N S I O N
     1  DFN   (IMBX,LP1),  UFN   (IMBX,LP1),   CR    (IMBX,LP1)
     2, TTD   (IMBX,LP1),  TTU   (IMBX,LP1),   CT    (IMBX,LP1)
     3, PPTOP (IMBX,LP1),  DPCLD (IMBX,LP1)
                       D I M E N S I O N
     1  MNKBTM(LP1)     ,  MNKTOP(LP1)     ,   MXKBTM(LP1)
     2, MXKTOP(LP1)
                       L O G I C A L
     1  LSAVE(IMAX),LSAVE0(IMBX,LP1),LSAVE1(IMBX,LP1,LP1)
     2, LSAVE2(IMBX,LP1,LP1)
C --- EQUIVALENCED LOCAL VARIABLES
                       D I M E N S I O N
     1  TTUB1 (IMBX,LP1),  TUCL1 (IMBX,LP1)
     2, TTDB1 (IMBX,LP1),  TDCL1 (IMBX,LP1),   TDCL2 (IMBX,LP1)
     3, UFNTRN(IMBX,LP1),  UFNCLU(IMBX,LP1),   TCLU  (IMBX,LP1)
     4, DFNTRN(IMBX,LP1),  DFNCLU(IMBX,LP1),   TCLD  (IMBX,LP1)
     5, ALFA  (IMBX,LP1),  ALFAU (IMBX,LP1)
                     E Q U I V A L E N C E
     1  (UDO3 , UO3 (1,1), DFNCLU),  (URO3 , UO3 (1,LP2), UFNCLU)
     2, (UDCO2, UCO2(1,1), TCLD  ),  (URCO2, UCO2(1,LP2), TCLU  )
     3, (TDO3 , TO3 (1,1), DFNTRN),  (TUO3 , TO3 (1,LP2), UFNTRN)
     4, (TDCO2, TCO2(1,1)        ),  (TUCO2, TCO2(1,LP2)        )
     5, (FF   , ALFA ),   (FFCO2 , ALFAU ),   (FFO3  , TTDB1 )
     6, (DU   , TTUB1),   (DUCO2 , TUCL1 ),   (DUO3  , TDCL1 )
     7, (PR2  , TDCL2)
C
C---COMMON FOR LOCAL DATA VARIABLES---
      COMMON /SWRSAV/ ABCFF(NB),PWTS(NB),CFCO2,CFO3,REFLO3,RRAYAV
C                           D A T A
C    1  ABCFF / 2*4.0E-5, 0.002, 0.035, 0.377, 1.95, 9.40, 44.6,
C    1          190.0,    989.0, 2706.0, 39011.0 /
C    2, PWTS  / 0.5000, 0.121416, 0.0698, 0.1558, 0.0631, 0.0362,
C    2          0.0243, 0.0158, 0.0087, 0.001467, 0.002342, 0.001075 /
C    3, CFCO2, CFO3, REFLO3, RRAYAV / 508.96, 466.64, 1.9, 0.144 /
C    1  ABCFF / 2*4.0E-5, .002, .035, .377, 1.95, 9.40, 44.6, 190. /
C    2, PWTS  /.5000,.1470,.698,.1443,.0584,.0335,.0225,.0158,.0087/
C    3, CFCO2, CFO3, REFLO3, RRAYAV / 508.96, 466.64, 1.9, 0.144 /
C
C     CALCULATE SECANT OF ZENITH ANGLE (SECZ),FLUX PRESSURES(PP),
C     LAYER WIDTH (DP) AND PRESSURE SCALING FACTOR (PR2).
      DO 100 I=1,IMAX
        SECZ(I) = H35E1/SQRT(H1224E3*COSZRO(I)*COSZRO(I)+ONE)
        PP(I,1)   = ZERO
        PP(I,LP1) = PRESS(I,LP1)
        TEMP1(I)  = ONE/PRESS(I,LP1)
100   CONTINUE
      DO 110 K=2,L
      DO 110 I=1,IMAX
        PP(I,K) = HAF*(PRESS(I,K)+PRESS(I,K-1))
110   CONTINUE
      DO 120 K=1,L
      DO 120 I=1,IMAX
        DP (I,K) = PP(I,K+1)-PP(I,K)
        PR2(I,K) = HAF*(PP(I,K)+PP(I,K+1))
120   CONTINUE
      DO 130 K=1,L
      DO 130 I=1,IMAX
        PR2(I,K) = PR2(I,K)*TEMP1(I)
130   CONTINUE
C     CALCULATE ENTERING FLUX AT THE TOP FOR EACH BAND(IN CGS UNITS)
      DO 140 N=1,NB
      DO 140 IP=1,IMAX
        DFNTOP(IP,N) = SSOLAR*H69766E5*COSZRO(IP)*TAUDAR(IP)*PWTS(N)
140   CONTINUE
C     EXECUTE THE LACIS-HANSEN REFLECTIVITY PARAMETERIZATION
C     FOR THE VISIBLE BAND
      DO 150 I=1,IMAX
        RRAY(I) = HP219/(ONE+HP816*COSZRO(I))
        REFL(I) = RRAY(I) + (ONE-RRAY(I))*(ONE-RRAYAV)*ALVB(I)/
     1            (ONE-ALVD(I)*RRAYAV)
150   CONTINUE
      DO 155 I=1,IMAX
        RRAY(I) = 0.104/(ONE+4.8*COSZRO(I))
        REFL2(I)= RRAY(I) + (ONE-RRAY(I))*(ONE-0.093)*ALVB(I)/
     1            (ONE-ALVD(I)*0.093)
155   CONTINUE
C     CALCULATE PRESSURE-WEIGHTED OPTICAL PATHS FOR EACH LAYER
C     IN UNITS OF CM-ATM. PRESSURE WEIGHTING IS USING PR2.
C     DU= VALUE FOR H2O;DUCO2 FOR CO2;DUO3 FOR O3.
      DO 160 K=1,L
      DO 160 I=1,IMAX
        DU   (I,K) = GINV*RH2O(I,K)*DP(I,K)*PR2(I,K)
        DUCO2(I,K) = (RRCO2*GINV*CFCO2)*DP(I,K)*PR2(I,K)
        DUO3 (I,K) = (GINV*CFO3)*QO3(I,K)*DP(I,K)
160   CONTINUE
C...............  CALCULATE CLEAR SKY SW FLUX
C     OBTAIN THE OPTICAL PATH FROM THE TOP OF THE ATMOSPHERE TO THE
C     FLUX PRESSURE. ANGULAR FACTORS ARE NOW INCLUDED. UD=DOWNWARD
C     PATH FOR H2O,WIGTH UR THE UPWARD PATH FOR H2O. CORRESPONDING
C     QUANTITIES FOR CO2,O3 ARE UDCO2/URCO2 AND UDO3/URO3.
      DO 200 IP=1,IMAX
        UD   (IP,1) = ZERO
        UDCO2(IP,1) = ZERO
        UDO3 (IP,1) = ZERO
200   CONTINUE
      DO 210 K=2,LP1
      DO 210 I=1,IMAX
        UD   (I,K) = UD   (I,K-1)+DU   (I,K-1)*SECZ(I)
        UDCO2(I,K) = UDCO2(I,K-1)+DUCO2(I,K-1)*SECZ(I)
        UDO3 (I,K) = UDO3 (I,K-1)+DUO3 (I,K-1)*SECZ(I)
210   CONTINUE
      DO 220 IP=1,IMAX
        UR   (IP,LP1) = UD   (IP,LP1)
        URCO2(IP,LP1) = UDCO2(IP,LP1)
        URO3 (IP,LP1) = UDO3 (IP,LP1)
220   CONTINUE
      DO 230 K=L,1,-1
      DO 230 IP=1,IMAX
        UR   (IP,K) = UR   (IP,K+1)+DU   (IP,K)*DIFFCTR
        URCO2(IP,K) = URCO2(IP,K+1)+DUCO2(IP,K)*DIFFCTR
        URO3 (IP,K) = URO3 (IP,K+1)+DUO3 (IP,K)*O3DIFCTR
230   CONTINUE
C     CALCULATE CO2 ABSORPTIONS . THEY WILL BE USED IN NEAR INFRARED
C     BANDS.SINCE THE ABSORPTION AMOUNT IS GIVEN (IN THE FORMULA USED
C     BELOW, DERIVED FROM SASAMORI) IN TERMS OF THE TOTAL SOLAR FLUX,
C     AND THE ABSORPTION IS ONLY INCLUDED IN THE NEAR IR (50 PERCENT
C     OF THE SOLAR SPECTRUM), THE ABSORPTIONS ARE MULTIPLIED BY 2.
C       SINCE CODE ACTUALLY REQUIRES TRANSMISSIONS, THESE ARE THE
C     VALUES ACTUALLY STORED IN TCO2.
      DO 240 K=2,LL+1
      DO 240 I=1,IMAX
        TCO2(I,K) = ONE-TWO*(H235M3*EXP(HP26*LOG(UCO2(I,K)+H129M2))
     1                       -H75826M4)
240   CONTINUE
C     NOW CALCULATE OZONE ABSORPTIONS. THESE WILL BE USED IN
C     THE VISIBLE BAND.JUST AS IN THE CO2 CASE, SINCE THIS BAND IS
C     50 PERCENT OF THE SOLAR SPECTRUM,THE ABSORPTIONS ARE MULTIPLIED
C     BY 2. THE TRANSMISSIONS ARE STORED IN TO3.
      HTEMP = H1036E2*H1036E2*H1036E2
      DO 250 K=2,LL+1
      DO 250 I=1,IMAX
        TO3(I,K) = ONE - TWO*UO3(I,K)*
     1             (H1P082*EXP(HMP805*LOG(ONE+H1386E2*UO3(I,K)))+
     2             H658M2/(ONE+HTEMP*UO3(I,K)*UO3(I,K)*UO3(I,K))+
     3             H2118M2/(ONE+UO3(I,K)*(H42M2+H323M4*UO3(I,K))))
250   CONTINUE
C   START FREQUENCY LOOP (ON N) HERE
C
C--- BAND 1 (VISIBLE) INCLUDES O3 AND H2O ABSORPTION
      DO 260 K=1,L
      DO 260 I=1,IMAX
        TTD(I,K+1) = EXP(HM1EZ*MIN(FIFTY,ABCFF(1)*UD(I,K+1)))
        TTU(I,K) = EXP(HM1EZ*MIN(FIFTY,ABCFF(1)*UR(I,K)))
        DFN(I,K+1) = TTD(I,K+1)*TDO3(I,K+1)
        UFN(I,K) = TTU(I,K)*TUO3(I,K)
260   CONTINUE
      DO 270 I=1,IMAX
        DFN(I,1)   = ONE
        UFN(I,LP1) = DFN(I,LP1)
270   CONTINUE
C     SCALE VISIBLE BAND FLUXES BY SOLAR FLUX AT THE TOP OF THE
C     ATMOSPHERE (DFNTOP(I,1))
C     DFSW/UFSW WILL BE THE FLUXES, SUMMED OVER ALL BANDS
      DO 280  K=1,LP1
      DO 280  I=1,IMAX
        DFSWL(I,K) =         DFN(I,K)*DFNTOP(I,1)
        UFSWL(I,K) = REFL(I)*UFN(I,K)*DFNTOP(I,1)
280   CONTINUE
      DO 285 I=1,IMAX
        GDFVB(I) = DFSWL(I,LP1)*EXP(-0.15746*SECZ(I))
        GDFVD(I) = ((ONE-REFL2(I))*DFSWL(I,LP1) -
     1              (ONE-ALVB(I)) *GDFVB(I)) / (ONE-ALVD(I))
        GDFNB(I) = ZERO
        GDFND(I) = ZERO
285   CONTINUE
C---NOW OBTAIN FLUXES FOR THE NEAR IR BANDS. THE METHODS ARE THE SAME
C   AS FOR THE VISIBLE BAND, EXCEPT THAT THE REFLECTION AND
C   TRANSMISSION COEFFICIENTS (OBTAINED BELOW) ARE DIFFERENT, AS
C   RAYLEIGH SCATTERING NEED NOT BE CONSIDERED.
      DO 350 N=2,NB
        IF (N.EQ.2) THEN
C   THE WATER VAPOR TRANSMISSION FUNCTION FOR BAND 2 IS EQUAL TO
C   THAT OF BAND 1 (SAVED AS TTD,TTU)
C--- BAND 2-9 (NEAR-IR) INCLUDES O3, CO2 AND H2O ABSORPTION
          DO 290 K=1,L
          DO 290 I=1,IMAX
            DFN(I,K+1) = TTD(I,K+1)*TDCO2(I,K+1)
            UFN(I,K) = TTU(I,K)*TUCO2(I,K)
290       CONTINUE
        ELSE
C   CALCULATE WATER VAPOR TRANSMISSION FUNCTIONS FOR NEAR INFRARED
C   BANDS. INCLUDE CO2 TRANSMISSION (TDCO2/TUCO2), WHICH
C   IS THE SAME FOR ALL INFRARED BANDS.
          DO 300 K=1,L
          DO 300 I=1,IMAX
            DFN(I,K+1)=
     &           EXP(HM1EZ*MIN(FIFTY,ABCFF(N)*UD(I,K+1)))*TDCO2(I,K+1)
            UFN(I,K)=EXP(HM1EZ*MIN(FIFTY,ABCFF(N)*UR(I,K)))*TUCO2(I,K)
300       CONTINUE
        ENDIF
C---AT THIS POINT,INCLUDE DFN(1),UFN(LP1), NOTING THAT DFN(1)=1 FOR
C   ALL BANDS, AND THAT UFN(LP1)=DFN(LP1) FOR ALL BANDS.
        DO 310 I=1,IMAX
          DFN(I,1)   = ONE
          UFN(I,LP1) = DFN(I,LP1)
310     CONTINUE
C     SCALE THE PREVIOUSLY COMPUTED FLUXES BY THE FLUX AT THE TOP
C     AND SUM OVER BANDS
        DO 320 K=1,LP1
        DO 320 I=1,IMAX
          DFSWL(I,K) = DFSWL(I,K) +         DFN(I,K)*DFNTOP(I,N)
          UFSWL(I,K) = UFSWL(I,K) + ALNB(I)*UFN(I,K)*DFNTOP(I,N)
320     CONTINUE
        DO 330 I=1,IMAX
          GDFNB(I) = GDFNB(I) + DFN(I,LP1)*DFNTOP(I,N)
330     CONTINUE
350   CONTINUE
      DO 360 K=1,LP1
      DO 360 I=1,IMAX
        FSWL(I,K) = UFSWL(I,K)-DFSWL(I,K)
360   CONTINUE
      DO 370 K=1,L
      DO 370 I=1,IMAX
        HSWL(I,K) = RADCON*(FSWL(I,K+1)-FSWL(I,K))/DP(I,K)
370   CONTINUE
C
C---END OF FREQUENCY LOOP (OVER N)
C.................CALCULATE CLOUDY SKY SW FLUX
      KCLDS=NCLDS(1)
      MAXKTP=KTOP(1,NCLDS(1)+1)
CDE93 MAXKTP=KTOPSW(1,NCLDS(1)+1)
      DO 400 I=2,IMAX
        KCLDS=MAX(NCLDS(I),KCLDS)
        MAXKTP=MAX(KTOP(I,NCLDS(I)+1),MAXKTP)
CDE93   MAXKTP=MAX(KTOPSW(I,NCLDS(I)+1),MAXKTP)
400   CONTINUE
      IF (KCLDS .EQ. 0) THEN
        DO 410 K=1,LP1
        DO 410 I=1,IMAX
          DFSWC(I,K) = DFSWL(I,K)
          UFSWC(I,K) = UFSWL(I,K)
          FSWC (I,K) = FSWL (I,K)
410     CONTINUE
        DO 420 K=1,L
        DO 420 I=1,IMAX
          HSWC(I,K) = HSWL(I,K)
420     CONTINUE
        RETURN
      END IF
      DO 430 K=1,LP1
      DO 430 I=1,IMAX
        XAMT(I,K) = CAMT(I,K)
        KBTMSW(I,K) = KBTM(I,K)
430   CONTINUE
      DO 440 K=2,KCLDS+1
      DO 440 I=1,IMAX
        IF (CAMT(I,K).GT.ZERO) KBTMSW(I,K) = KBTMSW(I,K) + 1
440   CONTINUE
      DO 445 I=1,IMAX
        IF(NCLDS(I).LE.0) THEN
          CCMAX(I) = ZERO
        ELSE
          CCMAX(I) = ONE
        ENDIF
445   CONTINUE
      DO 450 K=1,KCLDS
        DO 450 I=1,IMAX
          IF(K.LE.NCLDS(I)) THEN
            CCMAX(I) = CCMAX(I) * (ONE - CAMT(I,K+1))
          ENDIF
450   CONTINUE
      DO 455 I=1,IMAX
        IF(NCLDS(I).GT.0) CCMAX(I) = ONE - CCMAX(I)
455   CONTINUE
      DO 460 K=1,KCLDS
        DO 460 I=1,IMAX
          IF(K.LE.NCLDS(I) .AND. CCMAX(I).GT.ZERO) THEN
            XAMT(I,K+1) = CAMT(I,K+1)/CCMAX(I)
          ENDIF
460   CONTINUE
C     DO 470 I=1,IMAX
C       NNCLDS   = NCLDS(I)
C       CCMAX(I) = ZERO
C       IF (NNCLDS .LE. 0) GO TO 470
C       DO 450 K=1,NNCLDS
C         CCMAX(I) = CCMAX(I) * (ONE - CAMT(I,K+1))
C450    CONTINUE
C       CCMAX(I) = ONE - CCMAX(I)
C       IF (CCMAX(I) .GT. ZERO) THEN
C         DO 460 K=1,NNCLDS
C           XAMT(I,K+1) = CAMT(I,K+1)/CCMAX(I)
C460      CONTINUE
C       END IF
C470  CONTINUE
      DO 480 K=1,LP1
      DO 480 I=1,IMAX
        FF   (I,K) = DIFFCTR
        FFCO2(I,K) = DIFFCTR
        FFO3 (I,K) = O3DIFCTR
480   CONTINUE
      DO 490 K=1,MAXKTP
        DO 490 IP=1,IMAX
CDE93     IF(K.LE.KTOPSW(IP,NCLDS(IP)+1)) THEN
          IF(K.LE.KTOP(IP,NCLDS(IP)+1)) THEN
            FF   (IP,K) = SECZ(IP)
            FFCO2(IP,K) = SECZ(IP)
            FFO3 (IP,K) = SECZ(IP)
          ENDIF
490   CONTINUE
C     DO 490 IP=1,IMAX
CDE93   JTOP = KTOPSW(IP,NCLDS(IP)+1)
C       JTOP = KTOP(IP,NCLDS(IP)+1)
C     DO 490 K=1,JTOP
C       FF   (IP,K) = SECZ(IP)
C       FFCO2(IP,K) = SECZ(IP)
C       FFO3 (IP,K) = SECZ(IP)
C490  CONTINUE
      DO 500 I=1,IMAX
        RRAY(I) = HP219/(ONE+HP816*COSZRO(I))
        REFL(I) = RRAY(I) + (ONE-RRAY(I))*(ONE-RRAYAV)*ALVD(I)/
     1            (ONE-ALVD(I)*RRAYAV)
500   CONTINUE
      DO 510 IP=1,IMAX
        UD   (IP,1) = ZERO
        UDCO2(IP,1) = ZERO
        UDO3 (IP,1) = ZERO
510   CONTINUE
      DO 520 K=2,LP1
      DO 520 I=1,IMAX
        UD   (I,K) = UD   (I,K-1)+DU   (I,K-1)*FF   (I,K)
        UDCO2(I,K) = UDCO2(I,K-1)+DUCO2(I,K-1)*FFCO2(I,K)
        UDO3 (I,K) = UDO3 (I,K-1)+DUO3 (I,K-1)*FFO3 (I,K)
520   CONTINUE
      DO 530 IP=1,IMAX
        UR   (IP,LP1) = UD   (IP,LP1)
        URCO2(IP,LP1) = UDCO2(IP,LP1)
        URO3 (IP,LP1) = UDO3 (IP,LP1)
530   CONTINUE
      DO 540 K=L,1,-1
      DO 540 IP=1,IMAX
        UR   (IP,K) = UR   (IP,K+1)+DU   (IP,K)*DIFFCTR
        URCO2(IP,K) = URCO2(IP,K+1)+DUCO2(IP,K)*DIFFCTR
        URO3 (IP,K) = URO3 (IP,K+1)+DUO3 (IP,K)*O3DIFCTR
540   CONTINUE
      DO 550 K=2,LL+1
      DO 550 I=1,IMAX
        TCO2(I,K) = ONE - TWO*(H235M3 * EXP(HP26*LOG(UCO2(I,K)+H129M2))
     1                        -H75826M4)
550   CONTINUE
      DO 560 K=2,LL+1
      DO 560 I=1,IMAX
        TO3(I,K) = ONE - TWO*UO3(I,K)*
     1             (H1P082*EXP(HMP805*LOG(ONE+H1386E2*UO3(I,K)))+
     2             H658M2/(ONE+HTEMP*UO3(I,K)*UO3(I,K)*UO3(I,K))+
     3             H2118M2/(ONE+UO3(I,K)*(H42M2+H323M4*UO3(I,K))))
560   CONTINUE
C********************************************************************
C---THE FIRST CLOUD IS THE GROUND; ITS PROPERTIES ARE GIVEN
C   BY REFL (THE TRANSMISSION (0) IS IRRELEVANT FOR NOW!).
C********************************************************************
      DO 570 I=1,IMAX
        CR(I,1) = REFL(I)
570   CONTINUE
C***OBTAIN CLOUD REFLECTION AND TRANSMISSION COEFFICIENTS FOR
C   REMAINING CLOUDS (IF ANY) IN THE VISIBLE BAND
C---THE MAXIMUM NO OF CLOUDS IN THE ROW (KCLDS) IS USED. THIS CREATES
C   EXTRA WORK (MAY BE REMOVED IN A SUBSEQUENT UPDATE).
      DO 580 KK=2,KCLDS+1
      DO 580 I=1,IMAX
CFE93   CR(I,KK) = CUVRF(I,KK)*XAMT(I,KK)
CFE93   CT(I,KK) = ONE-CR(I,KK)
        CR(I,KK) = CRR(I,1,KK)*XAMT(I,KK)
        CT(I,KK) = ONE - (ONE-CTT(I,1,KK))*XAMT(I,KK)
580   CONTINUE
C---OBTAIN THE PRESSURE AT THE TOP,BOTTOM AND THE THICKNESS OF
C   "THICK" CLOUDS (THOSE AT LEAST 2 LAYERS THICK). THIS IS USED
C   LATER IS OBTAINING FLUXES INSIDE THE THICK CLOUDS, FOR ALL
C   FREQUENCY BANDS.
      DO 590 KK=1,KCLDS
      DO 590 I=1,IMAX
CDE93   IF ((KBTMSW(I,KK+1)-1).GT.KTOPSW(I,KK+1)) THEN
        IF ((KBTM(I,KK+1)).GT.KTOP(I,KK+1)) THEN
CDE93      PPTOP(I,KK)=PP(I,KTOPSW(I,KK+1))
           PPTOP(I,KK)=PP(I,KTOP(I,KK+1))
           DPCLD(I,KK)=ONE/(PPTOP(I,KK)-PP(I,KBTMSW(I,KK+1)))
        ENDIF
590   CONTINUE
      DO 600 K=1,L
      DO 600 I=1,IMAX
        TTDB1(I,K+1) = EXP(HM1EZ*MIN(FIFTY,ABCFF(1)*UD(I,K+1)))
        TTUB1(I,K) = EXP(HM1EZ*MIN(FIFTY,ABCFF(1)*UR(I,K)))
        TTD  (I,K+1) = TTDB1(I,K+1)*TDO3(I,K+1)
        TTU  (I,K) = TTUB1(I,K)*TUO3(I,K)
600   CONTINUE
      DO 610 I=1,IMAX
        TTD(I,1)   = ONE
        TTU(I,LP1) = TTD(I,LP1)
610   CONTINUE
C***FOR EXECUTION OF THE CLOUD LOOP, IT IS NECESSARY TO SEPARATE OUT
C   TRANSMISSION FCTNS AT THE TOP AND BOTTOM OF THE CLOUDS, FOR
C   EACH BAND N. THE REQUIRED QUANTITIES ARE:
C      TTD(I,KTOPSW(I,K),N)  K RUNS FROM 1 TO NCLDS(I)+1:
C      TTU(I,KTOPSW(I,K),N)  K RUNS FROM 1 TO NCLDS(I)+1:
C      TTD(I,KBTMSW(I,K),N)  K RUNS FROM 1 TO NCLDS(I)+1:
C      AND INVERSES OF THE FIRST TWO. THE ABOVE QUANTITIES ARE
C      STORED IN TDCL1,TUCL1,TDCL2, AND DFNTRN,UFNTRN, RESPECTIVELY,
C      AS THEY HAVE MULTIPLE USE IN THE PGM.
C---FOR FIRST CLOUD LAYER (GROUND) TDCL1,TUCL1 ARE KNOWN:
      DO 620 I=1,IMAX
        TDCL1 (I,1) = TTD(I,LP1)
        TUCL1 (I,1) = TTU(I,LP1)
        TDCL2 (I,1) = TDCL1(I,1)
        DFNTRN(I,1) = ONE/TDCL1(I,1)
        UFNTRN(I,1) = DFNTRN(I,1)
620   CONTINUE
      DO 630 KK=2,KCLDS+1
      DO 630 I=1,IMAX
CDE93   TDCL1(I,KK) = TTD(I,KTOPSW(I,KK))
CDE93   TUCL1(I,KK) = TTU(I,KTOPSW(I,KK))
        TDCL1(I,KK) = TTD(I,KTOP(I,KK))
        TUCL1(I,KK) = TTU(I,KTOP(I,KK))
        TDCL2(I,KK) = TTD(I,KBTMSW(I,KK))
630   CONTINUE
C---COMPUTE INVERSES
      DO 640 K=1,KCLDS
      DO 640 I=1,IMAX
        DFNTRN(I,K+1) = ONE/TDCL1(I,K+1)
        UFNTRN(I,K+1) = ONE/TUCL1(I,K+1)
640   CONTINUE
C---COMPUTE THE TRANSMISSIVITY FROM THE TOP OF CLOUD (K+1) TO THE
C   TOP OF CLOUD (K). THE CLOUD TRANSMISSION (CT) IS INCLUDED. THIS
C   QUANTITY IS CALLED TCLU (INDEX K). ALSO, OBTAIN THE TRANSMISSIVITY
C   FROM THE BOTTOM OF CLOUD (K+1) TO THE TOP OF CLOUD (K)(A PATH
C   ENTIRELY OUTSIDE CLOUDS). THIS QUANTITY IS CALLED TCLD (INDEX K).
      DO 650 K=1,KCLDS
      DO 650 I=1,IMAX
        TCLU(I,K) = TDCL1(I,K)*DFNTRN(I,K+1)*CT(I,K+1)
        TCLD(I,K) = TDCL1(I,K)/TDCL2(I,K+1)
650   CONTINUE
C***THE FOLLOWING IS THE RECURSION RELATION FOR ALFA: THE REFLECTION
C   COEFFICIENT FOR A SYSTEM INCLUDING THE CLOUD IN QUESTION AND THE
C   FLUX COMING OUT OF THE CLOUD SYSTEM INCLUDING ALL CLOUDS BELOW
C   THE CLOUD IN QUESTION.
C---ALFAU IS ALFA WITHOUT THE REFLECTION OF THE CLOUD IN QUESTION
      DO 660 I=1,IMAX
        ALFA (I,1)=CR(I,1)
        ALFAU(I,1)=ZERO
660   CONTINUE
C---AGAIN,EXCESSIVE CALCULATIONS-MAY BE CHANGED LATER!
      DO 670 KK=2,KCLDS+1
      DO 670 I=1,IMAX
        ALFAU(I,KK)= TCLU(I,KK-1)*TCLU(I,KK-1)*ALFA(I,KK-1)/
     1        (ONE - TCLD(I,KK-1)*TCLD(I,KK-1)*ALFA(I,KK-1)*CR(I,KK))
        ALFA (I,KK)= ALFAU(I,KK)+CR(I,KK)
670   CONTINUE
C     CALCULATE UFN AT CLOUD TOPS AND DFN AT CLOUD BOTTOMS
C---NOTE THAT UFNCLU(I,KCLDS+1) GIVES THE UPWARD FLUX AT THE TOP
C   OF THE HIGHEST REAL CLOUD (IF NCLDS(I)=KCLDS). IT GIVES THE FLUX
C   AT THE TOP OF THE ATMOSPHERE IF NCLDS(I) < KCLDS. IN THE FIRST
C   CASE, TDCL1 EQUALS THE TRANSMISSION FCTN TO THE TOP OF THE
C   HIGHEST CLOUD, AS WE WANT. IN THE SECOND CASE, TDCL1=1, SO UFNCLU
C   EQUALS ALFA. THIS IS ALSO CORRECT.
CKZ   DO 680 I=1,IMAX
      DO 680 KK=KCLDS,1,-1
      DO 680 I=1,IMAX
        IF(KK.GE.NCLDS(I)) THEN
          UFNCLU(I,KK+1) = ALFA(I,KK+1)*TDCL1(I,KK+1)
          DFNCLU(I,KK+1) = TDCL1(I,KK+1)
        END IF
680   CONTINUE
C---THIS CALCULATION IS THE REVERSE OF THE RECURSION RELATION USED
C  ABOVE
CKZ   DO 690 KK=KCLDS,1,-1
      DO 690 KK=KCLDS,2,-1
      DO 690 I=1,IMAX
        IF(KK.LE.NCLDS(I)) THEN
          UFNCLU(I,KK) = UFNCLU(I,KK+1)*ALFAU(I,KK+1)/(ALFA(I,KK+1)*
     1                   TCLU(I,KK))
          DFNCLU(I,KK) = UFNCLU(I,KK)/ALFA(I,KK)
        END IF
690   CONTINUE
CKZ
      DO 695 I=1,IMAX
        UFNCLU(I,1) = UFNCLU(I,2)*ALFAU(I,2)/(ALFA(I,2)*TCLU(I,1))
        DFNCLU(I,1) = UFNCLU(I,1)/ALFA(I,1)
695   CONTINUE
      DO 700 K=1,KCLDS+1
      DO 700 I=1,IMAX
        UFNTRN(I,K) = UFNCLU(I,K)*UFNTRN(I,K)
        DFNTRN(I,K) = DFNCLU(I,K)*DFNTRN(I,K)
700   CONTINUE
C---CASE OF KK=1( FROM THE GROUND TO THE BOTTOM OF THE LOWEST CLOUD)
      MNKBOT = KBTMSW(1,2)
      DO 710 I=2,IMAX
        MNKBOT = MIN(KBTMSW(I,2),MNKBOT)
710   CONTINUE
      DO 720 K=MNKBOT,LP1
        DO 720 I=1,IMAX
          LSAVE0(I,K) = K.GE.KBTMSW(I,2)
          IF(LSAVE0(I,K)) THEN
            UFN(I,K) = UFNTRN(I,1)*TTU(I,K)
            DFN(I,K) = DFNTRN(I,1)*TTD(I,K)
          ENDIF
720   CONTINUE
C     DO 720 I=1,IMAX
C       J2=KBTMSW(I,2)
C       DO 710 K=J2,LP1
C         UFN(I,K) = UFNTRN(I,1)*TTU(I,K)
C         DFN(I,K) = DFNTRN(I,1)*TTD(I,K)
C710    CONTINUE
C720  CONTINUE
C---REMAINING LEVELS (IF ANY!)
      DO 760 KK=2,KCLDS+1
CDE93   MXKTOP(KK) = KTOPSW(1,KK)
        MXKTOP(KK) = KTOP(1,KK)
        MNKBTM(KK+1) = KBTMSW(1,KK+1)
CDE93   MNKTOP(KK) = KTOPSW(1,KK)
        MNKTOP(KK) = KTOP(1,KK)
        MXKBTM(KK) = KBTMSW(1,KK)
        DO 725 I=2,IMAX
CDE93     MXKTOP(KK) = MAX(KTOPSW(I,KK),MXKTOP(KK))
          MXKTOP(KK) = MAX(KTOP(I,KK),MXKTOP(KK))
          MNKBTM(KK+1) = MIN(KBTMSW(I,KK+1),MNKBTM(KK+1))
CDE93     MNKTOP(KK) = MIN(KTOPSW(I,KK),MNKTOP(KK))
          MNKTOP(KK) = MIN(KTOP(I,KK),MNKTOP(KK))
          MXKBTM(KK) = MAX(KBTMSW(I,KK),MXKBTM(KK))
725     CONTINUE
        DO 730 I=1,IMAX
CDE93     LSAVE(I) = KTOPSW(I,KK).GT.1
          LSAVE(I) = KTOP(I,KK).GT.1
730     CONTINUE
        DO 740 K=MNKBTM(KK+1),MXKTOP(KK)
          DO 740 I=1,IMAX
            LSAVE1(I,K,KK) = K.GE.KBTMSW(I,KK+1) .AND.
     1                       K.LE.KTOP(I,KK) .AND. LSAVE(I)
CDE931                       K.LE.KTOPSW(I,KK) .AND. LSAVE(I)
            IF(LSAVE1(I,K,KK)) THEN
              UFN(I,K) = UFNTRN(I,KK)*TTU(I,K)
              DFN(I,K) = DFNTRN(I,KK)*TTD(I,K)
            ENDIF
740     CONTINUE
C---FOR THE THICK CLOUDS, THE FLUX DIVERGENCE THROUGH THE CLOUD
C   LAYER IS ASSUMED TO BE CONSTANT. THE FLUX DERIVATIVE IS GIVEN BY
C   TEMPF (FOR THE UPWARD FLUX) AND TEMPG (FOR THE DOWNWARD FLUX).
        DO 745 I=1,IMAX
          IF ((KBTM(I,KK)).GT.KTOP(I,KK)) THEN
            TEMPF(I) = (UFNCLU(I,KK)-UFN(I,KBTMSW(I,KK)))*DPCLD(I,KK-1)
            TEMPG(I) = (DFNCLU(I,KK)-DFN(I,KBTMSW(I,KK)))*DPCLD(I,KK-1)
          ENDIF
745     CONTINUE
        DO 750 K=MNKTOP(KK)+1,MXKBTM(KK)-1
          DO 750 I=1,IMAX
CDE93       LSAVE2(I,K,KK) = K.GT.KTOPSW(I,KK) .AND.
            LSAVE2(I,K,KK) = K.GT.KTOP(I,KK) .AND.
     1                       K.LT.KBTMSW(I,KK) .AND. LSAVE(I)
            IF(LSAVE2(I,K,KK)) THEN
              UFN(I,K) = UFNCLU(I,KK)+TEMPF(I)*(PP(I,K)-PPTOP(I,KK-1))
              DFN(I,K) = DFNCLU(I,KK)+TEMPG(I)*(PP(I,K)-PPTOP(I,KK-1))
            ENDIF
750     CONTINUE
760   CONTINUE
C     DO 760 KK=2,KCLDS+1
C     DO 755 I=1,IMAX
CDE93   J1=KTOPSW(I,KK)
C       J1=KTOP(I,KK)
C       J2=KBTMSW(I,KK+1)
C       IF (J1.EQ.1) GO TO 755
C       DO 730 K=J2,J1
C         UFN(I,K) = UFNTRN(I,KK)*TTU(I,K)
C         DFN(I,K) = DFNTRN(I,KK)*TTD(I,K)
C730    CONTINUE
C---FOR THE THICK CLOUDS, THE FLUX DIVERGENCE THROUGH THE CLOUD
C   LAYER IS ASSUMED TO BE CONSTANT. THE FLUX DERIVATIVE IS GIVEN BY
C   TEMPF (FOR THE UPWARD FLUX) AND TEMPG (FOR THE DOWNWARD FLUX).
C       J3=KBTMSW(I,KK)
C       IF ((J3-J1).GT.1) THEN
C         TEMPF = (UFNCLU(I,KK)-UFN(I,J3))*DPCLD(I,KK-1)
C         TEMPG = (DFNCLU(I,KK)-DFN(I,J3))*DPCLD(I,KK-1)
C         DO 740 K=J1+1,J3-1
C           UFN(I,K) = UFNCLU(I,KK)+TEMPF*(PP(I,K)-PPTOP(I,KK-1))
C           DFN(I,K) = DFNCLU(I,KK)+TEMPG*(PP(I,K)-PPTOP(I,KK-1))
C740      CONTINUE
C       ENDIF
C755  CONTINUE
C760  CONTINUE
      DO 770 K=1,LP1
      DO 770 I=1,IMAX
        DFSWC(I,K) = DFN(I,K)*DFNTOP(I,1)
        UFSWC(I,K) = UFN(I,K)*DFNTOP(I,1)
770   CONTINUE
      DO 780 I=1,IMAX
        TEMP1(I) = ONE - CCMAX(I)
        GDFVB(I) = TEMP1(I)*GDFVB(I)
        GDFNB(I) = TEMP1(I)*GDFNB(I)
        GDFVD(I) = TEMP1(I)*GDFVD(I) + CCMAX(I)*DFSWC(I,LP1)
780   CONTINUE
C---NOW OBTAIN FLUXES FOR THE NEAR IR BANDS. THE METHODS ARE THE SAME
C   AS FOR THE VISIBLE BAND, EXCEPT THAT THE REFLECTION AND
C   TRANSMISSION COEFFICIENTS ARE DIFFERENT, AS
C   RAYLEIGH SCATTERING NEED NOT BE CONSIDERED.
CFE93 DO 790 I=1,IMAX*(KCLDS+1)
CFE93   CR(I,1) = CIRRF(I,1)*XAMT(I,1)
CFE93   CT(I,1) = ONE-XAMT(I,1)*(CIRRF(I,1)+CIRAB(I,1))
C90   CONTINUE
C
      DO 1000 N=2,NB
CFE93
        DO 790 K=1,KCLDS+1
        DO 790 I=1,IMAX
          CR(I,K) = CRR(I,N,K)*XAMT(I,K)
          CT(I,K) = ONE - (ONE-CTT(I,N,K))*XAMT(I,K)
790     CONTINUE
CFE93
        IF (N.EQ.2) THEN
C   THE WATER VAPOR TRANSMISSION FUNCTION FOR BAND 2 IS EQUAL TO
C   THAT OF BAND 1 (SAVED AS TTDB1,TTUB1)
          DO 800 K=1,L
          DO 800 I=1,IMAX
            TTD(I,K+1) = TTDB1(I,K+1)*TDCO2(I,K+1)
            TTU(I,K) = TTUB1(I,K)*TUCO2(I,K)
800       CONTINUE
        ELSE
          DO 810 K=1,L
          DO 810 I=1,IMAX
            TTD(I,K+1) = EXP(HM1EZ*MIN(FIFTY,ABCFF(N)*UD(I,K+1)))
     1               * TDCO2(I,K+1)
            TTU(I,K) = EXP(HM1EZ*MIN(FIFTY,ABCFF(N)*UR(I,K)))
     1               * TUCO2(I,K)
810       CONTINUE
        ENDIF
C---AT THIS POINT,INCLUDE TTD(1),TTU(LP1), NOTING THAT TTD(1)=1 FOR
C   ALL BANDS, AND THAT TTU(LP1)=TTD(LP1) FOR ALL BANDS.
        DO 820 I=1,IMAX
          TTU(I,LP1) = TTD(I,LP1)
          TTD(I,1)   = ONE
820     CONTINUE
C***FOR EXECUTION OF THE CLOUD LOOP, IT IS NECESSARY TO SEPARATE OUT
C   TRANSMISSION FCTNS AT THE TOP AND BOTTOM OF THE CLOUDS, FOR
C   EACH BAND N. THE REQUIRED QUANTITIES ARE:
C      TTD(I,KTOPSW(I,K),N)  K RUNS FROM 1 TO NCLDS(I)+1:
C      TTD(I,KBTMSW(I,K),N)  K RUNS FROM 2 TO NCLDS(I)+1:
C      TTU(I,KTOPSW(I,K),N)  K RUNS FROM 1 TO NCLDS(I)+1:
C      AND INVERSES OF THE ABOVE. THE ABOVE QUANTITIES ARE STORED
C      IN TDCL1,TDCL2,TUCL1,AND DFNTRN,UFNTRN,RESPECTIVELY, AS
C      THEY HAVE MULTIPLE USE IN THE PGM.
C---FOR FIRST CLOUD LAYER (GROUND) TDCL1,TUCL1 ARE KNOWN:
        DO 830 I=1,IMAX
          TDCL1 (I,1) = TTD(I,LP1)
          TUCL1 (I,1) = TTU(I,LP1)
          TDCL2 (I,1) = TDCL1(I,1)
          DFNTRN(I,1) = ONE/TDCL1(I,1)
          UFNTRN(I,1) = DFNTRN(I,1)
830     CONTINUE
        DO 840 KK=2,KCLDS+1
        DO 840 I=1,IMAX
CDE93     TDCL1(I,KK) = TTD(I,KTOPSW(I,KK))
CDE93     TUCL1(I,KK) = TTU(I,KTOPSW(I,KK))
          TDCL1(I,KK) = TTD(I,KTOP(I,KK))
          TUCL1(I,KK) = TTU(I,KTOP(I,KK))
          TDCL2(I,KK) = TTD(I,KBTMSW(I,KK))
840     CONTINUE
        DO 850 K=1,KCLDS
        DO 850 I=1,IMAX
          DFNTRN(I,K+1) = ONE/TDCL1(I,K+1)
          UFNTRN(I,K+1) = ONE/TUCL1(I,K+1)
850     CONTINUE
        DO 860 K=1,KCLDS
        DO 860 I=1,IMAX
          TCLU(I,K) = TDCL1(I,K)*DFNTRN(I,K+1)*CT(I,K+1)
          TCLD(I,K) = TDCL1(I,K)/TDCL2(I,K+1)
860     CONTINUE
C***THE FOLLOWING IS THE RECURSION RELATION FOR ALFA: THE REFLECTION
C   COEFFICIENT FOR A SYSTEM INCLUDING THE CLOUD IN QUESTION AND THE
C   FLUX COMING OUT OF THE CLOUD SYSTEM INCLUDING ALL CLOUDS BELOW
C   THE CLOUD IN QUESTION.
        DO 870 I=1,IMAX
          ALFA (I,1) = CR(I,1)
          ALFAU(I,1) = ZERO
870     CONTINUE
C---AGAIN,EXCESSIVE CALCULATIONS-MAY BE CHANGED LATER!
        DO 880 KK=2,KCLDS+1
        DO 880 I=1,IMAX
          ALFAU(I,KK) = TCLU(I,KK-1)*TCLU(I,KK-1)*ALFA(I,KK-1)/(ONE -
     1             TCLD(I,KK-1)*TCLD(I,KK-1)*ALFA(I,KK-1)*CR(I,KK))
          ALFA (I,KK) = ALFAU(I,KK)+CR(I,KK)
880     CONTINUE
C     CALCULATE UFN AT CLOUD TOPS AND DFN AT CLOUD BOTTOMS
C---NOTE THAT UFNCLU(I,KCLDS+1) GIVES THE UPWARD FLUX AT THE TOP
C   OF THE HIGHEST REAL CLOUD (IF NCLDS(I)=KCLDS). IT GIVES THE FLUX
C   AT THE TOP OF THE ATMOSPHERE IF NCLDS(I) < KCLDS. IT THE FIRST
C   CASE, TDCL1 EQUALS THE TRANSMISSION FCTN TO THE TOP OF THE
C   HIGHEST CLOUD, AS WE WANT. IN THE SECOND CASE, TDCL1=1, SO UFNCLU
C   EQUALS ALFA. THIS IS ALSO CORRECT.
CKZ     DO 890 I=1,IMAX
        DO 890 KK=KCLDS,1,-1
        DO 890 I=1,IMAX
          IF(KK.GE.NCLDS(I)) THEN
            UFNCLU(I,KK+1) = ALFA(I,KK+1)*TDCL1(I,KK+1)
            DFNCLU(I,KK+1) = TDCL1(I,KK+1)
          END IF
890     CONTINUE
CKZ     DO 900 KK=KCLDS,1,-1
        DO 900 KK=KCLDS,2,-1
        DO 900 I=1,IMAX
          IF(KK.LE.NCLDS(I)) THEN
            UFNCLU(I,KK) = UFNCLU(I,KK+1)*ALFAU(I,KK+1)/(ALFA(I,KK+1)*
     1                     TCLU(I,KK))
            DFNCLU(I,KK) = UFNCLU(I,KK)/ALFA(I,KK)
          END IF
900     CONTINUE
CKZ
        DO 905 I=1,IMAX
          UFNCLU(I,1) = UFNCLU(I,2)*ALFAU(I,2)/(ALFA(I,2)*TCLU(I,1))
          DFNCLU(I,1) = UFNCLU(I,1)/ALFA(I,1)
905     CONTINUE
C     NOW OBTAIN DFN AND UFN FOR LEVELS BETWEEN THE CLOUDS
C
C     NOTE THAT MNKBOT, MNKBTM, MXKTOP, MNKTOP, MXKBTM, LSAVE1, AND
C     LSAVE2 WERE ALL SAVED WHEN CALCULATED FOR BAND NO. 1 !
C     THEY DO NOT CHANGE HERE FOR THE CALCULATION OF BANDS 2-12 !
C
        DO 910 K=1,KCLDS+1
        DO 910 I=1,IMAX
          UFNTRN(I,K) = UFNCLU(I,K)*UFNTRN(I,K)
          DFNTRN(I,K) = DFNCLU(I,K)*DFNTRN(I,K)
910     CONTINUE
        DO 930 K=MNKBOT,LP1
          DO 930 I=1,IMAX
            IF(LSAVE0(I,K)) THEN
              UFN(I,K) = UFNTRN(I,1)*TTU(I,K)
              DFN(I,K) = DFNTRN(I,1)*TTD(I,K)
            ENDIF
930     CONTINUE
C       DO 930 I=1,IMAX
C         J2 = KBTMSW(I,2)
C         DO 920 K=J2,LP1
C           UFN(I,K) = UFNTRN(I,1)*TTU(I,K)
C           DFN(I,K) = DFNTRN(I,1)*TTD(I,K)
C920      CONTINUE
C930    CONTINUE
        DO 970 KK=2,KCLDS+1
          DO 940 K=MNKBTM(KK+1),MXKTOP(KK)
            DO 940 I=1,IMAX
              IF(LSAVE1(I,K,KK)) THEN
                UFN(I,K) = UFNTRN(I,KK)*TTU(I,K)
                DFN(I,K) = DFNTRN(I,KK)*TTD(I,K)
              ENDIF
940       CONTINUE
          DO 950 I=1,IMAX
            IF ((KBTM(I,KK)).GT.KTOP(I,KK)) THEN
              TEMPF(I)=(UFNCLU(I,KK)-UFN(I,KBTMSW(I,KK)))*DPCLD(I,KK-1)
              TEMPG(I)=(DFNCLU(I,KK)-DFN(I,KBTMSW(I,KK)))*DPCLD(I,KK-1)
            ENDIF
950       CONTINUE
          DO 960 K=MNKTOP(KK)+1,MXKBTM(KK)-1
            DO 960 I=1,IMAX
              IF(LSAVE2(I,K,KK)) THEN
                UFN(I,K) = UFNCLU(I,KK)+TEMPF(I)*(PP(I,K)-PPTOP(I,KK-1))
                DFN(I,K) = DFNCLU(I,KK)+TEMPG(I)*(PP(I,K)-PPTOP(I,KK-1))
              ENDIF
960       CONTINUE
970     CONTINUE
C       DO 970 KK=2,KCLDS+1
C       DO 965 I=1,IMAX
CDE93     J1 = KTOPSW(I,KK)
C         J1 = KTOP(I,KK)
C         J2 = KBTMSW(I,KK+1)
C         IF (J1.EQ.1) GO TO 965
C         DO 940 K=J2,J1
C           UFN(I,K) = UFNTRN(I,KK)*TTU(I,K)
C           DFN(I,K) = DFNTRN(I,KK)*TTD(I,K)
C940      CONTINUE
C         J3 = KBTMSW(I,KK)
C         IF ((J3-J1).GT.1) THEN
C           TEMPF = (UFNCLU(I,KK)-UFN(I,J3))*DPCLD(I,KK-1)
C           TEMPG = (DFNCLU(I,KK)-DFN(I,J3))*DPCLD(I,KK-1)
C           DO 950 K=J1+1,J3-1
C             UFN(I,K) = UFNCLU(I,KK)+TEMPF*(PP(I,K)-PPTOP(I,KK-1))
C             DFN(I,K) = DFNCLU(I,KK)+TEMPG*(PP(I,K)-PPTOP(I,KK-1))
C950        CONTINUE
C         ENDIF
C965    CONTINUE
C970    CONTINUE
        DO 980 K=1,LP1
        DO 980 I=1,IMAX
          DFSWC(I,K) = DFSWC(I,K) + DFN(I,K)*DFNTOP(I,N)
          UFSWC(I,K) = UFSWC(I,K) + UFN(I,K)*DFNTOP(I,N)
980     CONTINUE
        DO 990 I=1,IMAX
          GDFND(I) = GDFND(I) + CCMAX(I)*DFN(I,LP1)*DFNTOP(I,N)
990     CONTINUE
1000  CONTINUE
      DO 1100 K=1,LP1
      DO 1100 I=1,IMAX
        DFSWC(I,K) = TEMP1(I)*DFSWL(I,K) + CCMAX(I)*DFSWC(I,K)
        UFSWC(I,K) = TEMP1(I)*UFSWL(I,K) + CCMAX(I)*UFSWC(I,K)
1100  CONTINUE
      DO 1200 K=1,LP1
      DO 1200 I=1,IMAX
        FSWC(I,K) = UFSWC(I,K)-DFSWC(I,K)
1200  CONTINUE
      DO 1250 K=1,L
      DO 1250 I=1,IMAX
        HSWC(I,K) = RADCON*(FSWC(I,K+1)-FSWC(I,K))/DP(I,K)
1250  CONTINUE
      RETURN
      END
      SUBROUTINE TABLE
CFPP$ NOCONCUR R
C     SUBROUTINE TABLE COMPUTES TABLE ENTRIES USED IN THE LONGWAVE RADIA
C     PROGRAM. ALSO CALCULATED ARE INDICES USED IN STRIP-MINING AND FOR
C     SOME PRE-COMPUTABLE FUNCTIONS.
C         INPUTS:
C         OUTPUTS:
C       EM1,EM1WDE,TABLE1,TABLE2,TABLE3         TABCOM
C       EM3,SOURCE,DSRCE,IND,INDX2,KMAXV        TABCOM
C       KMAXVM,                                 TABCOM
C       AO3RND,BO3RND,AB15                      BANDTA
C       AB15WD,SKC1R,SKO3R,SKO2D                BDWIDE
C
 %INCLUDE HCON    ;
 %INCLUDE RDPARM  ;
 %INCLUDE RNDDTA  ;
 %INCLUDE TABCOM  ;
C
      DIMENSION SUM(28,180),PERTSM(28,180),SUM3(28,180),
     1 SUMWDE(28,180),SRCWD(28,NBLX),SRC1NB(28,NBLW),DBDTNB(28,NBLW)
      DIMENSION ZMASS(181),ZROOT(181),SC(28),DSC(28),XTEMV(28),
     1 TFOUR(28),FORTCU(28),X(28),X1(28),X2(180),SRCS(28),
     2 SUM4(28),SUM6(28),SUM7(28),SUM8(28),SUM4WD(28),
     3 R1(28),R2(28),S2(28),T3(28),R1WD(28)
      DIMENSION EXPO(180),FAC(180)
      DIMENSION CNUSB(30),DNUSB(30)
      DIMENSION ALFANB(NBLW),AROTNB(NBLW)
      DIMENSION ANB(NBLW),BNB(NBLW),CENTNB(NBLW),DELNB(NBLW),
     1          BETANB(NBLW)
      COMMON/TBLTMP/ DELCM(NBLY)
C****************************************
C***COMPUTE LOCAL QUANTITIES AND AO3,BO3,AB15
C....FOR NARROW-BANDS...
      DO 101 N=1,NBLW
      ANB(N)=ARNDM(N)
      BNB(N)=BRNDM(N)
      CENTNB(N)=HAF*(BANDLO(N)+BANDHI(N))
      DELNB(N)=BANDHI(N)-BANDLO(N)
      BETANB(N)=BETAD(N)
101   CONTINUE
      AB15(1)=ANB(57)*BNB(57)
      AB15(2)=ANB(58)*BNB(58)
C....FOR WIDE BANDS...
      AB15WD=AWIDE*BWIDE
C
C***COMPUTE INDICES: IND,INDX2,KMAXV
      DO 111 I=1,IMAX
      IND(I)=I
111   CONTINUE
      ICNT=0
      DO 113 I1=1,L
        I2E=LP1-I1
        DO 115 I2=1,I2E
          ICNT=ICNT+1
          INDX2(ICNT)=LP1*(I2-1)+LP2*I1
115     CONTINUE
113   CONTINUE
      KMAXV(1)=1
      DO 117 I=2,L
      KMAXV(I)=KMAXV(I-1)+(LP2-I)
117   CONTINUE
      KMAXVM=KMAXV(L)
C***COMPUTE RATIOS OF CONT. COEFFS
      SKC1R=BETAWD/BETINW
      SKO3R=BETAD(61)/BETINW
      SKO2D=ONE/BETINW
C
C****BEGIN TABLE COMPUTATIONS HERE***
C***COMPUTE TEMPS, MASSES FOR TABLE ENTRIES
C---NOTE: THE DIMENSIONING AND INITIALIZATION OF XTEMV AND OTHER ARRAYS
C   WITH DIMENSION OF 28 IMPLY A RESTRICTION OF MODEL TEMPERATURES FROM
C   100K TO 370K.
C---THE DIMENSIONING OF ZMASS,ZROOT AND OTHER ARRAYS WITH DIMENSION OF
C   180 IMPLY A RESTRICTION OF MODEL H2O AMOUNTS SUCH THAT OPTICAL PATHS
C   ARE BETWEEN 10**-16 AND 10**2, IN CGS UNITS.
      ZMASS(1)=H1M16
      DO 201 J=1,180
      JP=J+1
      ZROOT(J)=SQRT(ZMASS(J))
      ZMASS(JP)=ZMASS(J)*H1P25892
201   CONTINUE
      DO 203 I=1,28
      XTEMV(I)=HNINETY+TEN*I
      TFOUR(I)=XTEMV(I)*XTEMV(I)*XTEMV(I)*XTEMV(I)
      FORTCU(I)=FOUR*XTEMV(I)*XTEMV(I)*XTEMV(I)
203   CONTINUE
C******THE COMPUTATION OF SOURCE,DSRCE IS  NEEDED ONLY
C   FOR THE COMBINED WIDE-BAND CASE.TO OBTAIN THEM,THE SOURCE
C   MUST BE COMPUTED FOR EACH OF THE (NBLX) WIDE BANDS(=SRCWD)
C   THEN COMBINED (USING IBAND) INTO SOURCE.
      DO 205 N=1,NBLY
      DO 205 I=1,28
      SOURCE(I,N)=ZERO
205   CONTINUE
      DO 207 N=1,NBLX
      DO 207 I=1,28
      SRCWD(I,N)=ZERO
207   CONTINUE
C---BEGIN FREQ. LOOP (ON N)
      DO 211 N=1,NBLX
        IF (N.LE.46) THEN
C***THE 160-1200 BAND CASES
          CENT=CENTNB(N+16)
          DEL=DELNB(N+16)
          BDLO=BANDLO(N+16)
          BDHI=BANDHI(N+16)
        ENDIF
        IF (N.EQ.NBLX) THEN
C***THE 2270-2380 BAND CASE
          CENT=CENTNB(NBLW)
          DEL=DELNB(NBLW)
          BDLO=BANDLO(NBLW)
          BDHI=BANDHI(NBLW)
        ENDIF
C***FOR PURPOSES OF ACCURACY, ALL EVALUATIONS OF PLANCK FCTNS ARE MADE
C  ON 10 CM-1 INTERVALS, THEN SUMMED INTO THE (NBLX) WIDE BANDS.
      NSUBDS=(DEL-H1M3)/10+1
      DO 213 NSB=1,NSUBDS
      IF (NSB.NE.NSUBDS) THEN
        CNUSB(NSB)=TEN*(NSB-1)+BDLO+FIVE
        DNUSB(NSB)=TEN
      ELSE
        CNUSB(NSB)=HAF*(TEN*(NSB-1)+BDLO+BDHI)
        DNUSB(NSB)=BDHI-(TEN*(NSB-1)+BDLO)
      ENDIF
      C1=(H37412M5)*CNUSB(NSB)**3
C---BEGIN TEMP. LOOP (ON I)
      DO 215 I=1,28
      X(I)=H1P4387*CNUSB(NSB)/XTEMV(I)
      X1(I)=EXP(X(I))
      SRCS(I)=C1/(X1(I)-ONE)
      SRCWD(I,N)=SRCWD(I,N)+SRCS(I)*DNUSB(NSB)
215   CONTINUE
213   CONTINUE
211   CONTINUE
C***THE FOLLOWING LOOPS CREATE THE COMBINED WIDE BAND QUANTITIES SOURCE
C   AND DSRCE
      DO 221 N=1,40
      DO 221 I=1,28
      SOURCE(I,IBAND(N))=SOURCE(I,IBAND(N))+SRCWD(I,N)
221   CONTINUE
      DO 223 N=9,NBLY
      DO 223 I=1,28
      SOURCE(I,N)=SRCWD(I,N+32)
223   CONTINUE
      DO 225 N=1,NBLY
      DO 225 I=1,27
      DSRCE(I,N)=(SOURCE(I+1,N)-SOURCE(I,N))*HP1
225   CONTINUE
      DO 231 N=1,NBLW
      ALFANB(N)=BNB(N)*ANB(N)
      AROTNB(N)=SQRT(ALFANB(N))
231   CONTINUE
C***FIRST COMPUTE PLANCK FCTNS (SRC1NB) AND DERIVATIVES (DBDTNB) FOR
C   USE IN TABLE EVALUATIONS. THESE ARE DIFFERENT FROM SOURCE,DSRCE
C   BECAUSE DIFFERENT FREQUENCY PTS ARE USED IN EVALUATION, THE FREQ.
C   RANGES ARE DIFFERENT, AND THE DERIVATIVE ALGORITHM IS DIFFERENT.
C
      DO 301 N=1,NBLW
      CENT=CENTNB(N)
      DEL=DELNB(N)
C---NOTE: AT PRESENT, THE IA LOOP IS ONLY USED FOR IA=2. THE LOOP STRUCT
C   IS KEPT SO THAT IN THE FUTURE, WE MAY USE A QUADRATURE SCHEME FOR
C   THE PLANCK FCTN EVALUATION, RATHER THAN USE THE MID-BAND FREQUENCY.
      DO 303 IA=1,3
      ANU=CENT+HAF*(IA-2)*DEL
      C1=(H37412M5)*ANU*ANU*ANU+H1M20
C---TEMPERATURE LOOP---
      DO 305 I=1,28
         X(I)=H1P4387*ANU/XTEMV(I)
         X1(I)=EXP(X(I))
         SC(I)=C1/((X1(I)-ONE)+H1M20)
         DSC(I)=SC(I)*SC(I)*X(I)*X1(I)/(XTEMV(I)*C1)
305      CONTINUE
      IF (IA.EQ.2) THEN
         DO 307 I=1,28
         SRC1NB(I,N)=DEL*SC(I)
         DBDTNB(I,N)=DEL*DSC(I)
307      CONTINUE
      ENDIF
303   CONTINUE
301   CONTINUE
C***NEXT COMPUTE R1,R2,S2,AND T3- COEFFICIENTS USED FOR E3 FUNCTION
C   WHEN THE OPTICAL PATH IS LESS THAN 10-4. IN THIS CASE, WE ASSUME A
C   DIFFERENT DEPENDENCE ON (ZMASS).
C---ALSO OBTAIN R1WD, WHICH IS R1 SUMMED OVER THE 160-560 CM-1 RANGE
      DO 311 I=1,28
      SUM4(I)=ZERO
      SUM6(I)=ZERO
      SUM7(I)=ZERO
      SUM8(I)=ZERO
      SUM4WD(I)=ZERO
311   CONTINUE
      DO 313 N=1,NBLW
      CENT=CENTNB(N)
C***PERFORM SUMMATIONS FOR FREQ. RANGES OF 0-560,1200-2200 CM-1 FOR SUM4
C   SUM6,SUM7,SUM8
      IF (CENT.LT.560. .OR. CENT.GT.1200..AND.CENT.LE.2200.) THEN
         DO 315 I=1,28
         SUM4(I)=SUM4(I)+SRC1NB(I,N)
         SUM6(I)=SUM6(I)+DBDTNB(I,N)
         SUM7(I)=SUM7(I)+DBDTNB(I,N)*AROTNB(N)
         SUM8(I)=SUM8(I)+DBDTNB(I,N)*ALFANB(N)
315      CONTINUE
      ENDIF
C***PERFORM SUMMATIONS OVER 160-560 CM-1 FREQ RANGE FOR E1 CALCS (SUM4WD
      IF (CENT.GT.160. .AND. CENT.LT.560.) THEN
         DO 316 I=1,28
         SUM4WD(I)=SUM4WD(I)+SRC1NB(I,N)
316      CONTINUE
      ENDIF
313   CONTINUE
      DO 317 I=1,28
      R1(I)=SUM4(I)/TFOUR(I)
      R2(I)=SUM6(I)/FORTCU(I)
      S2(I)=SUM7(I)/FORTCU(I)
      T3(I)=SUM8(I)/FORTCU(I)
      R1WD(I)=SUM4WD(I)/TFOUR(I)
317   CONTINUE
      DO 401 J=1,180
      DO 401 I=1,28
      SUM(I,J)=ZERO
      PERTSM(I,J)=ZERO
      SUM3(I,J)=ZERO
      SUMWDE(I,J)=ZERO
401   CONTINUE
C---FREQUENCY LOOP BEGINS---
      DO 411 N=1,NBLW
      CENT=CENTNB(N)
C***PERFORM CALCULATIONS FOR FREQ. RANGES OF 0-560,1200-2200 CM-1
      IF (CENT.LT.560. .OR. CENT.GT.1200..AND.CENT.LE.2200.) THEN
         DO 413 J=1,180
         X2(J)=AROTNB(N)*ZROOT(J)
         EXPO(J)=EXP(-X2(J))
413      CONTINUE
         DO 415 J=1,180
         IF (X2(J).GE.HUNDRED) THEN
              EXPO(J)=ZERO
         ENDIF
415      CONTINUE
         DO 417 J=121,180
         FAC(J)=ZMASS(J)*(ONE-(ONE+X2(J))*EXPO(J))/(X2(J)*X2(J))
417      CONTINUE
         DO 419 J=1,180
         DO 419 I=1,28
         SUM(I,J)=SUM(I,J)+SRC1NB(I,N)*EXPO(J)
         PERTSM(I,J)=PERTSM(I,J)+DBDTNB(I,N)*EXPO(J)
419      CONTINUE
         DO 421 J=121,180
         DO 421 I=1,28
         SUM3(I,J)=SUM3(I,J)+DBDTNB(I,N)*FAC(J)
421      CONTINUE
      ENDIF
C---COMPUTE SUM OVER 160-560 CM-1 RANGE FOR USE IN E1 CALCS (SUMWDE)
      IF (CENT.GT.160. .AND. CENT.LT.560.) THEN
         DO 420 J=1,180
         DO 420 I=1,28
         SUMWDE(I,J)=SUMWDE(I,J)+SRC1NB(I,N)*EXPO(J)
420      CONTINUE
      ENDIF
411   CONTINUE
      DO 431 J=1,180
      DO 431 I=1,28
      EM1(I,J)=SUM(I,J)/TFOUR(I)
      TABLE1(I,J)=PERTSM(I,J)/FORTCU(I)
431   CONTINUE
      DO 433 J=121,180
      DO 433 I=1,28
      EM3(I,J)=SUM3(I,J)/FORTCU(I)
433   CONTINUE
      DO 441 J=1,179
      DO 441 I=1,28
      TABLE2(I,J)=(TABLE1(I,J+1)-TABLE1(I,J))*TEN
441   CONTINUE
      DO 443 J=1,180
      DO 443 I=1,27
      TABLE3(I,J)=(TABLE1(I+1,J)-TABLE1(I,J))*HP1
443   CONTINUE
      DO 445 I=1,28
      TABLE2(I,180)=ZERO
445   CONTINUE
      DO 447 J=1,180
      TABLE3(28,J)=ZERO
447   CONTINUE
      DO 449 J=1,2
      DO 449 I=1,28
      EM1(I,J)=R1(I)
449   CONTINUE
      DO 451 J=1,120
      DO 451 I=1,28
      EM3(I,J)=R2(I)/TWO-S2(I)*SQRT(ZMASS(J))/THREE+T3(I)*ZMASS(J)/EIGHT
451   CONTINUE
      DO 453 J=121,180
      DO 453 I=1,28
      EM3(I,J)=EM3(I,J)/ZMASS(J)
453   CONTINUE
C***NOW COMPUTE E1 TABLES FOR 160-560 CM-1 BANDS ONLY.
C   WE USE R1WD AND SUMWDE OBTAINED ABOVE.
      DO 501 J=1,180
      DO 501 I=1,28
      EM1WDE(I,J)=SUMWDE(I,J)/TFOUR(I)
501   CONTINUE
      DO 503 J=1,2
      DO 503 I=1,28
      EM1WDE(I,J)=R1WD(I)
503   CONTINUE
      RETURN
      END
      SUBROUTINE O3INT(O3O3,SIGL)
CFPP$ NOCONCUR R
 % INCLUDE DBO3INT  ;
C....     PROGRAM O3INT FROM DAN SCHWARZKOPF-GETS ZONAL MEAN O3
C..       CODE ADAPTED FOR MRF USE, IN-LINE.....    K.A.C. JUNE 1989
C....     LAUNCHER======SUBROUTINE O3INT(T41,O3O3)
C..    OUTPUT O3 IS WINTER,SPRING,SUMMER,FALL (NORTHERN HEMISPHERE)
 %INCLUDE RDPARM;
C     *********************************************************
C       SAVE DATA ON PERMANENT DATA SET DENOTED BY CO222 ****
C          ..... K.CAMPANA   OCTOBER 1988
CCCC  DIMENSION T41(LP2,2),O3O3(37,L,4)
      DIMENSION SIGL(L),O3O3(37,L,4)
C     *********************************************************
      DIMENSION QI(82)
      DIMENSION DDUO3N(19,L),RO31(10,41),RO32(10,41),DUO3N(19,41)
      DIMENSION TEMPN(19)
      DIMENSION O3HI(10,25),O3LO1(10,16),O3LO2(10,16),O3LO3(10,16),
     1          O3LO4(10,16)
      DIMENSION O3HI1(10,16),O3HI2(10,9),PH1(45),PH2(37),P1(48),P2(33)
      DIMENSION O35DEG(37,L)
      DIMENSION RSTD(81),RO3(10,41),RO3M(10,40),RBAR(L),RDATA(81),
     1 PHALF(LP1),PSTD(LP2),P(81),PH(82)
      EQUIVALENCE (O3HI1(1,1),O3HI(1,1)),(O3HI2(1,1),O3HI(1,17))
      EQUIVALENCE (PH1(1),PH(1)),(PH2(1),PH(46))
      EQUIVALENCE (P1(1),P(1)),(P2(1),P(49))
      DATA PH1/      0.,
     1     0.1027246E-04, 0.1239831E-04, 0.1491845E-04, 0.1788053E-04,
     1     0.2135032E-04, 0.2540162E-04, 0.3011718E-04, 0.3558949E-04,
     1     0.4192172E-04, 0.4922875E-04, 0.5763817E-04, 0.6729146E-04,
     1     0.7834518E-04, 0.9097232E-04, 0.1053635E-03, 0.1217288E-03,
     1     0.1402989E-03, 0.1613270E-03, 0.1850904E-03, 0.2119495E-03,
     1     0.2423836E-03, 0.2768980E-03, 0.3160017E-03, 0.3602623E-03,
     1     0.4103126E-03, 0.4668569E-03, 0.5306792E-03, 0.6026516E-03,
     1     0.6839018E-03, 0.7759249E-03, 0.8803303E-03, 0.9987843E-03,
     1     0.1133178E-02, 0.1285955E-02, 0.1460360E-02, 0.1660001E-02,
     1     0.1888764E-02, 0.2151165E-02, 0.2452466E-02, 0.2798806E-02,
     1     0.3197345E-02, 0.3656456E-02, 0.4185934E-02, 0.4797257E-02/
      DATA PH2/
     1     0.5503893E-02, 0.6321654E-02, 0.7269144E-02, 0.8368272E-02,
     1     0.9644873E-02, 0.1112946E-01, 0.1285810E-01, 0.1487354E-01,
     1     0.1722643E-01, 0.1997696E-01, 0.2319670E-01, 0.2697093E-01,
     1     0.3140135E-01, 0.3660952E-01, 0.4274090E-01, 0.4996992E-01,
     1     0.5848471E-01, 0.6847525E-01, 0.8017242E-01, 0.9386772E-01,
     1     0.1099026E 00, 0.1286765E 00, 0.1506574E 00, 0.1763932E 00,
     1     0.2065253E 00, 0.2415209E 00, 0.2814823E 00, 0.3266369E 00,
     1     0.3774861E 00, 0.4345638E 00, 0.4984375E 00, 0.5697097E 00,
     1     0.6490189E 00, 0.7370409E 00, 0.8344896E 00, 0.9421190E 00,
     1     0.1000000E 01/
      DATA P1/
     1     0.9300000E-05, 0.1129521E-04, 0.1360915E-04, 0.1635370E-04,
     1     0.1954990E-04, 0.2331653E-04, 0.2767314E-04, 0.3277707E-04,
     1     0.3864321E-04, 0.4547839E-04, 0.5328839E-04, 0.6234301E-04,
     1     0.7263268E-04, 0.8450696E-04, 0.9793231E-04, 0.1133587E-03,
     1     0.1307170E-03, 0.1505832E-03, 0.1728373E-03, 0.1982122E-03,
     1     0.2266389E-03, 0.2592220E-03, 0.2957792E-03, 0.3376068E-03,
     1     0.3844381E-03, 0.4379281E-03, 0.4976965E-03, 0.5658476E-03,
     1     0.6418494E-03, 0.7287094E-03, 0.8261995E-03, 0.9380076E-03,
     1     0.1063498E-02, 0.1207423E-02, 0.1369594E-02, 0.1557141E-02,
     1     0.1769657E-02, 0.2015887E-02, 0.2295520E-02, 0.2620143E-02,
     1     0.2989651E-02, 0.3419469E-02, 0.3909867E-02, 0.4481491E-02,
     1     0.5135272E-02, 0.5898971E-02, 0.6774619E-02, 0.7799763E-02/
      DATA P2/
     1     0.8978218E-02, 0.1036103E-01, 0.1195488E-01, 0.1382957E-01,
     1     0.1599631E-01, 0.1855114E-01, 0.2151235E-01, 0.2501293E-01,
     1     0.2908220E-01, 0.3390544E-01, 0.3952926E-01, 0.4621349E-01,
     1     0.5403168E-01, 0.6330472E-01, 0.7406807E-01, 0.8677983E-01,
     1     0.1015345E 00, 0.1189603E 00, 0.1391863E 00, 0.1630739E 00,
     1     0.1908004E 00, 0.2235461E 00, 0.2609410E 00, 0.3036404E 00,
     1     0.3513750E 00, 0.4055375E 00, 0.4656677E 00, 0.5335132E 00,
     1     0.6083618E 00, 0.6923932E 00, 0.7845676E 00, 0.8875882E 00,
     1     0.1000000E 01/
      DATA O3HI1/
     * .55,.50,.45,.45,.40,.35,.35,.30,.30,.30,
     * .55,.51,.46,.47,.42,.38,.37,.36,.35,.35,
     * .55,.53,.48,.49,.44,.42,.41,.40,.38,.38,
     * .60,.55,.52,.52,.50,.47,.46,.44,.42,.41,
     * .65,.60,.55,.56,.53,.52,.50,.48,.45,.45,
     * .75,.65,.60,.60,.55,.55,.55,.50,.48,.47,
     * .80,.75,.75,.75,.70,.70,.65,.63,.60,.60,
     * .90,.85,.85,.80,.80,.75,.75,.74,.72,.71,
     * 1.10,1.05,1.00,.90,.90,.90,.85,.83,.80,.80,
     * 1.40,1.30,1.25,1.25,1.25,1.20,1.15,1.10,1.05,1.00,
     * 1.7,1.7,1.6,1.6,1.6,1.6,1.6,1.6,1.5,1.5,
     * 2.1,2.0,1.9,1.9,1.9,1.8,1.8,1.8,1.7,1.7,
     * 2.4,2.3,2.2,2.2,2.2,2.1,2.1,2.1,2.0,2.0,
     * 2.7,2.5,2.5,2.5,2.5,2.5,2.4,2.4,2.3,2.3,
     * 2.9,2.8,2.7,2.7,2.7,2.7,2.7,2.7,2.6,2.6,
     * 3.1,3.1,3.0,3.0,3.0,3.0,3.0,3.0,2.9,2.8/
      DATA O3HI2/
     * 3.3,3.4,3.4,3.6,3.7,3.9,4.0,4.1,4.0,3.8,
     * 3.6,3.8,3.9,4.2,4.7,5.3,5.6,5.7,5.5,5.2,
     * 4.1,4.3,4.7,5.2,6.0,6.7,7.0,6.8,6.4,6.2,
     * 5.4,5.7,6.0,6.6,7.3,8.0,8.4,7.7,7.1,6.7,
     * 6.7,6.8,7.0,7.6,8.3,10.0,9.6,8.2,7.5,7.2,
     * 9.2,9.3,9.4,9.6,10.3,10.6,10.0,8.5,7.7,7.3,
     * 12.6,12.1,12.0,12.1,11.7,11.0,10.0,8.6,7.8,7.4,
     * 14.2,13.5,13.1,12.8,11.9,10.9,9.8,8.5,7.8,7.5,
     * 14.3,14.0,13.4,12.7,11.6,10.6,9.3,8.4,7.6,7.3/
      DATA O3LO1/
     * 14.9,14.2,13.3,12.5,11.2,10.3,9.5,8.6,7.5,7.4,
     * 14.5,14.1,13.0,11.8,10.5,9.8,9.2,7.9,7.4,7.4,
     * 11.8,11.5,10.9,10.5,9.9,9.6,8.9,7.5,7.2,7.2,
     * 7.3,7.7,7.8,8.4,8.4,8.5,7.9,7.4,7.1,7.1,
     * 4.1,4.4,5.3,6.6,6.9,7.5,7.4,7.2,7.0,6.9,
     * 1.8,1.9,2.5,3.3,4.5,5.8,6.3,6.3,6.4,6.1,
     * 0.4,0.5,0.8,1.2,2.7,3.6,4.6,4.7,5.0,5.2,
     * .10,.15,.20,.50,1.4,2.1,3.0,3.2,3.5,3.9,
     * .07,.10,.12,.30,1.0,1.4,1.8,1.9,2.3,2.5,
     * .06,.08,.10,.15,.60,.80,1.4,1.5,1.5,1.6,
     * .05,.05,.06,.09,.20,.40,.70,.80,.90,.90,
     * .05,.05,.06,.08,.10,.13,.20,.25,.30,.40,
     * .05,.05,.05,.06,.07,.07,.08,.09,.10,.13,
     * .05,.05,.05,.05,.06,.06,.06,.06,.07,.07,
     * .05,.05,.05,.05,.05,.05,.05,.06,.06,.06,
     * .04,.04,.04,.04,.04,.04,.04,.05,.05,.05/
      DATA O3LO2/
     * 14.8,14.2,13.8,12.2,11.0,9.8,8.5,7.8,7.4,6.9,
     * 13.2,13.0,12.5,11.3,10.4,9.0,7.8,7.5,7.0,6.6,
     * 10.6,10.6,10.7,10.1,9.4,8.6,7.5,7.0,6.5,6.1,
     * 7.0,7.3,7.5,7.5,7.5,7.3,6.7,6.4,6.0,5.8,
     * 3.8,4.0,4.7,5.0,5.2,5.9,5.8,5.6,5.5,5.5,
     * 1.4,1.6,2.4,3.0,3.7,4.1,4.6,4.8,5.1,5.0,
     * .40,.50,.90,1.2,2.0,2.7,3.2,3.6,4.3,4.1,
     * .07,.10,.20,.30,.80,1.4,2.1,2.4,2.7,3.0,
     * .06,.07,.09,.15,.30,.70,1.2,1.4,1.6,2.0,
     * .05,.05,.06,.12,.15,.30,.60,.70,.80,.80,
     * .04,.05,.06,.08,.09,.15,.30,.40,.40,.40,
     * .04,.04,.05,.055,.06,.09,.12,.13,.15,.15,
     * .03,.03,.045,.052,.055,.06,.07,.07,.06,.07,
     * .03,.03,.04,.051,.052,.052,.06,.06,.05,.05,
     * .02,.02,.03,.05,.05,.05,.04,.04,.04,.04,
     * .02,.02,.02,.04,.04,.04,.03,.03,.03,.03/
      DATA O3LO3/
     * 14.5,14.0,13.5,11.3,11.0,10.0,9.0,8.3,7.5,7.3,
     * 13.5,13.2,12.5,11.1,10.4,9.7,8.2,7.8,7.4,6.8,
     * 10.8,10.9,11.0,10.4,10.0,9.6,7.9,7.5,7.0,6.7,
     * 7.3,7.5,7.8,8.5,9.0,8.5,7.7,7.4,6.9,6.5,
     * 4.1,4.5,5.3,6.2,7.3,7.7,7.3,7.0,6.6,6.4,
     * 1.8,2.0,2.2,3.8,4.3,5.6,6.2,6.2,6.4,6.2,
     * .30,.50,.60,1.5,2.8,3.7,4.5,4.7,5.5,5.6,
     * .09,.10,.15,.60,1.2,2.1,3.0,3.5,4.0,4.3,
     * .06,.08,.10,.30,.60,1.1,1.9,2.2,2.9,3.0,
     * .04,.05,.06,.15,.45,.60,1.1,1.3,1.6,1.8,
     * .04,.04,.04,.08,.20,.30,.55,.60,.75,.90,
     * .04,.04,.04,.05,.06,.10,.12,.15,.20,.25,
     * .04,.04,.03,.04,.05,.06,.07,.07,.07,.08,
     * .03,.03,.04,.05,.05,.05,.05,.05,.05,.05,
     * .03,.03,.03,.04,.04,.04,.05,.05,.04,.04,
     * .02,.02,.02,.04,.04,.04,.04,.04,.03,.03/
      DATA O3LO4/
     * 14.2,13.8,13.2,12.5,11.7,10.5,8.6,7.8,7.5,6.6,
     * 12.5,12.4,12.2,11.7,10.8,9.8,7.8,7.2,6.5,6.1,
     * 10.6,10.5,10.4,10.1,9.6,9.0,7.1,6.8,6.1,5.9,
     * 7.0,7.4,7.9,7.8,7.6,7.3,6.2,6.1,5.8,5.6,
     * 4.2,4.6,5.1,5.6,5.9,5.9,5.9,5.8,5.6,5.3,
     * 2.1,2.3,2.6,2.9,3.5,4.3,4.8,4.9,5.1,5.1,
     * 0.7,0.8,1.0,1.5,2.0,2.8,3.5,3.6,3.7,4.0,
     * .15,.20,.40,.50,.60,1.4,2.1,2.2,2.3,2.5,
     * .08,.10,.15,.25,.30,.90,1.2,1.3,1.4,1.6,
     * .07,.08,.10,.14,.20,.50,.70,.90,.90,.80,
     * .05,.06,.08,.12,.14,.20,.35,.40,.60,.50,
     * .05,.05,.08,.09,.09,.09,.11,.12,.15,.18,
     * .04,.05,.06,.07,.07,.08,.08,.08,.08,.08,
     * .04,.04,.05,.07,.07,.07,.07,.07,.06,.05,
     * .02,.02,.04,.05,.05,.05,.05,.05,.04,.04,
     * .02,.02,.03,.04,.04,.04,.04,.04,.03,.03/
C***READ IN USER-SPECIFIED PRESSURES,IN MB. THIS CAN BE OUTPUT FROM PTZ
CKAC ..  FILE 41 FROM PTZ(PSFC=1013.25 MB)
606   FORMAT (5E16.9)
CCC      READ (8,606) (PSTD(K),K=1,LP2)
CCC      READ (8,606) (PHALF(K),K=1,LP1)
CO222  ***************************************************
      PSS=1013.250#E0
      PSTD(1) = 0.#E0
      PSTD(LP2) = PSS
      DO 202 K=2,LP1
        PSTD(K) = SIGL(LP2-K) * PSS
  202 CONTINUE
      PHALF(1) = 0.#E0
      PHALF(LP1) = PSS
      DO 204 K=1,LM1
        PHALF(K+1) = 0.5#E0 * (PSTD(K+1)+PSTD(K+2))
  204 CONTINUE
CKAC  DO 300 K=1,LP2
CKAC    PSTD(K) = T41(K,1)
CK300 CONTINUE
CKAC  DO 301 K=1,LP1
CKAC    PHALF(K) = T41(K,2)
CK301 CONTINUE
CC          REWIND 66
CO222  ***************************************************
      NKK=41
      NK=81
      NKP=NK+1
      DO 24 K=1,LP1
      PHALF(K)=PHALF(K)*1.0E 03
   24 PSTD(K)=PSTD(K+1)*1.0E 03
      DO 25 K=1,NK
      PH(K)=PH(K)*1013250.
   25 P(K)=P(K)*1013250.
      PH(NKP)=PH(NKP)*1013250.
CKAC  WRITE (6,3) PH
CKAC  WRITE (6,3) P
      WRITE (6,3) (PHALF(K),K=1,LP1)
      WRITE (6,3) (PSTD(K),K=1,LP1)
C***LOAD ARRAYS RO31,RO32,AS IN DICKS PGM.
      DO 1010 K=1,25
      DO 1010 N=1,10
        RO31(N,K)=O3HI(N,K)
        RO32(N,K)=O3HI(N,K)
1010  CONTINUE
C
      DO 3000 NCASE=1,4
      ITAPE=NCASE+50
      IPLACE=2
      IF (NCASE.EQ.2) IPLACE=4
      IF (NCASE.EQ.3) IPLACE=1
      IF (NCASE.EQ.4) IPLACE=3
C***NCASE=1: SPRING (IN N.H.)
C***NCASE=2: FALL   (IN N.H.)
C***NCASE=3: WINTER (IN N.H.)
C***NCASE=4: SUMMER (IN N.H.)
      IF (NCASE.EQ.1.OR.NCASE.EQ.2) THEN
         DO 1011 K=26,41
         DO 1011 N=1,10
           RO31(N,K)=O3LO1(N,K-25)
           RO32(N,K)=O3LO2(N,K-25)
1011     CONTINUE
      ENDIF
      IF (NCASE.EQ.3.OR.NCASE.EQ.4) THEN
         DO 1031 K=26,41
         DO 1031 N=1,10
           RO31(N,K)=O3LO3(N,K-25)
           RO32(N,K)=O3LO4(N,K-25)
1031     CONTINUE
      ENDIF
      DO 30 KK=1,NKK
      DO 31 N=1,10
      DUO3N(N,KK)=RO31(11-N,KK)
   31 DUO3N(N+9,KK)=RO32(N,KK)
      DUO3N(10,KK)=.5*(RO31(1,KK)+RO32(1,KK))
   30 CONTINUE
C***FOR NCASE=2 OR NCASE=4,REVERSE LATITUDE ARRANGEMENT OF CORR. SEASON
      IF (NCASE.EQ.2.OR.NCASE.EQ.4) THEN
         DO 1024 KK=1,NKK
         DO 1025 N=1,19
           TEMPN(N)=DUO3N(20-N,KK)
1025     CONTINUE
         DO 1026 N=1,19
           DUO3N(N,KK)=TEMPN(N)
1026     CONTINUE
1024     CONTINUE
      ENDIF
C***DUO3N NOW IS O3 PROFILE FOR APPROPRIATE SEASON,AT STD. PRESSURE
C      LEVELS
CKAC  WRITE (6,800) DUO3N
C***BEGIN LATITUDE (10 DEG) LOOP
      DO 33 N=1,19
      DO 22 KK=1,NKK
   22 RSTD(KK)=DUO3N(N,KK)
      NKM=NK-1
      NKMM=NK-3
C     BESSELS HALF-POINT INTERPOLATION FORMULA
      DO 60 K=4,NKMM,2
      KI=K/2
   60 RDATA(K)=.5*(RSTD(KI)+RSTD(KI+1))-(RSTD(KI+2)-RSTD(KI+1)-RSTD(KI)+
     1RSTD(KI-1))/16.
      RDATA(2)=.5*(RSTD(2)+RSTD(1))
      RDATA(NKM)=.5*(RSTD(NKK)+RSTD(NKK-1))
C     PUT UNCHANGED DATA INTO NEW ARRAY
      DO 61 K=1,NK,2
      KQ=(K+1)/2
   61 RDATA(K)=RSTD(KQ)
C---NOTE TO NMC: THIS WRITE IS COMMENTED OUT TO REDUCE PRINTOUT
C     WRITE (6,798) RDATA
C     CALCULATE LAYER-MEAN OZONE MIXING RATIO FOR EACH MODEL LEVEL
      DO 99 KK=1,L
      RBAR(KK)=0.
C     LOOP TO CALCULATE SUMS TO GET LAYER OZONE MEAN
      DO 98 K=1,NK
      IF(PH(K+1).LT.PHALF(KK)) GO TO 98
      IF(PH(K).GT.PHALF(KK+1)) GO TO 98
      IF(PH(K+1).LT.PHALF(KK+1).AND.PH(K).LT.PHALF(KK)) RBAR(KK)=RBAR(KK
     1)+RDATA(K)*(PH(K+1)-PHALF(KK))
      IF(PH(K+1).LT.PHALF(KK+1).AND.PH(K).GE.PHALF(KK)) RBAR(KK)=RBAR(K
     1K)+RDATA(K)*(PH(K+1)-PH(K))
      IF(PH(K+1).GT.PHALF(KK+1).AND.PH(K).GT.PHALF(KK)) RBAR(KK)=RBAR(K
     1K)+RDATA(K)*(PHALF(KK+1)-PH(K))
   98 CONTINUE
      RBAR(KK)=RBAR(KK)/(PHALF(KK+1)-PHALF(KK))
      IF(RBAR(KK).GT..0000) GO TO 99
C     CODE TO COVER CASE WHEN MODEL RESOLUTION IS SO FINE THAT NO VALUE
C     OF P(K) IN THE OZONE DATA ARRAY FALLS BETWEEN PHALF(KK+1) AND
C     PHALF(KK).   PROCEDURE IS TO SIMPLY GRAB THE NEAREST VALUE FROM
C     RDATA
      DO 29 K=1,NK
      IF(PH(K).LT.PHALF(KK).AND.PH(K+1).GE.PHALF(KK+1)) RBAR(KK)=RDATA(K
     1)
   29 CONTINUE
   99 CONTINUE
C     CALCULATE TOTAL OZONE
      O3RD=0.
      DO 89 KK=1,80
   89 O3RD=O3RD+RDATA(KK)*(PH(KK+1)-PH(KK))
      O3RD=O3RD+RDATA(81)*(P(81)-PH(81))
      O3RD=O3RD/980.
      O3TOT=0.
      DO 88 KK=1,L
   88 O3TOT=O3TOT+RBAR(KK)*(PHALF(KK+1)-PHALF(KK))
      O3TOT=O3TOT/980.
C     UNITS ARE MICROGRAMS/CM**2
      O3DU=O3TOT/2.144
C     O3DU UNITS ARE DOBSON UNITS (10**-3 ATM-CM)
C--NOTE TO NMC: THIS IS COMMENTED OUT TO SAVE PRINTOUT
C     WRITE (6,796) O3RD,O3TOT,O3DU
      DO 23 KK=1,L
   23 DDUO3N(N,KK)=RBAR(KK)*.01
   33 CONTINUE
C***END OF LATITUDE LOOP
C
C***CREATE 5 DEG OZONE QUANTITIES BY LINEAR INTERPOLATION OF
C      10 DEG VALUES
      DO 1060 KK=1,L
        DO 1061 N=1,19
          O35DEG(2*N-1,KK)=DDUO3N(N,KK)
1061    CONTINUE
        DO 1062 N=1,18
          O35DEG(2*N,KK)=0.5*(DDUO3N(N,KK)+DDUO3N(N+1,KK))
1062    CONTINUE
1060  CONTINUE
C***OUTPUT TO UNIT (ITAPE) THE OZONE VALUES FOR LATER USE
CO222  ***************************************************
CC          WRITE (66) O35DEG
      DO 302 JJ=1,37
       DO 302 KEN=1,L
        O3O3(JJ,KEN,IPLACE) = O35DEG(JJ,KEN)
  302 CONTINUE
CO222  ***************************************************
CCC       WRITE (ITAPE,101) O35DEG
CKAC  WRITE (6,101) O35DEG
3000  CONTINUE
C***END OF LOOP OVER CASES
      RETURN
   1  FORMAT(10F4.2)
    2 FORMAT(10X,E14.7,1X,E14.7,1X,E14.7,1X,E14.7,1X)
   3  FORMAT(10E12.5)
C 796 FORMAT(3E12.5)
  797 FORMAT(10F7.2)
C 798 FORMAT(20F6.2)
  799 FORMAT(19F6.4)
  800 FORMAT(19F6.2)
  101 FORMAT(5X,1H*,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,
     *1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,)
      END
      SUBROUTINE O3INTN(O3O3,PSTD)
CFPP$ NOCONCUR R
 % INCLUDE DBO3INT  ;
C....     PROGRAM O3INT FROM DAN SCHWARZKOPF-GETS ZONAL MEAN O3
C..       CODE ADAPTED FOR MRF USE, IN-LINE.....    K.A.C. JUNE 1989
C....     LAUNCHER======SUBROUTINE O3INT(T41,O3O3)
C..     NO INPUT, JUST CALCULATE COMPLETE 81 LAYER DATA FOR LATER
C..                         INTERPOLATION           K.A.C. DEC 1994..
C..    OUTPUT O3 IS WINTER,SPRING,SUMMER,FALL (NORTHERN HEMISPHERE)
 %INCLUDE RDPARM;
      PARAMETER (NL=81, NLP1=NL+1)
C     *********************************************************
C       SAVE DATA ON PERMANENT DATA SET DENOTED BY CO222 ****
C          ..... K.CAMPANA   OCTOBER 1988
CCCC  DIMENSION T41(LP2,2),O3O3(37,L,4)
CO3   DIMENSION SIGL(L),O3O3(37,L,4)
      DIMENSION         O3O3(37,NL,4)
C     *********************************************************
      DIMENSION QI(82)
      DIMENSION DDUO3N(19,NL),RO31(10,41),RO32(10,41),DUO3N(19,41)
      DIMENSION TEMPN(19)
      DIMENSION O3HI(10,25),O3LO1(10,16),O3LO2(10,16),O3LO3(10,16),
     1          O3LO4(10,16)
      DIMENSION O3HI1(10,16),O3HI2(10,9),PH1(45),PH2(37),P1(48),P2(33)
      DIMENSION O35DEG(37,NL)
      DIMENSION RSTD(81),RO3(10,41),RO3M(10,40),RBAR(NL),RDATA(81),
     1 PHALF(NL),PSTD(NL),P(81),PH(82)
      EQUIVALENCE (O3HI1(1,1),O3HI(1,1)),(O3HI2(1,1),O3HI(1,17))
      EQUIVALENCE (PH1(1),PH(1)),(PH2(1),PH(46))
      EQUIVALENCE (P1(1),P(1)),(P2(1),P(49))
      DATA PH1/      0.,
     1     0.1027246E-04, 0.1239831E-04, 0.1491845E-04, 0.1788053E-04,
     1     0.2135032E-04, 0.2540162E-04, 0.3011718E-04, 0.3558949E-04,
     1     0.4192172E-04, 0.4922875E-04, 0.5763817E-04, 0.6729146E-04,
     1     0.7834518E-04, 0.9097232E-04, 0.1053635E-03, 0.1217288E-03,
     1     0.1402989E-03, 0.1613270E-03, 0.1850904E-03, 0.2119495E-03,
     1     0.2423836E-03, 0.2768980E-03, 0.3160017E-03, 0.3602623E-03,
     1     0.4103126E-03, 0.4668569E-03, 0.5306792E-03, 0.6026516E-03,
     1     0.6839018E-03, 0.7759249E-03, 0.8803303E-03, 0.9987843E-03,
     1     0.1133178E-02, 0.1285955E-02, 0.1460360E-02, 0.1660001E-02,
     1     0.1888764E-02, 0.2151165E-02, 0.2452466E-02, 0.2798806E-02,
     1     0.3197345E-02, 0.3656456E-02, 0.4185934E-02, 0.4797257E-02/
      DATA PH2/
     1     0.5503893E-02, 0.6321654E-02, 0.7269144E-02, 0.8368272E-02,
     1     0.9644873E-02, 0.1112946E-01, 0.1285810E-01, 0.1487354E-01,
     1     0.1722643E-01, 0.1997696E-01, 0.2319670E-01, 0.2697093E-01,
     1     0.3140135E-01, 0.3660952E-01, 0.4274090E-01, 0.4996992E-01,
     1     0.5848471E-01, 0.6847525E-01, 0.8017242E-01, 0.9386772E-01,
     1     0.1099026E 00, 0.1286765E 00, 0.1506574E 00, 0.1763932E 00,
     1     0.2065253E 00, 0.2415209E 00, 0.2814823E 00, 0.3266369E 00,
     1     0.3774861E 00, 0.4345638E 00, 0.4984375E 00, 0.5697097E 00,
     1     0.6490189E 00, 0.7370409E 00, 0.8344896E 00, 0.9421190E 00,
     1     0.1000000E 01/
      DATA P1/
     1     0.9300000E-05, 0.1129521E-04, 0.1360915E-04, 0.1635370E-04,
     1     0.1954990E-04, 0.2331653E-04, 0.2767314E-04, 0.3277707E-04,
     1     0.3864321E-04, 0.4547839E-04, 0.5328839E-04, 0.6234301E-04,
     1     0.7263268E-04, 0.8450696E-04, 0.9793231E-04, 0.1133587E-03,
     1     0.1307170E-03, 0.1505832E-03, 0.1728373E-03, 0.1982122E-03,
     1     0.2266389E-03, 0.2592220E-03, 0.2957792E-03, 0.3376068E-03,
     1     0.3844381E-03, 0.4379281E-03, 0.4976965E-03, 0.5658476E-03,
     1     0.6418494E-03, 0.7287094E-03, 0.8261995E-03, 0.9380076E-03,
     1     0.1063498E-02, 0.1207423E-02, 0.1369594E-02, 0.1557141E-02,
     1     0.1769657E-02, 0.2015887E-02, 0.2295520E-02, 0.2620143E-02,
     1     0.2989651E-02, 0.3419469E-02, 0.3909867E-02, 0.4481491E-02,
     1     0.5135272E-02, 0.5898971E-02, 0.6774619E-02, 0.7799763E-02/
      DATA P2/
     1     0.8978218E-02, 0.1036103E-01, 0.1195488E-01, 0.1382957E-01,
     1     0.1599631E-01, 0.1855114E-01, 0.2151235E-01, 0.2501293E-01,
     1     0.2908220E-01, 0.3390544E-01, 0.3952926E-01, 0.4621349E-01,
     1     0.5403168E-01, 0.6330472E-01, 0.7406807E-01, 0.8677983E-01,
     1     0.1015345E 00, 0.1189603E 00, 0.1391863E 00, 0.1630739E 00,
     1     0.1908004E 00, 0.2235461E 00, 0.2609410E 00, 0.3036404E 00,
     1     0.3513750E 00, 0.4055375E 00, 0.4656677E 00, 0.5335132E 00,
     1     0.6083618E 00, 0.6923932E 00, 0.7845676E 00, 0.8875882E 00,
     1     0.1000000E 01/
      DATA O3HI1/
     * .55,.50,.45,.45,.40,.35,.35,.30,.30,.30,
     * .55,.51,.46,.47,.42,.38,.37,.36,.35,.35,
     * .55,.53,.48,.49,.44,.42,.41,.40,.38,.38,
     * .60,.55,.52,.52,.50,.47,.46,.44,.42,.41,
     * .65,.60,.55,.56,.53,.52,.50,.48,.45,.45,
     * .75,.65,.60,.60,.55,.55,.55,.50,.48,.47,
     * .80,.75,.75,.75,.70,.70,.65,.63,.60,.60,
     * .90,.85,.85,.80,.80,.75,.75,.74,.72,.71,
     * 1.10,1.05,1.00,.90,.90,.90,.85,.83,.80,.80,
     * 1.40,1.30,1.25,1.25,1.25,1.20,1.15,1.10,1.05,1.00,
     * 1.7,1.7,1.6,1.6,1.6,1.6,1.6,1.6,1.5,1.5,
     * 2.1,2.0,1.9,1.9,1.9,1.8,1.8,1.8,1.7,1.7,
     * 2.4,2.3,2.2,2.2,2.2,2.1,2.1,2.1,2.0,2.0,
     * 2.7,2.5,2.5,2.5,2.5,2.5,2.4,2.4,2.3,2.3,
     * 2.9,2.8,2.7,2.7,2.7,2.7,2.7,2.7,2.6,2.6,
     * 3.1,3.1,3.0,3.0,3.0,3.0,3.0,3.0,2.9,2.8/
      DATA O3HI2/
     * 3.3,3.4,3.4,3.6,3.7,3.9,4.0,4.1,4.0,3.8,
     * 3.6,3.8,3.9,4.2,4.7,5.3,5.6,5.7,5.5,5.2,
     * 4.1,4.3,4.7,5.2,6.0,6.7,7.0,6.8,6.4,6.2,
     * 5.4,5.7,6.0,6.6,7.3,8.0,8.4,7.7,7.1,6.7,
     * 6.7,6.8,7.0,7.6,8.3,10.0,9.6,8.2,7.5,7.2,
     * 9.2,9.3,9.4,9.6,10.3,10.6,10.0,8.5,7.7,7.3,
     * 12.6,12.1,12.0,12.1,11.7,11.0,10.0,8.6,7.8,7.4,
     * 14.2,13.5,13.1,12.8,11.9,10.9,9.8,8.5,7.8,7.5,
     * 14.3,14.0,13.4,12.7,11.6,10.6,9.3,8.4,7.6,7.3/
      DATA O3LO1/
     * 14.9,14.2,13.3,12.5,11.2,10.3,9.5,8.6,7.5,7.4,
     * 14.5,14.1,13.0,11.8,10.5,9.8,9.2,7.9,7.4,7.4,
     * 11.8,11.5,10.9,10.5,9.9,9.6,8.9,7.5,7.2,7.2,
     * 7.3,7.7,7.8,8.4,8.4,8.5,7.9,7.4,7.1,7.1,
     * 4.1,4.4,5.3,6.6,6.9,7.5,7.4,7.2,7.0,6.9,
     * 1.8,1.9,2.5,3.3,4.5,5.8,6.3,6.3,6.4,6.1,
     * 0.4,0.5,0.8,1.2,2.7,3.6,4.6,4.7,5.0,5.2,
     * .10,.15,.20,.50,1.4,2.1,3.0,3.2,3.5,3.9,
     * .07,.10,.12,.30,1.0,1.4,1.8,1.9,2.3,2.5,
     * .06,.08,.10,.15,.60,.80,1.4,1.5,1.5,1.6,
     * .05,.05,.06,.09,.20,.40,.70,.80,.90,.90,
     * .05,.05,.06,.08,.10,.13,.20,.25,.30,.40,
     * .05,.05,.05,.06,.07,.07,.08,.09,.10,.13,
     * .05,.05,.05,.05,.06,.06,.06,.06,.07,.07,
     * .05,.05,.05,.05,.05,.05,.05,.06,.06,.06,
     * .04,.04,.04,.04,.04,.04,.04,.05,.05,.05/
      DATA O3LO2/
     * 14.8,14.2,13.8,12.2,11.0,9.8,8.5,7.8,7.4,6.9,
     * 13.2,13.0,12.5,11.3,10.4,9.0,7.8,7.5,7.0,6.6,
     * 10.6,10.6,10.7,10.1,9.4,8.6,7.5,7.0,6.5,6.1,
     * 7.0,7.3,7.5,7.5,7.5,7.3,6.7,6.4,6.0,5.8,
     * 3.8,4.0,4.7,5.0,5.2,5.9,5.8,5.6,5.5,5.5,
     * 1.4,1.6,2.4,3.0,3.7,4.1,4.6,4.8,5.1,5.0,
     * .40,.50,.90,1.2,2.0,2.7,3.2,3.6,4.3,4.1,
     * .07,.10,.20,.30,.80,1.4,2.1,2.4,2.7,3.0,
     * .06,.07,.09,.15,.30,.70,1.2,1.4,1.6,2.0,
     * .05,.05,.06,.12,.15,.30,.60,.70,.80,.80,
     * .04,.05,.06,.08,.09,.15,.30,.40,.40,.40,
     * .04,.04,.05,.055,.06,.09,.12,.13,.15,.15,
     * .03,.03,.045,.052,.055,.06,.07,.07,.06,.07,
     * .03,.03,.04,.051,.052,.052,.06,.06,.05,.05,
     * .02,.02,.03,.05,.05,.05,.04,.04,.04,.04,
     * .02,.02,.02,.04,.04,.04,.03,.03,.03,.03/
      DATA O3LO3/
     * 14.5,14.0,13.5,11.3,11.0,10.0,9.0,8.3,7.5,7.3,
     * 13.5,13.2,12.5,11.1,10.4,9.7,8.2,7.8,7.4,6.8,
     * 10.8,10.9,11.0,10.4,10.0,9.6,7.9,7.5,7.0,6.7,
     * 7.3,7.5,7.8,8.5,9.0,8.5,7.7,7.4,6.9,6.5,
     * 4.1,4.5,5.3,6.2,7.3,7.7,7.3,7.0,6.6,6.4,
     * 1.8,2.0,2.2,3.8,4.3,5.6,6.2,6.2,6.4,6.2,
     * .30,.50,.60,1.5,2.8,3.7,4.5,4.7,5.5,5.6,
     * .09,.10,.15,.60,1.2,2.1,3.0,3.5,4.0,4.3,
     * .06,.08,.10,.30,.60,1.1,1.9,2.2,2.9,3.0,
     * .04,.05,.06,.15,.45,.60,1.1,1.3,1.6,1.8,
     * .04,.04,.04,.08,.20,.30,.55,.60,.75,.90,
     * .04,.04,.04,.05,.06,.10,.12,.15,.20,.25,
     * .04,.04,.03,.04,.05,.06,.07,.07,.07,.08,
     * .03,.03,.04,.05,.05,.05,.05,.05,.05,.05,
     * .03,.03,.03,.04,.04,.04,.05,.05,.04,.04,
     * .02,.02,.02,.04,.04,.04,.04,.04,.03,.03/
      DATA O3LO4/
     * 14.2,13.8,13.2,12.5,11.7,10.5,8.6,7.8,7.5,6.6,
     * 12.5,12.4,12.2,11.7,10.8,9.8,7.8,7.2,6.5,6.1,
     * 10.6,10.5,10.4,10.1,9.6,9.0,7.1,6.8,6.1,5.9,
     * 7.0,7.4,7.9,7.8,7.6,7.3,6.2,6.1,5.8,5.6,
     * 4.2,4.6,5.1,5.6,5.9,5.9,5.9,5.8,5.6,5.3,
     * 2.1,2.3,2.6,2.9,3.5,4.3,4.8,4.9,5.1,5.1,
     * 0.7,0.8,1.0,1.5,2.0,2.8,3.5,3.6,3.7,4.0,
     * .15,.20,.40,.50,.60,1.4,2.1,2.2,2.3,2.5,
     * .08,.10,.15,.25,.30,.90,1.2,1.3,1.4,1.6,
     * .07,.08,.10,.14,.20,.50,.70,.90,.90,.80,
     * .05,.06,.08,.12,.14,.20,.35,.40,.60,.50,
     * .05,.05,.08,.09,.09,.09,.11,.12,.15,.18,
     * .04,.05,.06,.07,.07,.08,.08,.08,.08,.08,
     * .04,.04,.05,.07,.07,.07,.07,.07,.06,.05,
     * .02,.02,.04,.05,.05,.05,.05,.05,.04,.04,
     * .02,.02,.03,.04,.04,.04,.04,.04,.03,.03/
      NKK=41
      NK=81
      NKP=NK+1
      DO 25 K=1,NK
      PH(K)=PH(K)*1013250.
   25 P(K)=P(K)*1013250.
      PH(NKP)=PH(NKP)*1013250.
      DO 24 K=1,NL
       PSTD(K)=P(K)
   24 CONTINUE
CKAC  WRITE (6,3) PH
CKAC  WRITE (6,3) P
CKAC  WRITE (6,3) (PSTD(K),K=1,LP1)
C***LOAD ARRAYS RO31,RO32,AS IN DICKS PGM.
      DO 1010 K=1,25
      DO 1010 N=1,10
        RO31(N,K)=O3HI(N,K)
        RO32(N,K)=O3HI(N,K)
1010  CONTINUE
C
      DO 3000 NCASE=1,4
      ITAPE=NCASE+50
      IPLACE=2
      IF (NCASE.EQ.2) IPLACE=4
      IF (NCASE.EQ.3) IPLACE=1
      IF (NCASE.EQ.4) IPLACE=3
C***NCASE=1: SPRING (IN N.H.)
C***NCASE=2: FALL   (IN N.H.)
C***NCASE=3: WINTER (IN N.H.)
C***NCASE=4: SUMMER (IN N.H.)
      IF (NCASE.EQ.1.OR.NCASE.EQ.2) THEN
         DO 1011 K=26,41
         DO 1011 N=1,10
           RO31(N,K)=O3LO1(N,K-25)
           RO32(N,K)=O3LO2(N,K-25)
1011     CONTINUE
      ENDIF
      IF (NCASE.EQ.3.OR.NCASE.EQ.4) THEN
         DO 1031 K=26,41
         DO 1031 N=1,10
           RO31(N,K)=O3LO3(N,K-25)
           RO32(N,K)=O3LO4(N,K-25)
1031     CONTINUE
      ENDIF
      DO 30 KK=1,NKK
      DO 31 N=1,10
      DUO3N(N,KK)=RO31(11-N,KK)
   31 DUO3N(N+9,KK)=RO32(N,KK)
      DUO3N(10,KK)=.5*(RO31(1,KK)+RO32(1,KK))
   30 CONTINUE
C***FOR NCASE=2 OR NCASE=4,REVERSE LATITUDE ARRANGEMENT OF CORR. SEASON
      IF (NCASE.EQ.2.OR.NCASE.EQ.4) THEN
         DO 1024 KK=1,NKK
         DO 1025 N=1,19
           TEMPN(N)=DUO3N(20-N,KK)
1025     CONTINUE
         DO 1026 N=1,19
           DUO3N(N,KK)=TEMPN(N)
1026     CONTINUE
1024     CONTINUE
      ENDIF
C***DUO3N NOW IS O3 PROFILE FOR APPROPRIATE SEASON,AT STD. PRESSURE
C      LEVELS
CKAC  WRITE (6,800) DUO3N
C***BEGIN LATITUDE (10 DEG) LOOP
      DO 33 N=1,19
      DO 22 KK=1,NKK
   22 RSTD(KK)=DUO3N(N,KK)
      NKM=NK-1
      NKMM=NK-3
C     BESSELS HALF-POINT INTERPOLATION FORMULA
      DO 60 K=4,NKMM,2
      KI=K/2
   60 RDATA(K)=.5*(RSTD(KI)+RSTD(KI+1))-(RSTD(KI+2)-RSTD(KI+1)-RSTD(KI)+
     1RSTD(KI-1))/16.
      RDATA(2)=.5*(RSTD(2)+RSTD(1))
      RDATA(NKM)=.5*(RSTD(NKK)+RSTD(NKK-1))
C     PUT UNCHANGED DATA INTO NEW ARRAY
      DO 61 K=1,NK,2
      KQ=(K+1)/2
   61 RDATA(K)=RSTD(KQ)
C---NOTE TO NMC: THIS WRITE IS COMMENTED OUT TO REDUCE PRINTOUT
C     WRITE (6,798) RDATA
CO3   DO 23 KK=1,L
      DO 23 KK=1,NL
   23 DDUO3N(N,KK)=RDATA(KK)*.01
   33 CONTINUE
C***END OF LATITUDE LOOP
C
C***CREATE 5 DEG OZONE QUANTITIES BY LINEAR INTERPOLATION OF
C      10 DEG VALUES
CO3   DO 1060 KK=1,L
      DO 1060 KK=1,NL
        DO 1061 N=1,19
          O35DEG(2*N-1,KK)=DDUO3N(N,KK)
1061    CONTINUE
        DO 1062 N=1,18
          O35DEG(2*N,KK)=0.5*(DDUO3N(N,KK)+DDUO3N(N+1,KK))
1062    CONTINUE
1060  CONTINUE
C***OUTPUT TO UNIT (ITAPE) THE OZONE VALUES FOR LATER USE
CO222  ***************************************************
CC          WRITE (66) O35DEG
      DO 302 JJ=1,37
CO3    DO 302 KEN=1,L
       DO 302 KEN=1,NL
        O3O3(JJ,KEN,IPLACE) = O35DEG(JJ,KEN)
  302 CONTINUE
CO222  ***************************************************
CCC       WRITE (ITAPE,101) O35DEG
CKAC  WRITE (6,101) O35DEG
3000  CONTINUE
C***END OF LOOP OVER CASES
      RETURN
   1  FORMAT(10F4.2)
    2 FORMAT(10X,E14.7,1X,E14.7,1X,E14.7,1X,E14.7,1X)
   3  FORMAT(10E12.5)
C 796 FORMAT(3E12.5)
  797 FORMAT(10F7.2)
C 798 FORMAT(20F6.2)
  799 FORMAT(19F6.4)
  800 FORMAT(19F6.2)
  101 FORMAT(5X,1H*,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,,F6.5,
     *1H,,F6.5,1H,,F6.5,1H,,F6.5,1H,)
      END
      SUBROUTINE OZON2D(SIGL,QO3,SFCP,XLAT,RSIN1,RCOS1,RCOS2)
CFPP$ NOCONCUR R
C ...  COMPUTE MODEL LYR O3 PROFILE FROM THE ORIGINAL GFDL DATA
      PARAMETER (L=#LEVS)
      PARAMETER (NL=81,NLP1=NL+1,LNGTH=37*NL)
      DIMENSION SIGL(#LEVS),PSM(#LONR2)
      DIMENSION QO3(#LONR2,#LEVS),SFCP(#LONR2),XLAT(#LONR2)
      DIMENSION JJROW(#LONR2),                           TTHAN(#LONR2)
      DIMENSION QO3O3(#LONR2,NL)
      COMMON /RDFSAV/ EMISP,EMIST,XLATT,XLATP,Q19001,HP98,H3M6,
     1     HP75,H6M2,HP537,H74E1,H15E1,Q14330,HP2,TWENTY,HNINE,
     2     DEGRAD,HSIGMA,DAYSEC,RCO2
C...    **************************************************************
C--   SEASONAL CLIMATOLOGIES OF O3 FROM O3INTN
      COMMON /SEASO3/
C-       ...WINTER....  ...SPRING....  ...SUMMER....  ....FALL.....
     1   DDUO3N(37,NL), DDO3N2(37,NL), DDO3N3(37,NL), DDO3N4(37,NL)
     2  , PRGFDL(NL)
C...    **************************************************************
C...       BEGIN HERE .....
      RNDG = 180./#PI
      DO 10 I=1,#LONR2
       TH2=HP2*XLAT(I)*RNDG
       JJROW(I)=Q19001-TH2
       TTHAN(I)=(19-JJROW(I))-TH2
   10 CONTINUE
C....   SEASONAL AND SPATIAL INTERPOLATION DONE BELOW.
      DO 20 K=1,NL
      DO 20 I=1,#LONR2
        DO3V = DDUO3N(JJROW(I),K) + RSIN1*DDO3N2(JJROW(I),K)
     1             +RCOS1*DDO3N3(JJROW(I),K)
     2             +RCOS2*DDO3N4(JJROW(I),K)
        DO3VP = DDUO3N(JJROW(I)+1,K) + RSIN1*DDO3N2(JJROW(I)+1,K)
     1             +RCOS1*DDO3N3(JJROW(I)+1,K)
     2             +RCOS2*DDO3N4(JJROW(I)+1,K)
C...   NOW LATITUDINAL INTERPOLATION, AND
C          CONVERT O3 INTO MASS MIXING RATIO(ORIGINAL DATA MPY BY 1.E4)
C      FLIP VERTICAL COORDINATE TOO...
        QO3O3(I,NL+1-K) = 1.#E-4 * (DO3V+TTHAN(I)*(DO3VP-DO3V))
   20 CONTINUE
C...    VERTICAL (LINEAR IN LN P) INTERPOLATE FOR EACH GRIDPOINT
      NUMITR = 0
      ILOG = NL
   21 CONTINUE
      ILOG = (ILOG+1)/2
        IF(ILOG.EQ.1) GO TO 22
        NUMITR = NUMITR + 1
        GO TO 21
   22 CONTINUE
      DO 60 K=1,L
        NHALF=(NL+1)/2
        DO 30 I=1,#LONR2
          JJROW(I) = NHALF
          PSM(I) = SFCP(I) * SIGL(K)
   30   CONTINUE
        DO 40 IT=1,NUMITR
          NHALF=(NHALF+1)/2
          DO 40 I=1,#LONR2
            IF(PSM(I).LT.PRGFDL(JJROW(I))) THEN
              JJROW(I) = JJROW(I) + NHALF
            ELSE IF(PSM(I).GE.PRGFDL(JJROW(I)-1)) THEN
              JJROW(I) = JJROW(I) - NHALF
            ENDIF
            JJROW(I) = MIN(JJROW(I),NL)
            JJROW(I) = MAX(JJROW(I),2)
   40   CONTINUE
        DO 50 I=1,#LONR2
          IF(PSM(I).GT.PRGFDL(1)) THEN
            QO3(I,K) = QO3O3(I,1)
          ELSE IF(PSM(I).LT.PRGFDL(NL)) THEN
            QO3(I,K) = QO3O3(I,NL)
          ELSE
            APLO = ALOG(PRGFDL(JJROW(I)-1))
            APUP = ALOG(PRGFDL(JJROW(I)))
            QO3(I,K) = QO3O3(I,JJROW(I)) + (ALOG(PSM(I))-APUP) /
     1                 (APLO-APUP) *
     2                 (QO3O3(I,JJROW(I)-1)-QO3O3(I,JJROW(I)))
          ENDIF
   50   CONTINUE
   60 CONTINUE
      RETURN
      END
