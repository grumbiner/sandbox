      SUBROUTINE LWFLUX
C
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    LWFLUX      PERFORMS LW CALCULATIONS
C   PRGMMR: J TUCCILLO       ORG: W/NMC4     DATE: 90-06-13
C
C ABSTRACT:    PERFORMS LW CALCULATIONS
C   .
C
C PROGRAM HISTORY LOG:
C   90-06-13  J TUCCILLO
C
C USAGE:  CALL LWFLUX
C   SUBPROGRAMS CALLED:
C     UNIQUE:    - LWCRUNCH
C                  RDHGATHR
C     LIBRARY:
C       COMMON   - BLANK
C                  H2O
C
C REMARKS:
C   .
C   - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   INFORMATION COMMUNICATED THROUGH COMMON
C   .
C   - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   INFORMATION COMMUNICATED THROUGH COMMON
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN
C   MACHINE:  CRAY Y-MP
C
C$$$
C
      INCLUDE 'parmodel'
C
      PARAMETER (NIM= IIJRAD, NJM=46, NLM= IKM, NLS=02)
      PARAMETER (NNQFDS=5, NOFDS=2, NQIFDS=5, NOIFDS=8
     *,      NNQP3=21, NNQP2=59, N2DFDS=29, NEQO3O=01)
      PARAMETER (NIMP1=NIM+1,NIMP2=NIM+2,NIMP3=NIM+3,NIMD2=NIM/2+1/NIM
     *,     NLMM2=NLM-2, NLSP1=NLS+1, LMM1T2=(NLM-1)*2
     *,     IMD2P1=NIM/2+1, NJMM2=NJM-2, NLMP1=NLM+1, NLMM1=NLM-1
     *,     N1=NLM*NQIFDS+NOIFDS
     *,     N2=NLM*NNQFDS+NOFDS, N3=NIMP2*N2
     *,     NIMT2=NIM*2,N6=NIMP2*N1,NILPT=NIM*NLM
     *,     NNQPFD = NNQP3 + (NNQP2-1)/NLM + 1
     *,     NN5= NNQP3+ (NNQP2+(N2DFDS*NIM-1)/NIMP2)/NLM + 3
     *,     NN6 = NN5*NLM,NN1 = N1 - 1
     *,     N5= NIMP2*NN6, NTDSG =NLM-NLSP1
     *,     NNBITX=NIMP2*NLM
     *,     NPG=(NN1*NIMP2*NJMM2-1)/131072 + 1
     *,     N55=N5-2*NLM*NIMP2
     *,     NTL=(N55*NJMM2-1)/131072 + 1)
C
C
      PARAMETER (NNP=NLM+2, NNPP1=NNP+1, NNPBIT=NIM*NNPP1)
C...TRANSLATED BY FPP 3.00Z36 11/09/90  14:51:41  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C
      COMMON  TXUF(NIM,NNP,NNP),CS(NIM,NNP,NNP)
     *,X1(NIM,NNPP1),X2(NIM,NNPP1),TV1(NIM,NNPP1),DP(NIM,NNP)
     *,CSS(NIM,NNP),CCU(NIM,NNP),CH(NIM,NNP),WDEL(NIM,NLMP1)
     *,ZW(NIM,NLMP1),IT(NIM,NNPP1),X4(NIM,NNP),X3(NIM,NNP)
     *,CC(NIM,NNPP1),TV2(NIM,NNPP1),TUI2(NIM,NNPP1),SHI(NIM,NNP)
     *,RAWI(NIM,NNPP1),WV(NIM,NLMP1),YV(NIM,NLMP1),TUI(NIM,NNPP1)
     *,ZV(NIM,NLMP1),WW(NIM,NLMP1),YW(NIM,NLMP1),SHU(NIM,NLMP1)
     *,SHH(NIM,NNP),SUM(NIM),FU(NIM,NLMP1),FW(NIM,NLMP1)
     *,ADEL(NIM,NLMP1),BDEL(NIM,NLMP1),SUMSAV(NIM)
C
      DIMENSION PAI(NIM,NNP),FLUXU(NIM,NNP),UBAR(NIM,NNP),VBAR(NIM,NNP)
     *,WBAR(NIM,NNP),UBARM(NIM,NNP),OZAI(NIM,NNP),WBARM(NIM,NNP)
     *,TAI(NIM,NNP),FLUXD(NIM,NNP),VBARM(NIM,NNP)
C
      EQUIVALENCE (PAI(1,1)  ,CS(1,1,1)),    (FLUXU(1,1),CS(1,1,2))
     *,           (UBAR(1,1) ,CS(1,1,3)),    (VBAR(1,1) ,CS(1,1,4))
     *,           (WBAR(1,1) ,CS(1,1,5)),    (UBARM(1,1),CS(1,1,6))
     *,           (OZAI(1,1) ,CS(1,1,7)),    (WBARM(1,1),CS(1,1,8))
     *,           (TAI(1,1)  ,CS(1,1,9)),    (FLUXD(1,1),CS(1,1,10))
     *,           (VBARM(1,1),CS(1,1,11))
C
      COMMON /H2O/ NP,LM,IM,LMP1,LS,IMNP,IMLMP1,H1P,H0P,H1P5,HP5
     *,IMLM,IMNPNP,NPP1,IMNPP1,NTM1,DTB,DTBINV,PR(2),OZONE,DUM
C
      DIMENSION B2501(32),B2502(32),BLKWIN(32),BLKCO2(32)
C
      LOGICAL OZONE
C
      INTEGER I,I1X,I2X,I3X,I4X,I5X,I6X,I7X,ISYS,I8X
      REAL TMP,V
      PARAMETER (ISYS = 1)
      DATA HP25/2.6E-1/,     TEMP1/1.65E02/,     H250P/2.50E02/
     *,    PP/1.0E0/
C
      DATA B2501 / 16.280E0, 17.471E0, 18.701E0, 19.974E0, 21.292E0
     *,            22.661E0, 24.086E0, 25.575E0, 27.135E0, 28.775E0
     *,            30.506E0, 32.339E0, 34.286E0, 36.361E0, 38.578E0
     *,            40.954E0, 43.505E0, 46.248E0, 49.203E0, 52.388E0
     *,            55.824E0, 59.532E0, 63.533E0, 67.849E0, 72.502E0
     *,            77.516E0, 82.913E0, 88.717E0, 94.952E0, 101.64E0
     *,           108.806E0,116.472E0/
C
      DATA B2502 / 16.379E0, 18.744E0, 21.345E0, 24.195E0,  27.311E0
     *,            30.708E0, 34.405E0, 38.417E0, 42.763E0,  47.461E0
     *,            52.529E0, 57.985E0, 63.850E0, 70.141E0,  76.880E0
     *,            84.088E0, 91.784E0,  99.99E0,108.726E0, 118.016E0
     *,           127.881E0,138.344E0,149.429E0,161.160E0, 173.561E0
     *,           186.659E0,200.478E0,215.046E0,230.390E0, 246.539E0
     *,           263.523E0,281.368E0/
C
      DATA BLKWIN/ 0.593E0, 0.774E0, 0.993E0, 1.258E0, 1.573E0
     *,            1.944E0, 2.377E0, 2.877E0, 3.450E0, 4.102E0
     *,            4.838E0, 5.664E0, 6.585E0, 7.606E0, 8.733E0
     *,            9.969E0,11.320E0,12.788E0,14.380E0,16.097E0
     *,           17.944E0,19.923E0,22.038E0,24.292E0,26.685E0
     *,           29.221E0,31.902E0,34.729E0,37.703E0,40.825E0
     *,           44.097E0,47.520E0/
C
C        NEW PLANCK FUNCTION (WIDE BAND)
C
      DATA BLKCO2/  8.789E0, 10.385E0, 12.159E0, 14.117E0, 16.264E0
     *,            18.606E0, 21.145E0, 23.884E0, 26.826E0, 29.973E0
     *,            33.325E0, 36.883E0, 40.647E0, 44.617E0, 48.792E0
     *,            53.170E0, 57.750E0, 62.530E0, 67.509E0, 72.683E0
     *,            78.050E0, 83.609E0, 89.354E0, 95.285E0,101.397E0
     *,           107.688E0,114.155E0,120.794E0,127.601E0,134.574E0
     *,           141.710E0,149.004E0/
C
CMIC$ PARALLEL SHARED(IMNPP1, IT, B2501, X1, X2, TEMP1, DTBINV, H1P5, 
CMIC$1   NTM1, H1P, DTB, TUI, RAWI, IMNPNP, H0P, TXUF, IM, SHI) PRIVATE(
CMIC$2   I, I1X, IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 88890 IQ2=1,IM
         SHI(IQ2,1)=H0P
88890 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 88900 IQ2=1,IMNPNP
         TXUF(IQ2,1,1)=H0P
88900 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 88910 IQ2=1,IMNPP1
         RAWI(IQ2,1)=(TUI(IQ2,1)-TEMP1)*DTBINV+H1P5
         IT(IQ2,1)=RAWI(IQ2,1)
         IF ( IT(IQ2,1) .GT. NTM1 ) IT(IQ2,1) = NTM1
         IF ( IT(IQ2,1) .LT. 1    ) IT(IQ2,1) = 1
         RAWI(IQ2,1)=IT(IQ2,1)-H1P
         RAWI(IQ2,1)=TUI(IQ2,1)-(TEMP1+RAWI(IQ2,1)*DTB)
         RAWI(IQ2,1)=RAWI(IQ2,1)*DTBINV
88910 CONTINUE
C
C
C*****  Code Expanded From Routine:  RDHGATHR
CMIC$ DO PARALLEL VECTOR
      DO 77001 I = 1, IMNPP1
         X1(I,1) = B2501(IT(I,1))
         X2(I,1) = B2501(IT(I,1)+1)
77001 CONTINUE
CMIC$ END PARALLEL
C*****  End of Code Expanded From Routine:  RDHGATHR
CMIC$ PARALLEL SHARED(IMNPP1, IT, B2502, X2, X1, RAWI, TV1) PRIVATE(I2X
CMIC$1   , I3X, IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 88980 IQ2=1,IMNPP1
         TV1(IQ2,1)=X1(IQ2,1)+(X2(IQ2,1)-X1(IQ2,1))*R
     *   AWI(IQ2,1)
88980 CONTINUE
C*****  Code Expanded From Routine:  RDHGATHR
CMIC$ DO PARALLEL VECTOR
      DO 77003 I2X = 1, IMNPP1
         X2(I2X,1) = B2502(IT(I2X,1)+1)
         X1(I2X,1) = B2502(IT(I2X,1))
77003 CONTINUE
CMIC$ END PARALLEL
C*****  End of Code Expanded From Routine:  RDHGATHR
CMIC$ PARALLEL SHARED(IMNPP1, IT, BLKCO2, X1, X2, H250P, TUI, TUI2, IM, 
CMIC$1   NPP1, TV1, TV2, SUMSAV, IMNP, SHH, RAWI) PRIVATE(I4X, I5X, IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 88990 IQ2=1,IMNPP1
         TV2(IQ2,1)=X1(IQ2,1)+(X2(IQ2,1)-X1(IQ2,1))*R
     *   AWI(IQ2,1)
88990 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89000 IQ2=1,IMNP
         SHH(IQ2,1)=TV1(IQ2,1)+TV2(IQ2,1)
89000 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89010 IQ2=1,IM
         SUMSAV(IQ2)=TV1(IQ2,NPP1)+TV2(IQ2,NPP1)
89010 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89020 IQ2=1,IMNPP1
         TUI(IQ2,1)=TUI(IQ2,1)-H250P
         TUI2(IQ2,1)=TUI(IQ2,1)*TUI(IQ2,1)
89020 CONTINUE
C
C     CARBON DIOXIDE AND OZONE FLUXES ARE CALCULATED HERE.
C
C*****  Code Expanded From Routine:  RDHGATHR
CMIC$ DO PARALLEL VECTOR
      DO 77005 I4X = 1, IMNPP1
         X1(I4X,1) = BLKCO2(IT(I4X,1)+1)
         X2(I4X,1) = BLKCO2(IT(I4X,1))
77005 CONTINUE
CMIC$ END PARALLEL
C*****  End of Code Expanded From Routine:  RDHGATHR
CMIC$ PARALLEL SHARED(IMNPP1, IT, BLKWIN, X2, X1, RAWI, CC) PRIVATE(I6X
CMIC$1   , I7X, IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89040 IQ2=1,IMNPP1
         CC(IQ2,1)=X2(IQ2,1)+(X1(IQ2,1)-X2(IQ2,1))*RA
     *   WI(IQ2,1)
89040 CONTINUE
C*****  Code Expanded From Routine:  RDHGATHR
CMIC$ DO PARALLEL VECTOR
      DO 77007 I6X = 1, IMNPP1
         X2(I6X,1) = BLKWIN(IT(I6X,1))
         X1(I6X,1) = BLKWIN(IT(I6X,1)+1)
77007 CONTINUE
CMIC$ END PARALLEL
C*****  End of Code Expanded From Routine:  RDHGATHR
CMIC$ PARALLEL SHARED(IMLMP1, PP, PAI, X1, PR, FW, IM, H0P, TAI, CH, 
CMIC$1   IMNPP1, X2, RAWI) PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89050 IQ2=1,IMNPP1
         RAWI(IQ2,1)=X2(IQ2,1)+(X1(IQ2,1)-X2(IQ2,1))*RAWI(
     *   IQ2,1)
89050 CONTINUE
C
C     COMPUTE TRANSMITTANCES IN THE 15 MICRON AND 9.6 MICRON BANDS.
C
CMIC$ DO PARALLEL VECTOR
      DO 89060 IQ2 = 1, IMLMP1
         CH(IQ2,2) = EXP(2.5E-2*(TAI(IQ2,2)-240.0E0))
         TAI(IQ2,2) = EXP(8.9E-3*(TAI(IQ2,2)-240.0E0))
89060 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89080 IQ2=1,IM
         TAI(IQ2,1)=H0P
         CH(IQ2,1)=H0P
89080 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89100 IQ2 = 1, IMLMP1
         X1(IQ2,1) = PAI(IQ2,1)
         IF (PAI(IQ2,1) .LT. PP) X1(IQ2,1) = PP
         FW(IQ2,1) = X1(IQ2,1)*PR(1)
89100 CONTINUE
CMIC$ END PARALLEL
C*****  Code Expanded From Routine:  RDEXP85
CMIC$ DO ALL VECTOR SHARED(IMLMP1, FW, X2) PRIVATE(I8X)
      DO 77010 I8X = 1, IMLMP1
         X2(I8X,1) = FW(I8X,1)**0.849609375
77010 CONTINUE
C*****  End of Code Expanded From Routine:  RDEXP85
CMIC$ DO ALL VECTOR SHARED(IMLMP1, HP25, X2, TAI, X1, PR, CH, DP)
CMIC$1    PRIVATE(IQ2)
      DO 89130 IQ2 = 1, IMLMP1
         TAI(IQ2,2) = X2(IQ2,1)*TAI(IQ2,2)
         CH(IQ2,2) = SQRT(X1(IQ2,1)*PR(2))*CH(IQ2,2)
         TAI(IQ2,2) = DP(IQ2,2)*TAI(IQ2,2)*HP25
         CH(IQ2,2) = DP(IQ2,2)*CH(IQ2,2)*HP25
89130 CONTINUE
CMIC$ PARALLEL SHARED(IM, TAI, CH, NP) PRIVATE(IQ2, IP)
      DO 20 IP=2,NP
CMIC$ DO PARALLEL VECTOR
      DO 89190 IQ2=1,IM
         TAI(IQ2,IP)=TAI(IQ2,IP-1)+TAI(IQ2,IP)
         CH(IQ2,IP)=CH(IQ2,IP-1)+CH(IQ2,IP)
89190 CONTINUE
   20 CONTINUE
CMIC$ END PARALLEL
C
CMIC$ DO ALL VECTOR SHARED(IMLMP1, HP5, TAI, CSS, CH, CCU) PRIVATE(IQ2)
      DO 89210 IQ2=1,IMLMP1
         CSS(IQ2,2)=(TAI(IQ2,2)+TAI(IQ2,1))*HP5
         CCU(IQ2,2)=(CH(IQ2,2)+CH(IQ2,1))*HP5
89210 CONTINUE
C
      IF (.NOT. OZONE) GOTO 35
C
CMIC$ PARALLEL SHARED(IMLMP1, PAI, OZAI, FLUXD, IMNP, H0P, FLUXU, IM)
CMIC$1    PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89230 IQ2=1,IM
         FLUXD(IQ2,1)=H0P
89230 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89240 IQ2=1,IMNP
         FLUXU(IQ2,1)=H0P
89240 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89250 IQ2=1,IMLMP1
         FLUXD(IQ2,2)=PAI(IQ2,1)*OZAI(IQ2,2)
89250 CONTINUE
CMIC$ END PARALLEL
CMIC$ PARALLEL SHARED(IM, FLUXD, FLUXU, OZAI, NP) PRIVATE(IQ2, IX)
      DO 30 IX=2,NP
CMIC$ DO PARALLEL VECTOR
      DO 89260 IQ2=1,IM
         FLUXD(IQ2,IX)=FLUXD(IQ2,IX-1)+FLUXD(IQ2,IX)
         FLUXU(IQ2,IX)=FLUXU(IQ2,IX-1)+OZAI(IQ2,IX)
89260 CONTINUE
   30 CONTINUE
CMIC$ END PARALLEL
CMIC$ DO ALL VECTOR SHARED(IMLMP1, HP5, FLUXD, PAI, FLUXU, OZAI, WDEL, 
CMIC$1   FW) PRIVATE(IQ2)
      DO 89280 IQ2=1,IMLMP1
         PAI(IQ2,2)=(FLUXD(IQ2,1)+FLUXD(IQ2,2))*HP5
         OZAI(IQ2,2)=(FLUXU(IQ2,1)+FLUXU(IQ2,2))*HP5
         WDEL(IQ2,1)=ABS(FLUXU(IQ2,2))
         FW(IQ2,1)=ABS(FLUXD(IQ2,2))
89280 CONTINUE
C
   35 INDX1 = 1
      INDX2 = 1
C
      CALL LWCRUNCH(INDX1,INDX2)
C
      INDX1 = 2
      INDX2 = 2
C
      CALL LWCRUNCH(INDX1,INDX2)
C
C     DOWNWARD FLUX TXUF FOR WATER VAPOR
C
      INDX1 = 2
      INDX2 = NP
C
      CALL LWCRUNCH(INDX1,INDX2)
C
C     UPWARD FLUX TXUF FOR WATER VAPOR
C
      INDX1 = 1
      INDX2 = LMP1
C
      CALL LWCRUNCH(INDX1,INDX2)
C
CMIC$ PARALLEL SHARED(IM,NPP1,SUMSAV,RAWI,CC,IMNP,SHH)PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89320 IQ2=1,IMNP
         SHH(IQ2,1)=SHH(IQ2,1)+RAWI(IQ2,1)+CC(IQ2,1)
89320 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89330 IQ2=1,IM
         SUMSAV(IQ2)=SUMSAV(IQ2)+RAWI(IQ2,NPP1)+CC(IQ2,NPP1)
89330 CONTINUE
CMIC$ END PARALLEL
C
      RETURN
      END
