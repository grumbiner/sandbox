      SUBROUTINE SWSET
C
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    SWSET       TO SETUP SW CALCULATIONS
C   PRGMMR: J TUCCILLO       ORG: W/NMC4      DATE: 90-06-17
C
C ABSTRACT:    SETS UP SHORTWAVE CALCULATIONS
C   .
C
C PROGRAM HISTORY LOG:
C   90-06-17  J TUCCILLO
C
C USAGE:  CALL SWSET
C   SUBPROGRAMS CALLED:
C     UNIQUE:    - SWCLEAR
C                  SWCLOUDY
C     LIBRARY:
C       COMMON   - BLANK COMMON
C
C REMARKS:
C   - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   .            INFORMATION PASSED THROUGH COMMON
C   .
C   - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   .            INFORMATION PASSED THROUGH COMMON
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN
C   MACHINE:  CRAY Y-MP
C
C$$$
C
      INCLUDE 'parmodel'
C
      PARAMETER (NIM= IIJRAD, NJM=46, NLM= IKM, NLS=02)
      PARAMETER (NNQFDS=5, NOFDS=2, NQIFDS=5, NOIFDS=8
     *,      NNQP3=21, NNQP2=59, N2DFDS=29, NEQO3O=01)
      PARAMETER (NIMP1=NIM+1,NIMP2=NIM+2,NIMP3=NIM+3,NIMD2=NIM/2+1/NIM
     *,     NLMM2=NLM-2, NLSP1=NLS+1, LMM1T2=(NLM-1)*2
     *,     IMD2P1=NIM/2+1, NJMM2=NJM-2, NLMP1=NLM+1, NLMM1=NLM-1
     *,     N1=NLM*NQIFDS+NOIFDS
     *,     N2=NLM*NNQFDS+NOFDS, N3=NIMP2*N2
     *,     NIMT2=NIM*2,N6=NIMP2*N1,NILPT=NIM*NLM
     *,     NNQPFD = NNQP3 + (NNQP2-1)/NLM + 1
     *,     NN5= NNQP3+ (NNQP2+(N2DFDS*NIM-1)/NIMP2)/NLM + 3
     *,     NN6 = NN5*NLM,NN1 = N1 - 1
     *,     N5= NIMP2*NN6, NTDSG =NLM-NLSP1
     *,     NNBITX=NIM*NLM
     *,     NPG=(NN1*NIMP2*NJMM2-1)/131072 + 1
     *,     N55=N5-2*NLM*NIMP2
     *,     NTL=(N55*NJMM2-1)/131072 + 1)
C
      PARAMETER (NNP=NLMP1+1,IMLMP1=NIM*NLMP1,IMNNP=NIM*NNP
     *,          ILP1=NIM*NLMP1)
C...TRANSLATED BY FPP 3.00Z36 11/09/90  15:03:44  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C
      DIMENSION ARG1(NIM),A1(NIM),E1(NIM),UPIM(NIM),DNIM(NIM)
     *,    RC1(NIM),TLIM(NIM),G(NIM),TAUI(NIM),B1(NIM),C1(NIM)
C
      INTEGER ICL(NIM), ICC(NIM)
C
      LOGICAL BITX(ILP1), BITC(IMNNP), BITD(IMNNP)
C
      COMMON  IM,NP,NPP1,LMP1,LS1,LS,NSOL,NSOLP1,NSLMP1,NSOLNP,DOOZ
     *,       SQRT3,GG,GGP,GGSQ,NCLD,NCLDP1,NCLMP1,NCLDNP,RCN1
     *,       ATHRD,TTHRD,RCN2
     *,       PU(IMNNP),TA(IMLMP1),WA(IMLMP1),OA(IMLMP1),E0(IMLMP1)
     *,       DP(IMLMP1),DPC(IMLMP1),W(IMNNP),DN(IMNNP),UP(IMNNP)
     *,       AG(NIM),RSURF(NIM),AGCD(NIM),RSRCD(NIM),VM(IMNNP)
     *,       SCOSZ(NIM),CMU(NIM),COSMAG(NIM),CSMCLD(NIM),SCZCD(NIM)
     *,       CMUC(NIM),SCOSC(NIM),CSS(IMLMP1),CCU(IMLMP1),VP(IMNNP)
     *,       SL(NIM),ACLR(IMLMP1),DSCLR(NIM),SC(NIM),ACLD(ILP1)
     *,       TAUC(IMLMP1),TAUT(NIM),RCO(NIM),RCG(NIM),CM(IMNNP)
     *,       OZALE(IMNNP),OZCD(IMNNP),RLO(NIM),RLG(NIM),DL(IMNNP)
     *,       SWIL(IMLMP1),SWALE(IMNNP),SWILC(IMLMP1),DEN(IMLMP1)
     *,       F2(IMLMP1),CR(IMNNP),E2(IMLMP1)
     *,       U1(IMLMP1),AK(IMLMP1),DA(IMLMP1),DB(IMLMP1)
     *,       ALF1(IMLMP1),ALF2(IMLMP1)
     *,       UL(IMNNP)
     *,       SOL(IMNNP),DSCLD(NIM),BITX,BITC,BITD
C
      LOGICAL DOOZ
C
C     COMPUTE ALBEDO OF SURFACE FOR DIRECT BEAM
C
CMIC$ DO ALL VECTOR SHARED(NSOL, AG, CMU, RSURF) PRIVATE(IQ2W6E, RG)
      DO 88890 IQ2W6E=1,NSOL
         RG=
     *   AMAX1(((AG(IQ2W6E)-0.054313E0)*1.0574323E0),0.0)
         RSURF(IQ2W6E)=RG+(1.0E0-RG)*
     *                 EXP(5.72957795E0*ACOS(CMU(IQ2W6E))-9.0E0)
88890 CONTINUE
C
C     ZERO OUT OZONE BELOW 500 MB
C
      IF (DOOZ) THEN
CMIC$ PARALLEL SHARED(NSLMP1, OA, DP, NSOL, OZALE, NSOLP1, PU) PRIVATE(
CMIC$1   IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 88950 IQ2W6E=1,NSLMP1
         IF (PU(NSOLP1+IQ2W6E-1).GT.500.0E0) OA(IQ2W6E) = 0.E0
88950 CONTINUE
C
C        COMPUTE OZONE AND WATER VAPOR AMOUNTS
C
CMIC$ DO PARALLEL VECTOR
      DO 88960 IQ2W6E=1,NSOL
         OZALE(IQ2W6E)=0.0E0
88960 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 88970 IQ2W6E=1,NSLMP1
         OA(IQ2W6E)=476.0E0*OA(IQ2W6E)*DP(IQ2W6E)
88970 CONTINUE
CMIC$ END PARALLEL
C
CFPP$ NOCONCUR L
         DO 50 L=2,NP
         L0 = (L-2) * NSOL + 1
         L1 = (L-1) * NSOL + 1
CMIC$ DO ALL VECTOR SHARED(NSOL, L0, L1, OZALE, OA) PRIVATE(IQ2W6E)
      DO 88980 IQ2W6E=1,NSOL
         OZALE(L1+IQ2W6E-1)=OZALE(L0+IQ2W6E-1)+OA(L0+IQ2W6E-1)
88980 CONTINUE
   50    CONTINUE
      END IF
C
CMIC$ PARALLEL SHARED(NSLMP1, NSOLP1, PU, WA, TA, SWIL, NSOLNP, NSOL, 
CMIC$1   SWALE) PRIVATE(IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 88990 IQ2W6E=1,NSOL
         SWALE(IQ2W6E)=0.0E0
88990 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89000 IQ2W6E=1,NSOLNP
         PU(IQ2W6E)=PU(IQ2W6E)*PU(IQ2W6E)
89000 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89010 IQ2W6E=1,NSLMP1
         SWIL(IQ2W6E)=(PU(NSOLP1+IQ2W6E-1)-PU(IQ2W6E))*WA(IQ2W6E)/
     *               ( 120.1621E0 * SQRT(TA(IQ2W6E)))
89010 CONTINUE
CMIC$ END PARALLEL
C
CFPP$ NOCONCUR L
      DO 70 L=2,NP
      L0 = (L-2) * NSOL + 1
      L1 = (L-1) * NSOL + 1
CMIC$ DO ALL VECTOR SHARED(NSOL, L0, L1, SWALE, SWIL) PRIVATE(IQ2W6E)
      DO 89040 IQ2W6E=1,NSOL
         SWALE(L1+IQ2W6E-1)=SWALE(L0+IQ2W6E-1)+SWIL(L0+IQ2W6E-1)
89040 CONTINUE
   70 CONTINUE
C
C     COMPUTE CLEAR SKY REFLECTIVITIES
C     CLEAR SKY OZONE REFLECTION, TAURAY=0.85
C
CMIC$ DO ALL VECTOR SHARED(NSOL, RCN1, TTHRD, ATHRD, RCN2, COSMAG, E1, 
CMIC$1   CMU, B1, C1, A1, UPIM, DNIM, RSURF, AG, RLO, RLG) PRIVATE(
CMIC$2   IQ2W6E)
      DO 89050 IQ2W6E = 1, NSOL
         E1(IQ2W6E) = EXP((-0.85E0*COSMAG(IQ2W6E)))
         B1(IQ2W6E) = 3.0E0*CMU(IQ2W6E)
         C1(IQ2W6E) = 2.0E0 - B1(IQ2W6E)
         B1(IQ2W6E) = 2.0E0 + B1(IQ2W6E)
         A1(IQ2W6E) = (B1(IQ2W6E)+C1(IQ2W6E)*E1(IQ2W6E))*RCN1
         UPIM(IQ2W6E) = 1.0E0 - A1(IQ2W6E)
         DNIM(IQ2W6E) = A1(IQ2W6E) - E1(IQ2W6E)
         RLO(IQ2W6E) = UPIM(IQ2W6E) + (E1(IQ2W6E)*RSURF(IQ2W6E)+DNIM(
     1      IQ2W6E)*AG(IQ2W6E))*0.576E0/(1.0E0-0.424E0*AG(IQ2W6E))
         RLO(IQ2W6E) = TTHRD*RSURF(IQ2W6E) + ATHRD*RLO(IQ2W6E)
         E1(IQ2W6E) = EXP((-0.118E0*COSMAG(IQ2W6E)))
         A1(IQ2W6E) = (B1(IQ2W6E)+C1(IQ2W6E)*E1(IQ2W6E))*RCN2
         UPIM(IQ2W6E) = 1.0E0 - A1(IQ2W6E)
         DNIM(IQ2W6E) = A1(IQ2W6E) - E1(IQ2W6E)
         RLG(IQ2W6E) = UPIM(IQ2W6E) + (E1(IQ2W6E)*RSURF(IQ2W6E)+DNIM(
     1      IQ2W6E)*AG(IQ2W6E))*0.907284E0/(1.0E0-0.092716E0*AG(IQ2W6E))
89050 CONTINUE
C
C
C        CLEAR SKY COMPUTATIONS
C
C
      CALL SWCLEAR
C
C     FIND CLOUD TOP
C
CMIC$ PARALLEL SHARED(NSOL, NP, ICC, NSLMP1, CCU, CSS) PRIVATE(IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 89210 IQ2W6E=1,NSLMP1
         IF (CCU(IQ2W6E).GT.CSS(IQ2W6E)) CSS(IQ2W6E)=CCU(IQ2W6E)
89210 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89220 IQ2W6E=1,NSOL
         ICC(IQ2W6E)=NP
89220 CONTINUE
CMIC$ END PARALLEL
CFPP$ NOCONCUR L
      DO 120 K=1,LMP1
      L=NP-K
      L0 = (L-1) * NSOL + 1
CMIC$ DO ALL VECTOR SHARED(NSOL, L0, L, CSS, ICC) PRIVATE(IQ2W6E)
      DO 89230 IQ2W6E=1,NSOL
         IF (CSS(L0+IQ2W6E-1).GT.0.0E0) ICC(IQ2W6E) = L
89230 CONTINUE
  120 CONTINUE
C
CMIC$ DO ALL VECTOR SHARED(NSOL, NP, ICC, BITD) PRIVATE(IQ2W6E)
      DO 89240 IQ2W6E=1,NSOL
         BITD(IQ2W6E)=ICC(IQ2W6E).NE.NP
89240 CONTINUE
      NCLD = 0
      DO 1005 I = 1, NSOL
         IF ( BITD(I) ) NCLD = NCLD + 1
1005  CONTINUE
C
C
      IF (NCLD .EQ. 0) THEN
CMIC$ PARALLEL SHARED(NSOL, SL, SC, DSCLR, DSCLD, NSLMP1, ACLR, ACLD)
CMIC$1    PRIVATE(IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 89250 IQ2W6E=1,NSLMP1
         ACLD(IQ2W6E)=ACLR(IQ2W6E)
89250 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89260 IQ2W6E=1,NSOL
         SC(IQ2W6E)=SL(IQ2W6E)
         DSCLD(IQ2W6E)=DSCLR(IQ2W6E)
89260 CONTINUE
CMIC$ END PARALLEL
      RETURN
      END IF
C
      NCLDP1 = NCLD + 1
      NCLMP1 = NCLD * LMP1
      NCLDNP = NCLD * NP
 
CMIC$ DO ALL SHARED(LMP1, NSOL, BITD) PRIVATE(L, L1, IQ2W6E)
      DO 130 L=1,LMP1
      L1 = L * NSOL + 1
      DO 89280 IQ2W6E=1,NSOL
         BITD(L1+IQ2W6E-1)=BITD(IQ2W6E)
89280 CONTINUE
  130 CONTINUE
C
C     COMPRESS OUT CLOUDY GRID POINT VALUES FOR OZONE AMT., WATER AMT.,
C     SCOSZ, ETC.
C
      IN = 1
CFPP$ NOCONCUR L
      DO 6001 I = 1, NSOL
         IF ( BITD(I) ) THEN
            ICL(IN)     = ICC(I)
            CMUC(IN)    = CMU(I)
            AGCD(IN)    = AG(I)
            RSRCD(IN)   = RSURF(I)
            SCOSC(IN)   = SCOSZ(I)
            CSMCLD(IN)  = COSMAG(I)
            IN = IN + 1
         END IF
6001  CONTINUE
      IN = 1
CFPP$ NOCONCUR L
      DO 6004 I = 1, NSLMP1
         IF ( BITD(I) ) THEN
              SWILC(IN) = SWIL(I)
              IN = IN + 1
         END IF
6004  CONTINUE
C
      IF (DOOZ) THEN
         IN = 1
CFPP$ NOCONCUR L
         DO 6002 I = 1, NSOLNP
            IF ( BITD(I))  THEN
                OZCD(IN) = OZALE(I)
                IN = IN + 1
            END IF
6002     CONTINUE
C
C        MAKE OZONE AMOUNT CONSTANT BELOW CLOUD TOP
C
CFPP$ NOCONCUR L
         DO 140 L=1,LMP1
         L0 = (L-1) * NCLD + 1
         L1 =  L    * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L, L0, L1, ICL, OZCD) PRIVATE(IQ2W6E)
      DO 89290 IQ2W6E=1,NCLD
         IF (ICL(IQ2W6E).LE.L) OZCD(IQ2W6E+L1-1)=OZCD(IQ2W6E+L0-1)
89290 CONTINUE
  140    CONTINUE
      END IF
C
C     COMPUTE CLOUD OPTICAL DEPTH
C
      ACLDL = 0.1E0
      ACLDF = ACLDL * 0.5E0
CMIC$ DO ALL VECTOR SHARED(NSLMP1, ACLDF, ACLDL, TA, CCU, E0, DPC, CSS)
CMIC$1    PRIVATE(IQ2W6E)
      DO 89300 IQ2W6E = 1, NSLMP1
         IF (TA(IQ2W6E).LT.253.0E0 .AND. CCU(IQ2W6E).EQ.0.0E0) THEN
            E0(IQ2W6E) = ACLDF
         ELSE
            E0(IQ2W6E) = ACLDL
         ENDIF
         E0(IQ2W6E) = E0(IQ2W6E)*DPC(IQ2W6E)*CSS(IQ2W6E)
89300 CONTINUE
      IN = 1
CFPP$ NOCONCUR L
      DO 8003 I = 1, NSLMP1
         IF ( BITD(I) ) THEN
            TAUC(IN) = E0(I)
            IN = IN + 1
         END IF
8003  CONTINUE
C
CMIC$ DO ALL VECTOR SHARED(NCLD, TAUT) PRIVATE(IQ2W6E)
      DO 89330 IQ2W6E=1,NCLD
         TAUT(IQ2W6E)=0.0E0
89330 CONTINUE
C
      DO 180 L=1,LMP1
      L0 = (L-1) * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L0, TAUT, TAUC) PRIVATE(IQ2W6E)
      DO 89340 IQ2W6E=1,NCLD
         TAUT(IQ2W6E)=TAUT(IQ2W6E)+TAUC(L0+IQ2W6E-1)
89340 CONTINUE
  180 CONTINUE
C
C     COMPUTE CLOUDY SKY REFLECTIVITIES
C     CLOUDY SKY OZONE REFLECTION, TAURAY=0.0, GCLD=0.85
C
CMIC$ DO ALL VECTOR SHARED(NCLD, TTHRD, ATHRD, TAUT, TLIM, CSMCLD, E1, 
CMIC$1   CMUC, B1, C1, A1, UPIM, DNIM, RSRCD, AGCD, RC1, TAUI, G, ARG1, 
CMIC$2   RCO, RCG) PRIVATE(IQ2W6E)
      DO 89350 IQ2W6E = 1, NCLD
         TLIM(IQ2W6E) = 1.0E0/(1.0E0+0.1299E0*TAUT(IQ2W6E))
         E1(IQ2W6E) = EXP((-0.2775E0*TAUT(IQ2W6E)*CSMCLD(IQ2W6E)))
         B1(IQ2W6E) = 3.0E0*CMUC(IQ2W6E)
         C1(IQ2W6E) = 2.0E0 - B1(IQ2W6E)
         B1(IQ2W6E) = 2.0E0 + B1(IQ2W6E)
         A1(IQ2W6E) = B1(IQ2W6E) + C1(IQ2W6E)*E1(IQ2W6E)
         A1(IQ2W6E) = A1(IQ2W6E)/(4.0E0+0.45E0*TAUT(IQ2W6E))
         UPIM(IQ2W6E) = 1.0E0 - A1(IQ2W6E)
         DNIM(IQ2W6E) = A1(IQ2W6E) - E1(IQ2W6E)
         RC1(IQ2W6E) = UPIM(IQ2W6E) + (E1(IQ2W6E)*RSRCD(IQ2W6E)+DNIM(
     1      IQ2W6E)*AGCD(IQ2W6E))*TLIM(IQ2W6E)/(1.0E0-(1.0E0-TLIM(IQ2W6E
     2      ))*AGCD(IQ2W6E))
         TAUI(IQ2W6E) = TAUT(IQ2W6E) + 0.85E0
         G(IQ2W6E) = 0.85E0*TAUT(IQ2W6E)/TAUI(IQ2W6E)
         TLIM(IQ2W6E) = 1.0E0/(1.0E0+0.866E0*(1.0E0-G(IQ2W6E))*TAUI(
     1      IQ2W6E))
         ARG1(IQ2W6E) = (1.0E0-G(IQ2W6E)*G(IQ2W6E))*TAUI(IQ2W6E)*CSMCLD(
     1      IQ2W6E)
         E1(IQ2W6E) = EXP((-ARG1(IQ2W6E)))
         A1(IQ2W6E) = B1(IQ2W6E) + C1(IQ2W6E)*E1(IQ2W6E)
         A1(IQ2W6E) = A1(IQ2W6E)/(4.0E0+3.0E0*(1.0E0-G(IQ2W6E))*TAUI(
     1      IQ2W6E))
         UPIM(IQ2W6E) = 1.0E0 - A1(IQ2W6E)
         DNIM(IQ2W6E) = A1(IQ2W6E) - E1(IQ2W6E)
         RCO(IQ2W6E) = UPIM(IQ2W6E) + (E1(IQ2W6E)*RSRCD(IQ2W6E)+DNIM(
     1      IQ2W6E)*AGCD(IQ2W6E))*TLIM(IQ2W6E)/(1.0E0-(1.0E0-TLIM(IQ2W6E
     2      ))*AGCD(IQ2W6E))
         RCO(IQ2W6E) = TTHRD*RC1(IQ2W6E) + ATHRD*RCO(IQ2W6E)
         TAUI(IQ2W6E) = TAUT(IQ2W6E) + 0.118E0
         G(IQ2W6E) = 0.85E0*TAUT(IQ2W6E)/TAUI(IQ2W6E)
         TLIM(IQ2W6E) = 1.0E0/(1.0E0+0.866E0*(1.0E0-G(IQ2W6E))*TAUI(
     1      IQ2W6E))
         ARG1(IQ2W6E) = (1.0E0-G(IQ2W6E)*G(IQ2W6E))*TAUI(IQ2W6E)*CSMCLD(
     1      IQ2W6E)
         E1(IQ2W6E) = EXP((-ARG1(IQ2W6E)))
         A1(IQ2W6E) = B1(IQ2W6E) + C1(IQ2W6E)*E1(IQ2W6E)
         A1(IQ2W6E) = A1(IQ2W6E)/(4.0E0+3.0E0*(1.0E0-G(IQ2W6E))*TAUI(
     1      IQ2W6E))
         UPIM(IQ2W6E) = 1.0E0 - A1(IQ2W6E)
         DNIM(IQ2W6E) = A1(IQ2W6E) - E1(IQ2W6E)
         RCG(IQ2W6E) = UPIM(IQ2W6E) + (E1(IQ2W6E)*RSRCD(IQ2W6E)+DNIM(
     1      IQ2W6E)*AGCD(IQ2W6E))*TLIM(IQ2W6E)/(1.0E0-(1.0E0-TLIM(IQ2W6E
     2      ))*AGCD(IQ2W6E))
89350 CONTINUE
C
      CALL SWCLOUDY
C
      RETURN
      END
