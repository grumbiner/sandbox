      SUBROUTINE OUTAREA(PF,IMF,JMF,XPF,YPF,EQPF,IMC,JMC,XPC,YPC,
     1  EQPC,PC,X,IX,I1,I2,J1,J2,IER)
C...TRANSLATED BY FPP 3.00Z36 11/09/90  14:43:03  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    OUTAREA    MAP VALUES FROM HIGH TO COURSE GRID
C   PRGMMR: J TUCCILLO      ORG: W/NMC40    DATE: 90-06-22
C
C ABSTRACT:  THIS ROUTINE
C   DECIDES WHAT RECTANGULAR BLOCK OF COARSE GRID SQUARES
C   CENTERED ON THE COARSE GRID POINTS IS COMPLETELY
C   COVERED BY SIMILAR SQUARES CENTERED ON THE FINE GRID.
C   AFTER ZEROING THE OUTPUT COARSE ARRAY (PC), IT THEN
C   MAPS THE INPUT VARIABLES ON THE FINE GRID POINTS ONTO
C   THE COARSE GRID POINTS WITH WEIGHTS DEPENDING ON THE
C   FRACTIONAL AREA OF A COARSE GRID SQUARE COVERED BY A
C   FINE GRID SQUARE( OR THE OBVIOUS SUBDIVISIONS OF THE
C   LATTER).
C   VALUES (I1,I2,J1,J2) DEFINING THE RECTANGULAR ARRAY
C   OF COARSE GRID VALUES SO MAPPED ARE RETURNED.
C   ERROR RETURNS ARE:
C   IER = 1  THE FINE GRID IS NOT OF HIGHER RESOLUTION
C   .        THAN THE COARSE GRID
C   IER = 2  THE RECTANGULAR BLOCK DOES NOT EXIST.
C   (IER = 0 DENOTES SOME POINTS HAVE BEEN FILLED IN)
C   ****  NOTE THAT NO TEST IS MADE FOR EQUAL ORIENTATION OF THE
C   ****  X AND Y AXES OF THE TWO GRIDS
C   .
C   THE CALLING CODE MUST
C   CHECK OR KNOW THAT THE ARRAYS ARE ORIENTED WITH
C   RESPECT TO LONGITUDE IN THE SAME WAY.  THE CALLING
C   CODE MUST ALSO CHECK THE ERROR RETURN  'IER'  .
C
C PROGRAM HISTORY LOG:
C   90-06-22  J TUCCILLO
C
C USAGE:    CALL OUTAREA(PF,IMF,JMF,XPF,YPF,EQPF,IMC,JMC,XPC,YPC,
C                        EQPC,PC,X,IX,I1,I2,J1,J2,IER)
C   INPUT ARGUMENT LIST:
C     PF       - INPUT HIGH RESOLUTION ARRAY OF DIMENSION
C                ( IMF,JMF)
C     IMF,JMF  - HORIZONTAL DIMENSIONS OF INPUT ARRAY
C     XPF,YPF  - I AND J COORDINATES OF THE NORTH POLE
C                OF THE INPUT ARRAY
C     EQPF     - THE NUMBER OF INPUT GRID MESH INTERVALS
C                BETWEEN POLE AND EQUATOR ( THIS NEED NOT
C                BE AN INTEGER ).
C     IMC,JMC  - HORIZONTAL DIMENSIONS OF THE OUTPUT
C                ARRAY  PC  .
C     XPC,YPC  - I AND J COORDINATES OF THE NORTH POLE
C                OF THE OUTPUT ARRAY
C     EQPC     - THE NUMBER OF OUTPUT GRID MESH INTERVALS
C                BETWEEN THE NORTH POLE AND THE EQUATOR
C                (BOTH EQPC AND EQPF CAN BE MULTIPLED
C                BY A COMMON FACTOR---ONLY THEIR RATIO IS
C                USED, TO DEFINE THE RESOLUTION RATIO.)
C     X        - A HALF PRECISION SCRATCH ARRAY OF SIZE
C                8 * IMF + 1 .
C     IX       - AN INTEGER SCRATCH ARRAY OF SIZE 2 * IMF
C
C   OUTPUT ARGUMENT LIST:
C     PC       - OUTPUT ARRAY OF DIMENSION (IMC,JMC)
C     I1,I2,   - I AND J COORDINATES ON THE COARSE GRID
C     J1,J2      MARKING OUT THE RECTANGULAR BLOCK OF
C                POINTS FOR WHICH VALUES HAVE BEEN PUT
C                INTO ARRAY PC ( OTHER POINTS IN PC WILL
C                HAVE ZEROS.)
C
C REMARKS: MAP VARIABLE VALUES FROM A HIGH RESOLUTION
C   .      CARTESIAN STEREOGRAPHIC GRID TO A COARSER
C   .      RESOLUTION GRID OF THE SAME TYPE, WITH THE
C   .      SAME LONGITUDINAL LOCATION OF THE X-AXIS.
C
C ATTRIBUTES:
C    LANGUAGE: FORTRAN
C    MACHINE:  CRAY Y-MP
C
C$$$
C
      DIMENSION PF(1),PC(1),X(1),IX(1)
C
      DATA ICALL /0/, ICALLB/0/,ICALLC/0/
C
C          SET ERROR RETURN
C
C          SET ERROR RETURN
      IER=0
C
C          ZERO OUT THE OUTPUT ARRAY
      IZERO = IMC * JMC
CMIC$ DO ALL VECTOR SHARED(IZERO, PC) PRIVATE(IQ2W6E)
      DO 88890 IQ2W6E=1,IZERO
         PC(IQ2W6E)=0.E0
88890 CONTINUE
C
C           RATIO OF LARGE TO SMALL GRID INCREMENT SIZE
      B=EQPF/EQPC
C         RETURN IF B IS .LE. ONE
      IF( B .LE. 1.E0 ) THEN
           IER=1
C              DECIDE ON PRINT
      ICALLB = ICALLB + 1
      IF(ICALLB .GT. 2 ) GO TO 4
C
           PRINT 11,IMC,JMC,IMF,JMF,EQPC,EQPF
   11 FORMAT(1H0,2X,'IN SR OUTAREA,B .LT. 1,IMC,JMC,IMF,JMF,',
     1 'EQPC, AND EQPF =',4I6,2E14.6)
    4      CONTINUE
           RETURN
      END IF
C
      BREC=1.E0/B
C          GRID TRANSLATION COEFFICIENTS
      A=XPF-B*XPC
      C=YPF-B*YPC
C         (THE FORMULAE ARE
C     I(SG) = A + B * I(LG)
C     J(SG) = C + B * J(LG)
C
C         DETERMINE THE I AND J LIMITS(I1-I2 AND J1-J2) ON THE
C         COARSE GRID THAT CAN BE COMPLETELY 'COVERED' BY THE
C         AVAILABLE SMALL GRID SQUARES.
      I1=INT( (.5E0-A)/B + 1.5E0 )
      IF(I1 .LT. 1 ) I1=1
      J1=INT( (.5E0-C)/B + 1.5E0 )
      IF(J1 .LT. 1 ) J1=1
      I2=INT( (FLOAT(IMF)+.5E0-A)/B - .5E0 )
      IF(I2 .GT. IMC) I2=IMC
      J2=INT( (FLOAT(JMF)+.5E0-C)/B - .5E0 )
      IF(J2 .GT. JMC) J2=JMC
C
      ICALL = ICALL + 1
      IF( ICALL .GE. 4 ) GO TO 5
      PRINT 3,IMC,JMC,IMF,JMF,I1,I2,J1,J2
    3 FORMAT(1H0,2X,'IN SR OUTAREA, COARSE GRID IM,JM=',
     1  2I6,' FINE GRID HAS IM,JM=',2I6,' I1,I2,J1,J2=',4I6)
C
    5 IF ( I2 .LT. I1 ) GO TO 6
      IF ( J2 .GE. J1 ) GO TO 10
    6 IER = 2
C               DECIDE ON PRINT
      ICALLC = ICALLC + 1
      IF( ICALLC .GT. 2 ) RETURN
      PRINT 7,IMC,JMC,IMF,JMF,I1,I2,J1,J2
    7 FORMAT(1H0,2X,'SUBROUTINE OUTAREA,IMC,JMC,IMF,JMF,I1,I2,',
     1 'J1,J2=',8I6,' HAS ZERO RELEVANT CONTRIBUTION')
   10 CONTINUE
C
C          SCRATCH ADDRESSES
      K1=1
      K2=K1+IMF
      K3=K2+IMF
      K4=K3+IMF
      K5=K4+IMF
      K6=K5+IMF
      K7=K6+IMF
      K8=K7+IMF
C
C          ( WORD K8 IN ARRAY X WILL GET ALL OF THE JUNK
C            RESULTS THAT ARE NOT VALID FOR THE COARSE GRID ROW )
C           DESCRIPTOR FOR THE BIT ARRAY
C
C          GET IL(I)-- WHERE IL IS THE VALUE OF I FOR THE LARGE
C          GRID SQUARE THAT CONTAINS THE LEFT EDGE OF THE SMALL
C          GRID SQUARE I .
C
CMIC$ DO ALL VECTOR SHARED(IMF, K4, X) PRIVATE(IQ2)
      DO 1001 IQ2 = 1, IMF
         X(IQ2+K4-1) = 1.E0 + 1.E0*FLOAT(IQ2-1)
1001  CONTINUE
      C1=0.5E0*(B-1.E0) - A
CMIC$ PARALLEL SHARED(IMF, K5, K6, X, IX, K4, C1, BREC) PRIVATE(IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 88900 IQ2W6E=1,IMF
         X(K5+IQ2W6E-1)=X(K4+IQ2W6E-1)+C1
         X(K5+IQ2W6E-1)=BREC*X(K5+IQ2W6E-1)
88900 CONTINUE
C         TRUNCATE THIS TO A WHOLE NUMBER
CMIC$ DO PARALLEL VECTOR
      DO 88920 IQ2W6E = 1, IMF
         X(K6+IQ2W6E-1) = AINT(X(K5+IQ2W6E-1))
         IX(IQ2W6E) = INT(X(K6+IQ2W6E-1))
88920 CONTINUE
CMIC$ END PARALLEL
C         GET THE WEIGHT COEFFICIENTS XM AND XP
      C1 = A + 0.5E0 *(1.E0 + B)
CMIC$ DO ALL VECTOR IF ((ABS(K4-K2).GE.IMF .OR. K4-K2.EQ.0) .AND. (ABS(
CMIC$1   K4-1).GE.IMF .OR. K4-1.EQ.0) .AND. (ABS(K2-K6).GE.IMF .OR. K2-
CMIC$2   K6.EQ.0) .AND. (ABS(K6-1).GE.IMF .OR. K6-1.EQ.0)) SHARED(IMF, 
CMIC$3   C1, K4, K2, B, K6, X) PRIVATE(IQ2W6E)
      DO 88940 IQ2W6E = 1, IMF
         X(K2+IQ2W6E-1) = C1 - X(K4+IQ2W6E-1)
         X(K2+IQ2W6E-1) = X(K2+IQ2W6E-1) + B*X(K6+IQ2W6E-1)
         X(IQ2W6E) = 1.E0 - X(K2+IQ2W6E-1)
88940 CONTINUE
C         GET IR(I)-- WHERE IR IS THE VALUE OF I FOR THE LARGE
C         GRID SQUARE THAT CONTAINS THE RIGHT EDGE OF THE SMALL
C         GRID SQUARE I .
C
CMIC$ DO ALL VECTOR IF (ABS(K5-K7).GE.IMF .OR. K5-K7.EQ.0) SHARED(IMF, 
CMIC$1   K5, BREC, K6, K7, K2, X, IX) PRIVATE(IQ2W6E)
      DO 88970 IQ2W6E=1,IMF
         X(K6+IQ2W6E-1)=X(K5+IQ2W6E-1)+BREC
         X(K7+IQ2W6E-1)=AINT(X(K6+IQ2W6E-1))
         IX(K2+IQ2W6E-1)=INT(X(K7+IQ2W6E-1))
88970 CONTINUE
C           MAKE IL AND IR ZERO WHERE THEY ARE OUT OF BOUNDS
CMIC$ DO ALL VECTOR SHARED(IMF, I1, I2, K2, IX) PRIVATE(IQ2W6E)
      DO 89000 IQ2W6E = 1, IMF
         IF (IX(IQ2W6E) .LT. I1) IX(IQ2W6E) = 0
         IF (IX(IQ2W6E) .GT. I2) IX(IQ2W6E) = 0
         IF (IX(K2+IQ2W6E-1) .LT. I1) IX(K2+IQ2W6E-1) = 0
         IF (IX(K2+IQ2W6E-1) .GT. I2) IX(K2+IQ2W6E-1) = 0
89000 CONTINUE
C
C          CAN START ON THE J-LOOP FOR THE FINE GRID.
C
C
C          SOME NEEDED CONSTANTS AND INITIAL VALUES OF DJB,DJT,DJ.
      KL = K1 - 1
      KR = K2 - 1
      L1 = K4 - 1
      L2 = K5 - 1
      L3 = K6 - 1
C
      CBM2=BREC*BREC
C
      DJB=0.5E0-BREC*(.5E0+C)
      DJT=0.5E0+BREC*(0.5E0-C)
      DJ=0.E0
C
      DO 1000 J=1,JMF
C
      DJ=DJ+1.E0
C          GET JB( OR JT)-- THE J VALUE FOR THE LARGE GRID SQUARE
C          THAT CONTAINS THE BOTTOM ( OR TOP) SIDE OF THE SMALL
C          GRID SQUARE J
      DJB=DJB + BREC
      DJT=DJT + BREC
C          GET THEIR WHOLE NUMBER VALUES
      WJB=INT(DJB)
      WJT=INT(DJT)
C           THE INTEGER TYPE VALUES
      JB=INT(WJB)
      JT=INT(WJT)
C          TEST THE RANGE
C          IF JT IS .LT. J1, SKIP TO END OF J-LOOP
      IF( JT .LT. J1 ) GO TO 1000
C          IF JB EXCEEDS J2, WE ARE DONE
      IF( JB .GT. J2 ) GO TO 2000
C
C          WE ARE IN RANGE FOR AT LEAST ONE OF JB OR JT
C        GET VALUES OF INTERPOLATION WEIGHTS YM AND YP
      YP = 0.5E0 + C -DJ + B*( WJB + 0.5E0 )
      YM = 1.E0 - YP
C          GET THE SCALED VALUES OF THE INPUT DATA F.
      IADF=IMF*(J-1) + 1
CMIC$ DO ALL VECTOR SHARED(IMF, CBM2, IADF, K3, PF, X) PRIVATE(IQ2W6E)
      DO 89040 IQ2W6E=1,IMF
         X(K3+IQ2W6E-1)=CBM2*PF(IADF+IQ2W6E-1)
89040 CONTINUE
C
C         ARE THE TOP AND BOTTOM BOUNDARIES OF THIS FINE GRID
C         ROW OF SQUARES CONTAINED IN TWO SEPARATE ROWS OF LARGE
C         GRID SQUARE BOXES?????
      IF( JT .EQ. (JB+1) ) GO TO 400
C
C         JB=JT AND   J1. LE. (JB=JT) .LE. J2
C
C           CONTRIBUTIONS FOR THE LEFT BIG BOX INTO X(K5)=X2D
CMIC$ DO ALL VECTOR IF ((ABS(K2-K5).GE.IMF .OR. K2-K5.EQ.0) .AND. (ABS(
CMIC$1   K3-K5).GE.IMF .OR. K3-K5.EQ.0)) SHARED(IMF, K2, K3, K5, X)
CMIC$2    PRIVATE(IQ2W6E)
      DO 89050 IQ2W6E=1,IMF
         X(K5+IQ2W6E-1)=X(K2+IQ2W6E-1)*X(K3+IQ2W6E-1)
89050 CONTINUE
C           CONTRIBUTIONS FOR THE RIGHT BIG BOX INTO X(K6)=X3D
CMIC$ DO ALL VECTOR IF ((ABS(1-K6).GE.IMF .OR. 1-K6.EQ.0) .AND. (ABS(K3-
CMIC$1   K6).GE.IMF .OR. K3-K6.EQ.0)) SHARED(IMF, K3, K6, X) PRIVATE(
CMIC$2   IQ2W6E)
      DO 89060 IQ2W6E = 1, IMF
         X(K6+IQ2W6E-1) = X(IQ2W6E)*X(K3+IQ2W6E-1)
89060 CONTINUE
C          WE ACCUMULATE LEFT AND RIGHT CONTRIBUTIONS IN
C          ARRAY X(  K8+IL(I) OR K8+IR(I)  ). NOTE THAT HERE
C          AND LATER, X(K8) WILL GET RESULTS FROM ALL VALUES
C          OF IL(I) AND IR(I) THAT ARE OUT OF THE RANGE I=I1,I2.
C
CMIC$ DO ALL VECTOR SHARED(IMC, K8, X) PRIVATE(IQ2W6E)
      DO 89070 IQ2W6E=1,IMC
         X(K8+IQ2W6E)=0.E0
89070 CONTINUE
C
      DO 100 I= 1,IMF
C           ADDRESS FOR THE LEFT TERM
      IADL=IX(KL+I) + K8
      X(IADL) = X(IADL) + X(L2 + I)
C           ADDRESS FOR THE RIGHT TERM
      IADR=IX(KR+I) + K8
      X(IADR) = X(IADR) + X(L3 + I)
C
  100 CONTINUE
C           INSERT INTO PC ARRAY
      IAD = (JB-1)*IMC + 1
CMIC$ DO ALL VECTOR SHARED(IMC, IAD, K8, PC, X) PRIVATE(IQ2W6E)
      DO 89080 IQ2W6E=1,IMC
         PC(IAD+IQ2W6E-1)=PC(IAD+IQ2W6E-1)+X(K8+IQ2W6E)
89080 CONTINUE
C
C        SINCE JB=JT, WE ARE DONE WITH THIS FINE GRID ROW J.
      GO TO 1000
C
C           ENTRANCE FOR WHEN JT=JB+1
  400 CONTINUE
C
C       WE HAVE J1 .LE. (JT=JB+1) .LE. (J2+1)
C
C
C          XP * F TO X3D, AND XM * F TO X4D
CMIC$ DO ALL VECTOR IF ((ABS(K2-K6).GE.IMF .OR. K2-K6.EQ.0) .AND. (ABS(
CMIC$1   K2-K7).GE.IMF .OR. K2-K7.EQ.0) .AND. (ABS(K3-K6).GE.IMF .OR. K3
CMIC$2   -K6.EQ.0) .AND. (ABS(K3-K7).GE.IMF .OR. K3-K7.EQ.0) .AND. (ABS(
CMIC$3   K6-1).GE.IMF .OR. K6-1.EQ.0) .AND. (ABS(1-K7).GE.IMF .OR. 1-K7
CMIC$4   .EQ.0)) SHARED(IMF, K2, K3, K6, K7, X) PRIVATE(IQ2W6E)
      DO 89090 IQ2W6E = 1, IMF
         X(K6+IQ2W6E-1) = X(K2+IQ2W6E-1)*X(K3+IQ2W6E-1)
         X(K7+IQ2W6E-1) = X(IQ2W6E)*X(K3+IQ2W6E-1)
89090 CONTINUE
C
C          FIRST COMPUTE CONTRIBUTIONS FOR J=JB ON COARSE GRID
C          IF JB IS IN PROPER RANGE
      IF( JB .LT. J1 ) GO TO 650
C          LOWER LEFT CONTRIBUTION TO X2D
CMIC$ DO ALL VECTOR SHARED(IMF, YP, K6, K5, X) PRIVATE(IQ2W6E)
      DO 89110 IQ2W6E=1,IMF
         X(K5+IQ2W6E-1)=YP*X(K6+IQ2W6E-1)
89110 CONTINUE
C          LOWER RIGHT CONTRIBUTION TO X1D
CMIC$ DO ALL VECTOR IF (ABS(K7-K4).GE.IMF .OR. K7-K4.EQ.0) SHARED(IMF, 
CMIC$1   YP, K7, K4, X) PRIVATE(IQ2W6E)
      DO 89120 IQ2W6E=1,IMF
         X(K4+IQ2W6E-1)=YP*X(K7+IQ2W6E-1)
89120 CONTINUE
C
CMIC$ DO ALL VECTOR SHARED(IMC, K8, X) PRIVATE(IQ2W6E)
      DO 89130 IQ2W6E=1,IMC
         X(K8+IQ2W6E)=0.E0
89130 CONTINUE
C
      DO 600 I=1,IMF
C         ADDRESS FOR THE LEFT TERM
      IADL=IX(KL+I) + K8
      X(IADL) = X(IADL) + X(L2+I)
C         ADDRESS FOR THE RIGHT TERM
      IADR=IX(KR+I) + K8
      X(IADR) = X(IADR) + X(L1+I)
  600 CONTINUE
C           ADD TO THE PC ARRAY
      IAD = (JB-1)*IMC + 1
CMIC$ DO ALL VECTOR SHARED(IMC, IAD, K8, PC, X) PRIVATE(IQ2W6E)
      DO 89140 IQ2W6E=1,IMC
         PC(IAD+IQ2W6E-1)=PC(IAD+IQ2W6E-1)+X(K8+IQ2W6E)
89140 CONTINUE
C
C          WE CAN NOW DO THE UPPER LEFT AND RIGHT BOXES
C          IF WE HAVE NOT EXHAUSTED THE J-RANGE ON THE BIG BOXES.
C               NOTE THAT IF JT .GT. J2 THIS TIME,
C               THEN JB WILL EXCEED J2 ON NEXT J VALUE.
C
  650 IF ( JT .GT. J2 ) GO TO 2000
C
C            CONTRIBUTIONS FOR THE UPPER LEFT BOX INTO X(K5)=X2D
CMIC$ DO ALL VECTOR SHARED(IMF, YM, K6, K5, X) PRIVATE(IQ2W6E)
      DO 89150 IQ2W6E=1,IMF
         X(K5+IQ2W6E-1)=YM*X(K6+IQ2W6E-1)
89150 CONTINUE
C            CONTRIBUTIONS FOR THE UPPER RIGHT BOX INTO X(K4)=X1D
CMIC$ DO ALL VECTOR IF (ABS(K7-K4).GE.IMF .OR. K7-K4.EQ.0) SHARED(IMF, 
CMIC$1   YM, K7, K4, X) PRIVATE(IQ2W6E)
      DO 89160 IQ2W6E=1,IMF
         X(K4+IQ2W6E-1)=YM*X(K7+IQ2W6E-1)
89160 CONTINUE
CMIC$ DO ALL VECTOR SHARED(IMC, K8, X) PRIVATE(IQ2W6E)
      DO 89170 IQ2W6E=1,IMC
         X(K8+IQ2W6E)=0.E0
89170 CONTINUE
C
      DO 700 I=1,IMF
C         ADDRESS FOR THE LEFT TERM
      IADL = IX(KL+I) + K8
      X(IADL) = X(IADL) + X(L2+I)
C         ADDRESS FOR THE RIGHT TERM
      IADR = IX(KR+I) + K8
      X(IADR) = X(IADR) + X(L1 + I)
  700 CONTINUE
C          ADD TO THE PC ARRAY
      IAD = (JT-1)*IMC + 1
CMIC$ DO ALL VECTOR SHARED(IMC, IAD, K8, PC, X) PRIVATE(IQ2W6E)
      DO 89180 IQ2W6E=1,IMC
         PC(IAD+IQ2W6E-1)=PC(IAD+IQ2W6E-1)+X(K8+IQ2W6E)
89180 CONTINUE
C
C          END OF THE J-LOOP
 1000 CONTINUE
C
C          EXIT LANDING SPOT
 2000 CONTINUE
C
      RETURN
      END
