      SUBROUTINE SMOOTHA
C
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    SMOOTHA     HORIZONTAL SMOOTHING OF GRID A.
C   PRGMMR: J TUCCILLO           ORG: W/NMC4     DATE: 90-06-17
C
C ABSTRACT:  THIS SUBROUTINE PERFORMS 4TH-ORDER SMOOTHING BY THE
C   SHUMAN (NOT SHAPIRO) METHOD FOR GRID A.  IF THERE IS MORE THAN
C   1 GRID, THIS SUBROUTINE ASSUMES THAT THE HOLE IN THE GRID
C   HAS ALREADY BEEN FILLED BY SUBROUTINE FILLHOLE.
C   THE FIELDS THAT ARE SMOOTHED ARE U, V, TH (THETA), AND Q
C   ON SIGMA SURFACES.  BECAUSE THE VARIATION IN H IS PRIMARILY DUE
C   TO TOPOGRAPHY, H IS NOT SMOOTHED.
C   THIS SUBROUTINE TAKES ADVANTAGE OF THE
C   FACT THAT SUBROUTINE SHEM CAN WORK ON U, V, TH, AND Q IN
C   ADDITION TO HU, HV, HTH, AND HQ.
C   .
C
C PROGRAM HISTORY LOG:
C   90-06-17  J TUCCILLO
C
C USAGE:  CALL SMOOTHA
C   SUBPROGRAMS CALLED:
C     UNIQUE:    - SHEM
C     LIBRARY:
C       COMMON   - COMCONST
C                  COMBLANK
C
C REMARKS:
C   - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C   .
C   NAMES      MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----      ----------------------------------        ---------
C   IMG,JMG    HORIZONTAL GRID DIMENSIONS OF GRID A.     COMMON
C   .
C   IADDRG     INITIAL ADDRESSES OF DIFFERENT TYPE
C   .          VARIABLES AND GRIDS IN THE ARRAY VBL      COMMON
C   .
C   VBL        ARRAY CONTAINING ALL VBLS FOR ALL GRIDS   COMMON
C   .
C   - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C   .
C   NAMES      MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----      ----------------------------------        ---------
C   VBL        SMOOTHED VARIABLES.                       COMMON
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN
C   MACHINE:  CRAY Y-MP
C
C$$$
C
      INCLUDE 'parmodel'
C...TRANSLATED BY FPP 3.00Z36 11/09/90  14:47:26  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C
C     COMMON BLOCK /COMCONST/ CONTAINS GRID-RELATED PARAMETERS,
C          AND A FEW OTHER COMMON CONSTANTS.
      COMMON /COMCONST/ IJMAX, KM, LVLTOT, IJRAD, LOFCLDS(2,4),
     1                  ICALLRAD, IPHYSPL, NGRDUSE, NH,
     2                  NTIME, ITIME, NSTEPS,
     3                  IMG(INGRDUSE), JMG(INGRDUSE),
     4                  IAG(INGRDUS1), JAG(INGRDUS1),
     5                  IBG(INGRDUS1), JBG(INGRDUS1),
     6                  IADDRG(INIADDRS, INGRDUSE),
     7                  NPTSFH(2, INGRDUSE),
     8                  KUMULUS, LGRIDPPT, KLIFT1, KLIFT2, IBUCKET,
     9                  XPOLEH(INGRDUSE), YPOLEH(INGRDUSE), RADIUS,
     1                  DELSIG(IKM), PR(IKM), PRESS(IKM),
     2                  SIGINT(IKMP1),
     3                  DTOVDX, ANGVEL,
     4                  SIGMACC, SIGMAGSP, SIGMADHQ, CRITCONV,
     5                  SATDEL, RHFACTOR, QBOUND,
     6                  ANEM, BLKDR, CHARN, CONAUST, DDORF, PKATO,
     7                  SCALEHT, SIGDOT, DLAMNGM
C
      COMMON            SCR     (IIJMAX,  INSCR),
     1                  SCRGEOG (IIJMAX,  INSCRGEO),
     2                  SCR3    (IIJKMAX, INSCR3),
     3                  FILLER  (INFILLER),
     4                  VBL     (INVBL),
     5                  BITGRDH (IIJMAX, 2, INGRDUSE),
     6                  BITGRDU (IIJMAX, 2, INGRDUSE),
     7                  BITGRDV (IIJMAX, 2, INGRDUSE),
     8                  BITSEA  (IIJMAX, INGRDUSE),
     9                  BITSNO  (IIJMAX, INGRDUSE),
     1                  BITWVL  (IIJMAX, INGRDUSE)
C
      LOGICAL BITGRDH, BITGRDU, BITGRDV, BITSEA, BITSNO, BITWVL
C
      DIMENSION XNU(2)
C
C
      NG = 1
C
C     SPECIFY THE FUNDAMENTAL GRID DIMENSIONS.
      IM = IMG(NG)
      JM = JMG(NG)
      IJ = IM * JM
C
C     SPECIFY STARTING ADDRESSES WITHIN ARRAY VBL.
      MADDHU = IADDRG(1, NG)
      MADDHV = IADDRG(2, NG)
      MADDHT = IADDRG(3, NG)
      MADDHQ = IADDRG(4, NG)
      MADDH  = IADDRG(5, NG)
C
C
C     DEFINE THE SMOOTHING FACTORS.
      XNU(1) = + 0.5 E0
      XNU(2) = - 0.5 E0
C
C     SAVE THE INITIAL HU, HV, HTH, AND HQ, TO BE USED LATER TO
C     RESTORE THE ORIGINAL FIELDS AT NONFORECAST POINTS.  IF THIS
C     WERE NOT DONE, GARBAGE VALUES MIGHT DEVELOP THERE.
      IADDHU = MADDHU - IJ
      IADDHV = MADDHV - IJ
      IADDHT = MADDHT - IJ
      IADDHQ = MADDHQ - IJ
      IADD   = 1      - IJ
C
CMIC$ DO ALL SHARED(KM, IADDHU, IJ, IADDHV, IADDHT, IADDHQ, IADD, VBL, 
CMIC$1   SCR3) PRIVATE(K, IQ2W6E)
      DO 100 K = 1, KM
C
         DO 77001 IQ2W6E = 1, IJ
            SCR3(IADD+IQ2W6E-1+K*IJ,1) = VBL(IADDHU+IQ2W6E-1+K*IJ)
            SCR3(IADD+IQ2W6E-1+K*IJ,2) = VBL(IADDHV+IQ2W6E-1+K*IJ)
            SCR3(IADD+IQ2W6E-1+K*IJ,3) = VBL(IADDHT+IQ2W6E-1+K*IJ)
            SCR3(IADD+IQ2W6E-1+K*IJ,4) = VBL(IADDHQ+IQ2W6E-1+K*IJ)
77001    CONTINUE
  100 CONTINUE
C
C
C     CALCULATE SURFACE PRESSURE AND ITS INVERSE AT U, V, AND H
C     POINTS.  FOR SIMPLICITY OF CODING, SOME OF THE INVERSES ARE
C     CALCULATED AT POINTS THAT ARE NOT NEEDED OR AT POINTS FOR
C     WHICH THE SURFACE PRESSURE CANNOT BE OBTAINED CORRECTLY.
C
C     THE SURFACE PRESSURE AND ITS INVERSE AT U POINTS.
      LENU = IJ - IM
CMIC$ DO ALL VECTOR SHARED(LENU, MADDH, IM, VBL, SCR) PRIVATE(IQ2W6E)
      DO 88930 IQ2W6E=1,LENU
         SCR(IQ2W6E,8)=0.5E0*(VBL(MADDH+IQ2W6E-1)+VBL(MADDH+IM+IQ2W6E-
     *   1))
         SCR(IQ2W6E,9)=1.0E0/SCR(IQ2W6E,8)
88930 CONTINUE
C
C     THE SURFACE PRESSURE AND ITS INVERSE AT V POINTS.
      LENV = IJ - 1
CMIC$ DO ALL VECTOR SHARED(LENV, MADDH, VBL, SCR) PRIVATE(IQ2W6E)
      DO 88950 IQ2W6E=1,LENV
         SCR(IQ2W6E,10)=0.5E0*(VBL(MADDH+IQ2W6E-1)+VBL(MADDH+IQ2W6E))
         SCR(IQ2W6E,11)=1.0E0/SCR(IQ2W6E,10)
88950 CONTINUE
C
C     THE INVERSE OF SURFACE PRESSURE AT H POINTS.
      LENH = IJ
CMIC$ DO ALL VECTOR SHARED(LENH, MADDH, VBL, SCR) PRIVATE(IQ2W6E)
      DO 88970 IQ2W6E=1,LENH
         SCR(IQ2W6E,13)=1.0E0/VBL(MADDH+IQ2W6E-1)
88970 CONTINUE
C
C     DECOUPLE THE SURFACE PRESSURE FROM HU, HV, HTH, AND HQ.
C    (REASONABLE VALUES OF THE DECOUPLED FIELDS SHOULD EXIST
C     AT THE POINTS THAT WEREN'T DECOUPLED.)
      IADDHU = MADDHU - IJ
      IADDHV = MADDHV - IJ
      IADDHT = MADDHT - IJ
      IADDHQ = MADDHQ - IJ
C
      DO 200 K = 1, KM
C
         IADDHU = IADDHU + IJ
         IADDHV = IADDHV + IJ
         IADDHT = IADDHT + IJ
         IADDHQ = IADDHQ + IJ
C
CMIC$ PARALLEL SHARED(LENV, IADDHV, VBL, SCR, LENU, IADDHU) PRIVATE(
CMIC$1   IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 88980 IQ2W6E=1,LENU
         VBL(IADDHU+IQ2W6E-1)=VBL(IADDHU+IQ2W6E-1)*SCR(IQ2W6E,9)
88980 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 88990 IQ2W6E=1,LENV
         VBL(IADDHV+IQ2W6E-1)=VBL(IADDHV+IQ2W6E-1)*SCR(IQ2W6E,11)
88990 CONTINUE
CMIC$ END PARALLEL
CMIC$ DO ALL VECTOR IF (ABS(IADDHT-IADDHQ).GE.LENH .OR. IADDHT-IADDHQ
CMIC$1   .EQ.0) SHARED(LENH, IADDHT, IADDHQ, VBL, SCR) PRIVATE(IQ2W6E)
      DO 89000 IQ2W6E=1,LENH
         VBL(IADDHT+IQ2W6E-1)=VBL(IADDHT+IQ2W6E-1)*SCR(IQ2W6E,13)
         VBL(IADDHQ+IQ2W6E-1)=VBL(IADDHQ+IQ2W6E-1)*SCR(IQ2W6E,13)
89000 CONTINUE
C
  200 CONTINUE
C
C     THE FIRST OF THE TWO SMOOTHING PASSES IS DONE NEXT.
      IPASS = 1
      C1    = 0.5E0 * XNU(IPASS)
      C2    = 1.0E0 - XNU(IPASS)
C
      DO 300 K = 1, KM
C
C     FIRST SMOOTH U, V, TH, AND Q IN THE X DIRECTION.
         ISTART = 2
         LENGTH = IJ - 2
C
         IADDHU = (MADDHU - 1) + (IJ*(K-1)) + ISTART
         IADDHV = (MADDHV - 1) + (IJ*(K-1)) + ISTART
         IADDHT = (MADDHT - 1) + (IJ*(K-1)) + ISTART
         IADDHQ = (MADDHQ - 1) + (IJ*(K-1)) + ISTART
C
CMIC$ DO ALL VECTOR SHARED(LENGTH, C1, IADDHU, IADDHV, IADDHT, IADDHQ, 
CMIC$1   VBL, SCR) PRIVATE(IQ2W6E)
      DO 89020 IQ2W6E = 1, LENGTH
         SCR(1+IQ2W6E,14) = C1*(VBL(IADDHU-2+IQ2W6E)+VBL(IADDHU+IQ2W6E))
         SCR(1+IQ2W6E,15) = C1*(VBL(IADDHV-2+IQ2W6E)+VBL(IADDHV+IQ2W6E))
         SCR(1+IQ2W6E,16) = C1*(VBL(IADDHT-2+IQ2W6E)+VBL(IADDHT+IQ2W6E))
         SCR(1+IQ2W6E,17) = C1*(VBL(IADDHQ-2+IQ2W6E)+VBL(IADDHQ+IQ2W6E))
89020 CONTINUE
C
CMIC$ DO ALL VECTOR IF ((ABS(IADDHU-IADDHV).GE.LENGTH .OR. IADDHU-IADDHV
CMIC$1   .EQ.0) .AND. (ABS(IADDHU-IADDHT).GE.LENGTH .OR. IADDHU-IADDHT
CMIC$2   .EQ.0) .AND. (ABS(IADDHU-IADDHQ).GE.LENGTH .OR. IADDHU-IADDHQ
CMIC$3   .EQ.0) .AND. (ABS(IADDHV-IADDHT).GE.LENGTH .OR. IADDHV-IADDHT
CMIC$4   .EQ.0) .AND. (ABS(IADDHV-IADDHQ).GE.LENGTH .OR. IADDHV-IADDHQ
CMIC$5   .EQ.0) .AND. (ABS(IADDHT-IADDHQ).GE.LENGTH .OR. IADDHT-IADDHQ
CMIC$6   .EQ.0)) SHARED(LENGTH, C2, IADDHU, IADDHV, IADDHT, IADDHQ, VBL
CMIC$7   , SCR) PRIVATE(IQ2W6E)
      DO 89060 IQ2W6E = 1, LENGTH
         VBL(IADDHU+IQ2W6E-1)=C2*VBL(IADDHU+IQ2W6E-1)+SCR(1+IQ2W6E,14)
         VBL(IADDHV+IQ2W6E-1)=C2*VBL(IADDHV+IQ2W6E-1)+SCR(1+IQ2W6E,15)
         VBL(IADDHT+IQ2W6E-1)=C2*VBL(IADDHT+IQ2W6E-1)+SCR(1+IQ2W6E,16)
         VBL(IADDHQ+IQ2W6E-1)=C2*VBL(IADDHQ+IQ2W6E-1)+SCR(1+IQ2W6E,17)
89060 CONTINUE
C
C     NOW SMOOTH U, V, TH, AND Q IN THE Y DIRECTION.
         ISTART = IM + 2
         LENGTH = IJ - 2 - 2*IM
C
         IADDHU = (MADDHU - 1) + (IJ*(K-1)) + ISTART
         IADDHV = (MADDHV - 1) + (IJ*(K-1)) + ISTART
         IADDHT = (MADDHT - 1) + (IJ*(K-1)) + ISTART
         IADDHQ = (MADDHQ - 1) + (IJ*(K-1)) + ISTART
C
CMIC$ DO ALL VECTOR SHARED(LENGTH, C1, IADDHU, IM, ISTART, IADDHV, 
CMIC$1   IADDHT, IADDHQ, VBL, SCR) PRIVATE(IQ2W6E)
      DO 89100 IQ2W6E=1,LENGTH
         SCR(ISTART+IQ2W6E-1,14)=C1*(VBL(IADDHU-IM+IQ2W6E-1)+VBL(IADDH
     *   U+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,15)=C1*(VBL(IADDHV-IM+IQ2W6E-1)+VBL(IADDH
     *   V+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,16)=C1*(VBL(IADDHT-IM+IQ2W6E-1)+VBL(IADDH
     *   T+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,17)=C1*(VBL(IADDHQ-IM+IQ2W6E-1)+VBL(IADDH
     *   Q+IM+IQ2W6E-1))
89100 CONTINUE
C
CMIC$ DO ALL VECTOR IF ((ABS(IADDHU-IADDHV).GE.LENGTH .OR. IADDHU-IADDHV
CMIC$1   .EQ.0) .AND. (ABS(IADDHU-IADDHT).GE.LENGTH .OR. IADDHU-IADDHT
CMIC$2   .EQ.0) .AND. (ABS(IADDHU-IADDHQ).GE.LENGTH .OR. IADDHU-IADDHQ
CMIC$3   .EQ.0) .AND. (ABS(IADDHV-IADDHT).GE.LENGTH .OR. IADDHV-IADDHT
CMIC$4   .EQ.0) .AND. (ABS(IADDHV-IADDHQ).GE.LENGTH .OR. IADDHV-IADDHQ
CMIC$5   .EQ.0) .AND. (ABS(IADDHT-IADDHQ).GE.LENGTH .OR. IADDHT-IADDHQ
CMIC$6   .EQ.0)) SHARED(LENGTH, C2, IADDHU, ISTART, IADDHV, IADDHT, 
CMIC$7   IADDHQ, VBL, SCR) PRIVATE(IQ2W6E)
      DO 89140 IQ2W6E=1,LENGTH
         VBL(IADDHU+IQ2W6E-1)=C2*VBL(IADDHU+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,14)
         VBL(IADDHV+IQ2W6E-1)=C2*VBL(IADDHV+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,15)
         VBL(IADDHT+IQ2W6E-1)=C2*VBL(IADDHT+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,16)
         VBL(IADDHQ+IQ2W6E-1)=C2*VBL(IADDHQ+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,17)
89140 CONTINUE
C
  300 CONTINUE
C
C     APPLY THE EQUATORIAL BOUNDARY CONDITIONS TO THE EQUATORIAL
C     INTERPOLATION POINTS FOR U, V, TH, AND Q ONLY.  NOTE THAT
C     LEVELSH IS THE NUMBER OF CONTIGUOUS LEVELS OF H-POINT
C     VARIABLES TO BE PROCESSED.
C     ALSO NOTE THAT SHEM USES THE FIRST 7 SUBSETS OF ARRAY SCR.
      LEVELSH = 2 * KM
      CALL SHEM (LEVELSH)
C
C     NOW DO THE SECOND SMOOTHING PASS OF U, V, TH, AND Q.
      IPASS = 2
      C1    = 0.5E0 * XNU(IPASS)
      C2    = 1.0E0 - XNU(IPASS)
C
      DO 400 K = 1, KM
C
C     FIRST SMOOTH U, V, TH, AND Q IN THE X DIRECTION.
         ISTART = 2
         LENGTH = IJ - 2
C
         IADDHU = (MADDHU - 1) + (IJ*(K-1)) + ISTART
         IADDHV = (MADDHV - 1) + (IJ*(K-1)) + ISTART
         IADDHT = (MADDHT - 1) + (IJ*(K-1)) + ISTART
         IADDHQ = (MADDHQ - 1) + (IJ*(K-1)) + ISTART
C
CMIC$ DO ALL VECTOR SHARED(LENGTH, C1, IADDHU, IADDHV, IADDHT, IADDHQ, 
CMIC$1   VBL, SCR) PRIVATE(IQ2W6E)
      DO 89180 IQ2W6E = 1, LENGTH
         SCR(1+IQ2W6E,14) = C1*(VBL(IADDHU-2+IQ2W6E)+VBL(IADDHU+IQ2W6E))
         SCR(1+IQ2W6E,15) = C1*(VBL(IADDHV-2+IQ2W6E)+VBL(IADDHV+IQ2W6E))
         SCR(1+IQ2W6E,16) = C1*(VBL(IADDHT-2+IQ2W6E)+VBL(IADDHT+IQ2W6E))
         SCR(1+IQ2W6E,17) = C1*(VBL(IADDHQ-2+IQ2W6E)+VBL(IADDHQ+IQ2W6E))
89180 CONTINUE
C
CMIC$ DO ALL VECTOR IF ((ABS(IADDHU-IADDHV).GE.LENGTH .OR. IADDHU-IADDHV
CMIC$1   .EQ.0) .AND. (ABS(IADDHU-IADDHT).GE.LENGTH .OR. IADDHU-IADDHT
CMIC$2   .EQ.0) .AND. (ABS(IADDHU-IADDHQ).GE.LENGTH .OR. IADDHU-IADDHQ
CMIC$3   .EQ.0) .AND. (ABS(IADDHV-IADDHT).GE.LENGTH .OR. IADDHV-IADDHT
CMIC$4   .EQ.0) .AND. (ABS(IADDHV-IADDHQ).GE.LENGTH .OR. IADDHV-IADDHQ
CMIC$5   .EQ.0) .AND. (ABS(IADDHT-IADDHQ).GE.LENGTH .OR. IADDHT-IADDHQ
CMIC$6   .EQ.0)) SHARED(LENGTH, C2, IADDHU, IADDHV, IADDHT, IADDHQ, VBL
CMIC$7   , SCR) PRIVATE(IQ2W6E)
      DO 89220 IQ2W6E = 1, LENGTH
         VBL(IADDHU+IQ2W6E-1)=C2*VBL(IADDHU+IQ2W6E-1)+SCR(1+IQ2W6E,14)
         VBL(IADDHV+IQ2W6E-1)=C2*VBL(IADDHV+IQ2W6E-1)+SCR(1+IQ2W6E,15)
         VBL(IADDHT+IQ2W6E-1)=C2*VBL(IADDHT+IQ2W6E-1)+SCR(1+IQ2W6E,16)
         VBL(IADDHQ+IQ2W6E-1)=C2*VBL(IADDHQ+IQ2W6E-1)+SCR(1+IQ2W6E,17)
89220 CONTINUE
C
C     NOW SMOOTH U, V, TH, AND Q IN THE Y DIRECTION.
         ISTART = IM + 2
         LENGTH = IJ - 2 - 2*IM
C
         IADDHU = (MADDHU - 1) + (IJ*(K-1)) + ISTART
         IADDHV = (MADDHV - 1) + (IJ*(K-1)) + ISTART
         IADDHT = (MADDHT - 1) + (IJ*(K-1)) + ISTART
         IADDHQ = (MADDHQ - 1) + (IJ*(K-1)) + ISTART
C
CMIC$ DO ALL VECTOR SHARED(LENGTH, C1, IADDHU, IM, ISTART, IADDHV, 
CMIC$1   IADDHT, IADDHQ, VBL, SCR) PRIVATE(IQ2W6E)
      DO 89260 IQ2W6E=1,LENGTH
         SCR(ISTART+IQ2W6E-1,14)=C1*(VBL(IADDHU-IM+IQ2W6E-1)+VBL(IADDH
     *   U+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,15)=C1*(VBL(IADDHV-IM+IQ2W6E-1)+VBL(IADDH
     *   V+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,16)=C1*(VBL(IADDHT-IM+IQ2W6E-1)+VBL(IADDH
     *   T+IM+IQ2W6E-1))
         SCR(ISTART+IQ2W6E-1,17)=C1*(VBL(IADDHQ-IM+IQ2W6E-1)+VBL(IADDH
     *   Q+IM+IQ2W6E-1))
89260 CONTINUE
C
CMIC$ DO ALL VECTOR IF ((ABS(IADDHU-IADDHV).GE.LENGTH .OR. IADDHU-IADDHV
CMIC$1   .EQ.0) .AND. (ABS(IADDHU-IADDHT).GE.LENGTH .OR. IADDHU-IADDHT
CMIC$2   .EQ.0) .AND. (ABS(IADDHU-IADDHQ).GE.LENGTH .OR. IADDHU-IADDHQ
CMIC$3   .EQ.0) .AND. (ABS(IADDHV-IADDHT).GE.LENGTH .OR. IADDHV-IADDHT
CMIC$4   .EQ.0) .AND. (ABS(IADDHV-IADDHQ).GE.LENGTH .OR. IADDHV-IADDHQ
CMIC$5   .EQ.0) .AND. (ABS(IADDHT-IADDHQ).GE.LENGTH .OR. IADDHT-IADDHQ
CMIC$6   .EQ.0)) SHARED(LENGTH, C2, IADDHU, ISTART, IADDHV, IADDHT, 
CMIC$7   IADDHQ, VBL, SCR) PRIVATE(IQ2W6E)
      DO 89300 IQ2W6E=1,LENGTH
         VBL(IADDHU+IQ2W6E-1)=C2*VBL(IADDHU+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,14)
         VBL(IADDHV+IQ2W6E-1)=C2*VBL(IADDHV+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,15)
         VBL(IADDHT+IQ2W6E-1)=C2*VBL(IADDHT+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,16)
         VBL(IADDHQ+IQ2W6E-1)=C2*VBL(IADDHQ+IQ2W6E-1)+SCR(ISTART+
     *   IQ2W6E-1,17)
89300 CONTINUE
C
  400  CONTINUE
C
C     MULTIPLY U, V, TH, AND Q BY SURFACE PRESSURE.
C     THEN RESTORE HU, HV, HTH, AND HQ AT THE NONFORECAST POINTS
C     FOR GRID A TO THEIR VALUES AT THE START OF THIS SUBROUTINE.
C
      IADDHU = MADDHU - IJ
      IADDHV = MADDHV - IJ
      IADDHT = MADDHT - IJ
      IADDHQ = MADDHQ - IJ
      IADD   = 1      - IJ
C
      DO 500 K = 1, KM
C
         IADDHU = IADDHU + IJ
         IADDHV = IADDHV + IJ
         IADDHT = IADDHT + IJ
         IADDHQ = IADDHQ + IJ
         IADD   = IADD   + IJ
C
C    (MULTIPLY U, V, TH, AND Q BY SURFACE PRESSURE.)
CMIC$ PARALLEL SHARED(LENV, IADDHV, VBL, SCR, LENU, IADDHU) PRIVATE(
CMIC$1   IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 89340 IQ2W6E=1,LENU
         VBL(IADDHU+IQ2W6E-1)=VBL(IADDHU+IQ2W6E-1)*SCR(IQ2W6E,8)
89340 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89350 IQ2W6E=1,LENV
         VBL(IADDHV+IQ2W6E-1)=VBL(IADDHV+IQ2W6E-1)*SCR(IQ2W6E,10)
89350 CONTINUE
CMIC$ END PARALLEL
CMIC$ DO ALL VECTOR IF ((ABS(IADDHT-MADDH).GE.LENH .OR. IADDHT-MADDH.EQ.
CMIC$1   0) .AND. (ABS(IADDHT-IADDHQ).GE.LENH .OR. IADDHT-IADDHQ.EQ.0)
CMIC$2    .AND. (ABS(MADDH-IADDHQ).GE.LENH .OR. MADDH-IADDHQ.EQ.0))
CMIC$3    SHARED(LENH, IADDHT, MADDH, IADDHQ, VBL) PRIVATE(IQ2W6E)
      DO 89360 IQ2W6E=1,LENH
         VBL(IADDHT+IQ2W6E-1)=VBL(IADDHT+IQ2W6E-1)*VBL(MADDH+IQ2W6E-1)
         VBL(IADDHQ+IQ2W6E-1)=VBL(IADDHQ+IQ2W6E-1)*VBL(MADDH+IQ2W6E-1)
89360 CONTINUE
C
C    (RESTORE HU, HV, HTH, AND HQ AT THE NONFORECAST POINTS.)
CMIC$ PARALLEL SHARED(IJ, IADD, IADDHV, BITGRDV, SCR3, VBL, IADDHU, 
CMIC$1   BITGRDU) PRIVATE(IQ2W6E)
CMIC$ DO PARALLEL VECTOR
      DO 89380 IQ2W6E=1,IJ
       IF ( .NOT. BITGRDU(IQ2W6E,1,1 )) THEN
         VBL(IADDHU+IQ2W6E-1)=SCR3(IADD+IQ2W6E-1,1)
       END IF
89380 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89390 IQ2W6E=1,IJ
       IF ( .NOT. BITGRDV(IQ2W6E,1,1 )) THEN
         VBL(IADDHV+IQ2W6E-1)=SCR3(IADD+IQ2W6E-1,2)
       END IF
89390 CONTINUE
CMIC$ END PARALLEL
C
CMIC$ DO ALL VECTOR IF (ABS(IADDHT-IADDHQ).GE.IJ .OR. IADDHT-IADDHQ.EQ.0
CMIC$1   ) SHARED(IJ, IADD, IADDHT, IADDHQ, BITGRDH, SCR3, VBL) PRIVATE(
CMIC$2   IQ2W6E)
      DO 89400 IQ2W6E=1,IJ
       IF ( .NOT. BITGRDH(IQ2W6E,1,1 )) THEN
         VBL(IADDHT+IQ2W6E-1)=SCR3(IADD+IQ2W6E-1,3)
         VBL(IADDHQ+IQ2W6E-1)=SCR3(IADD+IQ2W6E-1,4)
       END IF
89400 CONTINUE
C
  500 CONTINUE
C
C     APPLY THE EQUATORIAL BOUNDARY CONDITIONS TO THE EQUATORIAL
C     INTERPOLATION POINTS FOR HU, HV, HTH, AND HQ ONLY.
C     NOTE THAT SHEM USES THE FIRST 7 SUBSETS OF ARRAY SCR.
      CALL SHEM (LEVELSH)
C
C
      RETURN
      END
