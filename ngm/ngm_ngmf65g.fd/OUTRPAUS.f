      SUBROUTINE OUTRPAUS
CFPP$ NOCONCUR R
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    OUTRPAUS    COMPUTE TROP OUTPUT VARIABLES FROM NGM
C   PRGMMR: N PHILLIPS       ORG: W/NMC22    DATE: 84-04-10
C
C ABSTRACT: ARRAYS OF TEMPERATURE, -LOG(PRESSURE), HEIGHT, U AND V
C   VELOCITY COMPONENTS ARE AVAILABLE AT SIGMA LEVELS ON THE
C   OUTPUT GRID.  THE TROPOPAUSE IS LOCATED AT THE FIRST PLACE
C   (ABOVE THE SPECIFIED PRESSURE GIVEN BY  PSTART  ) AT WHICH
C   THE LAPSE RATE (-DT/DZ) FIRST BECOMES LESS THAN THE VALUE
C   SPECIFIED BY  CRITLAP. THIS CRITERION IS PATTERNED CRUDELY
C   AFTER THAT DESCRIBED IN THE FEDERAL METEOROLOGICAL HANDBOOK
C   NUMBER 3 (RADIOSONDE OBSERVATIONS) DATED JAN 1 1969.
C   .
C   VALUES OF PRESSURE, TEMPERATURE, U AND V ARE THEN EVALUATED
C   AT THE TROPOPAUSE VALUE OF LOG(PRESSURE) DEFINED ABOVE IF THEY
C   ARE REQUESTED BY DATA CARDS IN THE ARRAYS LSTYPE,LQTYPE AND
C   LEVELS IN  COMOUT  .  LABEL INFORMATION IS UPDATED
C   AND THE DESIRED ARRAY IS SENT TO THE PACKER CODE FOR TRANSMISSION
C   TO THE FRONT END COMPUTER.
C   .
C   (THIS SHOULD BE DONE ONLY BY SR  OUTPUT  WHEN IT HAS
C   DETERMINED THAT AT LEAST ONE TROPOPAUSE VARIABLE IS WANTED.)
C
C PROGRAM HISTORY LOG:
C   84-04-10  N PHILLIPS
C   88-08-26  B SCHMIDT REVISED THE DOCBLOCK
C
C USAGE:  CALL OUTRPAUS
C   SUBPROGRAMS CALLED:
C     UNIQUE:    - OUTNULAB
C                  OUTPACK
C     LIBRARY:
C       COMMON   - COMBLANK
C                  COMCONST
C                  COMOUT
C
C REMARKS:
C   .
C   - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   TEMP        SIGMA ARRAY ON OUTPUT GRID OF TEMPERATURE   COMMON
C   .             (LOCATED IN ARRAY S(JSCR3OUT(1) )
C   Z           SIGMA ARRAY ON OUTPUT GRID OF Z = -LOG(PRES)COMMON
C   .             (LOCATED IN ARRAY S(JSCR3OUT(2) )
C   V           SIGMA ARRAY ON OUTPUT GRID OF V VELOCITY    COMMON
C   .             (LOCATED IN ARRAY S(JSCR3OUT(3) )
C   HGT         SIGMA ARRAY ON OUTPUT GRID OF HEIGHT        COMMON
C   .             (LOCATED IN ARRAY S(JSCR3OUT(4) )
C   U           SIGMA ARRAY ON OUTPUT GRID OF U VELOCITY    COMMON
C   .             (LOCATED IN ARRAY S(JSCR3OUT(5) )
C   .
C   - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   OUTPUT FROM THIS SUBROUTINE IS GENERATED BY CALLS TO THE
C   .   SUBROUTINES  OUTNULAB  AND  OUTPACK  .
C   FOR OUTNULAB, THE FOLLOWING LABEL INFORMATION IS PUT
C   .             IN COMOUT .
C   LABSSUB1      =130 FOR TROPOPAUSE SURFACE CODE           COMMON
C   LABSSUB2      =0 DENOTING NO OTHER SURFACE INVOLVED      COMMON
C   S1VALUE AND   BOTH = 0                                   COMMON
C   S2VALUE
C   LABQTYPE      =48,49,8, OR 16 FOR U,V,PRESSURE OR TEMP.  COMMON
C   .
C   FOR THE CALL TO SUBROUTINE  OUTPACK, THIS CODE PREPARES
C   .      THE FOLLOWING DATA.
C   S(MSOUT2)      THE OUTPUT ARRAY OF PRESS, TEMP, U OR V. ARGUMENT
C   .
C   IJOUT          SIZE OF OUTPUT GRID                      ARGUMENT
C   .
C   S(MSOUT1)      SCRATCH ARRAY OF SIZE IJOUT FOR PACKER   ARGUMENT
C   .
C   DESCRIPT(NCARD)20 CHARACTER STRING DESCRIBING VARIABLE  ARGUMENT
C   .
C   LABEL84        ARRAY IN COMOUT CONTAINING LABEL INFO.   ARGUMENT
C   .
C   IOUTUNIT       DISK UNIT NUMBER TO WHICH PACKED FIELDS  ARGUMENT
C   .              ARE TO BE WRITTEN.
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN
C   MACHINE:  CRAY Y-MP
C
C$$$
C
      INCLUDE 'parmodel'
C...TRANSLATED BY FPP 3.00Z36 11/09/90  15:13:46  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C
      COMMON            SCR     (IIJMAX,  INSCR),
     1                  SCRGEOG (IIJMAX,  INSCRGEO),
     2                  SCR3    (IIJKMAX, INSCR3),
     3                  FILLER  (INFILLER),
     4                  VBL     (INVBL),
     5                  BITGRDH (IIJMAX, 2, INGRDUSE),
     6                  BITGRDU (IIJMAX, 2, INGRDUSE),
     7                  BITGRDV (IIJMAX, 2, INGRDUSE),
     8                  BITSEA  (IIJMAX, INGRDUSE),
     9                  BITSNO  (IIJMAX, INGRDUSE),
     1                  BITWVL  (IIJMAX, INGRDUSE)
C
      LOGICAL BITGRDH, BITGRDU, BITGRDV, BITSEA, BITSNO, BITWVL
C
C     COMMON BLOCK /COMCONST/ CONTAINS GRID-RELATED PARAMETERS,
C          AND A FEW OTHER COMMON CONSTANTS.
      COMMON /COMCONST/ IJMAX, KM, LVLTOT, IJRAD, LOFCLDS(2,4),
     1                  ICALLRAD, IPHYSPL, NGRDUSE, NH,
     2                  NTIME, ITIME, NSTEPS,
     3                  IMG(INGRDUSE), JMG(INGRDUSE),
     4                  IAG(INGRDUS1), JAG(INGRDUS1),
     5                  IBG(INGRDUS1), JBG(INGRDUS1),
     6                  IADDRG(INIADDRS, INGRDUSE),
     7                  NPTSFH(2, INGRDUSE),
     8                  KUMULUS, LGRIDPPT, KLIFT1, KLIFT2, IBUCKET,
     9                  XPOLEH(INGRDUSE), YPOLEH(INGRDUSE), RADIUS,
     1                  DELSIG(IKM), PR(IKM), PRESS(IKM),
     2                  SIGINT(IKMP1),
     3                  DTOVDX, ANGVEL,
     4                  SIGMACC, SIGMAGSP, SIGMADHQ, CRITCONV,
     5                  SATDEL, RHFACTOR, QBOUND,
     6                  ANEM, BLKDR, CHARN, CONAUST, DDORF, PKATO,
     7                  SCALEHT, SIGDOT, DLAMNGM
C
C     COMMON BLOCK /COMOUT/ CONTAINS OUTPUT CODE PARAMETERS
C               AND ARRAYS.
C
      CHARACTER*20 DESCRIPT
C
      COMMON /COMOUT/
C
C          THE FOLLOWING ARE STORED BY OUT2FILE FROM DATA CARDS.
C          (THE LAST 6 WILL BE OVERWRITTEN BY  OUTPUT  IF KGTYPE
C          IS 5 OR 26 (I.E. AN LFM GRID DEFINED IN TABLE 7 OF
C          OFFICE NOTE 84.))
C
     1     INUNIT, IOUTUNIT, IOUTGRIB,
     2     KGTYPE, IMOUT, JMOUT, DNPEQOUT, DLAMOUT, XIPOUT, YJPOUT,
C
C          THE FOLLOWING COME FROM  MAIN  READING THE DATA CARDS.
     2   LQTYPE(IMAXOUTV),   LSTYPE(IMAXOUTV),
     3   DESCRIPT(IMAXOUTV), LEVELS(ILMOUT,IMAXOUTV),  NOUTVBLS,
C
C          THE FOLLOWING ARE DERIVED BY   OUTPUT  .
     4       IJOUT, LMOUT, NFILLER, NS2, NS3NGM, NS3OUT,
     5       COSOUT,   SINOUT,    DXOUT,    ZSIGLYR(IKM),
C
C           ARRAYS  PLOUT  AND  HTFD  ARE SET BY DATA STATEMENTS IN
C           THE SR  OUTPUT  .  'PADDER' FILLS OUT TO FULL WORD BNDRY.
     6      PLOUT(ILMOUT),   HTFD( 6),  PADDER,
C
C          THE FOLLOWING ADDRESSES AND ADDRESS ARRAYS ARE SET UP
C          BY   OUTPREP  WHEN IT IS CALLED BY   OUTPUT  .
     7  J1(INGRDUSE),          J2(INGRDUSE),   JADDK2L(INGRDUSE,2),
     8  JADDFNGM(INGRDUSE), JHREC(INGRDUSE),   JHKAP(INGRDUSE),
     9  JSCR2(12),    JSCR3NGM(INGRDUSE,12),   JSCR3OUT(12),
     A  LENGD(INGRDUSE), LTYPE(ILMOUT,INGRDUSE), MB1, MB2, MINT,
     B   MSOUT1,  MSOUT2,  MZGNDOUT,  MNGM3,  MHOUT, MZFR, MZTRO,
     C      MSZGND(INGRDUSE), NGRIDATA(INGRDUSE),
C
C            NUMGDREQ, THE NUMBER OF NGM GRIDS NEEDED TO COVER THE
C            OUTPUT GRID, AND ZLOUT, ARE SET BY  OUTPREP  .
     D                NUMGDREQ,    ZLOUT(ILMOUT),
C
C          OUTPREP ALSO ASSIGNS THE FOLLOWING DESCRIPTORS TO BE
C          USED BY  OUTHORIZ  FOR HORIZONTAL INTERPOLATION.
     E    AHORD,BHORD,CHORD,DHORD, ILLD,IULD,  SCRHORD,  OUTHORD,
C
C
C          THE FOLLOWING ARRAY CONTAINS THE INTEGERS NEEDED TO
C          FORM THE LABEL THAT GOES WITH EACH OUTPUT ARRAY.
     F               LABEL84( 27 ),
C
C          THE FOLLOWING SYMBOLS REPRESENT TEMPORARY VALUES OF
C          INTEGERS TO GO INTO  LABEL84 WHEN THE OUTPUT ARRAY
C          HAS BEEN PREPARED FOR PACKING.
C
     G  LABQTYPE, LABSSUB1, LABTMARK,  S1VALUE,  S2VALUE,
     H  LABMLDIF, LABSSUB2, LABFSUB2, LABKGRID, LABNUMPT
CER
      INTEGER IDGRBE(25)
C
      DIMENSION S(INSUMG),IN(INSUMG)
C
      LOGICAL BITS(INSUMG), B1D,B2D
C
      EQUIVALENCE (SCR(1,1),S(1), BITS(1), IN(1) )
C
      INTEGER I,I1X
      DATA LABTRO/130/,  LABVWSH/52/   , LABUGRD/48/,
     1     LABVGRD/49/,  LABPRES/8/,     LABTEMP/16/
C
C
C           CRITICAL LAPSE RATE
      DATA CRITLAP/.002E0/
C           LOWEST 'PRESSURE' LEVEL TO SEARCH FOR TROPOPAUSE
      DATA PSTART/.55E0/
C         (UNITS IN 1000 MBS )
C
C          SET UP THE COMMON PART OF LABEL ENTRYS
C
      LABSSUB1=LABTRO
      S1VALUE=0.E0
      LABSSUB2=0
      S2VALUE=0.E0
C
C          LOCATE DATA CARDS
C
      NCARDP=0
      NCARDT=0
      NCARDU=0
      NCARDV=0
      NCARDSH=0
C
      DO 10 N=1,NOUTVBLS
      IF( LSTYPE(N) .NE. LABTRO ) GO TO 10
      IF( LQTYPE(N) .EQ. LABPRES) NCARDP=N
      IF( LQTYPE(N) .EQ. LABTEMP) NCARDT=N
      IF( LQTYPE(N) .EQ. LABUGRD) NCARDU=N
      IF( LQTYPE(N) .EQ. LABVGRD) NCARDV=N
      IF( LQTYPE(N) .EQ. LABVWSH) NCARDSH=N
   10 CONTINUE
C
C          FIND THE SIGMA LEVEL(K) JUST ABOVE PSTART VALUE.
      DO 14 K=1,KM
      K1=K
      IF(PRESS(K) .LT. PSTART ) GO TO 15
   14 CONTINUE
C
   15 CONTINUE
C
C          COMPUTE LAPSE RATES FOR LAYERS K1 THROUGH KM-1.
C
      K2=KM-1
      IADEL=(K1-2)*IJOUT
C          WILL PUT THEM IN UNUSED NGM GRID SPACE
      IALAP=IADEL+JSCR3NGM(1,1)
      IAT=JSCR3OUT(1) + IADEL
      IAHGT=JSCR3OUT(4) + IADEL
      DO 18 K=K1,K2
      IAT=IAT+IJOUT
      IAHGT=IAHGT+IJOUT
      IALAP=IALAP+IJOUT
C          MINUS DELTA TEMPERATURE
      DO 88890 IQ2W6E=1,IJOUT
         S(JSCR2(1)+IQ2W6E-1)=S(IAT+IQ2W6E-1)-S(IAT+IJOUT+IQ2W6E-1)
88890 CONTINUE
C          DELTA HEIGHT
      DO 88900 IQ2W6E=1,IJOUT
         S(JSCR2(2)+IQ2W6E-1)=S(IAHGT+IJOUT+IQ2W6E-1)-S(IAHGT+IQ2W6E-1
     *   )
         S(IALAP+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)/S(JSCR2(2)+IQ2W6E-1)
88900 CONTINUE
C
   18 CONTINUE
C
C          WEIGHT THESE TO GET CENTERED ESTIMATES AT EACH LEVEL.
C          RESULTS WILL BE VALID AT K= K1+1, K1+2,,,,KM-1.
      K11=K1+1
      DO 20 KK=K11,K2
C          REVERSE THE SEQUENCE ORDER
      K=-KK+K11+K2
      INC=(K-1)*IJOUT
      IAHGT=JSCR3OUT(4) + INC
      IALAP=JSCR3NGM(1,1) + INC
      DO 88920 IQ2W6E=1,IJOUT
         S(JSCR2(1)+IQ2W6E-1)=S(IAHGT+IQ2W6E-1)-S(IAHGT-IJOUT+IQ2W6E-1
     *   )
         S(JSCR2(2)+IQ2W6E-1)=S(IAHGT+IJOUT+IQ2W6E-1)-S(IAHGT-IJO
     *   UT+IQ2W6E-1)
         S(JSCR2(1)+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)/S(JSCR2(2)+IQ2W6E-1
     *   )
         S(JSCR2(2)+IQ2W6E-1)=(1.E0-S(JSCR2(1)+IQ2W6E-1))*S(IALAP-IJOU
     *   T+IQ2W6E-1)
         S(JSCR2(1)+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)*S(IALAP+IQ2W6E-1)
         S(IALAP+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)+S(JSCR2(2)+IQ2W6E-1)
88920 CONTINUE
   20 CONTINUE
C
C          PROCEED THROUGH ARRAY OF LAPSE RATES TO FIND FIRST
C          PLACE WHERE LAPSE RATE .LE. CRITICAL VALUE.
C
C          INITIALIZE THE GATHER INTEGER ARRAY (ID) TO LEVEL K11.
      IAD=(K11-1)*IJOUT + 1
      DO 1001 IQ2 = 1, IJOUT
         IN(MINT+IQ2-1) = IAD + IQ2 - 1
1001  CONTINUE
C          BIT VECTOR B1D WILL BE 1 FOR EVERY POINT WHERE THE
C          TROPOPAUSE HAS BEEN FOUND.
C
C          BIT VECTOR B2D WILL BE 1 FOR EVERY POINT ON A NEW LEVEL
C          THAT MEETS THE CRITERION.
C
C          ARRAY VECTOR CD WILL CONTAIN THE INTERPOLATION COEFFICIENTS
C          SUCH THAT
C    F(TROP) = F(B)  +  CD * ( F(A) -F(B) )
C
C          WHERE F(A) AND F(B) ARE AT SIGMA LEVELS ABOVE AND BELOW THE
C          TROPOPAUSE, AND THE GATHER INTEGER IS SET TO GET F(A).
C
C          INITIALIZE THE COEFFICIENTS
      DO 88980 IQ2W6E=1,IJOUT
         S(JSCR2(3)+IQ2W6E-1)=1.E0
88980 CONTINUE
C          INITIALIZE B1D FOR POINTS AT K11 THAT ALREADY SATISFY THE
C          CRITERION.
      IALAP=(K11-1)*IJOUT + JSCR3NGM(1,1)
      DO 88990 IQ2W6E=1,IJOUT
         BITS(MB1+IQ2W6E-1)=S(IALAP+IQ2W6E-1).LE.CRITLAP
88990 CONTINUE
C
C          EXAMINE THE LEVELS K11+1,,,,KM-1.
      K12=K11+1
      IGINC=0
      DO 25 K=K12,K2
      INC=(K-1)*IJOUT
      IALAP=INC+JSCR3NGM(1,1)
      IGINC=IGINC+IJOUT
C           ANY STABLE POINTS,,,,
      DO 89000 IQ2W6E=1,IJOUT
         BITS(MB2+IQ2W6E-1)=S(IALAP+IQ2W6E-1).LE.CRITLAP
89000 CONTINUE
C          RESTRICT THESE TO NEW POINTS
      DO 89010 IQ2W6E=1,IJOUT
         BITS(MB2+IQ2W6E-1)=BITS(MB2+IQ2W6E-1).AND..NOT.BITS(MB1+
     *   IQ2W6E-1)
89010 CONTINUE
C           CORRECT GATHER INTEGER AND GET COEFFICIENT.
C
      DO 89020 IQ2W6E=1,IJOUT
       IF ( BITS(MB2+IQ2W6E-1) ) THEN
         IN(MINT+IQ2W6E-1)=IN(MINT+IQ2W6E-1)+IGINC
         S(JSCR2(1)+IQ2W6E-1)=CRITLAP-S(IALAP-IJOUT+IQ2W6E-1)
         S(JSCR2(2)+IQ2W6E-1)=S(IALAP+IQ2W6E-1)-S(IALAP-IJOUT+IQ2W6E-1
     *   )
         S(JSCR2(3)+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)/S(JSCR2(2)+IQ2W6E-1
     *   )
       END IF
89020 CONTINUE
C
C
C           UPDATE B1D
      DO 89060 IQ2W6E=1,IJOUT
         BITS(MB1+IQ2W6E-1)=BITS(MB1+IQ2W6E-1).OR.BITS(MB2+IQ2W6E-1)
89060 CONTINUE
C
C          CHECK FOR COMPLETION IF PRESSURE LOW ENOUGH
      IF( PRESS(K) .GE. 0.20E0 ) GO TO 25
C
      ICNT = 0
      DO 2001 IQ2 = 1, IJOUT
         IF ( BITS(MB1+IQ2-1) ) ICNT = ICNT + 1
2001  CONTINUE
      IF( ICNT .GE. IJOUT ) GO TO 30
C
   25 CONTINUE
C
C          IF ANY POINTS HAVE NOT BEEN DEFINED, SET THEM TO THE
C          TOP LEVEL.
      DO 89070 IQ2W6E=1,IJOUT
         BITS(MB2+IQ2W6E-1)=.NOT.BITS(MB1+IQ2W6E-1)
89070 CONTINUE
      DO 89080 IQ2W6E=1,IJOUT
       IF ( BITS(MB2+IQ2W6E-1) ) THEN
         IN(MINT+IQ2W6E-1)=IN(MINT+IQ2W6E-1)+IGINC
       END IF
89080 CONTINUE
C          ( THE INTERPOLATION COEFF. IS ALREADY = 1.E0)
C
   30 CONTINUE
C
C          IS TROPOPAUSE PRESSURE WANTED?
      IF( NCARDP .EQ.  0 ) GO TO 200
      IF( LEVELS(1,NCARDP) .NE. 1 ) GO TO 200
C
C          GET PRESSURE AT THE TROPOPAUSE
      IRET=1
C          Z(=-LOG(P) ) IS IN JSCR3OUT(2)
      IGET=2
      NCD=NCARDP
      LABQTYPE=LABPRES
      GO TO 100
C
C--------------------------------------------------------
C           COMPUTED GO TO ROUTINE TO DO VERTICAL INTERPOLATION
C           AND SEND RESULT TO PACKER CODE.
  100 CONTINUE
C
C          GATHER ADDRESS
      IAD=JSCR3OUT(IGET) - 1
C          NOMINAL LENGTH
      LEN=1
C           VALUES ABOVE TROPOPAUSE TO S2D
C*****  Code Expanded From Routine:  RDHGATHR
      DO 77053 I = 1, IJOUT
         S(I+JSCR2(2)-1) = S(IN(I+MINT-1)+IAD)
77053 CONTINUE
C*****  End of Code Expanded From Routine:  RDHGATHR
C*****  Code Expanded From Routine:  RDHGATHR
      DO 77054 I1X = 1, IJOUT
         S(I1X+JSCR2(1)-1) = S(IN(I1X+MINT-1)+IAD-IJOUT)
77054 CONTINUE
C*****  End of Code Expanded From Routine:  RDHGATHR
C          DIFFERENCE TO S2D
      DO 89090 IQ2W6E=1,IJOUT
         S(JSCR2(2)+IQ2W6E-1)=S(JSCR2(2)+IQ2W6E-1)-S(JSCR2(1)+IQ2W6E-1
     *   )
89090 CONTINUE
C          MULTIPLY BY COEFFICIENT
      DO 89100 IQ2W6E=1,IJOUT
         S(JSCR2(2)+IQ2W6E-1)=S(JSCR2(2)+IQ2W6E-1)*S(JSCR2(3)+IQ2W6E-1
     *   )
89100 CONTINUE
C
C          IF IRET=1, MUST CHANGE -LOG(P) TO P
      IF(IRET .EQ. 1) GO TO 105
C
C          NORMAL RESULT TO SMD(====S(MSOUT2)  )
      DO 89110 IQ2W6E=1,IJOUT
         S(MSOUT2+IQ2W6E-1)=S(JSCR2(1)+IQ2W6E-1)+S(JSCR2(2)+IQ2W6E-1)
89110 CONTINUE
      GO TO 110
C
  105 CONTINUE
      DO 89120 IQ2W6E=1,IJOUT
         S(JSCR2(1)+IQ2W6E-1)=-S(JSCR2(1)+IQ2W6E-1)-S(JSCR2(2)+IQ2W6E-
     *   1)
89120 CONTINUE
C           ( THAT GAVE + LOG(P)   )
      DO 89130 IQ2W6E=1,IJOUT
         S(MSOUT2+IQ2W6E-1)=1000.E0*EXP( S(JSCR2(1)+IQ2W6E-1) )
89130 CONTINUE
C
C
  110 CONTINUE
C
      CALL OUTNULAB
C
C
C  SET UP PDS INFO
C
      CALL LAB2PDS(LABEL84,IDGRBE)
      IDGRBE(7) =   0
      IF(LABEL84(1).EQ.8) IDGRBE(8) = 1
      IF(LABEL84(1).EQ.16) IDGRBE(8) = 11
      IF(LABEL84(1).EQ.48) IDGRBE(8) = 33
      IF(LABEL84(1).EQ.49) IDGRBE(8) = 34
      IDGRBE(9) =   7
      IDGRBE(10) =  0
      IDGRBE(11) =  0
      IDGRBE(18) =  LABEL84(3)
      IDGRBE(19) =  0
      IDGRBE(20) =  0

c     CALL OUTPACK(S(MSOUT2),IJOUT,S(MSOUT1),DESCRIPT(NCD),
c    1   LABEL84, IOUTUNIT )
      CALL GRIBITN (S(MSOUT2),IJOUT,S(MSOUT1),DESCRIPT(NCD),
     1   IDGRBE,IOUTGRIB,LABEL84 )
C
      GO TO ( 200, 300, 400, 500 ) , IRET
C
C---------------------------------------------------------
C
C
C          TEMPERATURE AT THE TROPOPAUSE
C
  200 IF( NCARDT .EQ. 0 ) GO TO 300
      IF( LEVELS(1,NCARDT) .NE. 1 ) GO TO 300
C
      IRET=2
      IGET=1
      NCD=NCARDT
      LABQTYPE=LABTEMP
      GO TO 100
C
C
C          U AT THE TROPOPAUSE
  300 IF( NCARDU .EQ. 0 ) GO TO 400
      IF( LEVELS(1,NCARDU) .NE. 1 ) GO TO 400
C
      IRET=3
      IGET=5
      NCD=NCARDU
      LABQTYPE=LABUGRD
      GO TO 100
C
C          V AT THE TROPOPAUSE
  400 IF( NCARDV .EQ. 0 ) GO TO 500
      IF( LEVELS(1,NCARDV) .NE. 1 ) GO TO 500
C
      IRET=4
      IGET=3
      NCD=NCARDV
      LABQTYPE=LABVGRD
      GO TO 100
C
C          SHEAR AT THE TROPOPAUSE
C        (THIS IS NOT AVAILABLE  )
  500 GO TO 600
C     IF( NCARDSH .EQ. 0 ) GO TO 600
C     IF( LEVELS(1,NCARDSH) .NE. 1 ) GO TO 600
C
C
C   ****** COMPUTE VERTICAL WIND SHEAR HERE AND PUT IN S(MSOUT2)
C     LABQTYPE=LABVWSH
C     CALL OUTNULAB
C     CALL OUTPACK( S(MSOUT2), IJOUT, S(MSOUT1), DESCRIPT(NCARDSH),
C    1 LABEL84, IOUTUNIT )
C     CALL GRIBIT ( S(MSOUT2), IJOUT, S(MSOUT1), DESCRIPT(NCARDSH),
C    1 LABEL84, IOUTGRIB )
C
  600 CONTINUE
C
      RETURN
      END
