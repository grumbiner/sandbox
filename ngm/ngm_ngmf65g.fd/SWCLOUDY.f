      SUBROUTINE SWCLOUDY
C
C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C
C SUBPROGRAM:    SWCLOUDY    TO COMPUTE CLOUDY SW RADIATION
C   PRGMMR: J TUCCILLO       ORG: W/NMC22    DATE: 90-06-18
C
C ABSTRACT:    COMPUTES CLOUDY SW RADIATION
C   .
C PROGRAM HISTORY LOG:
C   90-06-17  J TUCCILLO
C
C USAGE:  CALL SWCLOUDY
C   SUBPROGRAMS CALLED:
C     LIBRARY:
C       COMMON   - BLANK COMMON
C
C REMARKS:
C   - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   .            INFORMATION PASSED THROUGH COMMON
C   .
C   - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C   .
C   NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C   -----       ----------------------------------        ---------
C   .
C   .            INFORMATION PASSED THROUGH COMMON
C
C ATTRIBUTES:
C   LANGUAGE: FORTRAN
C   MACHINE:  CRAY Y-MP
C
C$$$
C
      INCLUDE 'parmodel'
C
      PARAMETER (NIM= IIJRAD, NJM=46, NLM= IKM, NLS=02)
      PARAMETER (NNQFDS=5, NOFDS=2, NQIFDS=5, NOIFDS=8
     *,      NNQP3=21, NNQP2=59, N2DFDS=29, NEQO3O=01)
      PARAMETER (NIMP1=NIM+1,NIMP2=NIM+2,NIMP3=NIM+3,NIMD2=NIM/2+1/NIM
     *,     NLMM2=NLM-2, NLSP1=NLS+1, LMM1T2=(NLM-1)*2
     *,     IMD2P1=NIM/2+1, NJMM2=NJM-2, NLMP1=NLM+1, NLMM1=NLM-1
     *,     N1=NLM*NQIFDS+NOIFDS
     *,     N2=NLM*NNQFDS+NOFDS, N3=NIMP2*N2
     *,     NIMT2=NIM*2,N6=NIMP2*N1,NILPT=NIM*NLM
     *,     NNQPFD = NNQP3 + (NNQP2-1)/NLM + 1
     *,     NN5= NNQP3+ (NNQP2+(N2DFDS*NIM-1)/NIMP2)/NLM + 3
     *,     NN6 = NN5*NLM,NN1 = N1 - 1
     *,     N5= NIMP2*NN6, NTDSG =NLM-NLSP1
     *,     NNBITX=NIM*NLM
     *,     NPG=(NN1*NIMP2*NJMM2-1)/131072 + 1
     *,     N55=N5-2*NLM*NIMP2
     *,     NTL=(N55*NJMM2-1)/131072 + 1)
C
      PARAMETER (NNP=NLMP1+1,IMLMP1=NIM*NLMP1,IMNNP=NIM*NNP
     *,          ILP1=NIM*NLMP1)
C...TRANSLATED BY FPP 3.00Z36 11/09/90  14:59:21  
C...SWITCHES: OPTON=I47,OPTOFF=VAE0
C
      DIMENSION FK(5),XK(5)
C
      LOGICAL BITX(ILP1), BITC(IMNNP), BITD(IMNNP)
C
      COMMON  IM,NP,NPP1,LMP1,LS1,LS,NSOL,NSOLP1,NSLMP1,NSOLNP,DOOZ
     *,       SQRT3,GG,GGP,GGSQ,NCLD,NCLDP1,NCLMP1,NCLDNP,RCN1
     *,       ATHRD,TTHRD,RCN2
     *,       PU(IMNNP),TA(IMLMP1),WA(IMLMP1),OA(IMLMP1),E0(IMLMP1)
     *,       DP(IMLMP1),DPC(IMLMP1),W(IMNNP),DN(IMNNP),UP(IMNNP)
     *,       AG(NIM),RSURF(NIM),AGCD(NIM),RSRCD(NIM),VM(IMNNP)
     *,       SCOSZ(NIM),CMU(NIM),COSMAG(NIM),CSMCLD(NIM),SCZCD(NIM)
     *,       CMUC(NIM),SCOSC(NIM),CSS(IMLMP1),CCU(IMLMP1),VP(IMNNP)
     *,       SL(NIM),ACLR(IMLMP1),DSCLR(NIM),SC(NIM),ACLD(ILP1)
     *,       TAUC(IMLMP1),TAUT(NIM),RCO(NIM),RCG(NIM),CM(IMNNP)
     *,       OZALE(IMNNP),OZCD(IMNNP),RLO(NIM),RLG(NIM),DL(IMNNP)
     *,       SWIL(IMLMP1),SWALE(IMNNP),SWILC(IMLMP1),DEN(IMLMP1)
     *,       F2(IMLMP1),CR(IMNNP),E2(IMLMP1)
     *,       U1(IMLMP1),AK(IMLMP1),DA(IMLMP1),DB(IMLMP1)
     *,       ALF1(IMLMP1),ALF2(IMLMP1)
     *,       UL(IMNNP)
     *,       SOL(IMNNP),DSCLD(NIM),BITX,BITC,BITD
C
      LOGICAL FIRST, DOOZ
      INTEGER ISYS,I1X,I2X
      REAL TMP,V,TMP1X,V1X
      PARAMETER (ISYS = 1)
      DATA FIRST / .TRUE. /
C
      DATA FK/0.107E0,0.104E0,0.073E0,0.044E0,0.025E0/
      DATA XK/0.005E0,0.041E0,0.416E0,4.752E0,72.459E0/
C
      IF (FIRST) THEN
         FIRST = .FALSE.
         GGPP1 = 1.0 + GGP
         GGPM1 = GGP - 1.0E0
         GSQM1 = 1.0E0 - GGSQ
      END IF
C
      LP = LMP1 * NCLD + 1
CMIC$ PARALLEL SHARED(NCLMP1, ACLD, NCLD, SC, DN) PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 88890 IQ2=1,NCLD
         SC(IQ2)=0.0E0
         DN(IQ2)=0.0E0
88890 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 88910 IQ2=1,NCLMP1
         ACLD(IQ2)=0.0E0
88910 CONTINUE
CMIC$ END PARALLEL
C
      IF (DOOZ) THEN
CMIC$ PARALLEL SHARED(NCLMP1, W, E0, VP, NP, NCLD, OZCD, CSMCLD)
CMIC$1    PRIVATE(IQ2, L, L0, L1)
CMIC$ DO PARALLEL
         DO 40 L=2,NP
         L0 = (L-2) * NCLD + 1
         L1 = (L-1) * NCLD + 1
      DO 88920 IQ2=1,NCLD
         W(L0+IQ2-1)=OZCD(L1+IQ2-1)*CSMCLD(IQ2)
88920 CONTINUE
   40    CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 88930 IQ2=1,NCLMP1
         E0(IQ2)=(103.63E0*W(IQ2)) ** 3
         VP(IQ2)=1.0E0+138.57E0*W(IQ2)
88930 CONTINUE
CMIC$ END PARALLEL
C*****  Code Expanded From Routine:  RDEXP805
CMIC$ DO ALL VECTOR SHARED(NCLMP1, VP, CM) PRIVATE(I1X)
      DO 77002 I1X = 1, NCLMP1
         CM(I1X) = VP(I1X)**0.8046875
77002 CONTINUE
C*****  End of Code Expanded From Routine:  RDEXP805
CMIC$ PARALLEL SHARED(LMP1, NCLD, ACLD, SCOSC, NCLMP1, NCLDP1, DN, W, CM
CMIC$1   , E0) PRIVATE(L, L0, IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 88960 IQ2=1,NCLMP1
         DN(NCLDP1+IQ2-1)=0.02118E0*W(IQ2)/(1.0E0+0.042E0*W
     *   (IQ2)+0.000323E0*W(IQ2)*W(IQ2))+1.08173E0*W(IQ2)/
     *   CM(IQ2)+0.0658E0*W(IQ2)/(1.0E0+E0(IQ2))
88960 CONTINUE
C
C     COMPUTE OZONE HEATING ON THE WAY DOWN
C
CMIC$ DO PARALLEL VECTOR
      DO 88970 IQ2=1,NCLMP1
         ACLD(IQ2)=DN(NCLDP1+IQ2-1)-DN(IQ2)
88970 CONTINUE
CMIC$ DO PARALLEL
         DO 50 L=1,LMP1
         L0 = (L-1) * NCLD + 1
      DO 88980 IQ2=1,NCLD
         ACLD(L0+IQ2-1)=ACLD(L0+IQ2-1)*SCOSC(IQ2)
88980 CONTINUE
   50    CONTINUE
CMIC$ END PARALLEL
      ELSE
CMIC$ DO ALL VECTOR SHARED(NCLD, LP, DN) PRIVATE(IQ2)
      DO 88990 IQ2=1,NCLD
         DN(LP+IQ2-1)=0.0E0
88990 CONTINUE
      END IF
C
C     GROUND ABSORPTION FOR WAVELENGTHS UNDER 0.9 MICRONS
C
CMIC$ DO ALL VECTOR SHARED(NCLD, LP, DN, RCG, SCOSC, SC) PRIVATE(IQ2)
      DO 89000 IQ2=1,NCLD
         SC(IQ2)=(0.647E0-DN(LP+IQ2-1))*(1.0E0-RCG(IQ2))*SCOS
     *   C(IQ2)
89000 CONTINUE
C
      IF (DOOZ) THEN
CMIC$ PARALLEL SHARED(NCLMP1, OZCD, W, NCLD, LP, DN, UP, CSMCLD)
CMIC$1    PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89010 IQ2=1,NCLD
         UP(LP+IQ2-1)=DN(LP+IQ2-1)
         W(LP+IQ2-1)=OZCD(LP+IQ2-1)*(1.9E0+CSMCLD(IQ2))
89010 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89030 IQ2=1,NCLMP1
         W(IQ2)=1.9E0*OZCD(IQ2)
89030 CONTINUE
CMIC$ END PARALLEL
C
         DO 80 L=1,LMP1
         L0 = (L-1) * NCLD + 1
CMIC$ DO ALL VECTOR IF (ABS(LP-L0).GE.NCLD .OR. LP-L0.EQ.0) SHARED(NCLD
CMIC$1   , LP, L0, W) PRIVATE(IQ2)
      DO 89040 IQ2=1,NCLD
         W(L0+IQ2-1)=W(LP+IQ2-1)-W(L0+IQ2-1)
89040 CONTINUE
   80    CONTINUE
C
CMIC$ DO ALL VECTOR SHARED(NCLMP1, W, E0, VP) PRIVATE(IQ2)
      DO 89050 IQ2=1,NCLMP1
         E0(IQ2)=(103.63E0*W(IQ2)) ** 3
         VP(IQ2)=1.0E0+138.57E0*W(IQ2)
89050 CONTINUE
C*****  Code Expanded From Routine:  RDEXP805
CMIC$ DO ALL VECTOR SHARED(NCLMP1, VP, CM) PRIVATE(I2X)
      DO 77004 I2X = 1, NCLMP1
         CM(I2X) = VP(I2X)**0.8046875
77004 CONTINUE
C*****  End of Code Expanded From Routine:  RDEXP805
CMIC$ PARALLEL SHARED(NCLMP1, ACLD, LMP1, NCLD, W, RCO, SCOSC, NCLDP1, 
CMIC$1   UP, CM, E0) PRIVATE(IQ2, L, L0)
CMIC$ DO PARALLEL VECTOR
      DO 89080 IQ2=1,NCLMP1
         UP(IQ2)=0.02118E0*W(IQ2)/(1.0E0+0.042E0*W(IQ2)+0.000
     *   323E0*W(IQ2)*W(IQ2))+1.08173E0*W(IQ2)/CM(IQ2)+0.0
     *   658E0*W(IQ2)/(1.0E0+E0(IQ2))
89080 CONTINUE
C
C        COMPUTE OZONE HEATING ON THE WAY UP
C
CMIC$ DO PARALLEL VECTOR
      DO 89090 IQ2=1,NCLMP1
         W(IQ2)=UP(IQ2)-UP(NCLDP1+IQ2-1)
89090 CONTINUE
CMIC$ DO PARALLEL
         DO 90 L=1,LMP1
         L0 = (L-1) * NCLD + 1
      DO 89100 IQ2=1,NCLD
         ACLD(L0+IQ2-1)=ACLD(L0+IQ2-1)+W(L0+IQ2-1)*RCO(IQ2
     *   )*SCOSC(IQ2)
89100 CONTINUE
   90    CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89110 IQ2=1,NCLMP1
         IF (ACLD(IQ2).LT.0.0E0) THEN
             ACLD(IQ2) = 0.0E0
         END IF
89110 CONTINUE
CMIC$ END PARALLEL
      END IF
C
CMIC$ PARALLEL SHARED(NCLMP1, GGP, OA, TA, WA, LMP1, NCLD, CMUC)
CMIC$1    PRIVATE(IQ2, L, L0)
CMIC$ DO PARALLEL
      DO 100 L=1,LMP1
      L0 = (L-1) * NCLD + 1
      DO 89120 IQ2=1,NCLD
         OA(L0+IQ2-1)=CMUC(IQ2)
89120 CONTINUE
  100 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89130 IQ2=1,NCLMP1
         TA(IQ2)=0.5E0-GGP*OA(IQ2)
         WA(IQ2)=1.0E0-TA(IQ2)
89130 CONTINUE
CMIC$ END PARALLEL
C
C     CYCLE OVER FIVE BANDS
C
      DO 290 IK=1,5
C
C     COMPUTE TOTAL OPTICAL DEPTH AND SINGLE SCATTERING ALBEDO
C     PIZERO OF CLOUDS IS 0.99
C
CMIC$ PARALLEL SHARED(NCLMP1, DPC, E0, LMP1, NCLD, CCU, CSMCLD, IK, 
CMIC$1   SCOSC, FK, SOL, GG, SQRT3, GGSQ, GSQM1, TAUC, SWILC, XK, CR, VP
CMIC$2   , VM, U1, E2, W, CM, PU, CSS) PRIVATE(IQ2, L, L0)
C
C     COMPUTE TOTAL OPTICAL DEPTH AND SINGLE SCATTERING ALBEDO
C     PIZERO OF CLOUDS IS 0.99
C
CMIC$ DO PARALLEL VECTOR
      DO 89150 IQ2 = 1, NCLMP1
         CCU(IQ2) = TAUC(IQ2) + SWILC(IQ2)*XK(IK)
         CR(IQ2) = TAUC(IQ2)/CCU(IQ2)*0.99E0
         VP(IQ2) = SQRT(1.0E0-CR(IQ2)*GG)
         VM(IQ2) = SQRT(1.0E0-CR(IQ2))
         U1(IQ2) = VP(IQ2)/VM(IQ2)
         E2(IQ2) = EXP((-SQRT3*VP(IQ2)*VM(IQ2)*CCU(IQ2)))
         W(IQ2) = U1(IQ2) + 1.0E0
         CM(IQ2) = U1(IQ2) - 1.0E0
         W(IQ2) = W(IQ2)*W(IQ2)
         CM(IQ2) = CM(IQ2)*CM(IQ2)
         CM(IQ2) = W(IQ2) - CM(IQ2)*E2(IQ2)*E2(IQ2)
         PU(IQ2) = (U1(IQ2)*U1(IQ2)-1.0E0)*(1.0E0-E2(IQ2)*E2(IQ2))/CM(
     1      IQ2)
         CSS(IQ2) = 4.0E0*U1(IQ2)*E2(IQ2)/CM(IQ2)
         VP(IQ2) = 1.0E0 - GGSQ*CR(IQ2)
         CCU(IQ2) = CCU(IQ2)*VP(IQ2)
         CR(IQ2) = CR(IQ2)*GSQM1/VP(IQ2)
89150 CONTINUE
C
C     COMPUTE DIRECT TRANSMISSION
C
CMIC$ DO PARALLEL VECTOR
      DO 89350 IQ2=1,NCLD
         SOL(IQ2)=SCOSC(IQ2)*FK(IK)
89350 CONTINUE
C
CMIC$ DO PARALLEL
      DO 150 L=1,LMP1
      L0 = (L-1) * NCLD + 1
      DO 89360 IQ2=1,NCLD
         DPC(L0+IQ2-1)=CCU(L0+IQ2-1)*CSMCLD(IQ2)
89360 CONTINUE
  150 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89370 IQ2=1,NCLMP1
         E0(IQ2)=EXP(-DPC(IQ2))
89370 CONTINUE
CMIC$ END PARALLEL
C
C     COMPUTE DIFFUSE REFLECTION AND TRANSMISSION FOR DIRECT BEAM
C     SET UP DELTA-EDDINGTON PARAMETERS
C
CFPP$ NOCONCUR L
      DO 160 L=1,LMP1
      L0 = (L-1) * NCLD + 1
      L1 =  L    * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L0, L1, SOL, E0) PRIVATE(IQ2)
      DO 89390 IQ2=1,NCLD
         SOL(L1+IQ2-1)=SOL(L0+IQ2-1)*E0(L0+IQ2-1)
89390 CONTINUE
  160 CONTINUE
C
CMIC$ DO ALL VECTOR SHARED(NCLMP1, GGPP1, GGPM1, NCLDP1, CR, SWIL, SWALE
CMIC$1   , AK, WA, TA, ALF1, ALF2, OA, VP, VM, UL, U1, CM, DL, E2, F2, 
CMIC$2   DEN, CCU, DPC, DA, DB, E0, UP, SOL, DN) PRIVATE(IQ2)
      DO 89400 IQ2 = 1, NCLMP1
         SWIL(IQ2) = 1.75E0 - CR(IQ2)*GGPP1
         SWALE(IQ2) = (-0.25E0) - CR(IQ2)*GGPM1
         AK(IQ2) = SQRT(SWIL(IQ2)*SWIL(IQ2)-SWALE(IQ2)*SWALE(IQ2))
         ALF1(IQ2) = SWIL(IQ2)*WA(IQ2) + SWALE(IQ2)*TA(IQ2)
         ALF2(IQ2) = SWIL(IQ2)*TA(IQ2) + SWALE(IQ2)*WA(IQ2)
         VP(IQ2) = 1.0E0 - AK(IQ2)*OA(IQ2)
         VM(IQ2) = 1.0E0 + AK(IQ2)*OA(IQ2)
         UL(IQ2) = TA(IQ2) - ALF2(IQ2)*OA(IQ2)
         U1(IQ2) = WA(IQ2) + ALF1(IQ2)*OA(IQ2)
         CM(IQ2) = ALF2(IQ2) + AK(IQ2)*TA(IQ2)
         DL(IQ2) = ALF2(IQ2) - AK(IQ2)*TA(IQ2)
         E2(IQ2) = ALF1(IQ2) - AK(IQ2)*WA(IQ2)
         F2(IQ2) = ALF1(IQ2) + AK(IQ2)*WA(IQ2)
         DEN(IQ2) = 1.0E0 - AK(IQ2)*AK(IQ2)*OA(IQ2)*OA(IQ2)
         IF (DEN(IQ2) .LT. 1.0E-6) DEN(IQ2) = 1.0E-6
         DPC(IQ2) = AK(IQ2)*CCU(IQ2)
         DA(IQ2) = EXP((-DPC(IQ2)))
         DB(IQ2) = EXP((-2.0E0*DPC(IQ2)))
         DEN(IQ2) = DEN(IQ2)*(AK(IQ2)+SWIL(IQ2)+(AK(IQ2)-SWIL(IQ2))*DB(
     1      IQ2))
         UP(IQ2) = CR(IQ2)*(VP(IQ2)*CM(IQ2)-VM(IQ2)*DL(IQ2)*DB(IQ2)-
     1      2.0E0*AK(IQ2)*UL(IQ2)*E0(IQ2)*DA(IQ2))/DEN(IQ2)
         UP(IQ2) = UP(IQ2)*SOL(IQ2)
         DN(NCLDP1+IQ2-1) = -CR(IQ2)*(VM(IQ2)*F2(IQ2)*E0(IQ2)-VP(IQ2)*E2
     1      (IQ2)*E0(IQ2)*DB(IQ2)-2.0E0*AK(IQ2)*U1(IQ2)*DA(IQ2))/DEN(IQ2
     2      )
         DN(NCLDP1+IQ2-1) = SOL(IQ2)*DN(NCLDP1+IQ2-1)
89400 CONTINUE
C
C     FILL UP BOUNDARY TERMS
C
CMIC$ DO ALL VECTOR IF (ABS(LP-1).GE.NCLD .OR. LP-1.EQ.0) SHARED(NCLD, 
CMIC$1   LP, RSRCD, SOL, UP, AGCD, PU, DN, CR, CM, VP, VM) PRIVATE(IQ2)
      DO 89670 IQ2=1,NCLD
         UP(LP+IQ2-1)=RSRCD(IQ2)*SOL(LP+IQ2-1)
         PU(LP+IQ2-1)=AGCD(IQ2)
         DN(IQ2)=0.0E0
         CR(IQ2)=0.0E0
         CM(IQ2)=1.0E0
         VP(IQ2)=0.0E0
         VM(IQ2)=UP(IQ2)
89670 CONTINUE
C
C     SAFETY NET
C
CMIC$ PARALLEL SHARED(NCLMP1,PU,CSS,E0,NCLDNP,UP,DN,SOL)PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89740 IQ2=1,NCLDNP
         IF (UP(IQ2).LT.0.0E0) THEN
             UP(IQ2) = 0.0E0
         END IF
         IF (DN(IQ2).LT.0.0E0) THEN
             DN(IQ2) = 0.0E0
         END IF
         IF (SOL(IQ2).LT.0.0E0) THEN
             SOL(IQ2) = 0.0E0
         END IF
89740 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89770 IQ2 = 1, NCLMP1
         IF (PU(IQ2) .LT. 0.0E0) PU(IQ2) = 0.0E0
         IF (CSS(IQ2) .LT. 0.0E0) CSS(IQ2) = 0.0E0
         E0(IQ2) = CSS(IQ2)*CSS(IQ2)
89770 CONTINUE
CMIC$ END PARALLEL
CFPP$ NOCONCUR L
      DO 250 L=1,LMP1
      L0 = (L-1) * NCLD + 1
      L1 =  L    * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L0, L1, PU, E0, CR, CM) PRIVATE(IQ2)
      DO 89800 IQ2=1,NCLD
         CR(L1+IQ2-1)=PU(L0+IQ2-1)+E0(L0+IQ2-1)*CR(L0+IQ2-
     *   1)*CM(L0+IQ2-1)
         CM(L1+IQ2-1)=1.0E0-CR(L1+IQ2-1)*PU(L1+IQ2-1)
         CM(L1+IQ2-1)=1.0E0/CM(L1+IQ2-1)
89800 CONTINUE
  250 CONTINUE
C
C     COMPUTE FLUXES ON THE WAY DOWN
C
CMIC$ DO ALL VECTOR SHARED(NCLMP1, CR, UP, DB, CSS, CM, E0) PRIVATE(IQ2)
      DO 89830 IQ2=1,NCLMP1
         DB(IQ2)=CR(IQ2)*UP(IQ2)
         E0(IQ2)=CSS(IQ2)*CM(IQ2)
89830 CONTINUE
CFPP$ NOCONCUR L
      DO 260 L=1,LMP1
      L0 = (L-1) * NCLD + 1
      L1 =  L    * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L0, L1, E0, VP, DB, DN) PRIVATE(IQ2)
      DO 89850 IQ2=1,NCLD
         VP(L1+IQ2-1)=E0(L0+IQ2-1)*(VP(L0+IQ2-1)+DB(L0+IQ2
     *   -1))+DN(L1+IQ2-1)
89850 CONTINUE
  260 CONTINUE
CMIC$ PARALLEL SHARED(NCLMP1, CSS, CM, E0, NCLD, LP, VM, UL, VP, CR, SOL
CMIC$1   , DL, SC, NCLDP1, PU, UP) PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89860 IQ2=1,NCLMP1
         VM(NCLDP1+IQ2-1)=CM(NCLDP1+IQ2-1)*(VP(NCLDP1+IQ2-1)*
     *   PU(NCLDP1+IQ2-1)+UP(NCLDP1+IQ2-1))
89860 CONTINUE
C
CMIC$ DO PARALLEL VECTOR
      DO 89870 IQ2=1,NCLD
         UL(LP+IQ2-1)=VM(LP+IQ2-1)
         DL(LP+IQ2-1)=VP(LP+IQ2-1)+UL(LP+IQ2-1)*CR(LP+IQ2-
     *   1)+SOL(LP+IQ2-1)
         SC(IQ2)=SC(IQ2)+DL(LP+IQ2-1)-UL(LP+IQ2-1)
89870 CONTINUE
C
C     COMPUTE FLUXES ON THE WAY UP
C
CMIC$ DO PARALLEL VECTOR
      DO 89900 IQ2=1,NCLMP1
         E0(IQ2)=CSS(IQ2)*CM(IQ2)
89900 CONTINUE
CMIC$ END PARALLEL
      DO 280 K=1,LMP1
      L=NP-K
      L0 = (L-1) * NCLD + 1
      L1 =  L    * NCLD + 1
CMIC$ DO ALL VECTOR SHARED(NCLD, L0, L1, VM, UL, E0) PRIVATE(IQ2)
      DO 89910 IQ2=1,NCLD
         UL(L0+IQ2-1)=VM(L0+IQ2-1)+UL(L1+IQ2-1)*E0(L0+IQ2-1)
89910 CONTINUE
  280 CONTINUE
CMIC$ PARALLEL SHARED(NCLMP1, NCLDP1, ACLD, DL, UL, VP, CR, SOL)
CMIC$1    PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89921 IQ2=1,NCLMP1
         DL(IQ2)=VP(IQ2)+UL(IQ2)*CR(IQ2)+SOL(IQ2)
89921 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89920 IQ2=1,NCLMP1
         ACLD(IQ2)=ACLD(IQ2)+DL(IQ2)-UL(IQ2)-(DL(NCLD
     *   P1+IQ2-1)-UL(NCLDP1+IQ2-1))
89920 CONTINUE
CMIC$ END PARALLEL
C
  290 CONTINUE
C
C     ADD UP ABSORPTION IN COLUMN
C
CMIC$ PARALLEL SHARED(NCLMP1, ACLD, E0, NCLD, SC, TAUT) PRIVATE(IQ2)
CMIC$ DO PARALLEL VECTOR
      DO 89940 IQ2=1,NCLD
         TAUT(IQ2)=SC(IQ2)
89940 CONTINUE
CMIC$ DO PARALLEL VECTOR
      DO 89950 IQ2=1,NCLMP1
         E0(IQ2)=ACLD(IQ2)
89950 CONTINUE
CMIC$ END PARALLEL
      IN = 1
CFPP$ NOCONCUR L
      DO 4001 I = 1, NSOL
         IF ( BITD(I) ) THEN
            SC(I) = TAUT(IN)
            IN = IN + 1
         ELSE
            SC(I) = 0.0E0
         END IF
4001  CONTINUE
      IN = 1
CFPP$ NOCONCUR L
      DO 4002 I = 1, NSLMP1
         IF ( BITD(I) ) THEN
            ACLD(I) = E0(IN)
            IN = IN + 1
         ELSE
            ACLD(I) = 0.0E0
         END IF
4002  CONTINUE
CMIC$ DO ALL VECTOR SHARED(NSOL, SC, DSCLD) PRIVATE(IQ2)
      DO 89960 IQ2=1,NSOL
         DSCLD(IQ2)=SC(IQ2)
89960 CONTINUE
C
      DO 310 L=1,LMP1
      L0 = (L-1) * NSOL + 1
CMIC$ DO ALL VECTOR SHARED(NSOL, L0, DSCLD, ACLD) PRIVATE(IQ2)
      DO 89970 IQ2=1,NSOL
         DSCLD(IQ2)=DSCLD(IQ2)+ACLD(L0+IQ2-1)
89970 CONTINUE
  310 CONTINUE
C
      RETURN
      END
