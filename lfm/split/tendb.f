       SUBROUTINE TENDB
C$$$   SUBPROGRAM  DOCUMENTATION  BLOCK
C
C SUBPROGRAM: TENDB          ADVANCES U & V FORWARD ONE STEP
C   AUTHOR: DENNIS DEAVEN    ORG: W/NMC23    DATE: 22 JUN 83
C
C ABSTRACT: COMPUTES TENDENCIES OF U & V, INCLUDING BOUNDARY LAYER
C   FRICTION AND LINEAR DIFFUSION, AND INTEGRATES FORWARD ONE TIME
C   STEP.
C
C USAGE:  CALL TENDB
C
C - - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     US,VS...    FORCAST VARIABLES PLUS FIXED FIELDS       /DEABLK/
C     XDIF        ARRAY OF DIFFUSION COEFFICIENTS           /BCOEF/
C 
C - - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     US,VS       U & V ADVANCED TO TAU+1 LEVEL           /DEABLK/
C                 STORED AT THE LNEW TIME LEVEL
C 
C - - - - - - - - - S U B P R O G R A M S   C A L L E D - - - - - - - -
C     NAME(S)                                               LIBRARY
C     -------                                               -------
C     DSYDX,DSXDY,DSXY,DEL2XY,TENXY                         LFM LIB
C     VHSQRT                                                FORTLIB
C
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C ATTRIBUTES:
C   LANGUAGE: SiliconGraphics 3.5 FORTRAN 77
C   MACHINE:  SiliconGraphics IRIS-4D/25, 35, INDIGO
C$$$
C
      IMPLICIT    REAL (A-H,O-Z)
      REAL        HOUR1
      REAL        ICE, MF
      CHARACTER*4 LABSIN,LABBND,LABS00,LABS06,LABS12,LABV06,LABV12
      COMMON /DEABLK/ US( 53 , 45 , 21 ),
     A     VS( 53 , 45 , 21 ),
     1     TS( 53 , 45 , 21 ),PSIG( 53 , 45 ,6 ),
     2     ST( 53 , 45 ),ICE( 53 , 45 ),
     3     COSZEN( 53 , 45 ),XM( 53 , 45 ),
     4     F( 53 , 45 ),CD( 53 , 45 ),
     5     SATW( 53 , 45 ,3),WS( 53 , 45 ,9 ),
     6     PREC( 53 , 45 ),ZSTAR( 53 , 45 ),
     7     ALON( 53 , 45 ),ALAT( 53 , 45 ),
     8     MF( 53 , 45 ),H2( 53 , 45 ,3 )
      COMMON /VERTV/ IVVEL( 53 , 45 ,8 )
      COMMON /INDEX/ LI,LJ,LK,LI1,LJ1,LK1,LI2,NIJ,LOLD,LMID,LNEW,
     1     K7OLD,K7MID,K7NEW,K3OLD,K3MID,K3NEW,K2OLD,K2MID,K2NEW,
     2     K,K1,K2,K3,KL,KH
      COMMON /FDATE/  IYEAR, IMO, IDAYMO, IZTIME, IHR1, IOUT
      COMMON /SVHOUR/ NWDS, IHOUR1( 1205 ), HOUR1(8)
      COMMON /TTME/   MNSTEP,IODD,IHOUR,IMONTH,ITSW,IVEL,NPHOUR,
     1                SSLDC,CSLDC,SSLHR,CSLHR,SHR,CHR,
     2                ALP,XDAYMO
      COMMON /FORTAP/ LUNBND,LUNSIN,LUNS00,LUNS06,LUNS12,LUNV06,LUNV12,
     A                LABSIN(8),LABBND(8),LABS00(8),LABS06(8),LABS12(8),
     B                LABV06(8),LABV12(8),PARM(25)
      COMMON /PBNDPE/ ALARGE( 53 ,12, 23 ), BLARGE(12, 33 ,23 )
      COMMON /PBNDRY/ AA( 53 ,12, 23 ), BB( 12, 33 ,23 )
      COMMON /VTEMP/  SIGDOT( 53 , 45 ,5 ), VT( 53 , 45 ,25 )
      COMMON /CNST/ BTHICK,BTHIK1,BTHK3,DT,RDELX,
     1              DTDS0,DTDS1,DTDS2,DTDX,DS1DX,DS2DX,
     2              CP,R,ROCP,TSTRAT,CPTS,SATRH,RSAT60,
     3              RDT,BTHICH,BTHK3H,BTK398,RBT,A1BRN,
     4              A2BRN,TDTDX4,RPK,VVCNST
      COMMON /DIAG/ SUMK(8),SUMP1(8),SUMP2(8),SUMS(8),SUMF(8),SUMFD(8),
     1     SUMVOR(8),SUMDIV(8),DP(8),SUMP(8),SUMTS(8),SUMZ(8),
     2     SIGB1,SIGT1,SIGT2,SIGS1,SIGS2,RMSSFC,RMSTRP
      COMMON /FASTER/ PIE(1100),AX(120)
      COMMON /GEOPOT/ PHI( 53 , 45 ,7 ), PI( 53 , 45 ,7 )
      COMMON /BCOEF/  XDIF( 53 , 45 ),XBND( 53 , 45 )
      SAVE
C
C  FIRST STORE VORTICITY IN VT(4)
C
       CALL DSYDX(VT(1,1,1),VS(1,1,K7MID))
       CALL DSXDY(VT(1,1,2),US(1,1,K7MID))
       CALL DSXY(VT(1,1,3),MF)
      DO 88890 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,4)=VT(IQ2W6E,1,3)*(VT(IQ2W6E,1,1)-VT(IQ2W6E,1,2))
88890 CONTINUE
       IF ( K .NE. 1 ) GO TO 5
       CALL DSXY(VT(1,1,KL+4),US(1,1,K7MID))
       CALL DSXY(VT(1,1,KL+6),VS(1,1,K7MID))
5      IF( K .EQ. 7 ) GO TO 6
       CALL DSXY(VT(1,1,KH+4),US(1,1,K7MID+1))
       CALL DSXY(VT(1,1,KH+6),VS(1,1,K7MID+1))
6      CONTINUE
C
C  FORM VERTICAL ADVECTION TERMS HERE, STORE IN VT(9 & 10)
C  USE VT(24 & 25) TO STORE LOWER LEVEL TERMS
C  PRIOR TO DOING THE VERTICAL BAR
C
       IF( K .NE. 1 ) GO TO 10
       CALL DSXY(VT(1,1,11),PSIG(1,1,K2MID))
      DO 88900 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,9)=SIGDOT(IQ2W6E,1,1)*(VT(IQ2W6E,1,KL+4)-VT(
     *   IQ2W6E,1,KH+4))*DTDS0/2.E0
         VT(IQ2W6E,1,10)=SIGDOT(IQ2W6E,1,1)*(VT(IQ2W6E,1,KL+6)-VT
     *   (IQ2W6E,1,KH+6))*DTDS0/2.E0
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,9)*6.E0*BTHK3/VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,25)=VT(IQ2W6E,1,10)*6.E0*BTHK3/VT(IQ2W6E,1,11)
88900 CONTINUE
       GO TO 20
10     XX = DTDS1
       IF ( K .GE. 5 ) XX = DTDS2
       IF ( K.EQ.4 .OR. K.EQ.7 ) THEN
      DO 88940 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,23)=0.E0
88940 CONTINUE
      END IF
      IF ( K.LE.3 ) THEN
      DO 88950 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,23)=SIGDOT(IQ2W6E,1,K)
88950 CONTINUE
      END IF
      IF ( K.EQ.5 .OR. K.EQ.6 ) THEN
      DO 88960 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,23)=SIGDOT(IQ2W6E,1,K-1)
88960 CONTINUE
      END IF
      DO 88970 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,11)=VT(IQ2W6E,1,23)*(VT(IQ2W6E,1,KL+4)-VT(IQ2W6E,
     *   1,KH+4))*XX
         VT(IQ2W6E,1,12)=VT(IQ2W6E,1,23)*(VT(IQ2W6E,1,KL+6)-VT(IQ2W6E,
     *   1,KH+6))*XX
         VT(IQ2W6E,1,9)=(VT(IQ2W6E,1,11)+VT(IQ2W6E,1,24))*0.5E0
         VT(IQ2W6E,1,10)=(VT(IQ2W6E,1,12)+VT(IQ2W6E,1,25))*0.5E0
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,25)=VT(IQ2W6E,1,12)
88970 CONTINUE
20     CONTINUE
       IF ( K.GT.2 ) GO TO 30
C
C BOUNDARY LAYER FRICTION HERE, ADDED TO VERTICAL ADVECTION TERM
C MODIFIED 29 NOV 1984 BY DENNIS DEAVEN TO INCLUDE EFFECT IN LAYER 2
C
       CALL DSXY2N(VT(1,1,11),US(1,1,K7OLD+1-K))
       CALL DSXY2N(VT(1,1,12),VS(1,1,K7OLD+1-K))
C
C  2.432 E-3  =  ROE * G /  DELTA(P)
C
       IVTMP =      2385
       AAAA = 0.2/3000.0
       BBBB = 1.0
       IF(K.EQ.2) AAAA = 0.8/3000.0
       IF(K.EQ.2) BBBB = 0.0
      DO 89030 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,13)=DT*2.432E-3*CD(IQ2W6E,1)*(AAAA*ZSTAR(IQ2W6E,1
     *   )+BBBB)*SQRT(VT(IQ2W6E,1,11)*VT(IQ2W6E,1,11) +
     *   VT(IQ2W6E,1,12)*VT(IQ2W6E,1,12))
         VT(IQ2W6E,1,9)=VT(IQ2W6E,1,9)+VT(IQ2W6E,1,13)*VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,10)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,13)*VT(IQ2W6E,1,1
     *   2)
89030 CONTINUE
30     CONTINUE
C
C  CALCULATE U AND V TENDENCIES HERE
C  FIRST WE NEED THE KINETIC ENERGY DERIVATIVES WHICH WILL BE STORED IN
C  VT(11 & 12)
C
      DO 89060 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,13)=.5E0*MF(IQ2W6E,1)*(US(IQ2W6E,1,K7MID)*US
     *   (IQ2W6E,1,K7MID)+VS(IQ2W6E,1,K7MID)*VS(IQ2W6E,1,K7MID))
89060 CONTINUE
       CALL DSYDX(VT(1,1,11),VT(1,1,13))
       CALL DSXDY(VT(1,1,12),VT(1,1,13))
       CALL DSXY(VT(1,1,14),F)
      DO 89070 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,14)=1.458E-4*DT*VT(IQ2W6E,1,14)
89070 CONTINUE
       DO 16 J = 1, 45
       DO 16 I = 1, 53
       US(I,J,K7NEW) = -VT(I,J,9) + VT(I,J,KL+6)*VT(I,J,14) + DTDX *
     A                 (VT(I,J,KL+6)*VT(I,J,4)-PHI(I,J,K)-VT(I,J,11))
       VS(I,J,K7NEW) = -VT(I,J,10) -(VT(I,J,KL+4)*VT(I,J,14)) - DTDX *
     A                 (VT(I,J,KL+4)*VT(I,J,4)+PI(I,J,K) +VT(I,J,12))
16     CONTINUE
C
C  ADVANCE TENDENCIES FORWARD IN TIME
C
       C1 = 2.E0
       IF( ITSW .EQ. 1 ) C1 = 1.E0
       CALL DEL2XY(VT(1,1,16),US(1,1,K7OLD))
       CALL DEL2XY(VT(1,1,18),VS(1,1,K7OLD))
       CALL TENXY(VT(1,1,17),US(1,1,K7NEW))
       CALL TENXY(VT(1,1,19),VS(1,1,K7NEW))
       DO 17 J = 1, 45
       DO 17 I = 1, 53
       US(I,J,K7NEW) = XDIF(I,J) *  VT(I,J,16) + VT(I,J,17)
     A                 * C1 + US(I,J,K7OLD)
       VS(I,J,K7NEW) = XDIF(I,J) * VT(I,J,18) + VT(I,J,19)
     A                 * C1 + VS(I,J,K7OLD)
17     CONTINUE
       RETURN
       END
