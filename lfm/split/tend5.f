       SUBROUTINE TEND5
C$$$   SUBPROGRAM  DOCUMENTATION  BLOCK
C
C SUBPROGRAM: TEND5          COMPUTES TS AND WS TIME TENDENCIES
C   AUTHOR: DENNIS DEAVEN    ORG: W/NMC23    DATE: 21 JUN 83
C
C ABSTRACT: COMPUTES SEA SURFACE HEAT AND MOISTURE FLUXES
C   AND THEN CREATES THE TIME TENDENCIES OF POTENTIAL
C   TEMPERATURE AND MOISTURE (EXCLUDING GRID AND SUBGRID SCALE PRECIP).
C
C PROGRAM HISTORY LOG:
C   93-05-14  R.E.JONES   CORRECTION FOR OVERFLOW, 32 BIT IEEE F.P HAS
C                         SMALLER EXPONENT RANGE (10E+38) THAN IBM370
C                         32 BIT FLOATING POINT (10E+75).
C
C USAGE:  CALL TEND5
C
C - - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     US,VS..     FORECAST VARIABLES PLUS FIXED FIELDS      /DEABLK/
C     SIGDOT      D(SIGMA)/DT                               /VTEMP/
C     K,KL,KH..   VERTICAL LAYER INDICIES                   /INDEX/
C 
C - - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     TS,WS,PSIG  TENDENCIES STORED AT LNEW TIME LEVEL      /DEABLK/
C 
C - - - - - - - - - S U B P R O G R A M S   C A L L E D - - - - - - - -
C
C     NAME(S)                                               LIBRARY
C     -------                                               -------
C     DSXY,DSXDY,DSYDX                                      LFMLIB
C
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C ATTRIBUTES:
C   LANGUAGE: SiliconGraphics 3.5 FORTRAN 77
C   MACHINE:  SiliconGraphics IRIS-4D/25, 35, INDIGO
C$$$
C
      IMPLICIT    REAL (A-H,O-Z)
      REAL        HOUR1
      REAL        ICE, MF
      CHARACTER*4 LABSIN,LABBND,LABS00,LABS06,LABS12,LABV06,LABV12
      COMMON /VTEMP/  SIGDOT( 53, 45, 5 ), VT( 53, 45, 25 )
      COMMON /DEABLK/ US( 53 , 45 , 21 ),
     A     VS( 53 , 45 , 21 ),
     1     TS( 53 , 45 , 21 ),PSIG( 53 , 45 ,6 ),
     2     ST( 53 , 45 ),ICE( 53 , 45 ),
     3     COSZEN( 53 , 45 ),XM( 53 , 45 ),
     4     F( 53 , 45 ),CD( 53 , 45 ),
     5     SATW( 53 , 45 ,3),WS( 53 , 45 , 9 ),
     6     PREC( 53 , 45 ),ZSTAR( 53 , 45 ),
     7     ALON( 53 , 45 ),ALAT( 53 , 45 ),
     8     MF( 53 , 45 ),H2( 53 , 45 ,3 )
      COMMON /VERTV/ IVVEL( 53 , 45 ,8 )
      COMMON /INDEX/ LI,LJ,LK,LI1,LJ1,LK1,LI2,NIJ,LOLD,LMID,LNEW,
     1     K7OLD,K7MID,K7NEW,K3OLD,K3MID,K3NEW,K2OLD,K2MID,K2NEW,
     2     K,K1,K2,K3,KL,KH
      COMMON /FDATE/  IYEAR, IMO, IDAYMO, IZTIME, IHR1, IOUT
      COMMON /SVHOUR/ NWDS, IHOUR1( 1205 ), HOUR1(8)
      COMMON /TTME/   MNSTEP,IODD,IHOUR,IMONTH,ITSW,IVEL,NPHOUR,
     1                SSLDC,CSLDC,SSLHR,CSLHR,SHR,CHR,
     2                ALP,XDAYMO
      COMMON /FORTAP/ LUNBND,LUNSIN,LUNS00,LUNS06,LUNS12,LUNV06,LUNV12,
     A                LABSIN(8),LABBND(8),LABS00(8),LABS06(8),LABS12(8),
     B                LABV06(8),LABV12(8),PARM(25)
      COMMON /PBNDPE/ ALARGE( 53 ,12,23),BLARGE(12,       33 ,23)
      COMMON /PBNDRY/ AA( 53 ,12,23), BB(12,       33 ,23)
      COMMON /CNST/ BTHICK,BTHIK1,BTHK3,DT,RDELX,
     1              DTDS0,DTDS1,DTDS2,DTDX,DS1DX,DS2DX,
     2              CP,R,ROCP,TSTRAT,CPTS,SATRH,RSAT60,
     3              RDT,BTHICH,BTHK3H,BTK398,RBT,A1BRN,
     4              A2BRN,TDTDX4,RPK,VVCNST
      COMMON /DIAG/ SUMK(8),SUMP1(8),SUMP2(8),SUMS(8),SUMF(8),SUMFD(8),
     1     SUMVOR(8),SUMDIV(8),DP(8),SUMP(8),SUMTS(8),SUMZ(8),
     2     SIGB1,SIGT1,SIGT2,SIGS1,SIGS2,RMSSFC,RMSTRP
      COMMON /FASTER/ PIE(1100),AX(120)
      SAVE
C
C   COMPUTE SEA SURFACE HEAT FLUX INTO THE BOUNDARY LAYER
C   AND STORE IN VT(18)
C
       IF (K .GT. 1) GO TO 100
       CALL DSXY2N(VT(1,1,16),TS(1,1,K7OLD))
       CALL DSXY2N(VT(1,1,17),XM)
      DO 88890 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,18)=0.E0
         VT(IQ2W6E,1,22)=.6E0*VT(IQ2W6E,1,17)*(VT(IQ2W6E,1,16)-ST
     *   (IQ2W6E,1))
88890 CONTINUE
         IQ2W6E=IQ2W6E
      DO 88910 IQ2W6E=1,NIJ
         IF(.NOT.(VT(IQ2W6E,1,22).LT.0.E0))GO TO 88910
         VT(IQ2W6E,1,18)=VT(IQ2W6E,1,22)
88910 CONTINUE
         IQ2W6E=IQ2W6E
C
C   COMPUTE SEA SURFACE MOISTURE FLUX (ONLY WHEN TSEA GT T B.L.)
C   STORE TENDENCY INTO BOUNDARY LAYER WS LNEW FIELD
C
       CALL DSXY2N(VT(1,1,22),WS(1,1,K3OLD))
       CALL DSXY2N(VT(1,1,19),SATW(1,1,1))
       VT(53,1,19) = 9.E0
       N3IJ = 3 *      2385
C****  WHERE(VT(1,1,22  ;  NIJ).LT.0.E0)
C****A  VT(1,1,18  ;  NIJ) = VT(1,1,22  ;  NIJ)
      DO 88920 IQ2W6E=1,N3IJ
         WS(IQ2W6E,1,K3NEW)=0.E0
88920 CONTINUE
      DO 88930 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,16)=ST(IQ2W6E,1)-273.E0
        VT(IQ2W6E,1,16)=7.5E0*VT(IQ2W6E,1,16)/(VT(IQ2W6E,1,16)+237.3)
88930 CONTINUE
C****  WHERE(VABS(VT(1,1,16  ;  NIJ)  ;  NIJ).GT.4.E0)
C****A  VT(1,1,16  ;  NIJ) = 4.E0
         IQ2W6E=IQ2W6E
      DO 88950 IQ2W6E=1,NIJ
         IF(.NOT.(ABS(VT(1,1,16)).GT.4.E0))GO TO 88950
         VT(IQ2W6E,1,16)=4.E0
88950 CONTINUE
         IQ2W6E=IQ2W6E
      DO 88960 IQ2W6E = 1,NIJ
         VT(IQ2W6E,1,20) = 6.11*10.0**(VT(IQ2W6E,1,16))
88960 CONTINUE
C
C   31.683673E0 BELOW IS ACTUALLY EQUAL TO 50.0/.98 * 0.621
C
      DO 88970 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,21)=31.683673E0*VT(IQ2W6E,1,20)/(1013.E0-.379E0*V
     *   T(IQ2W6E,1,20))*SATRH
         VT(IQ2W6E,1,23)=VT(IQ2W6E,1,22)/VT(IQ2W6E,1,19)
         VT(IQ2W6E,1,19)=.2E0*VT(IQ2W6E,1,17)*(VT(IQ2W6E,1,22)-VT
     *   (IQ2W6E,1,21))
88970 CONTINUE
         IQ2W6E=IQ2W6E
      DO 89000 IQ2W6E=1,NIJ
         IF(.NOT.(VT(IQ2W6E,1,18).LT..0E0.AND.VT(IQ2W6E,1,23).LE..7E0.
     *   AND.VT(IQ2W6E,1,19).LT.0.E0))GO TO 89000
         WS(IQ2W6E,1,K3NEW)=-DT*VT(IQ2W6E,1,19)
89000 CONTINUE
         IQ2W6E=IQ2W6E
C
C   FIRST CALCULATE THE VERTICAL ADVECTION TERMS FOR TS AND WS
C   TS STORED IN VT(1,1,16)
C   WS STORED IN VT(1,1,17)
C   VT(1,1,24) AND VT(1,1,25) WILL BE USED FOR HOLDING THE LOWER
C   LAYER VALUES UNTIL THE COMPLETION OF THE MASS FORCAST....
C   TOP OF BOUNDARY LAYER IS DONE HERE WHILE K IS STILL EQUAL TO ONE
C
C****  WHERE(VT(1,1,18  ;  NIJ).LT..0E0.AND.
C****A       VT(1,1,23  ;  NIJ).LE..7E0 .AND.
C****B       VT(1,1,19  ;  NIJ).LT.0.E0)
C****C       WS(1,1,K3NEW  ;  NIJ) = -DT*VT(1,1,19  ;  NIJ)
C****1  (VT(1,1,KL+5  ;  NIJ)-VT(1,1,KH+5  ;  NIJ)) *
C****A              DTDS0 / 2.E0
C****  VT(1,1,20  ;  NIJ)=BTHICK/VT(1,1,10  ;  NIJ)
      DO 89010 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,16)=SIGDOT(IQ2W6E,1,1)*(VT(IQ2W6E,1,KL+5)-VT
     *   (IQ2W6E,1,KH+5))*DTDS0/2.E0
         VT(IQ2W6E,1,20)=BTHICK/VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,21)=BTHICK/(BTHICK+VT(IQ2W6E,1,10))
         VT(IQ2W6E,1,17)=-SIGDOT(IQ2W6E,1,1)*(VT(IQ2W6E,1,20)*VT(
     *   IQ2W6E,1,KH+7)+VT(IQ2W6E,1,KL+7)/VT(IQ2W6E,1,20))*VT(IQ2W6E,1
     *   ,21)*DT
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,16)*6.E0*BTHK3/VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,25)=-VT(IQ2W6E,1,17)
89010 CONTINUE
       GO TO 200
100    CONTINUE
      DO 89070 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,18)=0.0
89070 CONTINUE
C
C   VERTICAL ADVECTION FOR K = 2,3,4,5,6,7
C   VT( 24 AND 25 ) ALREADY CONTAIN THE LOWER LAYER VALUES
C
       GO TO (20,20,30,40,50,60,70),K
20     CONTINUE
      DO 89080 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,20)=SIGDOT(IQ2W6E,1,2)*(VT(IQ2W6E,1,KL+5)-VT
     *   (IQ2W6E,1,KH+5))*DTDS1
         VT(IQ2W6E,1,16)=(VT(IQ2W6E,1,20)+VT(IQ2W6E,1,24))*0.5E0
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,20)
         VT(IQ2W6E,1,21)=SIGDOT(IQ2W6E,1,2)*(VT(IQ2W6E,1,KL+7)+VT
     *   (IQ2W6E,1,KH+7))*1.5E0*DT
         VT(IQ2W6E,1,17)=VT(IQ2W6E,1,25)-VT(IQ2W6E,1,21)
         VT(IQ2W6E,1,25)=VT(IQ2W6E,1,21)
89080 CONTINUE
       GO TO 200
30     CONTINUE
      DO 89140 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,20)=SIGDOT(IQ2W6E,1,3)*(VT(IQ2W6E,1,KL+5)-VT
     *   (IQ2W6E,1,KH+5))*DTDS1
         VT(IQ2W6E,1,16)=(VT(IQ2W6E,1,20)+VT(IQ2W6E,1,24))*.5E0
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,20)
         VT(IQ2W6E,1,17)=VT(IQ2W6E,1,25)
89140 CONTINUE
       GO TO 200
40     CONTINUE
      DO 89180 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,16)=VT(IQ2W6E,1,24)*.5E0
         VT(IQ2W6E,1,24)=0.E0
89180 CONTINUE
       GO TO 200
50     CONTINUE
60     CONTINUE
      DO 89200 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,20)=SIGDOT(IQ2W6E,1,K-1)*(VT(IQ2W6E,1,KL+5)-
     *   VT(IQ2W6E,1,KH+5))*DTDS2
         VT(IQ2W6E,1,16)=(VT(IQ2W6E,1,20)+VT(IQ2W6E,1,24))*.5E0
         VT(IQ2W6E,1,24)=VT(IQ2W6E,1,20)
89200 CONTINUE
       GO TO 200
70     CONTINUE
      DO 89230 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,16)=VT(IQ2W6E,1,24)*.5E0
89230 CONTINUE
200    CONTINUE
C
C  CALCULATE TS AND WS TENDENCIES AND STORE AT THE LNEW LEVEL
C
C  NEED DT/DX AND DT/DY FOR T TENDENCY
C
        CALL DSXDY(VT(1,1,20),TS(1,1,K7MID))
        CALL DSYDX(VT(1,1,21),TS(1,1,K7MID))
        IF( K .GT. 3 ) GO TO 300
      DO 89240 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,22)=DTDX*VT(IQ2W6E,1,1)
         TS(IQ2W6E,1,K7NEW)=-VT(IQ2W6E,1,16)-VT(IQ2W6E,1,22)*(VT(
     *   IQ2W6E,1,KL+1)*VT(IQ2W6E,1,21)+VT(IQ2W6E,1,KL+3)*VT(IQ2W6E,1,
     *   20))-DT*H2(IQ2W6E,1,K)-DT*VT(IQ2W6E,1,18)
89240 CONTINUE
C
C  NEED DW/DX, DW/DY AND DIVERGENCE FOR WS TENDENCY
C
       CALL DSXDY(VT(1,1,20),VS(1,1,K7MID))
       CALL DSYDX(VT(1,1,21),US(1,1,K7MID))
       CALL DSXDY(VT(1,1,22),WS(1,1,K3MID+K-1))
       CALL DSYDX(VT(1,1,23),WS(1,1,K3MID+K-1))
      DO 89260 IQ2W6E=1,NIJ
         WS(IQ2W6E,1,K3NEW+K-1)=-VT(IQ2W6E,1,17)-DTDX*VT(IQ2W6E,1,1)*(
     *   VT(IQ2W6E,1,KL+1)*VT(IQ2W6E,1,23)+VT(IQ2W6E,1,KL+3)*VT(IQ2W6E
     *   ,1,22)+VT(IQ2W6E,1,KL+7)*(VT(IQ2W6E,1,20)+VT(IQ2W6E,1,21)))+W
     *   S(IQ2W6E,1,K3NEW+K-1)
89260 CONTINUE

       GO TO 900
300    CONTINUE
      DO 89270 IQ2W6E=1,NIJ
         TS(IQ2W6E,1,K7NEW)=-VT(IQ2W6E,1,16)-DTDX*VT(IQ2W6E,1,1)*
     *   (VT(IQ2W6E,1,KL+1)*VT(IQ2W6E,1,21)+VT(IQ2W6E,1,KL+3)*VT(
     *   IQ2W6E,1,20))-DT*1.6667E-5
89270 CONTINUE
900    RETURN
       END
