       SUBROUTINE TEND3
C$$$   SUBPROGRAM  DOCUMENTATION  BLOCK
C
C SUBPROGRAM: TEND3          COMPUTES D(SIGMA)/DT AND D(PSIG)/DT
C   AUTHOR: DENNIS DEAVEN    ORG: W/NMC23    DATE: 21 JUN 83
C
C ABSTRACT: COMPUTES FIVE INTERFACE VALUES OF SIGMADOT AND THE
C   TWO TIME TENDENCIES OF DP/D(SIGMA) (PSIG).
C
C USAGE:  CALL TEND3
C
C - - - - - - - - - I N P U T   V A R I A B L E S  - - - - - - - - -
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     K,KL,KH..   LAYER POINTERS                            /INDEX/
C     US,VS...    ALL FORECAST VARIABLES PLUS FIXED FIELDS  /DEABLK/
C
C - - - - - - - - - O U T P U T   V A R I A B L E S - - - - - - - - - -
C     NAMES       MEANING/CONTENT/PURPOSE/UNITS/TYPE        INTERFACE
C     -----       ----------------------------------        ---------
C     SIGDOT      D(SIGMA)/DT FOR FIVE LAYERS               /VTEMP/
C     PSIG        PSIG TENDENCIES (TWO) STORED AT K2NEW LEV /DEABLK/
C     VT(1,1,1)   MAP SCALE BAR XY                          /VTEMP/
C     VT(1,1,10)  PSIG TROP BAR XY                            DITTO
C     VT(1,1,11)  PSIG STRAT BAR XY                           DITTO
C     VT(1,1,12)  D(PSIG)/DX BAR Y  TROP                      DITTO
C     VT(1,1,13)        DITTO       STRAT                     DITTO
C     VT(1,1,14)  D(PSIG)/DY BAR X  TROP                      DITTO
C     VT(1,1,15)        DITTO       STRAT                     DITTO
C 
C - - - - - - - - - S U B P R O G R A M S   C A L L E D - - - - - - - -
C     NAME(S)                                               LIBRARY
C     -------                                               -------
C     DSXY,DSXDY,DSYDX                                      LFM LIB
C
C - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
C ATTRIBUTES:
C   LANGUAGE: SiliconGraphics 3.5 FORTRAN 77
C   MACHINE:  SiliconGraphics IRIS-4D/25, 35, INDIGO
C$$$
C
      IMPLICIT    REAL (A-H,O-Z)
      REAL        HOUR1
      REAL        ICE, MF
      CHARACTER*4 LABSIN,LABBND,LABS00,LABS06,LABS12,LABV06,LABV12
      COMMON /VTEMP/ SIGDOT( 53 , 45 ,5 ), VT( 53 , 45 ,25 )
      COMMON /DEABLK/ US( 53 , 45 , 21 ),
     A     VS( 53 , 45 , 21 ),
     1     TS( 53 , 45 , 21 ), PSIG( 53 , 45 ,6),
     2     ST( 53 , 45 ),ICE( 53 , 45 ),
     3     COSZEN( 53 , 45 ),XM( 53 , 45 ),
     4     F( 53 , 45 ),CD( 53 , 45 ),
     5     SATW( 53 , 45 ,3),WS( 53 , 45 ,9 ),
     6     PREC( 53 , 45 ),ZSTAR( 53 , 45 ),
     7     ALON( 53 , 45 ),ALAT( 53 , 45 ),
     8     MF( 53 , 45 ),H2( 53 , 45 ,3 )
      COMMON /VERTV/ IVVEL( 53 , 45 ,8 )
      COMMON /CNST/ BTHICK,BTHIK1,BTHK3,DT,RDELX,
     1              DTDS0,DTDS1,DTDS2,DTDX,DS1DX,DS2DX,
     2              CP,R,ROCP,TSTRAT,CPTS,SATRH,RSAT60,
     3              RDT,BTHICH,BTHK3H,BTK398,RBT,A1BRN,
     4              A2BRN,TDTDX4,RPK,VVCNST
      COMMON /DIAG/ SUMK(8),SUMP1(8),SUMP2(8),SUMS(8),SUMF(8),SUMFD(8),
     1     SUMVOR(8),SUMDIV(8),DP(8),SUMP(8),SUMTS(8),SUMZ(8),
     2     SIGB1,SIGT1,SIGT2,SIGS1,SIGS2,RMSSFC,RMSTRP
      COMMON /FASTER/ PIE(1100),AX(120)
      COMMON /INDEX/ LI,LJ,LK,LI1,LJ1,LK1,LI2,NIJ,LOLD,LMID,LNEW,
     1     K7OLD,K7MID,K7NEW,K3OLD,K3MID,K3NEW,K2OLD,K2MID,K2NEW,
     2     K,K1,K2,K3,KL,KH
      COMMON /FDATE/  IYEAR, IMO, IDAYMO, IZTIME, IHR1, IOUT
      COMMON /SVHOUR/ NWDS, IHOUR1( 1205 ), HOUR1(8)
      COMMON /TTME/   MNSTEP,IODD,IHOUR,IMONTH,ITSW,IVEL,NPHOUR,
     1                SSLDC,CSLDC,SSLHR,CSLHR,SHR,CHR,
     2                ALP,XDAYMO
      COMMON /FORTAP/ LUNBND,LUNSIN,LUNS00,LUNS06,LUNS12,LUNV06,LUNV12,
     A                LABSIN(8),LABBND(8),LABS00(8),LABS06(8),LABS12(8),
     B                LABV06(8),LABV12(8),PARM(25)
      COMMON /PBNDPE/ ALARGE( 53, 12, 23 ), BLARGE( 12, 33, 23 )
      COMMON /PBNDRY/ AA( 53, 12, 23 ), BB( 12, 33, 23 )
      SAVE
C----------------------------------------------------------------------
C COMPUTES THE FIVE SIGMA DOT FIELDS AND STORES THEM IN SIGDOT(1,1,1-5)
C   INTERFACE INDEXES MAP INTO SIGDOT AS FOLLOWS:
C     INTERFACE  INDEX
C     ---------  -----
C           2 INTO 1
C           3 INTO 2
C           4 INTO 3
C           6 INTO 4
C           7 INTO 5
C----------------------------------------------------------------------
C   NEED SUMS OF U,V AND DIVERGENCE FOR TROPOSPHERE AND STRATOSPHERE
C   TO COMPUTE THE PSIG TENDENCIES
C   VALUES ARE STORED AS FOLLOWS:  (LOCAL TO THIS ROUTINE ONLY)
C            SUMU    TROP  VT(20)
C            SUMV    TROP  VT(21)
C            SUMDIV  TROP  VT(22)
C            SUMU    STRAT SIGDOT(3)
C            SUMV    STRAT SIGDOT(4)
C            SUMDIV  STRAT SIGDOT(5)
C----------------------------------------------------------------------
C
C   STORE MAP FACTOR SQUARED BAR XY IN VT(1,1,1) FOR USE LATER
C
       CALL DSXY(VT(1,1,1),MF)
C
C   FORM VERTICAL DERIVATIVE OF U BAR XY AND V BAR XY
C   D(U)/D(SIGMA) INTO VT(1,1,2-5)
C   D(V)/D(SIGMA) INTO VT(1,1,6-9)
C
       CALL DSXY(VT(1,1,10),US(1,1,K7MID+1))
       CALL DSXY(VT(1,1,11),US(1,1,K7MID+2))
       CALL DSXY(VT(1,1,12),VS(1,1,K7MID+1))
       CALL DSXY(VT(1,1,13),VS(1,1,K7MID+2))
      DO 88890 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,20)=VT(IQ2W6E,1,11)+VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,21)=VT(IQ2W6E,1,12)+VT(IQ2W6E,1,13)
         VT(IQ2W6E,1,2)=VT(IQ2W6E,1,10)-VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,6)=VT(IQ2W6E,1,12)-VT(IQ2W6E,1,13)
88890 CONTINUE
       CALL DSXY(VT(1,1,10),US(1,1,K7MID+3))
       CALL DSXY(VT(1,1,12),VS(1,1,K7MID+3))
      DO 88930 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,20)=VT(IQ2W6E,1,20)+VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,21)=VT(IQ2W6E,1,21)+VT(IQ2W6E,1,12)
         VT(IQ2W6E,1,3)=VT(IQ2W6E,1,11)-VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,7)=VT(IQ2W6E,1,13)-VT(IQ2W6E,1,12)
88930 CONTINUE
       CALL DSXY(VT(1,1,10),US(1,1,K7MID+4))
       CALL DSXY(VT(1,1,11),US(1,1,K7MID+5))
       CALL DSXY(VT(1,1,12),VS(1,1,K7MID+4))
       CALL DSXY(VT(1,1,13),VS(1,1,K7MID+5))
      DO 88970 IQ2W6E=1,NIJ
         SIGDOT(IQ2W6E,1,3)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,11)
         SIGDOT(IQ2W6E,1,4)=VT(IQ2W6E,1,12)+VT(IQ2W6E,1,13)
         VT(IQ2W6E,1,4)=VT(IQ2W6E,1,10)-VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,8)=VT(IQ2W6E,1,12)-VT(IQ2W6E,1,13)
88970 CONTINUE
       CALL DSXY(VT(1,1,10),US(1,1,K7MID+6))
       CALL DSXY(VT(1,1,12),VS(1,1,K7MID+6))
      DO 89010 IQ2W6E=1,NIJ
         SIGDOT(IQ2W6E,1,3)=SIGDOT(IQ2W6E,1,3)+VT(IQ2W6E,1,10)
         SIGDOT(IQ2W6E,1,4)=SIGDOT(IQ2W6E,1,4)+VT(IQ2W6E,1,12)
         VT(IQ2W6E,1,5)=VT(IQ2W6E,1,11)-VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,9)=VT(IQ2W6E,1,13)-VT(IQ2W6E,1,12)
89010 CONTINUE
C----------------------------------------------------------------------
C  FORM VERTICAL DERIVATIVES OF DIVERGENCE AND STORE IN VT(1,1,16-19)
C----------------------------------------------------------------------
       CALL DSYDX(VT(1,1,10),US(1,1,K7MID+1))
       CALL DSYDX(VT(1,1,11),US(1,1,K7MID+2))
       CALL DSXDY(VT(1,1,12),VS(1,1,K7MID+1))
       CALL DSXDY(VT(1,1,13),VS(1,1,K7MID+2))
      DO 89050 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,22)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,11)+VT(IQ2W6E,1,1
     *   2)+VT(IQ2W6E,1,13)
         VT(IQ2W6E,1,16)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,12)-VT(IQ2W6E,1,1
     *   1)-VT(IQ2W6E,1,13)
89050 CONTINUE
       CALL DSYDX(VT(1,1,10),US(1,1,K7MID+3))
       CALL DSXDY(VT(1,1,12),VS(1,1,K7MID+3))
      DO 89070 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,22)=VT(IQ2W6E,1,22)+VT(IQ2W6E,1,10)+VT(IQ2W6E,1,1
     *   2)
         VT(IQ2W6E,1,17)=VT(IQ2W6E,1,11)+VT(IQ2W6E,1,13)-VT(IQ2W6E,1,1
     *   0)-VT(IQ2W6E,1,12)
89070 CONTINUE
       CALL DSYDX(VT(1,1,10),US(1,1,K7MID+4))
       CALL DSYDX(VT(1,1,11),US(1,1,K7MID+5))
       CALL DSXDY(VT(1,1,12),VS(1,1,K7MID+4))
       CALL DSXDY(VT(1,1,13),VS(1,1,K7MID+5))
      DO 89090 IQ2W6E=1,NIJ
         SIGDOT(IQ2W6E,1,5)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,11)+VT(IQ2W6E,
     *   1,12)+VT(IQ2W6E,1,13)
         VT(IQ2W6E,1,18)=VT(IQ2W6E,1,10)+VT(IQ2W6E,1,12)-VT(IQ2W6E,1,1
     *   1)-VT(IQ2W6E,1,13)
89090 CONTINUE
       CALL DSYDX(VT(1,1,10),US(1,1,K7MID+6))
       CALL DSXDY(VT(1,1,12),VS(1,1,K7MID+6))
      DO 89110 IQ2W6E=1,NIJ
         SIGDOT(IQ2W6E,1,5)=SIGDOT(IQ2W6E,1,5)+VT(IQ2W6E,1,10)+VT
     *   (IQ2W6E,1,12)
         VT(IQ2W6E,1,19)=VT(IQ2W6E,1,11)+VT(IQ2W6E,1,13)-VT(IQ2W6E,1,1
     *   0)-VT(IQ2W6E,1,12)
89110 CONTINUE
C----------------------------------------------------------------------
C  FORM THE SECND VERTICAL DERIVATIVE OF SIGMA DOT (ZETA) FROM THE
C  CONTINUITY EQUATION AND STORE IN VT(1,1,2-5)
C----------------------------------------------------------------------
C  FIRST COMPUTE PSIG BAR XY, D(PSIG)/DX AND D(PSIG)/DY
C
       N6IJ = 6 *      2385
      DO 89130 IQ2W6E=1,N6IJ
         VT(IQ2W6E,1,10)=99.E0
89130 CONTINUE
       CALL DSXY(VT(1,1,10),PSIG(1,1,K2MID))
       CALL DSXY(VT(1,1,11),PSIG(1,1,K2MID+1))
       CALL DSYDX(VT(1,1,12),PSIG(1,1,K2MID))
       CALL DSYDX(VT(1,1,13),PSIG(1,1,K2MID+1))
       CALL DSXDY(VT(1,1,14),PSIG(1,1,K2MID))
       CALL DSXDY(VT(1,1,15),PSIG(1,1,K2MID+1))
C
C   NOW FORM THE VERTICAL SECOND DIFFERENCE
C
      DO 89140 IQ2W6E=1,NIJ
         VT(IQ2W6E,1,2)=-DS1DX*VT(IQ2W6E,1,1)*((VT(IQ2W6E,1,16)*V
     *   T(IQ2W6E,1,10)+VT(IQ2W6E,1,2)*VT(IQ2W6E,1,12)+VT(IQ2W6E,1,6)*
     *   VT(IQ2W6E,1,14)))/VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,3)=-DS1DX*VT(IQ2W6E,1,1)*((VT(IQ2W6E,1,17)*V
     *   T(IQ2W6E,1,10)+VT(IQ2W6E,1,3)*VT(IQ2W6E,1,12)+VT(IQ2W6E,1,7)*
     *   VT(IQ2W6E,1,14)))/VT(IQ2W6E,1,10)
         VT(IQ2W6E,1,4)=-DS2DX*VT(IQ2W6E,1,1)*((VT(IQ2W6E,1,18)*V
     *   T(IQ2W6E,1,11)+VT(IQ2W6E,1,4)*VT(IQ2W6E,1,13)+VT(IQ2W6E,1,8)*
     *   VT(IQ2W6E,1,15)))/VT(IQ2W6E,1,11)
         VT(IQ2W6E,1,5)=-DS2DX*VT(IQ2W6E,1,1)*((VT(IQ2W6E,1,19)*V
     *   T(IQ2W6E,1,11)+VT(IQ2W6E,1,5)*VT(IQ2W6E,1,13)+VT(IQ2W6E,1,9)*
     *   VT(IQ2W6E,1,15)))/VT(IQ2W6E,1,11)
89140 CONTINUE
C
C  FINALLY CALCULATE THE SIGDOTS AND PSIG TENDENCIES
C  NEED BOUNDARY LAYER DIVERGENCE FOR SIGDOT(2)
C  WHICH WILL BE STORED IN SIGDOT(1)   (SEE ABOVE INDEX MAP)
C
       CALL DSYDX(VT(1,1,6),US(1,1,K7MID))
       CALL DSXDY(VT(1,1,7),VS(1,1,K7MID))
      DO 89180 IQ2W6E=1,NIJ
         SIGDOT(IQ2W6E,1,1)=RDELX*(VT(IQ2W6E,1,6)+VT(IQ2W6E,1,7))
     *   *VT(IQ2W6E,1,1)
         VT(IQ2W6E,1,8)=BTHK3/VT(IQ2W6E,1,10)*SIGDOT(IQ2W6E,1,1)
         VT(IQ2W6E,1,23)=DTDX*VT(IQ2W6E,1,1)
         PSIG(IQ2W6E,1,K2NEW)=0.33333333333E0*(-DTDS1*VT(IQ2W6E,1,10)*
     *   VT(IQ2W6E,1,8)-VT(IQ2W6E,1,23)*(VT(IQ2W6E,1,20)*VT(IQ2W6E,1,1
     *   2)+VT(IQ2W6E,1,21)*VT(IQ2W6E,1,14)+VT(IQ2W6E,1,10)*VT(IQ2W6E,
     *   1,22)))
         PSIG(IQ2W6E,1,K2NEW+1)=(-0.3333333E0*(VT(IQ2W6E,1,23)*(SIGDOT
     *   (IQ2W6E,1,3)*VT(IQ2W6E,1,13)+SIGDOT(IQ2W6E,1,4)*VT(IQ2W6E,1,1
     *   5)+VT(IQ2W6E,1,11)*SIGDOT(IQ2W6E,1,5))))
         SIGDOT(IQ2W6E,1,2)=0.33333333E0*(-VT(IQ2W6E,1,3)+2.E0*(-
     *   VT(IQ2W6E,1,2)+VT(IQ2W6E,1,8)))
         SIGDOT(IQ2W6E,1,3)=VT(IQ2W6E,1,2)+2.E0*SIGDOT(IQ2W6E,1,2)-VT(
     *   IQ2W6E,1,8)
         SIGDOT(IQ2W6E,1,4)=0.33333333E0*(-VT(IQ2W6E,1,5)+2.E0*(-
     *   VT(IQ2W6E,1,4)))
         SIGDOT(IQ2W6E,1,5)=VT(IQ2W6E,1,4)+2.E0*SIGDOT(IQ2W6E,1,4)
89180 CONTINUE
       RETURN
       END
