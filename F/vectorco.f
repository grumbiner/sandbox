      SUBROUTINE VCC(X1,Y1,X2,Y2,NS,R2)
C
C   PROGRAM IN FORTRAN 77 TO CALCULATE THE VECTOR CORRELATION
C   COEFFICIENT OF JUPP AND MARDIA(BIOMETRIKA,1980).
C
C   THE FOLLOWING PROGRAM CALCULATES THE VECTOR CORRELATION BETWEEN
C   SEQUENCES OF TWO-DIMENSIONAL VECTORS. THESE VECTORS MUST BE
C   SPECIFIED IN TERMS OF THEIR U(X1,Y1) AND V(X2,Y2) COMPONENTS.
C   FOR TWO-DIMENSIONAL VECTORS, THE VECTOR CORRELATION COEFFICIENT
C   (SQUARED) WILL VARY BETWEEN 0.0(UNCORRELATED) AND 2.0
C   (COMPLETELY CORRELATED).
C
C   VECTOR CORRELATION COEFFICIENTS CALCULATED ACCORDING TO THE
C   FOLLOWING PROGRAM SHOULD BE ACCURATE TO AT LEAST THREE DECIMAL
C   PLACES USING SINGLE PRECISION ARITHMETIC.
C
C   NS IS THE SAMPLE SIZE - SAMPLE SIZES LESS THAN 8 ARE NOT
C   RECOMMENDED BECAUSE THE ASYMPTOTIC CHI-SQUARE DISTRIBUTION
C   BREAKS DOWN FOR SMALLER VALUES.
C
      REAL*4 VAR1,VAR2,VAR3,VAR4,COV12,COV13,COV14,COV23,COV24,
     *COV34,X1(NS),Y1(NS),X2(NS),Y2(NS),R2
C
        CALL STAT1(X1,Y1,X2,Y2,NS,VAR1,VAR2,COV12)
        CALL STAT2(X1,Y1,X2,Y2,NS,VAR1,VAR3,COV13)
        CALL STAT3(X1,Y1,X2,Y2,NS,VAR1,VAR4,COV14)
        CALL STAT4(X1,Y1,X2,Y2,NS,VAR2,VAR3,COV23)
        CALL STAT5(X1,Y1,X2,Y2,NS,VAR2,VAR4,COV24)
        CALL STAT6(X1,Y1,X2,Y2,NS,VAR3,VAR4,COV34)
        CALL RSQ(VAR1,VAR2,VAR3,VAR4,COV12,COV13,COV14,COV23,
     *  COV24,COV34,R2)
      STOP
      END
      SUBROUTINE STAT1(X1,Y1,X2,Y2,NS,VAR1,VAR2,COV12)
      REAL*4 VAR1,VAR2,COV12,SUMX1,SUMY1,SX1SQ,SY1SQ,SX1Y1,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMX1 = 0.0
      SUMY1 = 0.0
      SX1SQ = 0.0
      SY1SQ = 0.0
      SX1Y1 = 0.0
      DO 100 I = 1,NS
        SUMX1 = SUMX1 + X1(I)
        SUMY1 = SUMY1 + Y1(I)
        SX1SQ = SX1SQ + X1(I)*X1(I)
        SY1SQ = SY1SQ + Y1(I)*Y1(I)
        SX1Y1 = SX1Y1 + X1(I)*Y1(I)
  100 CONTINUE
      VAR1 = (FLOAT(NS) * SX1SQ - SUMX1 * SUMX1) / FLOAT(NS * (NS - 1))
      VAR2 = (FLOAT(NS) * SY1SQ - SUMY1 * SUMY1) / FLOAT(NS * (NS - 1))
      COV12 = (FLOAT(NS) * SX1Y1 - SUMX1 * SUMY1) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE STAT2(X1,Y1,X2,Y2,NS,VAR1,VAR3,COV13)
      REAL*4 VAR1,VAR3,COV13,SUMX1,SUMX2,SX1SQ,SX2SQ,SX1X2,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMX1 = 0.0
      SUMX2 = 0.0
      SX1SQ = 0.0
      SX2SQ = 0.0
      SX1X2 = 0.0
      DO 100 I = 1,NS
        SUMX1 = SUMX1 + X1(I)
        SUMX2 = SUMX2 + X2(I)
        SX1SQ = SX1SQ + X1(I)*X1(I)
        SX2SQ = SX2SQ + X2(I)*X2(I)
        SX1X2 = SX1X2 + X1(I)*X2(I)
  100 CONTINUE
      VAR1 = (FLOAT(NS) * SX1SQ - SUMX1 * SUMX1) / FLOAT(NS * (NS - 1))
      VAR3 = (FLOAT(NS) * SX2SQ - SUMX2 * SUMX2) / FLOAT(NS * (NS - 1))
      COV13 = (FLOAT(NS) * SX1X2 - SUMX1 * SUMX2) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE STAT3(X1,Y1,X2,Y2,NS,VAR1,VAR4,COV14)
      REAL*4 VAR1,VAR4,COV14,SUMX1,SUMY2,SX1SQ,SY2SQ,SX1Y2,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMX1 = 0.0
      SUMY2 = 0.0
      SX1SQ = 0.0
      SY2SQ = 0.0
      SX1Y2 = 0.0
      DO 100 I = 1,NS
        SUMX1 = SUMX1 + X1(I)
        SUMY2 = SUMY2 + Y2(I)
        SX1SQ = SX1SQ + X1(I)*X1(I)
        SY2SQ = SY2SQ + Y2(I)*Y2(I)
        SX1Y2 = SX1Y2 + X1(I)*Y2(I)
  100 CONTINUE
      VAR1 = (FLOAT(NS) * SX1SQ - SUMX1 * SUMX1) / FLOAT(NS * (NS - 1))
      VAR4 = (FLOAT(NS) * SY2SQ - SUMY2 * SUMY2) / FLOAT(NS * (NS - 1))
      COV14 = (FLOAT(NS) * SX1Y2 - SUMX1 * SUMY2) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE STAT4(X1,Y1,X2,Y2,NS,VAR2,VAR3,COV23)
      REAL*4 VAR2,VAR3,COV23,SUMY1,SUMX2,SY1SQ,SX2SQ,SY1X2,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMY1 = 0.0
      SUMX2 = 0.0
      SY1SQ = 0.0
      SX2SQ = 0.0
      SY1X2 = 0.0
      DO 100 I = 1,NS
        SUMY1 = SUMY1 + Y1(I)
        SUMX2 = SUMX2 + X2(I)
        SY1SQ = SY1SQ + Y1(I)*Y1(I)
        SX2SQ = SX2SQ + X2(I)*X2(I)
        SY1X2 = SY1X2 + Y1(I)*X2(I)
  100 CONTINUE
      VAR2 = (FLOAT(NS) * SY1SQ - SUMY1 * SUMY1) / FLOAT(NS * (NS - 1))
      VAR3 = (FLOAT(NS) * SX2SQ - SUMX2 * SUMX2) / FLOAT(NS * (NS - 1))
      COV23 = (FLOAT(NS) * SY1X2 - SUMY1 * SUMX2) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE STAT5(X1,Y1,X2,Y2,NS,VAR2,VAR4,COV24)
      REAL*4 VAR2,VAR4,COV24,SUMY1,SUMY2,SY1SQ,SY2SQ,SY1Y2,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMY1 = 0.0
      SUMY2 = 0.0
      SY1SQ = 0.0
      SY2SQ = 0.0
      SY1Y2 = 0.0
      DO 100 I = 1,NS
        SUMY1 = SUMY1 + Y1(I)
        SUMY2 = SUMY2 + Y2(I)
        SY1SQ = SY1SQ + Y1(I)*Y1(I)
        SY2SQ = SY2SQ + Y2(I)*Y2(I)
        SY1Y2 = SY1Y2 + Y1(I)*Y2(I)
  100 CONTINUE
      VAR2 = (FLOAT(NS) * SY1SQ - SUMY1 * SUMY1) / FLOAT(NS * (NS - 1))
      VAR4 = (FLOAT(NS) * SY2SQ - SUMY2 * SUMY2) / FLOAT(NS * (NS - 1))
      COV24 = (FLOAT(NS) * SY1Y2 - SUMY1 * SUMY2) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE STAT6(X1,Y1,X2,Y2,NS,VAR3,VAR4,COV34)
      REAL*4 VAR3,VAR4,COV34,SUMX2,SUMY2,SX2SQ,SY2SQ,SX2Y2,
     *X1(*),Y1(*),X2(*),Y2(*)
      SUMX2 = 0.0
      SUMY2 = 0.0
      SX2SQ = 0.0
      SY2SQ = 0.0
      SX2Y2 = 0.0
      DO 100 I = 1,NS
        SUMX2 = SUMX2 + X2(I)
        SUMY2 = SUMY2 + Y2(I)
        SX2SQ = SX2SQ + X2(I)*X2(I)
        SY2SQ = SY2SQ + Y2(I)*Y2(I)
        SX2Y2 = SX2Y2 + X2(I)*Y2(I)
  100 CONTINUE
      VAR3 = (FLOAT(NS) * SX2SQ - SUMX2 * SUMX2) / FLOAT(NS * (NS - 1))
      VAR4 = (FLOAT(NS) * SY2SQ - SUMY2 * SUMY2) / FLOAT(NS * (NS - 1))
      COV34 = (FLOAT(NS) * SX2Y2 - SUMX2 * SUMY2) / FLOAT(NS * (NS - 1))
      RETURN
      END
      SUBROUTINE RSQ(VAR1,VAR2,VAR3,VAR4,COV12,COV13,COV14,
     *COV23,COV24,COV34,R2)
      REAL*4 R,R2,VAR1,VAR2,VAR3,VAR4,COV12,COV13,COV14,COV23,
     *COV24,COV34,A1,A2,A3,A4,A5,A6,A7,A8,B1,B2,B3,B4,B5,B6,
     *B7,B8,C,D,E,F,G,H,I,J,M,N,T1,T2,U1,U2,T,U,P
      A1 = VAR2 * COV13
      A2 = COV12 * COV23
      A3 = VAR4 * COV13
      A4 = COV34 * COV14
      A5 = VAR2 * COV14
      A6 = COV12 * COV24
      A7 = COV34 * COV13
      A8 = VAR3 * COV14
      B1 = COV12 * COV13
      B2 = VAR1 * COV23
      B3 = VAR4 * COV23
      B4 = COV34 * COV24
      B5 = COV12 * COV14
      B6 = VAR1 * COV24
      B7 = COV34 * COV23
      B8 = VAR3 * COV24
      C = A1 - A2
      D = A3 - A4
      E = A5 - A6
      F = A8 - A7
      G = B2 - B1
      H = B3 - B4
      I = B6 - B5
      J = B8 - B7
      M = C*D + E*F
      N = G*H + I*J
      T1 = VAR1 * VAR2
      T2 = COV12 * COV12
      U1 = VAR3 * VAR4
      U2 = COV34 * COV34
      T = T1 - T2
      U = U1 - U2
      P = T * U
      R2 = (M + N)/P
      R = SQRT(R2)
      RETURN
      END
